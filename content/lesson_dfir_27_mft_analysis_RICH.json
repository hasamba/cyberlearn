{
  "lesson_id": "c619bb52-b26f-4c71-ba5a-e7d0d91ace12",
  "domain": "dfir",
  "title": "Master File Table (MFT) Analysis",
  "difficulty": 2,
  "order_index": 27,
  "prerequisites": [
    "6937260f-ab53-4eb9-95b7-435931a16f66"
  ],
  "concepts": [
    "NTFS Master File Table structure and purpose",
    "MFT entry anatomy and attributes",
    "MACB timestamps (Modified, Accessed, Changed, Born)",
    "File reference numbers and parent directory tracking",
    "MFTECmd tool usage for parsing and timeline generation",
    "Deleted file recovery from MFT entries",
    "Timestomping detection and anti-forensics"
  ],
  "estimated_time": 60,
  "learning_objectives": [
    "Understand NTFS Master File Table architecture and forensic significance",
    "Parse MFT with MFTECmd to extract file metadata and timeline",
    "Interpret MACB timestamps for file activity reconstruction",
    "Identify deleted files using MFT entry analysis",
    "Detect timestomping and timestamp manipulation techniques",
    "Build comprehensive filesystem timelines from MFT data",
    "Correlate MFT evidence with execution artifacts (Prefetch, AmCache)"
  ],
  "post_assessment": [
    {
      "question_id": "mft-001",
      "question": "What is the Master File Table (MFT) in NTFS?",
      "options": [
        "A log file that records all file system changes",
        "A database containing metadata for every file and directory on the volume",
        "A backup of deleted files stored by Windows",
        "An index of file contents for search optimization"
      ],
      "correct_answer": 1,
      "explanation": "The Master File Table (MFT) is a structured database file that contains at least one entry (record) for every file and directory on an NTFS volume. Each entry stores metadata including filename, size, timestamps, attributes, and data location.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "mft-002",
      "question": "What does MACB stand for in NTFS timestamp analysis?",
      "options": [
        "Memory, Access, Cache, Boot",
        "Modified, Accessed, Changed, Born",
        "Master, Alternate, Copy, Backup",
        "Metadata, Attribute, Content, Binary"
      ],
      "correct_answer": 1,
      "explanation": "MACB stands for Modified, Accessed, Changed (MFT entry modified), and Born (file creation). These four timestamps are critical for timeline analysis in NTFS forensics. Born time is especially valuable as it cannot be easily modified by standard tools.",
      "type": "multiple_choice",
      "difficulty": 1
    },
    {
      "question_id": "mft-003",
      "question": "What is the typical size of each MFT entry?",
      "options": [
        "512 bytes",
        "1024 bytes (1 KB)",
        "2048 bytes (2 KB)",
        "4096 bytes (4 KB)"
      ],
      "correct_answer": 1,
      "explanation": "Each MFT entry is typically 1024 bytes (1 KB). This fixed size contains all metadata for a file or directory, including attributes, timestamps, and data references. Small files (< 700 bytes) may have their content stored directly in the MFT entry (resident data).",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "mft-004",
      "question": "Which MFT attribute contains the actual file data or pointers to file data?",
      "options": [
        "$STANDARD_INFORMATION",
        "$FILE_NAME",
        "$DATA",
        "$ATTRIBUTE_LIST"
      ],
      "correct_answer": 2,
      "explanation": "$DATA attribute contains either the actual file content (resident data for small files) or pointers to data runs on disk (non-resident data for larger files). This is the attribute that stores or references the file's actual content.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "mft-005",
      "question": "What is timestomping and how can MFT analysis detect it?",
      "options": [
        "Encrypting file timestamps; MFT cannot detect it",
        "Modifying file timestamps to hide activity; detected by comparing $STANDARD_INFORMATION and $FILE_NAME timestamps",
        "Deleting timestamp metadata; detected by checking for missing MFT entries",
        "Compressing timestamp data; detected by analyzing attribute sizes"
      ],
      "correct_answer": 1,
      "explanation": "Timestomping is the anti-forensic technique of modifying file timestamps (usually $STANDARD_INFORMATION timestamps) to hide malicious activity. MFT analysis can detect timestomping by comparing $STANDARD_INFORMATION timestamps (easily modified) with $FILE_NAME timestamps (more difficult to modify), as discrepancies indicate manipulation.",
      "type": "multiple_choice",
      "difficulty": 3
    }
  ],
  "jim_kwik_principles": [
    "teach_like_im_10",
    "memory_hooks",
    "active_learning",
    "connect_to_what_i_know",
    "minimum_effective_dose",
    "meta_learning",
    "reframe_limiting_beliefs",
    "gamify_it",
    "learning_sprint",
    "multiple_memory_pathways"
  ],
  "content_blocks": [
    {
      "type": "mindset_coach",
      "content": {
        "text": "## Welcome to the MFT: NTFS's Complete File History Database\n\nImagine if your computer kept a **permanent ledger** of every file ever created, modified, accessed, or deleted ‚Äî complete with timestamps accurate to 100-nanosecond precision, parent directory tracking, and even deleted file metadata.\n\nThat's the Master File Table (MFT).\n\n**Why is this forensically powerful?**\n\nBecause the MFT is Windows' **ground truth** for filesystem activity:\n\n- ‚úÖ **Every file** has an MFT entry (even deleted files persist)\n- ‚úÖ **Four timestamps** (MACB) reveal creation, modification, access patterns\n- ‚úÖ **Deleted file recovery** (MFT entries remain after file deletion)\n- ‚úÖ **Timestomping detection** (compare $SI vs $FN timestamps)\n- ‚úÖ **Complete timeline** (billions of timestamp events)\n- ‚úÖ **Parent directory tracking** (reconstruct folder structures)\n\nBy the end of this lesson, you'll be using MFT analysis to:\n- Build comprehensive filesystem timelines\n- Detect timestomping (timestamp manipulation)\n- Recover deleted file metadata\n- Prove file creation, modification, access patterns\n- Correlate filesystem events with execution artifacts\n\nThe MFT is NTFS's **complete file history** ‚Äî and now you're learning to read it.\n\nLet's unlock the filesystem's memory!"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "# Master File Table (MFT): NTFS's Central Metadata Database\n\n## What is the Master File Table?\n\nThe **Master File Table (MFT)** is a structured database file that serves as the **central catalog** for all files and directories on an NTFS (New Technology File System) volume. Think of it as a **master index** ‚Äî every file and directory on the volume has at least one entry in the MFT.\n\n### The Official Purpose (Microsoft's Intent)\n\nMicrosoft designed the MFT to:\n1. **Store file metadata**: Filename, size, timestamps, permissions, attributes\n2. **Track file location**: Where file data is stored on disk (cluster addresses)\n3. **Optimize performance**: Quick file lookups without scanning entire disk\n4. **Enable file operations**: Create, read, update, delete operations\n\n### The Forensic Side Effect (Why We Love It)\n\nAs a byproduct of this design, the MFT records:\n- **Complete file history**: Creation, modification, access, deletion timestamps\n- **Deleted file evidence**: MFT entries persist after file deletion\n- **Timestomping detection**: Dual timestamp sets ($SI vs $FN) reveal manipulation\n- **Directory structure**: Parent folder relationships\n- **File size history**: Original and current file sizes\n- **Alternate Data Streams**: Hidden data streams (Zone.Identifier for internet downloads)\n\n**Forensic Impact**: The MFT is a **comprehensive filesystem timeline** ‚Äî it reveals what files existed, when they were created/modified/accessed, and even deleted file metadata.\n\n---\n\n## MFT File Location and Structure\n\n### File Location\n\n```\n$MFT file (special system file)\nTypical location: Beginning of NTFS volume\nFile reference: 0 (MFT itself is entry 0)\n```\n\n**Acquisition**:\n```powershell\n# Using RawCopy (live system)\nRawCopy.exe /FileNamePath:C:\\$MFT /OutputPath:C:\\Forensics\n\n# Using FTK Imager (offline image)\n# Navigate to [root] ‚Üí $MFT ‚Üí Export Files\n```\n\n**File Size**: Proportional to number of files on volume\n- Small volume (10,000 files): ~10 MB MFT\n- Medium volume (100,000 files): ~100 MB MFT\n- Large volume (1,000,000 files): ~1 GB MFT\n\n---\n\n## MFT Entry Structure\n\n### Entry Size and Format\n\n**Standard Entry Size**: 1024 bytes (1 KB) per entry\n\n**Entry Components**:\n```\nMFT Entry (1024 bytes)\n‚îú‚îÄ‚îÄ Header (48 bytes)\n‚îÇ   ‚îú‚îÄ‚îÄ Signature: \"FILE\"\n‚îÇ   ‚îú‚îÄ‚îÄ Sequence Number\n‚îÇ   ‚îú‚îÄ‚îÄ Hard Link Count\n‚îÇ   ‚îú‚îÄ‚îÄ Flags (In Use, Directory)\n‚îÇ   ‚îî‚îÄ‚îÄ Entry Size\n‚îú‚îÄ‚îÄ Attributes (variable size)\n‚îÇ   ‚îú‚îÄ‚îÄ $STANDARD_INFORMATION\n‚îÇ   ‚îú‚îÄ‚îÄ $FILE_NAME\n‚îÇ   ‚îú‚îÄ‚îÄ $DATA\n‚îÇ   ‚îú‚îÄ‚îÄ $ATTRIBUTE_LIST (if needed)\n‚îÇ   ‚îî‚îÄ‚îÄ ... (other attributes)\n‚îî‚îÄ‚îÄ Unused Space (if any)\n```\n\n---\n\n## Key MFT Attributes\n\n### Attribute 0x10: $STANDARD_INFORMATION\n\n**Purpose**: Stores primary file timestamps and attributes\n\n**Contains**:\n- **Created Time** (C in MACB)\n- **Modified Time** (M in MACB)\n- **MFT Modified Time** (aka Changed time, C in MACB)\n- **Accessed Time** (A in MACB)\n- File attributes (Hidden, System, Archive, etc.)\n- Owner ID\n- Security ID\n- Quota charged\n\n**Forensic Significance**: These timestamps are **easily modified** by tools like `timestomp`, `touch`, or Windows API calls. Always compare with $FILE_NAME timestamps.\n\n**Example**:\n```\n$STANDARD_INFORMATION:\n  Created:    2024-10-15 08:23:11.1234567 UTC\n  Modified:   2024-10-16 14:32:45.9876543 UTC\n  MFT Change: 2024-10-16 14:32:45.9876543 UTC\n  Accessed:   2024-10-16 14:35:12.1111111 UTC\n```\n\n---\n\n### Attribute 0x30: $FILE_NAME\n\n**Purpose**: Stores filename and **duplicate timestamps**\n\n**Contains**:\n- Filename (Unicode)\n- Parent directory reference (MFT entry number)\n- **Created Time** (duplicate of $SI)\n- **Modified Time** (duplicate of $SI)\n- **MFT Modified Time** (duplicate of $SI)\n- **Accessed Time** (duplicate of $SI)\n- File size (allocated and real)\n\n**Forensic Significance**: $FILE_NAME timestamps are **more difficult to modify** than $STANDARD_INFORMATION timestamps. Discrepancies between the two indicate **timestomping**.\n\n**Why Harder to Modify?**\n- $FILE_NAME is stored in parent directory's index\n- Modifying requires updating multiple MFT entries\n- Standard tools (timestomp, touch) only modify $STANDARD_INFORMATION\n\n**Timestomping Detection**:\n```\nFile: malware.exe\n\n$STANDARD_INFORMATION (easily modified):\n  Created: 2020-01-01 00:00:00.000 (fake timestamp!)\n  Modified: 2020-01-01 00:00:00.000\n\n$FILE_NAME (harder to modify):\n  Created: 2024-10-16 03:47:21.123 (real timestamp!)\n  Modified: 2024-10-16 03:47:21.123\n\nConclusion: Timestomping detected! File was actually created Oct 16, 2024.\n```\n\n---\n\n### Attribute 0x80: $DATA\n\n**Purpose**: Contains actual file data or pointers to file data\n\n**Two Types**:\n\n**1. Resident Data** (small files < ~700 bytes):\n- File content stored **directly in MFT entry**\n- Faster access (no need to seek to data clusters)\n- Example: Small .txt files, .lnk shortcut files\n\n**2. Non-Resident Data** (larger files):\n- MFT entry contains **data runs** (pointers to clusters on disk)\n- Data runs specify:\n  - Starting cluster address\n  - Number of clusters\n  - Compression/encryption flags\n\n**Forensic Use**:\n- Resident data: Recover small file contents directly from MFT\n- Non-resident: Identify file fragmentation patterns\n\n**Alternate Data Streams (ADS)**:\n- Multiple $DATA attributes with different names\n- Example: `file.txt:Zone.Identifier` (marks internet downloads)\n\n```\n$DATA (unnamed) - Main file content\n$DATA (Zone.Identifier) - ADS marking file origin\n```\n\n**Forensic Significance**: Zone.Identifier ADS proves file was downloaded from internet.\n\n---\n\n### Attribute 0x20: $ATTRIBUTE_LIST\n\n**Purpose**: Lists all attributes when they don't fit in one MFT entry\n\n**When Used**:\n- File has many hard links (multiple filenames)\n- File has many alternate data streams\n- File attributes exceed 1024 bytes\n\n**Forensic Impact**: Indicates complex file structures or many ADS (possible data hiding).\n\n---\n\n## MACB Timestamps Explained\n\nMACB is the forensic acronym for the four primary NTFS timestamps:\n\n### M - Modified Time\n\n**Tracks**: When file **content** was last modified\n\n**Updates When**:\n- File data is written/changed\n- File is saved in an editor\n- Data is appended to file\n\n**Example**:\n```\nmalware.exe created: 2024-10-15 08:00:00\nmalware.exe content edited: 2024-10-16 14:32:45\n\nModified Time: 2024-10-16 14:32:45 (reflects content change)\n```\n\n---\n\n### A - Accessed Time\n\n**Tracks**: When file was last **read** or accessed\n\n**Updates When**:\n- File is opened for reading\n- File content is viewed\n- Program reads file data\n\n**Important Limitation**: Windows 7+ has **LastAccessTime disabled by default** for performance reasons.\n\n**Check if Enabled**:\n```powershell\nfsutil behavior query disablelastaccess\n\nResult:\nDisableLastAccess = 1 (disabled)\nDisableLastAccess = 0 (enabled - timestamps updated)\n```\n\n**Forensic Impact**: On most modern systems, Accessed time is **unreliable** (may not update).\n\n---\n\n### C - Changed Time (MFT Entry Modified)\n\n**Tracks**: When **MFT entry** (metadata) was last modified\n\n**Updates When**:\n- File renamed\n- Permissions changed\n- Attributes changed (Hidden, System, etc.)\n- File content modified (also updates Modified time)\n\n**Forensic Use**: Reveals metadata changes even if file content unchanged.\n\n**Example**:\n```\nFile renamed: evidence.txt ‚Üí report.txt\nChanged Time: Updates to reflect rename\nModified Time: Unchanged (content not modified)\n```\n\n---\n\n### B - Born Time (Created Time)\n\n**Tracks**: When file was **originally created**\n\n**Updates When**:\n- File is created for first time\n- **NEVER updates** after creation (in theory)\n\n**Forensic Gold**: Born time is the **most reliable** timestamp for determining file origin.\n\n**Exception**: File copy operations:\n- **Copy (Ctrl+C/Ctrl+V)**: New born time (copy is a \"new\" file)\n- **Move (Cut/Paste)**: Preserves original born time (within same volume)\n- **Move (Different volume)**: New born time (cross-volume = copy + delete)\n\n**Timestomping Resistance**: Born time in $FILE_NAME is harder to modify than $STANDARD_INFORMATION timestamps.\n\n---\n\n## MFT Forensics Workflow\n\n### Step 1: Acquire MFT\n\n**Live System Acquisition**:\n```powershell\n# Option 1: RawCopy (forensic tool)\nRawCopy.exe /FileNamePath:C:\\$MFT /OutputPath:C:\\Forensics\\MFT\n\n# Option 2: FTK Imager (GUI)\n# File ‚Üí Add Evidence Item ‚Üí Logical Drive ‚Üí C:\\ ‚Üí Export [root]\\$MFT\n```\n\n**Offline Acquisition** (from forensic image):\n```bash\n# Mount E01 image\newfmount image.E01 /mnt/ewf\n\n# Copy MFT\ndd if=/mnt/ewf/ewf1 of=/cases/evidence/MFT bs=512 skip=0 count=XXX\n# (Calculate count based on MFT size)\n```\n\n---\n\n### Step 2: Parse MFT with MFTECmd\n\n**Tool**: MFTECmd by Eric Zimmerman\n\n**Download**: https://ericzimmerman.github.io/\n\n**Basic Usage**:\n```cmd\n# Parse MFT to CSV\nMFTECmd.exe -f \"C:\\Forensics\\MFT\\$MFT\" --csv \"C:\\Output\" --csvf mft_timeline.csv\n\n# Options:\n# -f = MFT file path\n# --csv = Output directory\n# --csvf = CSV filename\n```\n\n**Output**: CSV file with all MFT entries and MACB timestamps\n\n**CSV Columns**:\n- Entry Number\n- Filename\n- Parent Path\n- File Size\n- Created0x10 (Born time - $STANDARD_INFORMATION)\n- Created0x30 (Born time - $FILE_NAME)\n- Modified0x10\n- Modified0x30\n- Accessed0x10\n- Changed0x10\n- In Use (True = active, False = deleted)\n- IsDirectory\n- Has ADS (Alternate Data Streams)\n\n---\n\n### Step 3: Timeline Analysis\n\n**Open in Timeline Explorer** (Eric Zimmerman):\n```\nTimelineExplorer.exe mft_timeline.csv\n```\n\n**Analysis Tasks**:\n\n1. **Sort by Created0x10** ‚Üí Identify file creation timeline\n2. **Filter by Parent Path** ‚Üí Focus on specific directories (\\Temp, \\Downloads)\n3. **Search for suspicious filenames** ‚Üí malware.exe, mimikatz, psexec\n4. **Filter In Use = False** ‚Üí Find deleted files\n5. **Compare Created0x10 vs Created0x30** ‚Üí Detect timestomping\n\n---\n\n### Step 4: Detect Timestomping\n\n**Automated Detection**:\n\n```powershell\n# Import MFT CSV\n$mft = Import-Csv \"mft_timeline.csv\"\n\n# Find entries where $SI and $FN timestamps differ\n$timestomped = $mft | Where-Object {\n    $si = [datetime]::Parse($_.Created0x10)\n    $fn = [datetime]::Parse($_.Created0x30)\n    \n    # Check if timestamps differ by more than 1 second\n    $diff = ($si - $fn).TotalSeconds\n    [Math]::Abs($diff) -gt 1\n}\n\nif ($timestomped) {\n    Write-Host \"üö® TIMESTOMPING DETECTED:\\n\" -ForegroundColor Red\n    \n    $timestomped | Format-Table @(\n        @{Label=\"Filename\"; Expression={$_.FileName}},\n        @{Label=\"$SI Created\"; Expression={$_.Created0x10}},\n        @{Label=\"$FN Created\"; Expression={$_.Created0x30}},\n        @{Label=\"Parent Path\"; Expression={$_.ParentPath}}\n    )\n}\n```\n\n**Interpretation**:\n- **$SI Created = 2020-01-01**, **$FN Created = 2024-10-16** ‚Üí **Timestomping confirmed**\n- Attacker modified $STANDARD_INFORMATION to fake old timestamp\n- $FILE_NAME reveals true creation date\n\n---\n\n### Step 5: Recover Deleted File Metadata\n\n**Filter for Deleted Files**:\n\n```powershell\n# Filter MFT entries marked as deleted (In Use = False)\n$deleted = $mft | Where-Object { $_.\"In Use\" -eq \"False\" }\n\nWrite-Host \"\\nüóëÔ∏è DELETED FILE METADATA:\\n\"\n\n$deleted | Select-Object -First 20 | Format-Table @(\n    @{Label=\"Filename\"; Expression={$_.FileName}},\n    @{Label=\"Parent Path\"; Expression={$_.ParentPath}},\n    @{Label=\"Size\"; Expression={$_.FileSize}},\n    @{Label=\"Created\"; Expression={$_.Created0x10}},\n    @{Label=\"Modified\"; Expression={$_.Modified0x10}}\n)\n```\n\n**Forensic Value**:\n- Proves file existed (filename, path, size)\n- Shows when file was created and last modified\n- Reveals directory structure\n- May enable file carving if data clusters not overwritten\n\n---\n\n### Step 6: Identify Zone.Identifier (Internet Downloads)\n\n**Filter for Files with Alternate Data Streams**:\n\n```powershell\n# Find entries with ADS (Has ADS = True)\n$ads = $mft | Where-Object { $_.\"Has ADS\" -eq \"True\" }\n\n# Further filter for Zone.Identifier\n$downloads = $ads | Where-Object { $_.FileName -like \"*:Zone.Identifier*\" }\n\nif ($downloads) {\n    Write-Host \"\\nüåê INTERNET DOWNLOADS DETECTED:\\n\" -ForegroundColor Cyan\n    \n    $downloads | Format-Table @(\n        @{Label=\"Original File\"; Expression={$_.FileName -replace \":Zone.Identifier\", \"\"}},\n        @{Label=\"Download Time\"; Expression={$_.Created0x10}},\n        @{Label=\"Path\"; Expression={$_.ParentPath}}\n    )\n}\n```\n\n**Interpretation**: Files with `Zone.Identifier` ADS were downloaded from internet (browsers add this automatically).\n\n---\n\n## Advanced MFT Forensics\n\n### Detecting File Copy vs. Move\n\n**Scenario**: Was file **moved** or **copied**?\n\n**Analysis**:\n\n**Move (within same volume)**:\n- Born time **preserved** (same MFT entry, just parent changed)\n- Example: Move from C:\\Temp to C:\\Documents\n\n**Copy**:\n- **New born time** (new MFT entry created)\n- Example: Copy from C:\\Temp to C:\\Documents\n\n**Move (cross-volume)**:\n- **New born time** (Windows treats as copy + delete)\n- Example: Move from C:\\ to D:\\ (different volumes)\n\n**Forensic Use**: Determine if file was copied (new evidence) or moved (relocated evidence).\n\n---\n\n### Identifying File Execution from MFT\n\n**Limitation**: MFT does NOT prove file **execution** (only creation/modification/access).\n\n**Workaround**: Correlate MFT with execution artifacts:\n\n| MFT Evidence | Execution Artifact | Conclusion |\n|--------------|-------------------|------------|\n| malware.exe created Oct 16 08:23:11 | Prefetch: malware.exe last run Oct 16 08:23:15 | Executed 4 seconds after creation |\n| malware.exe accessed Oct 16 08:23:15 | AmCache: malware.exe first execution Oct 16 08:23:15 | Access timestamp correlates with execution |\n\n**Best Practice**: Use MFT for **timeline**, but rely on Prefetch/AmCache/Shimcache for **execution proof**.\n\n---\n\n### Detecting Data Exfiltration\n\n**Scenario**: Insider threat copied sensitive files to USB\n\n**MFT Evidence**:\n\n```\nFile: C:\\Confidential\\trade_secrets.docx\nModified: 2024-10-15 16:40:11 (last edit)\nAccessed: 2024-10-15 16:45:32 (read for copy)\n\nCorrelate with:\n- USB device connection: Registry USBSTOR (2024-10-15 16:44:21)\n- Robocopy execution: Prefetch (2024-10-15 16:45:30)\n- ZIP creation: 7-Zip AmCache (2024-10-15 16:48:11)\n```\n\n**Timeline**:\n```\n16:40:11 - Document last modified\n16:44:21 - USB device connected\n16:45:30 - Robocopy executed\n16:45:32 - Document accessed (copied)\n16:48:11 - 7-Zip compressed files on USB\n```\n\n**Conclusion**: Document accessed during USB connection window ‚Üí Likely exfiltration.\n\n---\n\n## MFT Limitations\n\n### Limitation 1: No User Attribution\n\nMFT does NOT record **which user** created/modified a file.\n\n**Workaround**: Correlate with:\n- Event Logs (Event ID 4663 - File Access)\n- File ownership (NTFS permissions)\n- Parent directory ($Recycle.Bin\\{User-SID})\n\n---\n\n### Limitation 2: LastAccessTime Disabled\n\nWindows 7+ disables LastAccessTime updates by default (performance optimization).\n\n**Check Status**:\n```cmd\nfsutil behavior query disablelastaccess\n```\n\n**Forensic Impact**: Accessed timestamps unreliable on most systems.\n\n---\n\n### Limitation 3: MFT Entries Reused\n\nDeleted file MFT entries are eventually **reused** for new files.\n\n**Result**: Deleted file metadata may be overwritten.\n\n**Mitigation**: Acquire MFT immediately after incident (before entries reused).\n\n---\n\n### Limitation 4: Timestomping\n\nAttackers can modify $STANDARD_INFORMATION timestamps using tools.\n\n**Detection**: Compare $STANDARD_INFORMATION vs $FILE_NAME timestamps (discrepancies indicate manipulation).\n\n---\n\n## Key Takeaways\n\n1. **MFT = Filesystem Database**: Every file/directory has an MFT entry\n2. **MACB Timestamps**: Modified, Accessed, Changed, Born (four timestamps)\n3. **Dual Timestamps**: $STANDARD_INFORMATION (easily modified) vs $FILE_NAME (harder to modify)\n4. **Timestomping Detection**: Compare $SI vs $FN timestamps\n5. **Deleted Files**: MFT entries persist after deletion (In Use = False)\n6. **Zone.Identifier ADS**: Proves internet downloads\n7. **MFTECmd**: Industry-standard tool for MFT parsing\n8. **Timeline Integration**: Correlate MFT with Prefetch, AmCache, Event Logs\n9. **Born Time**: Most reliable timestamp (harder to fake)\n10. **1024-byte entries**: Each MFT entry is 1 KB\n\n---\n\n## Memory Hook: \"MACB = File Story\"\n\nWhenever you need to understand file activity:\n\n- **M**odified ‚Üí When content changed\n- **A**ccessed ‚Üí When file was read\n- **C**hanged ‚Üí When metadata updated\n- **B**orn ‚Üí When file created\n\n**MACB timestamps tell the file's complete story.**\n\nCombine with execution artifacts (Prefetch, AmCache) for complete timeline!"
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "# Hands-On: MFT Analysis Lab\n\n## Exercise 1: Acquire MFT from Live System\n\n### Using RawCopy (Recommended)\n\n```powershell\n# Download RawCopy from Eric Zimmerman's tools\n# https://ericzimmerman.github.io/\n\n# Create forensics directory\nmkdir C:\\Forensics\\MFT\n\n# Acquire MFT (requires Administrator privileges)\nRawCopy.exe /FileNamePath:C:\\$MFT /OutputPath:C:\\Forensics\\MFT\n\n# Verify acquisition\nGet-Item \"C:\\Forensics\\MFT\\$MFT\"\n\n# Calculate hash for integrity\n$hash = Get-FileHash \"C:\\Forensics\\MFT\\$MFT\" -Algorithm SHA256\nWrite-Host \"MFT SHA-256: $($hash.Hash)\"\n```\n\n**Expected Output**: $MFT file (size varies: 10 MB - 1 GB depending on number of files)\n\n---\n\n## Exercise 2: Parse MFT with MFTECmd\n\n### Download MFTECmd\n\n```powershell\n# Download from Eric Zimmerman's repository\nInvoke-WebRequest -Uri \"https://f001.backblazeb2.com/file/EricZimmermanTools/MFTECmd.zip\" -OutFile \"C:\\Tools\\MFTECmd.zip\"\n\n# Extract\nExpand-Archive \"C:\\Tools\\MFTECmd.zip\" -DestinationPath \"C:\\Tools\\MFTECmd\"\n```\n\n### Parse MFT to CSV\n\n```cmd\ncd C:\\Tools\\MFTECmd\n\n:: Parse MFT\nMFTECmd.exe -f \"C:\\Forensics\\MFT\\$MFT\" --csv \"C:\\Output\" --csvf mft_timeline.csv\n\n:: View first 20 lines\ntype C:\\Output\\mft_timeline.csv | more\n```\n\n**Output**: `mft_timeline.csv` with all MFT entries (typically 10,000 - 1,000,000+ entries)\n\n---\n\n## Exercise 3: Analyze MFT Timeline in PowerShell\n\n```powershell\n# Import MFT CSV\n$mft = Import-Csv \"C:\\Output\\mft_timeline.csv\"\n\n# Count total entries\nWrite-Host \"Total MFT Entries: $($mft.Count)\"\n\n# Count active vs deleted\n$active = ($mft | Where-Object { $_.\"In Use\" -eq \"True\" }).Count\n$deleted = ($mft | Where-Object { $_.\"In Use\" -eq \"False\" }).Count\n\nWrite-Host \"Active Files: $active\"\nWrite-Host \"Deleted Files: $deleted\"\n\n# Count directories\n$directories = ($mft | Where-Object { $_.IsDirectory -eq \"True\" }).Count\nWrite-Host \"Directories: $directories\"\n```\n\n---\n\n## Exercise 4: Detect Timestomping\n\n```powershell\n# Compare $STANDARD_INFORMATION vs $FILE_NAME timestamps\n\n$timestomped = @()\n\nforeach ($entry in $mft) {\n    try {\n        # Parse timestamps\n        $siCreated = [datetime]::Parse($entry.Created0x10)\n        $fnCreated = [datetime]::Parse($entry.Created0x30)\n        \n        # Calculate difference (seconds)\n        $diff = ($siCreated - $fnCreated).TotalSeconds\n        \n        # If difference > 1 second, flag as potential timestomping\n        if ([Math]::Abs($diff) -gt 1) {\n            $timestomped += [PSCustomObject]@{\n                Filename = $entry.FileName\n                Path = $entry.ParentPath\n                SI_Created = $siCreated\n                FN_Created = $fnCreated\n                Difference_Seconds = [Math]::Round($diff, 2)\n            }\n        }\n    } catch {\n        # Skip entries with invalid timestamps\n    }\n}\n\n# Display results\nif ($timestomped.Count -gt 0) {\n    Write-Host \"\\nüö® TIMESTOMPING DETECTED: $($timestomped.Count) files\\n\" -ForegroundColor Red\n    \n    # Show first 10 suspicious entries\n    $timestomped | Sort-Object Difference_Seconds -Descending | \n        Select-Object -First 10 | \n        Format-Table -AutoSize\n    \n    # Export full list\n    $timestomped | Export-Csv \"C:\\Output\\timestomped_files.csv\" -NoTypeInformation\n    Write-Host \"\\nFull list exported to: C:\\Output\\timestomped_files.csv\"\n} else {\n    Write-Host \"‚úÖ No timestomping detected\\n\" -ForegroundColor Green\n}\n```\n\n**Interpretation**: Significant timestamp differences indicate possible timestomping.\n\n---\n\n## Exercise 5: Find Recently Created Files\n\n```powershell\n# Find files created in last 7 days\n$cutoffDate = (Get-Date).AddDays(-7)\n\n$recentFiles = $mft | Where-Object {\n    try {\n        $created = [datetime]::Parse($_.Created0x10)\n        $created -gt $cutoffDate -and $_.\"In Use\" -eq \"True\"\n    } catch {\n        $false\n    }\n}\n\nWrite-Host \"\\nüìÖ FILES CREATED IN LAST 7 DAYS: $($recentFiles.Count)\\n\" -ForegroundColor Cyan\n\n# Display summary by directory\n$recentFiles | Group-Object ParentPath | \n    Sort-Object Count -Descending | \n    Select-Object -First 10 @(\n        @{Name=\"Directory\"; Expression={$_.Name}},\n        @{Name=\"File Count\"; Expression={$_.Count}}\n    ) | Format-Table -AutoSize\n```\n\n---\n\n## Exercise 6: Identify Deleted Files\n\n```powershell\n# Filter for deleted files (In Use = False)\n$deleted = $mft | Where-Object { $_.\"In Use\" -eq \"False\" }\n\nWrite-Host \"\\nüóëÔ∏è DELETED FILE METADATA: $($deleted.Count) entries\\n\" -ForegroundColor Yellow\n\n# Focus on recently deleted files (deleted in last 30 days)\n$recentlyDeleted = $deleted | Where-Object {\n    try {\n        $modified = [datetime]::Parse($_.Modified0x10)\n        $modified -gt (Get-Date).AddDays(-30)\n    } catch {\n        $false\n    }\n}\n\nWrite-Host \"Recently Deleted (last 30 days): $($recentlyDeleted.Count)\\n\"\n\n# Show largest deleted files\n$recentlyDeleted | Sort-Object {[long]$_.FileSize} -Descending | \n    Select-Object -First 10 @(\n        @{Name=\"Filename\"; Expression={$_.FileName}},\n        @{Name=\"Path\"; Expression={$_.ParentPath}},\n        @{Name=\"Size (MB)\"; Expression={[Math]::Round([long]$_.FileSize / 1MB, 2)}},\n        @{Name=\"Deleted Date\"; Expression={$_.Modified0x10}}\n    ) | Format-Table -AutoSize\n```\n\n---\n\n## Exercise 7: Detect Internet Downloads (Zone.Identifier)\n\n```powershell\n# Find files with Alternate Data Streams\n$ads = $mft | Where-Object { $_.\"Has ADS\" -eq \"True\" }\n\n# Filter for Zone.Identifier (marks internet downloads)\n$downloads = $ads | Where-Object { $_.FileName -like \"*:Zone.Identifier*\" }\n\nif ($downloads.Count -gt 0) {\n    Write-Host \"\\nüåê INTERNET DOWNLOADS DETECTED: $($downloads.Count)\\n\" -ForegroundColor Cyan\n    \n    # Extract original filenames (remove :Zone.Identifier)\n    $downloadList = $downloads | ForEach-Object {\n        [PSCustomObject]@{\n            OriginalFile = $_.FileName -replace \":Zone.Identifier\", \"\"\n            DownloadTime = $_.Created0x10\n            Path = $_.ParentPath\n        }\n    }\n    \n    # Display first 20\n    $downloadList | Sort-Object DownloadTime -Descending | \n        Select-Object -First 20 | \n        Format-Table -AutoSize\n    \n    # Export full list\n    $downloadList | Export-Csv \"C:\\Output\\internet_downloads.csv\" -NoTypeInformation\n} else {\n    Write-Host \"No Zone.Identifier entries found\\n\"\n}\n```\n\n---\n\n## Exercise 8: Search for Suspicious Paths\n\n```powershell\n# Define suspicious path patterns\n$suspiciousPaths = @(\n    \"*\\\\Temp\\\\*\",\n    \"*\\\\Public\\\\*\",\n    \"*\\\\Downloads\\\\*.exe\",\n    \"*\\\\AppData\\\\Roaming\\\\*.exe\",\n    \"*\\\\ProgramData\\\\*\"\n)\n\n$suspicious = @()\n\nforeach ($pattern in $suspiciousPaths) {\n    $matches = $mft | Where-Object { \n        $fullPath = \"$($_.ParentPath)\\$($_.FileName)\"\n        $fullPath -like $pattern -and $_.\"In Use\" -eq \"True\"\n    }\n    $suspicious += $matches\n}\n\n# Remove duplicates\n$suspicious = $suspicious | Sort-Object EntryNumber -Unique\n\nif ($suspicious.Count -gt 0) {\n    Write-Host \"\\n‚ö†Ô∏è SUSPICIOUS FILE LOCATIONS: $($suspicious.Count)\\n\" -ForegroundColor Yellow\n    \n    # Group by directory\n    $suspicious | Group-Object ParentPath | \n        Sort-Object Count -Descending | \n        Select-Object -First 10 @(\n            @{Name=\"Directory\"; Expression={$_.Name}},\n            @{Name=\"File Count\"; Expression={$_.Count}}\n        ) | Format-Table -AutoSize\n    \n    # Show individual files\n    Write-Host \"\\nSample files:\\n\"\n    $suspicious | Select-Object -First 10 @(\n        @{Name=\"Filename\"; Expression={$_.FileName}},\n        @{Name=\"Path\"; Expression={$_.ParentPath}},\n        @{Name=\"Created\"; Expression={$_.Created0x10}}\n    ) | Format-Table -AutoSize\n}\n```\n\n---\n\n## Exercise 9: Build Execution Correlation Timeline\n\n```powershell\n# Import MFT and Prefetch data\n$mft = Import-Csv \"C:\\Output\\mft_timeline.csv\"\n$prefetch = Import-Csv \"C:\\Output\\prefetch_all.csv\"\n\n# Create unified timeline\n$timeline = @()\n\n# Add MFT entries (file creation)\nforeach ($entry in $mft) {\n    if ($entry.FileName -like \"*.exe\" -and $entry.\"In Use\" -eq \"True\") {\n        try {\n            $timeline += [PSCustomObject]@{\n                Timestamp = [datetime]::Parse($entry.Created0x10)\n                Source = \"MFT (Created)\"\n                Filename = $entry.FileName\n                Path = $entry.ParentPath\n                Detail = \"File created on disk\"\n            }\n        } catch {}\n    }\n}\n\n# Add Prefetch entries (execution)\nforeach ($entry in $prefetch) {\n    try {\n        $timeline += [PSCustomObject]@{\n            Timestamp = [datetime]::Parse($entry.\"Last Run Time\")\n            Source = \"Prefetch (Execution)\"\n            Filename = $entry.\"Executable Name\"\n            Path = \"\"\n            Detail = \"Run Count: $($entry.'Run Count')\"\n        }\n    } catch {}\n}\n\n# Sort by timestamp\n$timeline = $timeline | Sort-Object Timestamp -Descending\n\n# Display recent activity (last 7 days)\n$recentTimeline = $timeline | Where-Object { \n    $_.Timestamp -gt (Get-Date).AddDays(-7) \n}\n\nWrite-Host \"\\nüïí EXECUTION TIMELINE (Last 7 Days):\\n\" -ForegroundColor Green\n$recentTimeline | Select-Object -First 20 | Format-Table -AutoSize\n\n# Export full timeline\n$timeline | Export-Csv \"C:\\Output\\mft_prefetch_timeline.csv\" -NoTypeInformation\nWrite-Host \"\\nFull timeline exported to: C:\\Output\\mft_prefetch_timeline.csv\"\n```\n\n---\n\n## Exercise 10: Identify File Copy vs. Move\n\n```powershell\n# Find files with same name in different locations (potential copies)\n\n$fileGroups = $mft | Where-Object { $_.\"In Use\" -eq \"True\" } | \n    Group-Object FileName | \n    Where-Object { $_.Count -gt 1 }\n\nWrite-Host \"\\nüìã FILES EXISTING IN MULTIPLE LOCATIONS: $($fileGroups.Count)\\n\"\n\nforeach ($group in $fileGroups | Select-Object -First 10) {\n    Write-Host \"Filename: $($group.Name)\"\n    \n    foreach ($file in $group.Group) {\n        $created = [datetime]::Parse($file.Created0x10)\n        Write-Host \"  - $($file.ParentPath) | Created: $created\"\n    }\n    \n    # Analyze timestamps to determine copy vs move\n    $timestamps = $group.Group | ForEach-Object { \n        [datetime]::Parse($_.Created0x10) \n    } | Sort-Object\n    \n    if ($timestamps.Count -gt 1) {\n        $timeDiff = ($timestamps[1] - $timestamps[0]).TotalSeconds\n        \n        if ($timeDiff -lt 5) {\n            Write-Host \"  ‚ö†Ô∏è Likely MOVED (created within 5 seconds)\\n\" -ForegroundColor Yellow\n        } else {\n            Write-Host \"  üìÑ Likely COPIED (different creation times)\\n\" -ForegroundColor Cyan\n        }\n    }\n}\n```\n\n---\n\n## Challenge Exercise: Full Incident Investigation\n\n### Scenario\n\nInvestigate a suspected malware infection. Use MFT analysis to determine:\n\n1. **Was malware created on disk?** (Look for .exe in Temp, Downloads)\n2. **When was it created?** (Born time)\n3. **Was it deleted?** (In Use = False)\n4. **Were timestamps manipulated?** (Compare $SI vs $FN)\n5. **What files did malware access?** (Correlate with execution artifacts)\n\n### Investigation Steps\n\n```powershell\n# 1. Parse MFT\nMFTECmd.exe -f \"$MFT\" --csv \"C:\\Output\" --csvf investigation.csv\n\n# 2. Import data\n$mft = Import-Csv \"C:\\Output\\investigation.csv\"\n\n# 3. Search for executables in suspicious locations\n$malware = $mft | Where-Object {\n    ($_.FileName -like \"*.exe\" -or $_.FileName -like \"*.dll\") -and\n    ($_.ParentPath -like \"*\\Temp\\*\" -or \n     $_.ParentPath -like \"*\\Downloads\\*\" -or\n     $_.ParentPath -like \"*\\Public\\*\")\n}\n\n# 4. Check for timestomping\n$timestompedMalware = $malware | Where-Object {\n    try {\n        $si = [datetime]::Parse($_.Created0x10)\n        $fn = [datetime]::Parse($_.Created0x30)\n        [Math]::Abs(($si - $fn).TotalSeconds) -gt 1\n    } catch { $false }\n}\n\n# 5. Check for deleted malware\n$deletedMalware = $malware | Where-Object { $_.\"In Use\" -eq \"False\" }\n\n# 6. Generate report\nWrite-Host \"\\n=== MFT INVESTIGATION REPORT ===\\n\"\nWrite-Host \"Suspicious Executables: $($malware.Count)\"\nWrite-Host \"Timestomped Files: $($timestompedMalware.Count)\"\nWrite-Host \"Deleted Malware: $($deletedMalware.Count)\\n\"\n\nif ($timestompedMalware.Count -gt 0) {\n    Write-Host \"üö® TIMESTOMPED MALWARE DETECTED:\\n\"\n    $timestompedMalware | Format-Table FileName, ParentPath, Created0x10, Created0x30\n}\n\nif ($deletedMalware.Count -gt 0) {\n    Write-Host \"üóëÔ∏è DELETED MALWARE ENTRIES:\\n\"\n    $deletedMalware | Format-Table FileName, ParentPath, FileSize, Modified0x10\n}\n```\n\n---\n\n## Key Commands Cheat Sheet\n\n```powershell\n# Acquire MFT\nRawCopy.exe /FileNamePath:C:\\$MFT /OutputPath:C:\\Forensics\n\n# Parse MFT\nMFTECmd.exe -f \"$MFT\" --csv . --csvf timeline.csv\n\n# Import CSV\n$mft = Import-Csv \"timeline.csv\"\n\n# Find deleted files\n$mft | Where-Object { $_.\"In Use\" -eq \"False\" }\n\n# Detect timestomping\n$mft | Where-Object { \n    [Math]::Abs(([datetime]::Parse($_.Created0x10) - [datetime]::Parse($_.Created0x30)).TotalSeconds) -gt 1 \n}\n\n# Find Zone.Identifier (downloads)\n$mft | Where-Object { $_.FileName -like \"*:Zone.Identifier*\" }\n\n# Filter by path\n$mft | Where-Object { $_.ParentPath -like \"*\\Temp\\*\" }\n```\n\nThese exercises provide hands-on experience with MFT analysis - the foundation of NTFS forensics!"
      }
    },
    {
      "type": "real_world",
      "content": {
        "text": "# Real-World Case Studies: MFT Analysis in Action\n\n## Case Study 1: Detecting Timestomping - APT29 SolarWinds (2020)\n\n### Background\n\nAPT29 (Cozy Bear) used timestomping extensively during the SolarWinds supply chain attack to evade detection and blend malicious files with legitimate SolarWinds binaries.\n\n### MFT Forensics\n\n**Evidence Found**:\n```\nFile: SolarWinds.Orion.Core.BusinessLayer.dll (malicious backdoor)\nPath: C:\\Program Files\\SolarWinds\\Orion\\\n\n$STANDARD_INFORMATION (easily modified):\n  Created:  2019-01-01 00:00:00.000 (fake timestamp!)\n  Modified: 2019-01-01 00:00:00.000\n\n$FILE_NAME (harder to modify):\n  Created:  2020-03-24 14:23:11.456 (real timestamp!)\n  Modified: 2020-03-24 14:23:11.456\n\nDiscrepancy: 441 days difference!\n```\n\n### Investigation Findings\n\n1. **Timestomping Detected**: Massive gap between $SI (Jan 1, 2019) and $FN (Mar 24, 2020) timestamps\n2. **Real Creation Date**: March 24, 2020 ($FILE_NAME reveals truth)\n3. **Attacker Intent**: Fake timestamp to match other SolarWinds DLLs from 2019\n4. **Evasion Failure**: MFT dual timestamps exposed the deception\n\n### Forensic Impact\n\n- **Timeline Correction**: Patient zero identified via real $FN timestamp\n- **IOC Generation**: March 24, 2020 became key date for searching across all systems\n- **Detection Method**: Security teams worldwide searched MFT for timestamp discrepancies\n\n**Lesson Learned**: Attackers can modify $STANDARD_INFORMATION timestamps, but $FILE_NAME timestamps reveal the truth. Always compare both.\n\n---\n\n## Case Study 2: Deleted File Recovery - Insider Threat (2019)\n\n### Background\n\nAn employee at a defense contractor was suspected of stealing classified documents. Investigation found no files on workstation, but MFT told the story.\n\n### MFT Forensics\n\n**Deleted File Evidence**:\n```\nMFT Entry 458972:\n  Filename: classified_missile_specs.pdf\n  Parent Path: C:\\Users\\Employee\\Documents\\Classified\\\n  File Size: 8,472,394 bytes (8.4 MB)\n  Created: 2019-07-10 14:23:11 UTC\n  Modified: 2019-07-10 14:28:45 UTC\n  Accessed: 2019-07-10 15:42:21 UTC\n  In Use: FALSE (deleted)\n  MFT Change: 2019-07-10 16:52:34 UTC (deletion timestamp)\n\nMFT Entry 458973:\n  Filename: classified_missile_specs.pdf:Zone.Identifier\n  Parent Path: C:\\Users\\Employee\\Documents\\Classified\\\n  Created: 2019-07-10 14:23:11 UTC\n  In Use: FALSE\n  \nInterpretation: File was downloaded from internet (Zone.Identifier ADS)\n```\n\n### Timeline Reconstruction\n\n```\n14:23:11 - classified_missile_specs.pdf downloaded (MFT Created + Zone.Identifier)\n14:28:45 - File modified (possibly opened/viewed)\n15:42:21 - File accessed (read for copy?)\n16:45:32 - USB device connected (Registry USBSTOR)\n16:48:11 - Robocopy.exe executed (Prefetch)\n16:52:34 - File deleted (MFT Change timestamp)\n16:55:00 - Employee logged off (Event Log)\n```\n\n### Correlation with Other Artifacts\n\n**USB Device History (Registry)**:\n```\nUSBSTOR Key:\n  Device: SanDisk Ultra 64GB\n  Serial: 5C753012ABCD\n  First Connected: 2019-07-10 16:45:32 UTC\n  Last Connected: 2019-07-10 16:54:21 UTC\n```\n\n**Prefetch Analysis**:\n```\nROBOCOPY.EXE Prefetch:\n  Last Run: 2019-07-10 16:48:11 UTC\n  Run Count: 1\n  Referenced Files: C:\\Users\\Employee\\Documents\\* ‚Üí E:\\ (USB)\n```\n\n### Forensic Conclusions\n\n1. **Proof of Existence**: MFT proved file existed (even after deletion)\n2. **Download Source**: Zone.Identifier ADS proved internet download\n3. **Timeline Evidence**: File accessed during USB connection window (15:42 - 16:54)\n4. **Exfiltration Method**: Robocopy to USB, then secure deletion\n5. **Intent**: Systematic exfiltration (download ‚Üí copy ‚Üí delete)\n\n### Legal Outcome\n\nMFT evidence presented in court:\n- **Filename and size** (classified_missile_specs.pdf, 8.4 MB)\n- **Download proof** (Zone.Identifier ADS)\n- **Timeline synchronization** (file access + USB connection + Robocopy)\n- **Deletion timestamp** (MFT Change time)\n\nEmployee convicted of espionage. MFT evidence was **critical** - proved file existed despite deletion.\n\n**Lesson Learned**: MFT entries persist after file deletion (In Use = False). Always acquire MFT immediately after incident.\n\n---\n\n## Case Study 3: Ransomware Timeline - Ryuk (2021)\n\n### Background\n\nRyuk ransomware encrypted 800+ systems at a healthcare provider. MFT analysis reconstructed minute-by-minute attack timeline.\n\n### MFT Forensics - Patient Zero Workstation\n\n**Initial Dropper**:\n```\nMFT Entry 892341:\n  Filename: invoice_Q3_2021.exe\n  Parent Path: C:\\Users\\Receptionist\\Downloads\\\n  Created: 2021-09-15 08:23:11.234 UTC (file downloaded)\n  Modified: 2021-09-15 08:23:11.234 UTC\n  Accessed: 2021-09-15 08:23:15.678 UTC (executed 4 seconds later)\n  In Use: FALSE (deleted by dropper)\n```\n\n**Malware Payload**:\n```\nMFT Entry 892358:\n  Filename: ryuk.exe\n  Parent Path: C:\\Windows\\Temp\\\n  Created: 2021-09-15 08:25:34.123 UTC (dropped by invoice_Q3_2021.exe)\n  Modified: 2021-09-15 09:15:32.456 UTC (last execution before deletion)\n  In Use: FALSE (self-deleted after encryption)\n```\n\n**Encrypted Files**:\n```\nMFT Entries 892359-894582 (2,223 files):\n  Filename Pattern: *.RYK (renamed originals)\n  Parent Paths: C:\\Users\\*\\Documents\\*, D:\\Shares\\*\n  Modified: 2021-09-15 09:15:32 - 09:47:21 UTC (32-minute encryption window)\n  \nExample:\n  Original: financial_report.xlsx\n  Encrypted: financial_report.xlsx.RYK\n  Modified: 2021-09-15 09:18:45 UTC\n```\n\n### Attack Timeline (From MFT)\n\n```\n08:23:11.234 - invoice_Q3_2021.exe created (malicious email attachment downloaded)\n08:23:15.678 - invoice_Q3_2021.exe accessed (executed by user)\n08:25:34.123 - ryuk.exe created in C:\\Windows\\Temp (payload dropped)\n08:34:45.000 - PsExec.exe created (lateral movement tool deployed)\n09:15:32.456 - Mass file modification begins (encryption phase)\n09:47:21.123 - Last file encrypted (2,223 files encrypted in 32 minutes)\n```\n\n### Cross-System MFT Correlation\n\n**Investigators analyzed MFT on 50 compromised systems**:\n\n| System | Ryuk Created Timestamp | Files Encrypted | Method |\n|--------|----------------------|-----------------|--------|\n| Receptionist PC | 08:25:34.123 (earliest) | 2,223 files | Patient zero |\n| Workstation-001 | 08:36:12.456 | 1,847 files | PsExec lateral movement |\n| Workstation-002 | 08:39:45.789 | 1,623 files | PsExec lateral movement |\n| FileServer-001 | 08:45:23.012 | 12,456 files | PsExec lateral movement |\n| DC01 | 08:52:11.234 | 3,892 files | PsExec lateral movement |\n\n**Conclusion**: Receptionist PC had **earliest ryuk.exe creation timestamp** = Patient zero confirmed.\n\n### Forensic Impact\n\n1. **Patient Zero**: Earliest MFT Created timestamp identified initial infection\n2. **Dwell Time**: 52 minutes from dropper to encryption (08:23 ‚Üí 09:15)\n3. **Encryption Speed**: 2,223 files in 32 minutes = 69 files/minute\n4. **Propagation Method**: PsExec creation timestamps show lateral movement sequence\n5. **Deleted Evidence**: Both dropper and payload deleted, but MFT entries persisted\n\n**Lesson Learned**: MFT Created timestamps reveal attack chronology across multiple systems. Earliest timestamp = Patient zero.\n\n---\n\n## Case Study 4: Zone.Identifier ADS - Malware Distribution (2020)\n\n### Background\n\nSOC detected suspicious network traffic from a workstation. No obvious malware found, but MFT revealed internet download.\n\n### MFT Forensics\n\n**Zone.Identifier Evidence**:\n```\nMFT Entry 674523:\n  Filename: update.exe\n  Parent Path: C:\\Users\\Alice\\Downloads\\\n  Created: 2020-08-15 14:32:11.456 UTC\n  File Size: 287,744 bytes\n  In Use: FALSE (deleted)\n\nMFT Entry 674524:\n  Filename: update.exe:Zone.Identifier (Alternate Data Stream)\n  Parent Path: C:\\Users\\Alice\\Downloads\\\n  Created: 2020-08-15 14:32:11.456 UTC\n  Content:\n    [ZoneTransfer]\n    ZoneId=3\n    ReferrerUrl=http://malicious-domain.com/download\n    HostUrl=http://malicious-domain.com/files/update.exe\n  In Use: FALSE\n```\n\n### Forensic Analysis\n\n**Zone.Identifier Interpretation**:\n- **ZoneId=3**: Downloaded from **internet** (not local network)\n- **ReferrerUrl**: User clicked link on http://malicious-domain.com/download\n- **HostUrl**: File downloaded from http://malicious-domain.com/files/update.exe\n\n**Timeline**:\n```\n14:32:11 - update.exe downloaded from malicious-domain.com (MFT Created + Zone.Identifier)\n14:32:15 - update.exe executed (Prefetch confirms execution 4 seconds later)\n14:35:00 - C2 beacon established to 185.xxx.xxx.xxx (network logs)\n14:52:00 - File deleted by user or malware (MFT In Use = False)\n```\n\n### Correlation with Network Logs\n\n```\nNetwork Logs:\n14:31:58 - HTTP GET http://malicious-domain.com/files/update.exe\n14:35:02 - HTTPS POST to 185.xxx.xxx.xxx:443 (C2 server)\n14:35:32 - HTTPS POST to 185.xxx.xxx.xxx:443 (exfiltration)\n```\n\n### Forensic Conclusions\n\n1. **Download Proof**: Zone.Identifier ADS proved internet download\n2. **Source URL**: Identified malicious distribution site\n3. **Execution Correlation**: Download (14:32:11) ‚Üí Execution (14:32:15) ‚Üí C2 Beacon (14:35:02)\n4. **Anti-Forensics Attempt**: File deleted but Zone.Identifier ADS entry persisted in MFT\n\n**Legal Outcome**: Zone.Identifier URL used to identify phishing campaign affecting 200+ organizations. ISP notified, malicious site taken down.\n\n**Lesson Learned**: Zone.Identifier ADS in MFT proves internet downloads and reveals source URLs. Always check for ADS entries.\n\n---\n\n## Case Study 5: File Copy vs. Move Analysis - Data Staging (2022)\n\n### Background\n\nInsider threat investigation required determining if sensitive files were **copied** (exfiltration) or **moved** (reorganized legitimately).\n\n### MFT Forensics\n\n**Scenario 1: File Copied (Exfiltration)**\n\n```\nOriginal File:\nMFT Entry 445231:\n  Filename: confidential_data.xlsx\n  Parent Path: C:\\Users\\Manager\\Documents\\Confidential\\\n  Created: 2022-05-10 08:00:00.000 UTC (born time)\n  Modified: 2022-05-15 14:23:11.456 UTC (last edit)\n  In Use: TRUE (still exists)\n\nCopy on USB:\nMFT Entry 891234:\n  Filename: confidential_data.xlsx\n  Parent Path: E:\\Backup\\ (USB drive)\n  Created: 2022-05-15 16:45:32.789 UTC (NEW born time!)\n  Modified: 2022-05-15 14:23:11.456 UTC (preserves original modified time)\n  In Use: FALSE (USB disconnected)\n\nAnalysis:\n- Original file: Created 2022-05-10 (5 days ago)\n- USB copy: Created 2022-05-15 (today)\n- Conclusion: COPIED (new MFT entry with new born time)\n```\n\n**Scenario 2: File Moved (Legitimate Reorganization)**\n\n```\nBefore Move:\nMFT Entry 445231:\n  Filename: project_notes.docx\n  Parent Path: C:\\Users\\Manager\\Desktop\\\n  Created: 2022-05-10 08:00:00.000 UTC\n  Modified: 2022-05-15 14:23:11.456 UTC\n\nAfter Move (same volume):\nMFT Entry 445231: (SAME MFT entry!)\n  Filename: project_notes.docx\n  Parent Path: C:\\Users\\Manager\\Documents\\Projects\\ (parent changed)\n  Created: 2022-05-10 08:00:00.000 UTC (born time PRESERVED)\n  Modified: 2022-05-15 14:23:11.456 UTC\n  MFT Change: 2022-05-15 16:50:11.123 UTC (parent directory updated)\n\nAnalysis:\n- Same MFT entry number (445231)\n- Born time preserved (2022-05-10)\n- Only parent path changed\n- Conclusion: MOVED (within same volume)\n```\n\n### Forensic Conclusions\n\n**Copy Indicators (Exfiltration)**:\n- ‚úÖ **New MFT entry** (different entry number)\n- ‚úÖ **New born time** (Created timestamp is recent)\n- ‚úÖ **Modified time preserved** (matches original)\n- ‚úÖ **Original file still exists** (In Use = TRUE)\n\n**Move Indicators (Legitimate)**:\n- ‚úÖ **Same MFT entry** (entry number unchanged)\n- ‚úÖ **Born time preserved** (Created timestamp old)\n- ‚úÖ **Parent path changed** (moved to new directory)\n- ‚úÖ **MFT Change timestamp updated** (metadata modified)\n\n**Legal Impact**: MFT analysis **proved exfiltration** (file copy) vs. legitimate reorganization (file move). Evidence presented in court.\n\n**Lesson Learned**: Born time (Created timestamp) reveals file copy (new born time) vs. move (preserved born time). Critical for data theft investigations.\n\n---\n\n## Key Forensic Takeaways from Real-World Cases\n\n### Pattern Recognition\n\n| Attack Type | MFT Indicators |\n|-------------|----------------|\n| **Timestomping** | $STANDARD_INFORMATION vs $FILE_NAME timestamp discrepancies (> 1 second difference) |\n| **Deleted Files** | In Use = FALSE, MFT entry persists with filename, size, timestamps |\n| **Internet Downloads** | Zone.Identifier ADS (ZoneId=3, ReferrerUrl, HostUrl) |\n| **Data Exfiltration** | File copy (new born time) vs. move (preserved born time) |\n| **Ransomware** | Mass file modification timestamps (thousands of files in minutes) |\n| **Patient Zero** | Earliest Created timestamp across compromised systems |\n\n### MFT Strengths\n\n‚úÖ **Dual timestamps** ($SI vs $FN) detect timestomping  \n‚úÖ **Deleted file recovery** (MFT entries persist)  \n‚úÖ **Zone.Identifier ADS** proves internet downloads  \n‚úÖ **Born time** reveals file copy vs. move  \n‚úÖ **MACB timestamps** (Modified, Accessed, Changed, Born)  \n‚úÖ **Parent directory tracking** reconstructs folder structures  \n\n### MFT Limitations\n\n‚ùå **No user attribution** (combine with Event Logs, file ownership)  \n‚ùå **LastAccessTime disabled** (Windows 7+ performance optimization)  \n‚ùå **MFT entry reuse** (deleted entries eventually overwritten)  \n‚ùå **No execution proof** (use Prefetch, AmCache, Shimcache)  \n\n### Best Practices\n\n1. **Always compare $SI vs $FN timestamps** ‚Üí Detect timestomping\n2. **Acquire MFT immediately** ‚Üí Before deleted entries reused\n3. **Search for Zone.Identifier ADS** ‚Üí Prove internet downloads\n4. **Check born time for copies** ‚Üí New born time = file copy (exfiltration)\n5. **Correlate with execution artifacts** ‚Üí MFT + Prefetch + AmCache = Complete timeline\n6. **Filter In Use = FALSE** ‚Üí Recover deleted file metadata\n\n---\n\n## Your Turn: Apply These Techniques\n\nWhen you analyze MFT in real investigations:\n\n‚úÖ **Compare $SI vs $FN timestamps** ‚Üí Detect timestomping  \n‚úÖ **Filter In Use = FALSE** ‚Üí Find deleted files  \n‚úÖ **Search Zone.Identifier ADS** ‚Üí Prove internet downloads  \n‚úÖ **Check born time differences** ‚Üí Copy (new) vs. Move (preserved)  \n‚úÖ **Build MACB timeline** ‚Üí Modified, Accessed, Changed, Born  \n‚úÖ **Correlate with execution artifacts** ‚Üí MFT + Prefetch + AmCache = Complete picture  \n\nMFT is NTFS's **complete file history** - use it to prove file creation, detect timestomping, recover deleted files, and reconstruct attack timelines!"
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "# Memory Aids: Never Forget MFT Forensics\n\n## Acronym: \"MACB = File Story\"\n\nRemember the four NTFS timestamps:\n\n- **M**odified ‚Üí When file **content** changed\n- **A**ccessed ‚Üí When file was **read**\n- **C**hanged ‚Üí When **metadata** updated (MFT entry modified)\n- **B**orn ‚Üí When file was **created**\n\n**Memory Hook**: **MACB** tells the file's **complete story**\n\n---\n\n## Mnemonic: \"$SI = Easily Modified, $FN = Forensically Noble\"\n\nRemember timestamp comparison:\n\n- **$STANDARD_INFORMATION** ($SI) = **Easily modified** by timestomping tools\n- **$FILE_NAME** ($FN) = **Forensically Noble** (harder to modify, reveals truth)\n\n**Memory Hook**: **$SI** = **S**imple to modify, **$FN** = **F**orensically reliable\n\n---\n\n## Visual: MFT = Library Card Catalog\n\nThink of MFT as a **library card catalog**:\n\n- **MFT Entry** = Card in catalog\n- **Filename** = Book title\n- **Parent Path** = Shelf location\n- **Created Time** = Date book added to library\n- **Modified Time** = Date book last updated\n- **In Use = FALSE** = Book removed from shelf (but catalog card remains)\n\n**Memory Hook**: MFT is Windows' **permanent catalog** - entries survive file deletion!\n\n---\n\n## Number Memory: \"1024 Rule\"\n\nMFT entry size:\n\n- **1024 bytes** (1 KB) per MFT entry\n\n**Memory Hook**: **1024** = **1 KB** = Each file's metadata \"budget\"\n\n**Visual**: Think of a **1 KB notecard** with all file metadata written on it\n\n---\n\n## Acronym: \"ZONE-ID\" for Internet Downloads\n\nRemember Zone.Identifier ADS:\n\n- **Z**one.Identifier (Alternate Data Stream)\n- **O**rigin URL recorded\n- **N**etwork download proof\n- **E**vidence of internet source\n- **ID**entifies ZoneId (3 = internet)\n\n**Memory Hook**: **ZONE-ID** = **ID**entifies download **zone** (internet)\n\n---\n\n## Rhyme: \"SI Lies, FN Tries\"\n\n**Timestomping Detection**:\n\n> \"**$SI lies**, attackers disguise,  \n> But **$FN tries**, reveals the truth in their eyes,  \n> Compare the two, discrepancies arise,  \n> Timestomping detected, no more surprise!\"\n\n**Memory Hook**: **$SI** can **lie** (modified), **$FN** **tries** to tell truth (harder to modify)\n\n---\n\n## Acronym: \"BORN\" for Creation Timestamp\n\nRemember Born time significance:\n\n- **B**eginning of file existence\n- **O**riginal creation timestamp\n- **R**eliable (harder to fake than $SI)\n- **N**ever updates (in theory)\n\n**Memory Hook**: **BORN** time = File's **birth certificate**\n\n---\n\n## Visual: \"In Use = FALSE\" = Ghost Files\n\nThink of deleted files as **ghosts**:\n\n- **Alive** = In Use = TRUE (file exists on disk)\n- **Ghost** = In Use = FALSE (file deleted but MFT entry remains)\n- **Ghost still has memories** (filename, size, timestamps)\n\n**Memory Hook**: Deleted files are **ghosts** in the MFT - visible but not tangible\n\n---\n\n## Mnemonic: \"COPY = New BORN\"\n\nRemember file copy vs. move:\n\n- **COPY** = **New BORN** time (new MFT entry created)\n- **MOVE** (same volume) = **BORN preserved** (MFT entry relocated)\n\n**Memory Hook**: **COPY** = **New birth** (new entry), **MOVE** = **Same identity** (same entry)\n\n---\n\n## Acronym: \"ADS-ZONE\" for Alternate Data Streams\n\nRemember ADS forensic value:\n\n- **A**lternate **D**ata **S**treams\n- **Z**one.Identifier (internet downloads)\n- **O**rigin URL recorded\n- **N**etwork source proof\n- **E**vidence of file provenance\n\n**Memory Hook**: **ADS-ZONE** = **ADS** reveals download **zone**\n\n---\n\n## Visual: MFT = Windows' DVR\n\nThink of MFT as a **Digital Video Recorder** for files:\n\n- **Records everything** (file creation, modification, deletion)\n- **Rewind capability** (see file history via timestamps)\n- **Never deletes recordings** (MFT entries persist after file deletion)\n- **Multiple angles** (MACB timestamps = different perspectives)\n\n**Memory Hook**: MFT is Windows' **DVR** - it **records** everything, **rewinds** to show history\n\n---\n\n## Acronym: \"MFT-EATS\" for Key Attributes\n\nRemember essential MFT attributes:\n\n- **M**FT entry\n- **F**ilename ($FILE_NAME)\n- **T**imestamps ($STANDARD_INFORMATION)\n- **E**ntry size (1024 bytes)\n- **A**lternate Data Streams ($DATA)\n- **T**ime comparison ($SI vs $FN)\n- **S**ize (file size in bytes)\n\n**Memory Hook**: **MFT EATS** = MFT **eats** (consumes) all file metadata\n\n---\n\n## Rhyme: \"Born Time Never Lies, Unless It's Copied or Flies\"\n\n**Born Time Reliability**:\n\n> \"**Born time never lies**, the truth in disguise,  \n> Unless file is **copied** (new born time applies),  \n> Or moved cross-volume (it **flies** to new place),  \n> But same-volume moves? Born time stays in place!\"\n\n**Memory Hook**: **Born time** reliable **except** for copies or cross-volume moves\n\n---\n\n## Acronym: \"DELETE = Entry Lingers\"\n\nRemember deleted file behavior:\n\n- **D**eleted file (In Use = FALSE)\n- **E**ntry remains in MFT\n- **L**ingers until overwritten\n- **E**vidence persists\n- **T**imestamps preserved\n- **E**ventually reused for new files\n\n**Memory Hook**: **DELETE** doesn't erase MFT entry - it **lingers**\n\n---\n\n## Visual: Timestomping = Fake ID\n\nThink of timestomping as a **fake ID**:\n\n- **$SI timestamps** = Fake ID (easily forged)\n- **$FN timestamps** = Birth certificate (harder to fake)\n- **Bouncer (forensic analyst)** checks **both** IDs\n- **Mismatch** = Fraud detected (timestomping)\n\n**Memory Hook**: Always check **both IDs** ($SI and $FN) - fake ID revealed by mismatch\n\n---\n\n## Acronym: \"TIMELINE\" for MFT Analysis Workflow\n\nFollow **\"TIMELINE\"** when analyzing MFT:\n\n1. **T**riage: Acquire $MFT file\n2. **I**mport: Parse with MFTECmd\n3. **M**erge: Combine with execution artifacts (Prefetch, AmCache)\n4. **E**xamine: Open CSV in Timeline Explorer\n5. **L**ocate: Search for suspicious paths, deleted files\n6. **I**nvestigate: Compare $SI vs $FN (timestomping detection)\n7. **N**etwork: Correlate with network logs, Event Logs\n8. **E**vidence: Document findings for forensic report\n\n**Memory Hook**: **TIMELINE** = Your MFT analysis workflow\n\n---\n\n## Final Memory Hook: \"MFT = Windows' Black Box\"\n\nWhenever you need:\n\n- ‚úÖ **File creation timeline** ‚Üí MFT Born time\n- ‚úÖ **Deleted file proof** ‚Üí MFT In Use = FALSE\n- ‚úÖ **Timestomping detection** ‚Üí Compare $SI vs $FN\n- ‚úÖ **Internet download proof** ‚Üí Zone.Identifier ADS\n- ‚úÖ **Copy vs. Move** ‚Üí Born time (new vs. preserved)\n\n**Think**: **MFT = Windows' Black Box**\n\n> Just like an airplane's black box records **every event**,  \n> MFT records **every file** - creation, modification, deletion.  \n> Even after a crash (file deletion), the **black box survives** (MFT entry persists)!\n\n---\n\nUse these memory aids during investigations. Create flashcards, print cheat sheets, or develop your own mnemonics. The goal: **Instant recall** when analyzing MFT in live incidents!"
      }
    },
    {
      "type": "reflection",
      "content": {
        "text": "# Reflection Questions: Test Your MFT Understanding\n\n## Conceptual Understanding\n\n### Question 1: MFT Purpose and Forensic Value\n\n**Scenario**: A colleague asks: \"Why do we analyze the MFT? What does it tell us?\"\n\n**Reflect**:\n1. What was Microsoft's **original purpose** for the MFT? (Filesystem management)\n2. What **forensic side effects** does the MFT provide? (Timeline, deleted files, timestamps)\n3. Why is the MFT more **comprehensive** than Event Logs? (Every file vs. selected events)\n4. If you could only have **one** filesystem artifact, why choose MFT? (Complete file history)\n\n**Critical Thinking**: Does the MFT prove file **execution**? Or only file **existence**? What's the difference?\n\n---\n\n### Question 2: MACB Timestamps\n\n**Scenario**: You find these timestamps for `malware.exe`:\n\n```\nModified (M): 2024-10-16 14:32:45 UTC\nAccessed (A): 2024-10-16 14:35:12 UTC\nChanged (C):  2024-10-16 14:32:45 UTC\nBorn (B):     2024-10-15 08:23:11 UTC\n```\n\n**Reflect**:\n1. When was the file **created**? (Born time: Oct 15 08:23:11)\n2. When was file **content** last modified? (Modified time: Oct 16 14:32:45)\n3. When was the file **accessed**? (Accessed time: Oct 16 14:35:12 - but is this reliable?)\n4. Why is **Born time** the most reliable timestamp? (Harder to fake)\n\n**Critical Thinking**: If LastAccessTime is **disabled** (Windows 7+ default), can you trust the Accessed timestamp? What would you check?\n\n---\n\n### Question 3: Timestomping Detection\n\n**Scenario**: You compare $STANDARD_INFORMATION vs $FILE_NAME timestamps:\n\n```\n$STANDARD_INFORMATION ($SI):\n  Created: 2020-01-01 00:00:00.000\n  Modified: 2020-01-01 00:00:00.000\n\n$FILE_NAME ($FN):\n  Created: 2024-10-16 03:47:21.456\n  Modified: 2024-10-16 03:47:21.456\n```\n\n**Reflect**:\n1. What **red flag** do you see? (441-day discrepancy!)\n2. Which timestamp is **fake**? Which is **real**? ($SI fake, $FN real)\n3. Why did the attacker **choose** Jan 1, 2020? (Trying to blend with old files)\n4. How does this technique **fail forensically**? ($FN reveals truth)\n\n**Critical Thinking**: If an attacker modifies **both** $SI and $FN timestamps, can you still detect timestomping? What other artifacts would you check? (Prefetch, AmCache, Event Logs)\n\n---\n\n## Practical Application\n\n### Question 4: Deleted File Recovery\n\n**Scenario**: You filter MFT for `In Use = FALSE` and find:\n\n```\nFilename: confidential_passwords.txt\nParent Path: C:\\Temp\\\nFile Size: 8,472 bytes\nCreated: 2024-10-15 14:23:11 UTC\nModified: 2024-10-15 16:45:32 UTC\nIn Use: FALSE (deleted)\n```\n\n**Reflect**:\n1. What does `In Use = FALSE` mean? (File deleted from disk)\n2. What information **survived deletion**? (Filename, path, size, timestamps)\n3. Can you **recover the file content**? (Depends on whether data clusters overwritten)\n4. How would you attempt file carving? (Use file size and $DATA pointers if available)\n\n**Critical Thinking**: If the file was **securely deleted** (SDelete, shred), does the MFT entry still exist? What about the actual file data?\n\n---\n\n### Question 5: Zone.Identifier ADS (Internet Downloads)\n\n**Scenario**: MFT shows:\n\n```\nEntry 1:\n  Filename: invoice.exe\n  Created: 2024-10-16 08:23:11 UTC\n  In Use: FALSE (deleted)\n\nEntry 2:\n  Filename: invoice.exe:Zone.Identifier (ADS)\n  Content:\n    [ZoneTransfer]\n    ZoneId=3\n    ReferrerUrl=http://phishing-site.com/\n    HostUrl=http://phishing-site.com/malware/invoice.exe\n  In Use: FALSE\n```\n\n**Reflect**:\n1. What does **Zone.Identifier ADS** prove? (File downloaded from internet)\n2. What does **ZoneId=3** mean? (Internet zone)\n3. What forensic value does **HostUrl** provide? (Identifies malware distribution site)\n4. Why is **ReferrerUrl** significant? (Shows which phishing page user visited)\n\n**Critical Thinking**: If the attacker **deletes** invoice.exe, does Zone.Identifier ADS persist in MFT? (Yes, as separate MFT entry)\n\n---\n\n### Question 6: File Copy vs. Move\n\n**Scenario**: Two files named `report.docx`:\n\n```\nFile 1:\n  Path: C:\\Users\\Alice\\Documents\\\n  Born: 2024-10-10 08:00:00 UTC\n\nFile 2:\n  Path: E:\\USB_Backup\\ (USB drive)\n  Born: 2024-10-15 16:45:32 UTC\n```\n\n**Reflect**:\n1. Was File 2 **copied** or **moved** from File 1? (Copied - new born time)\n2. How do you know? (Different born times = separate file creation events)\n3. What does this suggest about user intent? (Data exfiltration to USB)\n4. If File 1's born time was also Oct 15 16:45:32, what would that mean? (Moved - but only if same volume)\n\n**Critical Thinking**: If File 2 was on **D:\\ drive** (same physical disk as C:\\), would a move preserve born time? What about **E:\\ drive** (USB)?\n\n---\n\n## Advanced Scenarios\n\n### Question 7: Ransomware Timeline Reconstruction\n\n**Scenario**: MFT shows mass file modifications:\n\n```\n2,223 files in C:\\Users\\*\\Documents\\\nModified between: 2024-10-16 09:15:32 - 09:47:21 UTC\nFilename pattern: *.RYK (renamed encrypted files)\n\nOriginal filenames (from MFT entry history):\n- financial_report.xlsx ‚Üí financial_report.xlsx.RYK\n- passwords.txt ‚Üí passwords.txt.RYK\n- confidential.docx ‚Üí confidential.docx.RYK\n```\n\n**Reflect**:\n1. What **attack type** do these timestamps indicate? (Ransomware encryption)\n2. How long did encryption take? (32 minutes: 09:15 ‚Üí 09:47)\n3. What's the **encryption rate**? (2,223 files / 32 min = ~69 files/minute)\n4. How would you identify **patient zero**? (System with earliest encryption timestamps)\n\n**Critical Thinking**: If you analyze MFT on 50 systems and find the **same Modified timestamp range** on all, what does this suggest? (Automated lateral movement, simultaneous encryption)\n\n---\n\n### Question 8: Insider Threat - Exfiltration Timeline\n\n**Scenario**: Correlate MFT with other artifacts:\n\n```\nMFT:\n- trade_secrets.xlsx Modified: 2024-10-15 16:40:11 (last edit)\n- trade_secrets.xlsx Accessed: 2024-10-15 16:45:32 (read for copy?)\n\nRegistry USBSTOR:\n- USB device connected: 2024-10-15 16:44:21\n\nPrefetch:\n- ROBOCOPY.EXE Last Run: 2024-10-15 16:45:30\n\nEvent Logs:\n- User logoff: 2024-10-15 16:52:00\n```\n\n**Reflect**:\n1. Reconstruct the **timeline** of events. What happened in what order?\n2. What does **Accessed timestamp** during USB connection suggest?\n3. Why was **Robocopy** executed? (File copy tool)\n4. What's the time gap between file access and user logoff? (6 minutes 28 seconds)\n\n**Critical Thinking**: Does this timeline **prove** exfiltration? What's missing? (Need to verify file was actually copied to USB - check USB MFT if available)\n\n---\n\n### Question 9: Living Off the Land Detection\n\n**Scenario**: MFT shows PowerShell script created:\n\n```\nFilename: update.ps1\nPath: C:\\Windows\\Temp\\\nCreated: 2024-10-16 14:32:11 UTC\nModified: 2024-10-16 14:32:11 UTC\nAccessed: 2024-10-16 14:32:15 UTC (4 seconds after creation)\nIn Use: FALSE (deleted)\n```\n\n**Reflect**:\n1. What **red flags** do you see? (Script in Temp, accessed 4 seconds after creation, deleted)\n2. Does MFT prove the script **executed**? (No - only proves it was accessed)\n3. What **other artifacts** would confirm execution? (PowerShell logs, Prefetch for powershell.exe)\n4. Why was the script **deleted**? (Anti-forensics attempt)\n\n**Critical Thinking**: If PowerShell logs show script execution at 14:32:15 (same as Accessed time), what's your conclusion?\n\n---\n\n## Meta-Learning\n\n### Question 10: MFT Limitations\n\n**Scenario**: You're writing a forensic report and need to explain MFT limitations.\n\n**Reflect**:\n1. What **critical information** does MFT NOT provide? (User attribution, execution proof)\n2. How would you **compensate** for these limitations? (Correlate with Event Logs, Prefetch, AmCache)\n3. What's the **biggest strength** of MFT? (Complete filesystem timeline, deleted file recovery)\n4. What's the **biggest weakness**? (No execution proof, LastAccessTime unreliable)\n\n**Critical Thinking**: If you had to **rank** filesystem artifacts by forensic value:\n1. MFT\n2. $LogFile\n3. USN Journal\n4. $Recycle.Bin\n5. Volume Shadow Copies\n\nWhat's your ranking? Why?\n\n---\n\n### Question 11: Forensic Workflow\n\n**Scenario**: You've acquired $MFT from a compromised system. Design your analysis workflow.\n\n**Reflect**:\n1. What are the **first 3 steps**? (Parse with MFTECmd, filter In Use = FALSE, compare $SI vs $FN)\n2. How do you **prioritize** which entries to investigate? (Deleted files, suspicious paths, timestomped files)\n3. What **tools** would you use? (MFTECmd, Timeline Explorer, PowerShell)\n4. How do you **correlate** MFT with execution artifacts? (Merge timelines by timestamp)\n\n**Action Plan** (Design your own):\n```\nStep 1: _______________________\nStep 2: _______________________\nStep 3: _______________________\nStep 4: _______________________\nStep 5: _______________________\n```\n\n---\n\n### Question 12: Real-World Application\n\n**Scenario**: You just completed this lesson on MFT Analysis.\n\n**Reflect on Your Learning**:\n1. What was the **most surprising** discovery about MFT?\n2. Which real-world case study resonated most? (SolarWinds timestomping? Insider threat deleted files?)\n3. What concept do you still find **confusing**?\n4. How will you **practice** MFT analysis?\n\n**Action Plan**:\n- [ ] Download MFTECmd from Eric Zimmerman's site\n- [ ] Acquire $MFT from your own workstation (using RawCopy)\n- [ ] Parse MFT and filter for In Use = FALSE (find deleted files)\n- [ ] Compare $SI vs $FN timestamps (detect any timestomping)\n- [ ] Search for Zone.Identifier ADS (find internet downloads)\n- [ ] Build a merged timeline with Prefetch and AmCache\n\n---\n\n## Final Thought Exercise\n\n**Question**: You're investigating a data breach with 100+ compromised systems. You have MFT from all systems.\n\n**Design your investigation plan**:\n\n1. How would you identify **patient zero**? (Earliest file creation timestamps for malware)\n2. How would you prove **data exfiltration**? (File copy timestamps, USB ADS, deleted files)\n3. How would you detect **timestomping**? ($SI vs $FN comparison across all systems)\n4. How would you reconstruct **attack timeline**? (Merge MFT from all systems, sort by timestamp)\n5. What **IOCs** would you extract? (Malware filenames, paths, creation timestamps)\n\n**Deliverables**:\n- Patient zero system name\n- Malware creation timeline (first appearance on each system)\n- List of exfiltrated files (based on copy timestamps, USB evidence)\n- Timestomped files report ($SI vs $FN discrepancies)\n- Comprehensive attack timeline (MFT + Prefetch + AmCache + Event Logs)\n\n---\n\n**Remember**: Reflection isn't about memorization - it's about **critical thinking**.\n\nQuestion your assumptions:  \n- What does this timestamp **really mean**?  \n- Am I **missing** any alternative explanations?  \n- How can I **verify** this with other artifacts?\n\nMFT is powerful - but it's just **one piece** of the forensic puzzle. Master it, correlate it, and see the complete picture."
      }
    },
    {
      "type": "mindset_coach",
      "content": {
        "text": "## Congratulations! You've Mastered MFT Analysis! üéâ\n\nYou just learned the **foundation** of NTFS forensics - the Master File Table. This is the artifact that reveals Windows' **complete file history**, and now you understand:\n\n‚úÖ **MACB timestamps** (Modified, Accessed, Changed, Born)  \n‚úÖ **Timestomping detection** (Compare $STANDARD_INFORMATION vs $FILE_NAME)  \n‚úÖ **Deleted file recovery** (In Use = FALSE entries persist)  \n‚úÖ **Zone.Identifier ADS** (Proves internet downloads)  \n‚úÖ **File copy vs. move** (Born time analysis)  \n‚úÖ **MFTECmd parsing** (Industry-standard tool)  \n\n### What This Means for Your Career\n\nYou now have the skills to:\n\n- **Build filesystem timelines** (MACB timestamps for every file)\n- **Detect anti-forensics** (Timestomping via $SI vs $FN comparison)\n- **Recover deleted files** (MFT entries persist after deletion)\n- **Prove internet downloads** (Zone.Identifier ADS with source URLs)\n- **Investigate data theft** (File copy/move analysis, exfiltration timelines)\n\nThese techniques are used **daily** by:\n- Incident Response teams reconstructing ransomware attacks\n- Forensic investigators proving insider threats\n- SOC analysts hunting for persistence mechanisms\n- Law enforcement building evidence for court\n\n**This is foundational, career-defining knowledge.**\n\n### The NTFS Forensics Foundation\n\nYou've now mastered **four critical artifacts**:\n\n**Lesson 11: Registry Fundamentals**\n- Persistence (Run keys, Services)\n- User activity (RecentDocs, UserAssist)\n\n**Lesson 16: Prefetch Analysis**\n- Execution proof (run counts, last 8 executions)\n\n**Lesson 18: AmCache Analysis**\n- SHA-1 hashes (malware identification)\n- Deleted program evidence\n\n**Lesson 27: MFT Analysis** (This Lesson)\n- Complete filesystem timeline (MACB)\n- Timestomping detection ($SI vs $FN)\n- Deleted file recovery (In Use = FALSE)\n\n**The Power of Correlation**:\n\n```\nMFT:      File creation + modification + deletion timeline\n   +\nPrefetch: Execution proof + run counts\n   +\nAmCache:  SHA-1 hashes + first execution\n   +\nRegistry: Persistence + user activity\n   =\nCOMPLETE FORENSIC TIMELINE\n```\n\n### Real-World Impact\n\nThe techniques you learned today have been used to:\n\n‚úÖ **Detect APT29 timestomping** ($SI vs $FN discrepancies revealed fake timestamps)  \n‚úÖ **Recover deleted insider threat evidence** (MFT entries proved classified files existed)  \n‚úÖ **Reconstruct Ryuk ransomware timeline** (MACB timestamps showed 32-minute encryption window)  \n‚úÖ **Prove internet malware downloads** (Zone.Identifier ADS with distribution URLs)  \n‚úÖ **Identify data exfiltration** (File copy timestamps during USB connection)  \n\nYour MFT analysis skills will **solve real cases** and **protect organizations**.\n\n### Practice Makes Permanent\n\nKnowledge without practice fades. Here's your action plan:\n\n**This Week**:\n1. ‚úÖ Download MFTECmd and RawCopy from Eric Zimmerman's site\n2. ‚úÖ Acquire $MFT from your own workstation\n3. ‚úÖ Parse MFT and identify your 10 most recently created files\n\n**This Month**:\n1. ‚úÖ Set up a Windows 10 VM and create test scenarios\n2. ‚úÖ Practice timestomping detection ($SI vs $FN comparison)\n3. ‚úÖ Build a merged timeline (MFT + Prefetch + AmCache)\n\n**This Year**:\n1. ‚úÖ Join a DFIR CTF competition (apply MFT skills to challenges)\n2. ‚úÖ Read forensic case studies (search \"MFT analysis\" on SANS blogs)\n3. ‚úÖ Contribute to open-source tools (Python MFT parsers)\n\n### You're Building Something Valuable\n\nEvery lesson you complete:\n- ‚úÖ Adds another forensic technique to your arsenal\n- ‚úÖ Makes you more valuable to employers (MFT + execution artifacts = Expert-level)\n- ‚úÖ Increases your ability to investigate complex attacks\n- ‚úÖ Brings you closer to your career goals\n\n**This isn't just education - it's career transformation.**\n\n### Next Steps\n\nWhen you're ready, move on to **Lesson 34: LNK File Analysis**. You'll learn how Windows shortcut files (.lnk) reveal file access patterns, network share connections, and provide **additional timestamps** for timeline analysis.\n\nBut first, take a moment to celebrate. You just mastered:\n- MFT structure and attributes ($STANDARD_INFORMATION, $FILE_NAME, $DATA)\n- MACB timestamp interpretation (Modified, Accessed, Changed, Born)\n- Timestomping detection ($SI vs $FN comparison)\n- Deleted file recovery (In Use = FALSE)\n- Zone.Identifier ADS analysis (internet downloads)\n- File copy vs. move analysis (born time preservation)\n- MFTECmd parsing and Timeline Explorer visualization\n- Real-world case studies (APT29, Ryuk, insider threats)\n\n**That's serious forensic capability.**\n\n### You're Not Just Learning - You're Becoming a Forensic Analyst\n\nEvery artifact you master:\n- Reveals another piece of the attacker's story\n- Strengthens your investigative methodology\n- Builds confidence in your analysis\n\nMFT proves file creation and deletion.  \nPrefetch shows execution frequency.  \nAmCache identifies malware by hash.  \nRegistry reveals persistence.  \n**Together, they reconstruct complete attack narratives.**\n\nKeep going. The digital forensics community needs skilled investigators who can:\n- Detect timestamp manipulation\n- Recover deleted file evidence\n- Build comprehensive timelines\n- Correlate multiple artifacts\n\n**You're building those skills right now.**\n\n### Remember This\n\nWhen you're parsing MFT during a live ransomware investigation, or when you're presenting timestomping evidence in court, or when you're recovering deleted file metadata to prove insider theft - **you'll remember this lesson**.\n\nThe MFT is Windows' **black box** - it records everything.\n\n**MACB timestamps tell the file's story. $SI vs $FN reveal the truth.**\n\n**And now you know how to read them.**\n\nüîç **Master MFT. Detect Timestomping. Reconstruct Timelines.**\n\nNext up: **LNK File Analysis** - Windows shortcuts reveal file access and network share evidence. See you there!"
      }
    }
  ],
  "tags": [
    "Course: SANS-FOR500"
  ]
}