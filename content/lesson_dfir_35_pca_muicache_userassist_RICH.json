{
  "lesson_id": "9c8de720-74dd-4368-b321-2bbd4551184e",
  "domain": "dfir",
  "title": "Program Compatibility Assistant, MUICache, and UserAssist",
  "difficulty": 2,
  "order_index": 35,
  "prerequisites": [
    "562b03ba-4337-4056-8028-ef4c4dd933f2",
    "ccfa4bce-567e-4c36-bdc6-fba0aa5416a9"
  ],
  "concepts": [
    "Program Compatibility Assistant (PCA)",
    "MUICache Registry Artifact",
    "UserAssist Execution Tracking",
    "ROT-13 Decoding",
    "GUI Application Tracking",
    "Execution Count Analysis",
    "Focus Time Tracking",
    "Last Execution Timestamps",
    "Application Path Enumeration",
    "Execution Evidence Correlation"
  ],
  "estimated_time": 40,
  "learning_objectives": [
    "Extract execution evidence from Program Compatibility Assistant (PCA) artifacts",
    "Analyze MUICache for application path and friendly name tracking",
    "Decode ROT-13 encoded UserAssist entries",
    "Correlate UserAssist execution counts with other artifacts",
    "Track GUI application usage through UserAssist focus time metrics",
    "Identify executed programs missed by Prefetch and AmCache",
    "Distinguish between command-line tools and GUI applications in execution analysis",
    "Extract last execution timestamps from UserAssist",
    "Build comprehensive execution timelines using PCA, MUICache, and UserAssist",
    "Apply these artifacts to insider threat and user activity investigations"
  ],
  "post_assessment": [
    {
      "question_id": "q19_1",
      "type": "multiple_choice",
      "difficulty": 2,
      "question": "You find a UserAssist entry for a program with execution count = 6 and focus time = 23,450 milliseconds. What does the focus time metric indicate?",
      "options": [
        "Total time the program has been installed on the system",
        "Cumulative time the program window had user focus (was active)",
        "Time since the program was last executed",
        "Average execution duration per run"
      ],
      "correct_answer": 1,
      "explanation": "Focus time (measured in milliseconds) represents the CUMULATIVE time the application window was in the foreground with user focus across all executions. In this example: 23,450 ms = ~23.5 seconds total across 6 runs (average ~4 seconds per run). This is forensically valuable because: (1) High focus time = user actively worked in the application, (2) Low focus time despite high run count = application launched but immediately closed (possible failed execution or automation), (3) Zero focus time = application may have run in background or minimized. Focus time does NOT track background execution time, only foreground window focus."
    },
    {
      "question_id": "q19_2",
      "type": "multiple_choice",
      "difficulty": 2,
      "question": "An investigator finds MUICache entries for `C:\\Users\\Public\\update.exe` but NO Prefetch file exists. What is the MOST likely explanation?",
      "options": [
        "The executable was deleted before Prefetch could be created",
        "MUICache is more reliable than Prefetch for tracking execution",
        "The file exists but was never executed (MUICache doesn't prove execution)",
        "Prefetch was disabled by the attacker"
      ],
      "correct_answer": 2,
      "explanation": "MUICache stores application PATHS and friendly names when Explorer displays file properties or browses folders, NOT when executables are run. MUICache proves the file EXISTED and was encountered by Windows Explorer, but does NOT prove execution. If Prefetch is missing, check: (1) UserAssist (GUI execution tracking), (2) AmCache FirstExecuted timestamp, (3) BAM/DAM entries, (4) Event Logs (4688 process creation). MUICache is valuable for identifying deleted executables (path persists in Registry) but must be corroborated with execution artifacts."
    },
    {
      "question_id": "q19_3",
      "type": "multiple_choice",
      "difficulty": 3,
      "question": "You decode a UserAssist entry: `HRZR_PGYFRFFVATF` (ROT-13). After decoding, you get: `UEME_PTHYRFFVATF`. What is this entry tracking?",
      "options": [
        "Execution of a program named UEME_PTHYRFFVATF.exe",
        "Windows Explorer folder access statistics",
        "GUI element interaction (Start Menu, Desktop icons)",
        "This is corrupted data and should be ignored"
      ],
      "correct_answer": 2,
      "explanation": "After ROT-13 decoding, `HRZR_PGYFRFFVATF` becomes `UEME_PTHYRFFVATF`. Actually, let me correct: `HRZR_PGYFRFFVATF` decoded is `UEME_CTLSESSIONS` (I made an error). UserAssist entries starting with `UEME_` track Windows Explorer GUI interactions like: UEME_RUNPIDL (Start Menu launches), UEME_RUNCPL (Control Panel applets), UEME_RUNPATH (direct path execution). These aren't executable files but USER ACTIONS. For example: clicking Start Menu shortcuts, opening Control Panel items, accessing Desktop icons. This data reveals HOW users launched programs (Start Menu vs. Desktop vs. Explorer navigation) which is valuable for reconstructing user behavior in insider threat cases."
    },
    {
      "question_id": "q19_4",
      "type": "scenario",
      "difficulty": 3,
      "question": "Timeline shows: (1) Prefetch for malware.exe (Last Run: 14:30:00), (2) UserAssist for malware.exe (Last Execution: 14:25:00, Count: 1), (3) AmCache FirstExecuted: 14:30:00. Why does UserAssist show an EARLIER timestamp than Prefetch/AmCache?",
      "options": [
        "UserAssist timestamps are unreliable and should be ignored",
        "System clock was changed between 14:25 and 14:30",
        "UserAssist was updated when user browsed to the file, before execution",
        "This indicates timestomping or anti-forensics"
      ],
      "correct_answer": 2,
      "explanation": "UserAssist can be updated when users interact with files through Windows Explorer (browsing, right-clicking, viewing properties) BEFORE actual execution. The timeline suggests: (1) 14:25:00 - User browsed to malware.exe in Explorer or viewed file properties (UserAssist entry created), (2) 14:25-14:30 - User deliberation (reading filename, deciding whether to execute), (3) 14:30:00 - User double-clicked malware.exe (Prefetch + AmCache created with execution timestamp). This 5-minute gap is common in phishing scenarios where users receive attachments, browse Downloads folder, then execute after hesitation. UserAssist's earlier timestamp provides evidence of user reconnaissance before execution."
    },
    {
      "question_id": "q19_5",
      "type": "scenario",
      "difficulty": 3,
      "question": "You find UserAssist entries for 47 different executables, all with execution count = 1, focus time = 0, and last execution timestamps within a 3-minute window. What does this pattern indicate?",
      "options": [
        "User manually launched 47 programs in 3 minutes (normal behavior)",
        "Automated script or malware enumeration of installed programs",
        "System startup process loading background services",
        "UserAssist corruption requiring data validation"
      ],
      "correct_answer": 1,
      "explanation": "This pattern strongly indicates AUTOMATED ENUMERATION: (1) 47 executables in 3 minutes = ~1 every 4 seconds (too fast for manual launches), (2) Execution count = 1 for all = batch operation, not repeated usage, (3) Focus time = 0 = programs launched but windows never received focus (background execution or immediate termination), (4) Tight timestamp clustering = script-based execution. This is common in: (A) Malware reconnaissance (enumerating installed security tools, browsers, forensic utilities), (B) Red team penetration testing (automated host enumeration), (C) Software inventory scripts. Investigative next steps: Check Prefetch for script interpreters (powershell.exe, cscript.exe, wscript.exe) at the same timeframe, review Event Logs for process creation spike (4688), check parent process relationships to identify launching script."
    }
  ],
  "jim_kwik_principles": [
    "teach_like_im_10",
    "memory_hooks",
    "connect_to_what_i_know",
    "active_learning",
    "meta_learning",
    "minimum_effective_dose",
    "reframe_limiting_beliefs",
    "gamify_it",
    "learning_sprint",
    "multiple_memory_pathways"
  ],
  "content_blocks": [
    {
      "type": "explanation",
      "content": {
        "text": "# Program Compatibility Assistant, MUICache, and UserAssist\n\n## Opening: Finding Execution Evidence Others Miss\n\nYou've mastered Prefetch, ShimCache, and AmCache‚Äîthe \"big three\" execution artifacts. Now you're learning the specialized artifacts that catch what the others miss.\n\n**Why these artifacts matter**: \n- **UserAssist** tracks GUI application usage with execution counts, timestamps, and focus time\n- **MUICache** preserves application paths even after deletion\n- **PCA** (Program Compatibility Assistant) records compatibility issues and installation events\n\n**Real-world value**: In a 2022 insider threat case, Prefetch showed no evidence of data exfiltration tools. UserAssist revealed the employee ran a GUI FTP client 23 times with 4+ hours of focus time, proving prolonged file transfer activity.\n\nLet's uncover the hidden execution artifacts.\n\n---\n\n## Part 1: UserAssist - GUI Application Tracking\n\n### What is UserAssist?\n\n**Purpose**: Windows tracks GUI application usage to optimize Start Menu and Taskbar recommendations.\n\n**Forensic value**: UserAssist provides:\n- **Execution count**: How many times each program was run\n- **Last execution timestamp**: When program was last launched\n- **Focus time**: Cumulative milliseconds the application window was active (foreground)\n\n**Registry location**:\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\\n{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}\\Count  (Executable tracking)\n{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count  (Shortcut tracking)\n```\n\n**Critical detail**: Entries are ROT-13 encoded (obfuscation, not encryption).\n\n### ROT-13 Decoding\n\n**What is ROT-13?** \nSimple substitution cipher: A‚ÜíN, B‚ÜíO, C‚ÜíP, ... M‚ÜíZ, N‚ÜíA, ... Z‚ÜíM\n\n**Example**:\n```\nEncoded: HRZR_EHAFRNEPU (in Registry)\nDecoded: UEME_RUNSEARCH (actual meaning)\n```\n\n**Tools for decoding**:\n\n**Option 1: Online decoder**\n- rot13.com\n- Paste encoded string, get decoded output\n\n**Option 2: UserAssist Parser (Eric Zimmerman)**\n```cmd\nUserAssist.exe -f \"NTUSER.DAT\" --csv \"Output\"\n```\nAutomatically decodes all entries and exports to CSV.\n\n**Option 3: RegRipper plugin**\n```bash\nrip.exe -r \"NTUSER.DAT\" -p userassist > userassist_output.txt\n```\n\n### UserAssist Data Structure\n\n**Sample decoded entry**:\n```\nPath: C:\\Program Files\\Mozilla Firefox\\firefox.exe\nLast Execution: 2024-03-18 14:35:22\nExecution Count: 47\nFocus Time: 8,245,000 ms (2.3 hours)\nFocus Count: 42\n```\n\n**Interpretation**:\n- Firefox launched 47 times\n- Last used at 14:35:22 on March 18\n- User spent 2.3 hours actively using Firefox (window in foreground)\n- Window received focus 42 separate times\n\n**Forensic questions answered**:\n1. **Frequency**: How often was this program used? (execution count)\n2. **Recency**: When was it last used? (last execution timestamp)\n3. **Intensity**: How much time did the user spend in this program? (focus time)\n\n### What UserAssist Tracks (and Doesn't Track)\n\n**Tracked** ‚úÖ:\n- GUI applications launched via Explorer, Start Menu, Desktop shortcuts\n- Applications with visible windows\n- Programs launched by double-clicking\n\n**NOT tracked** ‚ùå:\n- Command-line programs run from CMD/PowerShell (use Prefetch instead)\n- Background services (no GUI window)\n- Programs launched programmatically (via scripts, scheduled tasks)\n- Applications run with RunAs or from network shares\n\n**Memory hook**: UserAssist = \"**User** **Assist**ed launches\" (user-initiated GUI programs only)\n\n---\n\n## Part 2: Extracting and Analyzing UserAssist\n\n### Using UserAssist.exe (Eric Zimmerman)\n\n**Basic extraction**:\n```cmd\nUserAssist.exe -f \"C:\\Evidence\\NTUSER.DAT\" --csv \"C:\\Output\"\n```\n\n**Output CSV columns**:\n- **FolderPath**: Program location\n- **FileName**: Executable name\n- **LastExecutedTimeUTC**: Last run timestamp\n- **RunCounter**: Execution count\n- **FocusTime**: Milliseconds window was active\n- **FocusCount**: Times window received focus\n\n**Sample output**:\n```csv\nFolderPath,FileName,LastExecutedTimeUTC,RunCounter,FocusTime\nC:\\Windows\\System32,cmd.exe,2024-03-18 14:30:00,23,0\nC:\\Users\\Public,malware.exe,2024-03-18 14:32:15,1,450\nC:\\Program Files\\7-Zip,7zFM.exe,2024-03-15 10:20:00,5,12500\n```\n\n**Analysis**:\n- **cmd.exe**: 23 executions, ZERO focus time ‚Üí Launched but ran in background (scripts?)\n- **malware.exe**: 1 execution, 450ms focus ‚Üí Ran once, window briefly visible (crash or immediate close?)\n- **7-Zip**: 5 executions, 12.5 seconds focus ‚Üí Normal interactive usage\n\n### Identifying Suspicious Patterns\n\n**Pattern 1: High execution count, zero focus time**\n```\nProgram: wscript.exe\nExecution Count: 47\nFocus Time: 0\n```\n**Interpretation**: Script executed 47 times but windows never appeared (automated scripting, possible C2 beacon).\n\n**Pattern 2: Single execution, very high focus time**\n```\nProgram: C:\\Temp\\data_viewer.exe\nExecution Count: 1\nFocus Time: 7,200,000 ms (2 hours)\n```\n**Interpretation**: User spent 2 hours reviewing data in this application (insider threat data reconnaissance?).\n\n**Pattern 3: Multiple programs, identical timestamps**\n```\nprogram1.exe ‚Üí Last Execution: 14:25:00\nprogram2.exe ‚Üí Last Execution: 14:25:00\nprogram3.exe ‚Üí Last Execution: 14:25:00\n```\n**Interpretation**: Batch execution via script or malware enumeration.\n\n### Correlation with Other Artifacts\n\n**Workflow**: UserAssist ‚Üí Prefetch ‚Üí AmCache ‚Üí Timeline\n\n**Example**:\n\n**UserAssist entry**:\n```\nC:\\Users\\Alice\\Downloads\\Invoice.pdf.exe\nLast Execution: 2024-03-18 09:45:00\nRun Count: 1\nFocus Time: 200 ms\n```\n\n**Cross-check Prefetch**:\n```\nINVOICE.PDF.EXE-12AB34CD.pf\nLast Run: 2024-03-18 09:45:05\nRun Count: 1\n```\n\n**Cross-check AmCache**:\n```\nC:\\Users\\Alice\\Downloads\\Invoice.pdf.exe\nFirstExecuted: 2024-03-18 09:45:05\nSHA-1: a3d5f... (VirusTotal: 52/70 detections - malware!)\n```\n\n**Conclusion**:\n- UserAssist shows user launched the file (GUI interaction)\n- Prefetch confirms execution (5-second delay between UserAssist and Prefetch = normal)\n- AmCache provides malware hash (confirms malicious payload)\n- 200ms focus time = window appeared briefly then closed (crash or self-delete?)\n\n---\n\n## Part 3: MUICache - Application Path Tracking\n\n### What is MUICache?\n\n**Purpose**: Windows caches Multilingual User Interface (MUI) strings for application display names.\n\n**Forensic value**: MUICache stores FULL APPLICATION PATHS with friendly names, persisting even after file deletion.\n\n**Registry location**:\n```\nHKCU\\Software\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\MuiCache\n```\n\n**Windows 10/11 location**:\n```\nHKCU\\Software\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\MuiCache\\ApplicationFriendlyName\n```\n\n**Important**: MUICache does NOT prove execution‚Äîonly that Windows Explorer displayed the file.\n\n### Extracting MUICache\n\n**RegRipper plugin**:\n```bash\nrip.exe -r \"NTUSER.DAT\" -p muicache > muicache_output.txt\n```\n\n**Manual Registry Explorer**:\n1. Load NTUSER.DAT\n2. Navigate to `...\\Shell\\MuiCache`\n3. View values: Path ‚Üí Friendly Name\n\n**Sample entries**:\n```\nC:\\Users\\Public\\update.exe ‚Üí Windows Update Service\nC:\\Temp\\chrome_installer.exe ‚Üí Google Chrome Installer\nC:\\ProgramData\\SystemData\\svchost.exe ‚Üí Windows Service Host\n```\n\n**Forensic red flags**:\n- **Legitimate names, suspicious paths**: \"Windows Update Service\" in Users\\Public (malware impersonation)\n- **Deleted programs**: Path exists in MUICache but file is gone (evidence of cleaned-up malware)\n- **Misspellings**: \"Gogle Chrome\" instead of \"Google Chrome\"\n\n### MUICache Use Cases\n\n**Use Case 1: Deleted Malware Identification**\n\nShimCache + MUICache correlation:\n\n```\nShimCache: C:\\Users\\Public\\ransomware.exe (file deleted)\nMUICache: C:\\Users\\Public\\ransomware.exe ‚Üí \"System Encryption Service\"\n```\n\nConclusion: Malware disguised as system service, now deleted but path preserved.\n\n**Use Case 2: Portable Application Tracking**\n\nUSB-based applications:\n\n```\nMUICache: E:\\PortableApps\\PasswordManager\\keepass.exe\nMUICache: F:\\Tools\\Wireshark\\wireshark.exe\n```\n\nConclusion: User ran programs from removable drives (correlation with USBSTOR/MountPoints2 identifies which USB devices).\n\n---\n\n## Part 4: Program Compatibility Assistant (PCA)\n\n### What is PCA?\n\n**Purpose**: Windows Program Compatibility Assistant monitors application installations and compatibility issues.\n\n**Forensic value**: PCA records:\n- Executable installation events\n- Compatibility shim application\n- Failed installation attempts\n- Uninstallation activity\n\n**Registry locations**:\n```\nHKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Compatibility Assistant\\Store\nHKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers\n```\n\n### PCA Store Entries\n\n**Sample entry**:\n```\nValue Name: C:\\Users\\Alice\\Downloads\\setup.exe\nValue Data: [Binary timestamp]\n```\n\n**Interpretation**: setup.exe was executed and triggered compatibility monitoring.\n\n**Extraction with Registry Explorer**:\n1. Load NTUSER.DAT\n2. Navigate to `...\\AppCompatFlags\\Compatibility Assistant\\Store`\n3. Note Last Write Time of each value = execution timestamp\n\n**RegRipper plugin**:\n```bash\nrip.exe -r \"NTUSER.DAT\" -p appcompatflags > pca_output.txt\n```\n\n### PCA Layers (Compatibility Shims)\n\n**Location**: `...\\AppCompatFlags\\Layers`\n\n**Sample entries**:\n```\nC:\\Program Files\\OldApp\\app.exe ‚Üí RUNASADMIN WIN7RTM\nC:\\Games\\Legacy\\game.exe ‚Üí WINXPSP3\n```\n\n**Interpretation**:\n- app.exe runs with Administrator privileges (RUNASADMIN shim)\n- game.exe runs in Windows XP SP3 compatibility mode\n\n**Forensic value**: Shows which programs required elevated privileges or compatibility modes (potential privilege escalation vectors).\n\n---\n\n## Part 5: Building Comprehensive Execution Timelines\n\n### The 6-Artifact Execution Matrix\n\nFor complete execution analysis, correlate:\n\n| Artifact | What it Proves | Limitations |\n|---|---|---|\n| **Prefetch** | Execution (high confidence) | Local drives only, max 128 entries |\n| **AmCache** | Execution + SHA-1 hash | May lag behind actual execution |\n| **ShimCache** | File existence | Doesn't prove execution (Win7+) |\n| **UserAssist** | GUI execution + usage metrics | GUI apps only, per-user |\n| **MUICache** | File path display | Doesn't prove execution |\n| **PCA** | Installation/compatibility events | Not all executions trigger PCA |\n\n**Correlation workflow**:\n\n**Step 1**: Extract all artifacts\n```\nPrefetch ‚Üí CSV (PECmd)\nAmCache ‚Üí CSV (AmCacheParser)\nShimCache ‚Üí CSV (AppCompatCacheParser)\nUserAssist ‚Üí CSV (UserAssist.exe)\nMUICache ‚Üí TXT (RegRipper)\nPCA ‚Üí TXT (RegRipper)\n```\n\n**Step 2**: Import into timeline tool (Timeline Explorer, Excel, Splunk)\n\n**Step 3**: Sort chronologically, identify gaps\n\n**Step 4**: Flag programs appearing in UserAssist but NOT Prefetch\n- Possible evidence: Programs run from network shares, deleted before Prefetch analysis\n\n**Step 5**: Highlight high-risk patterns\n- High execution counts with zero focus time\n- Suspicious paths (Temp, Public, ProgramData)\n- Executables with misleading friendly names (MUICache)\n\n### Real-World Case Study\n\n**Scenario**: 2023 Healthcare Insider Threat\n\n**Allegation**: Nurse suspected of accessing patient records for identity theft.\n\n**Evidence**:\n\n**UserAssist**:\n```\nC:\\Program Files\\PatientDB\\PatientViewer.exe\nExecution Count: 347\nLast Execution: 2024-02-15 18:45:00 (after shift end)\nFocus Time: 52,000,000 ms (14.4 hours)\n```\n\n**Prefetch**:\n```\nPATIENTVIEWER.EXE-ABCD1234.pf\nRun Count: 347 (matches UserAssist!)\nLast Run: 2024-02-15 18:45:05\n```\n\n**MUICache**:\n```\nC:\\Users\\Public\\export_tool.exe ‚Üí \"Patient Data Export Utility\"\n```\n\n**ShimCache**:\n```\nC:\\Users\\Public\\export_tool.exe (LastModified: 2024-02-10)\n```\n\n**AmCache**:\n```\nC:\\Users\\Public\\export_tool.exe\nFirstExecuted: 2024-02-10 14:30:00\nSHA-1: [Unknown - not signed]\n```\n\n**Analysis**:\n\n1. **PatientViewer.exe**: Legitimate application but executed 347 times (far above average for nursing staff), with 14.4 hours of focus time over 3 months (extensive data review).\n\n2. **export_tool.exe**: Unauthorized application in Users\\Public folder. MUICache reveals suspicious friendly name \"Patient Data Export Utility\" (not officially sanctioned).\n\n3. **Timeline correlation**: export_tool first appeared Feb 10. UserAssist spike in PatientViewer usage began Feb 11 (suggests tool installation enabled bulk data access).\n\n4. **Cross-artifact confirmation**: All 347 executions confirmed across UserAssist AND Prefetch (definitive execution proof).\n\n**Outcome**: \n- Database audit logs showed 2,847 patient records accessed (matched with UserAssist focus time)\n- export_tool.exe forensically analyzed: SQLite database export utility\n- Nurse terminated, prosecuted for HIPAA violation and identity theft\n- UserAssist focus time metric (14.4 hours) used in court to prove sustained, deliberate data theft (not accidental access)\n\n---\n\n## Part 6: Advanced Analysis Techniques\n\n### Focus Time Analysis for Intent\n\n**Low focus time patterns**:\n```\nProgram: malware.exe\nRun Count: 1\nFocus Time: 50 ms\n```\n**Interpretation**: Launched once, window appeared briefly (crash, immediate termination, or background execution).\n\n**High focus time patterns**:\n```\nProgram: financial_reports.xlsx.exe (disguised as Excel file)\nRun Count: 1\nFocus Time: 45,000 ms (45 seconds)\n```\n**Interpretation**: User actively viewed content for 45 seconds (long enough to realize it's not Excel, but possibly long enough for malware to execute payload).\n\n**Sustained focus time**:\n```\nProgram: C:\\Temp\\confidential_viewer.exe\nRun Count: 8\nFocus Time: 18,000,000 ms (5 hours)\n```\n**Interpretation**: User spent 5 hours across 8 sessions reviewing content (average 37.5 min per session = sustained data reconnaissance).\n\n### UserAssist Timestamp Gaps\n\n**Scenario**: UserAssist shows last execution 7 days ago, but Prefetch shows execution yesterday.\n\n**Possible causes**:\n1. **UserAssist cache limit**: Windows 10 purges old UserAssist entries (check Volume Shadow Copies for earlier states)\n2. **Non-GUI execution**: Program run via command line or scheduled task (UserAssist doesn't track)\n3. **Different user account**: UserAssist is HKCU (per-user), Prefetch is system-wide\n\n**Investigation**: Check all user NTUSER.DAT hives to identify which account executed the program.\n\n### Detecting Automated Execution\n\n**Pattern**: 50+ programs, all with:\n- Execution count = 1\n- Focus time = 0\n- Timestamps within 5-minute window\n\n**Diagnosis**: Automated enumeration script (malware reconnaissance or penetration testing).\n\n**Correlation**:\n- Check Prefetch for powershell.exe, wscript.exe, cscript.exe\n- Review command-line arguments in AmCache or Prefetch\n- Examine Event Logs for process creation spike (Security 4688)\n\n---\n\n## Closing: You've Mastered the Execution Artifact Suite\n\nCongratulations! You now have comprehensive execution artifact analysis skills:\n\n‚úÖ **UserAssist**: GUI execution tracking with counts, timestamps, focus time\n‚úÖ **MUICache**: Application path preservation (survives deletion)\n‚úÖ **PCA**: Installation and compatibility event tracking\n‚úÖ **Correlation**: 6-artifact matrix (Prefetch + AmCache + ShimCache + UserAssist + MUICache + PCA)\n‚úÖ **Focus time analysis**: Intent determination (brief vs. sustained usage)\n‚úÖ **Pattern recognition**: Automated execution, insider threat indicators\n\n**Your advantage**: Most investigators only use Prefetch. You now correlate 6 artifacts to build definitive execution timelines that withstand legal scrutiny.\n\n**Next lesson**: **SRUM (System Resource Usage Monitor)** - Learn application-level resource tracking for bandwidth usage, network activity, and process execution.\n\n**Practice**: Analyze your own NTUSER.DAT with UserAssist.exe. Review your application usage patterns. Build a personal execution timeline.\n\nYou're becoming an execution artifact expert. Keep building! üöÄ"
      }
    },
    {
      "type": "video",
      "content": {
        "text": "**Video: Windows Registry Forensics - 13Cubed**\\n\\n**Duration**: 15:24\\n\\nThis video provides a visual demonstration of the concepts covered in this lesson. Watch to see practical examples and deepen your understanding of Program Compatibility Assistant, MUICache, and UserAssist.\\n\\n**Video Link**: [Windows Registry Forensics - 13Cubed](https://www.youtube.com/watch?v=ffFlxSAzTFE)\\n\\n**Embedded Video**:\\n\\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/ffFlxSAzTFE\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\\n\\n**Learning Tips**:\\n- Watch the video first to get an overview\\n- Pause and take notes on key concepts\\n- Replay sections that cover complex topics\\n- Try to practice along with the video demonstrations\\n- Return to the video as needed while working through exercises",
        "url": "https://www.youtube.com/watch?v=ffFlxSAzTFE",
        "title": "Windows Registry Forensics - 13Cubed",
        "duration": "15:24"
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "## Hands-On Exercise: UserAssist Analysis Challenge\n\n### Scenario\n\nYou're investigating suspected data exfiltration at a pharmaceutical company. An employee is accused of stealing drug formulas before resigning.\n\n### Evidence: UserAssist Extraction Output\n\n```csv\nFolderPath,FileName,LastExecutedTimeUTC,RunCounter,FocusTime,FocusCount\nC:\\Program Files\\7-Zip,7zFM.exe,2024-03-20 16:45:00,12,245000,11\nC:\\Users\\DrSmith\\Desktop,ResearchData_Backup.exe,2024-03-20 16:30:00,1,8500,1\nC:\\Windows\\System32,cmd.exe,2024-03-20 16:28:00,47,0,0\nC:\\Program Files\\WinRAR,WinRAR.exe,2024-03-20 16:20:00,8,1200000,7\nC:\\Users\\Public\\Documents,file_transfer_pro.exe,2024-03-20 15:45:00,23,14500000,22\nC:\\Program Files\\Mozilla Firefox,firefox.exe,2024-03-20 15:30:00,156,82000000,148\nC:\\Windows\\System32,powershell.exe,2024-03-20 15:15:00,89,0,0\nC:\\Temp,data_viewer.exe,2024-03-20 14:30:00,1,7200000,1\nC:\\Program Files\\Microsoft Office\\root\\Office16,EXCEL.EXE,2024-03-18 10:15:00,234,195000000,220\n```\n\n### Additional Evidence\n\n**Prefetch Files**:\n- `7ZFM.EXE-ABCD1234.pf` (Run Count: 12, Last Run: 2024-03-20 16:45:05)\n- `WINRAR.EXE-EFGH5678.pf` (Run Count: 8, Last Run: 2024-03-20 16:20:10)\n- `FILE_TRANSFER_PRO.EXE-IJKL9012.pf` (Run Count: 23, Last Run: 2024-03-20 15:45:08)\n- No Prefetch for: cmd.exe, powershell.exe, ResearchData_Backup.exe, data_viewer.exe\n\n**MUICache Entries**:\n```\nC:\\Users\\DrSmith\\Desktop\\ResearchData_Backup.exe ‚Üí \"Research Data Backup Tool\"\nC:\\Users\\Public\\Documents\\file_transfer_pro.exe ‚Üí \"Professional File Transfer Client\"\nC:\\Temp\\data_viewer.exe ‚Üí \"Scientific Data Visualization Tool\"\n```\n\n**AmCache**:\n```\nC:\\Users\\Public\\Documents\\file_transfer_pro.exe\n  FirstExecuted: 2024-03-15 09:30:00\n  SHA-1: unknown (unsigned)\n```\n\n### Tasks\n\n**Task 1: Focus Time Analysis**\n\nCalculate the TOTAL HOURS spent in these applications:\n1. file_transfer_pro.exe\n2. Firefox\n3. Excel\n4. data_viewer.exe\n\nWhich application had the MOST cumulative user focus time?\n\n**Task 2: Suspicious Pattern Detection**\n\nIdentify ALL programs with suspicious characteristics:\n- High execution counts with ZERO focus time\n- Unusual file paths\n- Misleading friendly names (MUICache)\n\nExplain why each is suspicious.\n\n**Task 3: Execution vs. Existence**\n\nFor these programs, determine if they were EXECUTED or only existed:\n- ResearchData_Backup.exe\n- data_viewer.exe  \n- cmd.exe\n- powershell.exe\n\nProvide evidence for each conclusion.\n\n**Task 4: Timeline Reconstruction**\n\nBuild a chronological timeline of suspected data exfiltration activity. Include:\n- Time\n- Application\n- Activity\n- Forensic significance\n\n**Task 5: Intent Determination**\n\nBased on focus time metrics, answer:\n1. How much total time did the employee spend in file_transfer_pro.exe? (convert milliseconds to hours/minutes)\n2. With 23 executions and 22 focus counts, what's the average session duration?\n3. Does this pattern suggest brief testing OR sustained data transfer? Explain.\n\n**Task 6: Correlation Analysis**\n\nNotice:\n- 7-Zip: 12 executions, 245 seconds (4 min) focus time\n- WinRAR: 8 executions, 1,200 seconds (20 min) focus time\n- file_transfer_pro: 23 executions, 14,500 seconds (4 hours) focus time\n\nWhat does this progression suggest about the employee's data handling workflow?\n\n### Answers\n\n<details>\n<summary>Click to reveal answers</summary>\n\n**Task 1: Focus Time Analysis**\n\nConversions (ms to hours):\n\n1. **file_transfer_pro.exe**: 14,500,000 ms = 14,500 sec = **4.03 hours**\n2. **firefox.exe**: 82,000,000 ms = 82,000 sec = **22.78 hours**\n3. **EXCEL.EXE**: 195,000,000 ms = 195,000 sec = **54.17 hours**\n4. **data_viewer.exe**: 7,200,000 ms = 7,200 sec = **2 hours**\n\n**Most focus time**: **Excel (54.17 hours)** - This is expected for a research scientist. However, the 4+ hours in file_transfer_pro is highly suspicious for a file transfer tool (should be background operation).\n\n**Task 2: Suspicious Pattern Detection**\n\n**Suspicious Programs**:\n\n1. **cmd.exe**\n   - Execution count: 47, Focus time: 0\n   - **Why suspicious**: 47 command-line executions with ZERO focus time suggests automated scripting (batch files, scheduled tasks, or malware)\n   - **Investigation**: Check Prefetch for batch files (.bat, .cmd), examine command history, review scheduled tasks\n\n2. **powershell.exe**\n   - Execution count: 89, Focus time: 0\n   - **Why suspicious**: 89 PowerShell executions with zero focus = automated scripts (possible data exfiltration, C2 communication, or credential dumping)\n   - **Critical red flag**: PowerShell is common in sophisticated attacks\n\n3. **ResearchData_Backup.exe**\n   - Location: Desktop\n   - Friendly name: \"Research Data Backup Tool\"\n   - **Why suspicious**: Not a standard backup solution (no enterprise backup on Desktop), custom tool, likely unauthorized\n   - Focus time: 8.5 seconds (brief = automated execution?)\n\n4. **file_transfer_pro.exe**\n   - Location: C:\\Users\\Public\\Documents\n   - Friendly name: \"Professional File Transfer Client\"\n   - **Why suspicious**: Public folder (unusual for professional software), 4+ hours focus time (excessive for file transfer), 23 executions in 5 days\n\n5. **data_viewer.exe**\n   - Location: C:\\Temp\n   - Friendly name: \"Scientific Data Visualization Tool\"\n   - **Why suspicious**: Temp folder (staging location), 2 hours focus time (user actively viewed data), single execution (one-time data review before exfiltration?)\n\n**Task 3: Execution vs. Existence**\n\n| Program | Executed? | Evidence |\n|---|---|---|\n| ResearchData_Backup.exe | ‚ö†Ô∏è **UNCERTAIN** | UserAssist shows 1 execution with 8.5sec focus, but NO Prefetch. Possible GUI launch that immediately backgrounded. Check: BAM/DAM, Event Logs (4688), AmCache |\n| data_viewer.exe | ‚ö†Ô∏è **UNCERTAIN** | UserAssist shows 1 execution with 2 hours focus (!!), but NO Prefetch. Very suspicious - 2 hours of user interaction proves execution. Likely GUI app from Temp\\ (Prefetch may have been disabled/deleted) |\n| cmd.exe | ‚úÖ **CONFIRMED** | UserAssist + Prefetch typically exist for cmd.exe. Zero focus time is NORMAL (command-line = no GUI window focus tracking) |\n| powershell.exe | ‚úÖ **CONFIRMED** | Same as cmd.exe - zero focus time expected for CLI tools |\n\n**Critical finding**: data_viewer.exe has 2 HOURS of focus time despite no Prefetch. This is execution proof via UserAssist alone. The missing Prefetch suggests anti-forensics (Prefetch disabled or deleted after execution).\n\n**Task 4: Timeline Reconstruction**\n\n```\nTime              | Application              | Activity                          | Significance\n------------------|--------------------------|-----------------------------------|---------------------------\n2024-03-20 14:30  | data_viewer.exe         | Viewed data for 2 hours           | Reconnaissance - employee reviewed confidential data\n2024-03-20 15:15  | powershell.exe          | 89 executions (zero focus)        | Automated scripting - data collection/prep?\n2024-03-20 15:30  | firefox.exe             | Web browsing session              | Possible cloud upload research or webmail\n2024-03-20 15:45  | file_transfer_pro.exe   | 4+ hours focus time over 23 runs  | Active file transfer - sustained exfiltration\n2024-03-20 16:20  | WinRAR.exe              | 20 minutes focus time (8 runs)    | File compression - preparing archive for transfer\n2024-03-20 16:28  | cmd.exe                 | 47 executions (zero focus)        | Batch automation - cleanup scripts?\n2024-03-20 16:30  | ResearchData_Backup.exe | 8.5 seconds focus (1 run)         | Final backup before resignation?\n2024-03-20 16:45  | 7-Zip.exe               | 4 minutes focus time (12 runs)    | Additional compression/encryption\n```\n\n**Attack narrative**:\n1. **14:30** - Employee uses data_viewer to review confidential research data (2-hour session = sustained reconnaissance)\n2. **15:15** - PowerShell scripts automate data collection from multiple sources\n3. **15:45** - file_transfer_pro begins 4-hour exfiltration session (23 separate uploads/downloads)\n4. **16:20** - WinRAR compresses files (20 min = large dataset)\n5. **16:30** - ResearchData_Backup creates local backup copy\n6. **16:45** - 7-Zip performs final compression/encryption before departure\n\n**Task 5: Intent Determination**\n\n1. **Total time in file_transfer_pro**: 14,500,000 ms = 4.03 hours = **4 hours, 2 minutes**\n\n2. **Average session duration**:\n   - Total focus time: 4.03 hours\n   - Total sessions: 23 executions\n   - Average: 4.03 / 23 = **0.175 hours per session** = **10.5 minutes per session**\n\n3. **Intent - SUSTAINED DATA TRANSFER**:\n   - **Evidence**:\n     * 4+ hours cumulative usage (not brief testing)\n     * 23 separate executions over 5 days (repeated, deliberate activity)\n     * 22 focus counts ‚âà 23 executions (nearly every launch received user attention)\n     * 10.5 minute average sessions (long enough for large file transfers)\n   - **Conclusion**: This is NOT casual usage. Pattern shows sustained, intentional data exfiltration over multiple sessions. Employee actively monitored transfers (high focus count proves hands-on operation, not background automation).\n\n**Task 6: Correlation Analysis - Workflow Progression**\n\n**Pattern observed**:\n1. **7-Zip** (12 runs, 4 min total) ‚Üí Brief, frequent usage\n2. **WinRAR** (8 runs, 20 min total) ‚Üí Longer sessions\n3. **file_transfer_pro** (23 runs, 4 hours total) ‚Üí Extensive usage\n\n**Interpretation - Data Handling Workflow**:\n\n**Stage 1: Initial compression experiments** (7-Zip)\n- 12 quick sessions (avg 20 seconds each)\n- Testing compression ratios, file splitting, encryption\n- Learning which tool works best for large research datasets\n\n**Stage 2: Archive creation** (WinRAR)\n- 8 sessions (avg 2.5 min each)\n- Creating compressed archives of stolen research data\n- Longer sessions = larger file sizes being processed\n\n**Stage 3: Exfiltration** (file_transfer_pro)\n- 23 sessions (avg 10.5 min each)\n- Uploading compressed archives to external location (cloud storage, personal server, or attacker-controlled C2)\n- Highest focus time = employee actively monitored transfer progress (watching upload bars, verifying completion)\n\n**Supporting evidence**:\n- **Progression**: Compression tools used BEFORE file transfer tool (logical workflow: compress ‚Üí upload)\n- **Timeline**: 7-Zip/WinRAR sessions END before file_transfer_pro session BEGINS (sequential, not overlapping)\n- **Focus time escalation**: 4 min ‚Üí 20 min ‚Üí 4 hours (increasing investment as operation advanced)\n\n**Conclusion**: Employee systematically compressed confidential research data and exfiltrated it using a third-party file transfer application. The 4-hour file_transfer_pro usage is definitive proof of sustained data theft, not accidental or authorized data handling.\n\n</details>\n\n### Learning Takeaway\n\nThis exercise demonstrates the power of **focus time metrics** in UserAssist:\n- **Brief focus time** (seconds) = automated, background, or failed execution\n- **Sustained focus time** (hours) = intentional, user-driven activity\n- **High execution counts** = repeated, deliberate usage (not one-time accidents)\n\nCombining UserAssist with Prefetch, MUICache, and AmCache creates an irrefutable execution timeline that proves intent in insider threat cases.\n"
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "**Hands-On Exercise**\\n\\nLet's practice the forensic workflow with real commands:\\n\\n**Step 1: Acquire the Artifact**\\n```cmd\\n# Copy artifact from evidence drive\\nrobocopy E:\\\\Evidence\\\\C\\\\Windows\\\\System32 C:\\\\Analysis\\\\ [artifact] /B\\n```\\n\\n**Step 2: Parse with Forensic Tools**\\n```cmd\\n# Use Eric Zimmerman tools or equivalent\\n[ToolName].exe -f C:\\\\Analysis\\\\[artifact] --csv C:\\\\Output\\\\\\n```\\n\\n**Step 3: Analyze Results**\\nOpen the CSV output and look for:\\n- Timestamps that align with incident timeframe\\n- Suspicious file paths or executables\\n- User accounts associated with malicious activity\\n- Network indicators or data transfer evidence\\n\\n**Step 4: Document Findings**\\nRecord all relevant artifacts in your investigation timeline."
      }
    },
    {
      "type": "real_world",
      "content": {
        "text": "**Real-World Investigation Scenario**\\n\\n**Background:** A financial services company detected suspicious network activity. You've been called in to perform digital forensics on a compromised workstation.\\n\\n**Initial Evidence:**\\n- Network monitoring detected 8.5 GB data transfer to external IP\\n- User reported system slowdown 3 days ago\\n- Antivirus quarantined 2 files yesterday\\n\\n**Your Forensic Approach:**\\n\\n1. **Timeline Development**\\n   - Collect all execution artifacts (Prefetch, AmCache, ShimCache, SRUM, UserAssist)\\n   - Create master timeline spanning 7-14 days before incident\\n   - Identify initial compromise vector\\n\\n2. **Artifact Analysis**\\n   - Examine this artifact for evidence of malicious executables\\n   - Cross-reference timestamps with network logs\\n   - Identify persistence mechanisms\\n\\n3. **Data Exfiltration Analysis**\\n   - Review SRUM for bandwidth usage by application\\n   - Check browser history and cloud sync logs\\n   - Analyze LNK files for accessed documents\\n\\n4. **Lateral Movement Detection**\\n   - Search for remote access tools (PsExec, RDP, WMI)\\n   - Review Windows Event Logs (4624, 4672, 4688)\\n   - Check for credential theft tools (Mimikatz indicators)\\n\\n**Key Findings:**\\nThis artifact revealed that `data_sync.exe` (disguised malware) executed 47 times over 3 days, correlating perfectly with the 8.5 GB data transfer detected by network monitoring. The attacker used a legitimate-looking filename to evade detection. By correlating this artifact with SRUM network data and MFT file access records, you can reconstruct exactly which files were exfiltrated and when.\\n\\n**Lessons Learned:**\\n- Multiple artifacts provide corroborating evidence\\n- Attackers often use legitimate-sounding filenames\\n- Timeline correlation is critical for proving causation\\n- Network logs + endpoint forensics = comprehensive investigation"
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "**Forensic Analysis Checklist**\\n\\nUse this mnemonic to remember key forensic steps:\\n\\n**T-R-A-C-E**\\n- **T**imeline: Build comprehensive timeline of events\\n- **R**ecovery: Extract and preserve artifacts\\n- **A**nalysis: Parse and interpret forensic data\\n- **C**orrelation: Cross-reference multiple artifacts\\n- **E**vidence: Document findings for legal proceedings\\n\\n**Quick Reference:**\\n- Artifact location: [Primary path]\\n- Parsing tool: [Recommended tool name]\\n- Key fields: Timestamp, User, Path, Execution count\\n- Correlate with: Prefetch, SRUM, AmCache, Event Logs\\n- Retention period: Varies by artifact (7-60 days typical)\\n\\n**Pro Tip:** Always collect artifacts from BOTH filesystem AND Volume Shadow Copies to catch evidence that attackers attempted to delete."
      }
    },
    {
      "type": "mindset_coach",
      "content": {
        "text": "**You're Building Forensic Expertise**\\n\\nDigital forensics can feel overwhelming with dozens of artifacts to master. Here's the mindset that successful DFIR analysts develop:\\n\\n**Master One Artifact at a Time**\\nYou don't need to memorize every field in every artifact. Focus on:\\n1. **What** the artifact proves (execution, file access, network activity)\\n2. **Where** it's located on the system\\n3. **How** to extract it with tools\\n4. **When** to use it in investigations\\n\\n**Build Mental Models**\\nThink of forensic artifacts as puzzle pieces. Each one tells part of the story:\\n- **Execution artifacts** (Prefetch, AmCache) = \"What ran?\"\\n- **File system artifacts** (MFT, USN Journal) = \"What files were created/accessed?\"\\n- **Network artifacts** (SRUM, Browser history) = \"Where did data go?\"\\n- **User artifacts** (LNK, UserAssist) = \"Who did what?\"\\n\\n**Practice Makes Permanent**\\nSet up a Windows VM and:\\n1. Run various applications\\n2. Extract the artifacts\\n3. Parse them with tools\\n4. See how your actions appear in forensic data\\n\\nThis hands-on practice builds intuition faster than reading alone.\\n\\n**You're Not Expected to Memorize Everything**\\nProfessional DFIR analysts use cheat sheets and reference guides. Your goal is to understand WHICH artifacts answer WHICH questions, then look up the specific syntax when needed.\\n\\n**Keep Going!** Every artifact you master makes you more valuable as an investigator. You're building skills that take years to develop‚Äîbe patient with yourself and celebrate each new technique you learn."
      }
    },
    {
      "type": "reflection",
      "content": {
        "text": "**Reflect on Your Forensic Journey**\\n\\nTake a moment to consider:\\n\\n**Integration Questions:**\\n1. How does this artifact fit into your overall forensic workflow?\\n2. What other artifacts would provide corroborating evidence?\\n3. In what types of investigations would this be most valuable?\\n\\n**Critical Thinking:**\\n4. What are the limitations of this artifact? What can't it tell you?\\n5. How might an attacker attempt to evade or manipulate this evidence?\\n6. What additional data sources would you need to build a complete timeline?\\n\\n**Practical Application:**\\n7. If you had to explain this artifact to a non-technical manager, what would you say?\\n8. What specific commands or tools do you need to practice to feel confident?\\n9. What real-world case studies demonstrate the value of this artifact?\\n\\n**Next Steps:**\\n- Set up a lab environment to practice artifact extraction\\n- Download and install recommended forensic tools\\n- Work through practice scenarios with sample evidence\\n- Join DFIR communities (Reddit r/computerforensics, SANS forums)\\n- Read case studies from DFIR blogs (13Cubed, SANS DFIR Summit talks)\\n\\nRemember: Every expert was once a beginner. Your consistent practice is building professional-grade investigative skills."
      }
    }
  ],
  "tags": [
    "Course: 13Cubed-Investigating Windows Endpoints"
  ]
}