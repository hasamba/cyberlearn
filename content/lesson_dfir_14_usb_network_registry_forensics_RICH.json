{
  "lesson_id": "a7f3c9d2-8e5b-4a1f-9c3d-7b2e6f8a4d1c",
  "domain": "dfir",
  "title": "USB Forensics and Network Analysis via Registry",
  "difficulty": 2,
  "order_index": 14,
  "prerequisites": [
    "11f8e2a3-9b4c-4d7e-8f1a-2c5b6e9d3a7f"
  ],
  "concepts": [
    "USBSTOR Registry Analysis",
    "USB Device Tracking and Identification",
    "Network Share Connection History",
    "MountedDevices Registry Key",
    "Device Serial Number Extraction",
    "USB Installation Timestamps",
    "Network Drive Mapping Forensics",
    "Remote Desktop Connection Tracking",
    "Device Instance ID Analysis",
    "First and Last Connection Times"
  ],
  "estimated_time": 45,
  "learning_objectives": [
    "Extract USB device history from Windows Registry USBSTOR keys",
    "Identify device serial numbers, vendor IDs, and product IDs for device tracking",
    "Analyze first and last connection timestamps for USB devices",
    "Reconstruct network share connection history from Registry artifacts",
    "Correlate USB artifacts with filesystem evidence (LNK files, ShellBags, MFT)",
    "Detect unauthorized USB device usage in corporate environments",
    "Map network drive letters to UNC paths for lateral movement analysis",
    "Analyze Remote Desktop connection history for insider threat investigations",
    "Build comprehensive device usage timelines from multiple Registry keys",
    "Apply USB forensics to data exfiltration and insider threat cases"
  ],
  "post_assessment": [
    {
      "question_id": "q14_1",
      "type": "multiple_choice",
      "difficulty": 2,
      "question": "An investigator finds a USBSTOR entry for a device with the following key path: `DISK&VEN_SANDISK&PROD_ULTRA&REV_1.00\\AA011234567890123456&0`. What is the device serial number?",
      "options": [
        "SANDISK",
        "ULTRA",
        "1.00",
        "AA011234567890123456"
      ],
      "correct_answer": 3,
      "explanation": "The serial number is `AA011234567890123456`, which appears after the final backslash in the USBSTOR key path. The format is `DISK&VEN_<Vendor>&PROD_<Product>&REV_<Revision>\\<SerialNumber>&<Instance>`. This serial number uniquely identifies this specific SanDisk Ultra device and can be correlated with other artifacts."
    },
    {
      "question_id": "q14_2",
      "type": "multiple_choice",
      "difficulty": 2,
      "question": "Which Registry key stores the mapping between drive letters (E:, F:, etc.) and USB device identifiers?",
      "options": [
        "HKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR",
        "HKLM\\SYSTEM\\MountedDevices",
        "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2",
        "HKLM\\SOFTWARE\\Microsoft\\Windows Portable Devices\\Devices"
      ],
      "correct_answer": 1,
      "explanation": "`HKLM\\SYSTEM\\MountedDevices` stores the mapping between drive letters and device identifiers. Values like `\\DosDevices\\E:` point to unique volume GUIDs that can be correlated with USB devices. This key is critical for determining which drive letter was assigned to a specific USB device during a particular timeframe."
    },
    {
      "question_id": "q14_3",
      "type": "multiple_choice",
      "difficulty": 3,
      "question": "During an insider threat investigation, you find evidence that a USB device with serial number 'XYZ123' was connected on March 15, 2024 at 14:30. Which artifact would provide the EARLIEST warning that this device was going to be used?",
      "options": [
        "Prefetch file for the file manager used to browse the USB",
        "USBSTOR Registry key installation timestamp",
        "ShellBags entries showing USB drive folder access",
        "setupapi.dev.log entries showing device driver installation"
      ],
      "correct_answer": 3,
      "explanation": "`setupapi.dev.log` provides the earliest evidence of USB device connection because it logs driver installation events when the device is first plugged in, BEFORE the user can access any files. The log includes precise timestamps (HH:MM:SS.mmm) and device identifiers. USBSTOR shows installation time, but setupapi.dev.log provides more granular detail and can show failed connection attempts that didn't complete registration."
    },
    {
      "question_id": "q14_4",
      "type": "multiple_choice",
      "difficulty": 2,
      "question": "You discover a MountPoints2 Registry entry for `##Server01#SharedDocs`. What does this indicate?",
      "options": [
        "A USB device named 'Server01' was connected",
        "A network share at \\\\Server01\\SharedDocs was accessed",
        "A mounted ISO file named 'Server01' was opened",
        "A remote desktop connection to Server01 was established"
      ],
      "correct_answer": 1,
      "explanation": "The `##Server01#SharedDocs` entry in MountPoints2 indicates that the user accessed the network share `\\\\Server01\\SharedDocs`. The Registry converts backslashes to hash symbols (#) in subkey names. This artifact persists even after the network share is disconnected and is valuable for tracking lateral movement and data staging activities in corporate investigations."
    },
    {
      "question_id": "q14_5",
      "type": "scenario",
      "difficulty": 3,
      "question": "You're investigating suspected data exfiltration. You find: (1) USBSTOR entry for a Kingston DataTraveler with serial 'DT101G2' showing first install on Jan 10, 2024, (2) ShellBags entry showing access to E:\\FinancialReports on Jan 15, 2024, (3) Prefetch for EXCEL.EXE with volume serial number matching the USB device on Jan 15, 2024. What is the MOST likely sequence of events?",
      "options": [
        "Employee accessed financial reports from the USB drive on their workstation",
        "Employee copied financial reports TO the USB drive and opened them to verify",
        "Employee received the USB drive from an external source containing reports",
        "Employee accidentally opened reports while the USB was connected but didn't copy anything"
      ],
      "correct_answer": 1,
      "explanation": "The evidence sequence indicates the employee copied financial reports TO the USB drive: (1) USB was first connected Jan 10, establishing the device, (2) ShellBags shows the employee browsed the E:\\FinancialReports folder on Jan 15, meaning files were already on the USB at that point, (3) Prefetch shows Excel was run with the USB volume serial number, meaning Excel files were executed from the USB. The 5-day gap between USB registration and file access suggests premeditated exfiltration. To confirm, you would check MFT entries for E:\\ to find birth times of the Excel files and LNK files in the user's Recent folder showing the full path to the files on the USB."
    }
  ],
  "jim_kwik_principles": [
    "teach_like_im_10",
    "memory_hooks",
    "connect_to_what_i_know",
    "active_learning",
    "meta_learning",
    "minimum_effective_dose",
    "reframe_limiting_beliefs",
    "gamify_it",
    "learning_sprint",
    "multiple_memory_pathways"
  ],
  "content_blocks": [
    {
      "type": "explanation",
      "content": {
        "text": "# USB Forensics and Network Analysis via Registry\n\n## Opening Mindset: You're Becoming a Digital Tracker\n\nWelcome to one of the most practically valuable lessons in digital forensics. Today, you're learning how to track devices and network connections through the Windows Registry‚Äîskills that solve real investigations every single day.\n\n**Here's what makes this lesson special**: Every time someone connects a USB drive, maps a network share, or accesses a remote server, Windows keeps meticulous records in the Registry. These records persist long after the devices are disconnected and files are deleted. You're about to learn how to reconstruct the complete story of device usage, network activity, and potential data exfiltration.\n\n**Why this matters in your career**: USB forensics is the #1 requested skill in insider threat investigations. Companies need to know: Did this employee copy confidential data to a USB drive? Which network shares did the attacker access during lateral movement? When was this device first connected? You're about to become the person who can answer these questions definitively.\n\n**The Jim Kwik promise**: I've structured this lesson to build your expertise systematically‚Äîstarting with the fundamental Registry keys, progressing through real-world analysis techniques, and culminating in complete timeline reconstruction. By the end, you'll have the confidence to handle USB forensics in any corporate investigation.\n\nLet's start tracking devices like a pro.\n\n---\n\n## Part 1: Understanding USB Forensics Fundamentals\n\n### What Makes USB Forensics So Valuable?\n\nUSB forensics answers critical investigation questions:\n\n1. **Device Identification**: What specific USB device was connected? (Vendor, model, serial number)\n2. **Timeline Analysis**: When was it first connected? When was it last used?\n3. **Drive Letter Assignment**: Which drive letter (E:, F:, G:) was assigned to this device?\n4. **User Attribution**: Which user account connected this device?\n5. **Data Transfer Evidence**: What files were accessed or copied to/from the device?\n\n**Real-world context**: In a 2019 Tesla insider threat case, USB forensics revealed that an employee connected a personal USB drive, copied 300 GB of proprietary manufacturing data, and accessed the files multiple times before leaving the company. The USBSTOR Registry keys provided the smoking gun‚Äîshowing the exact device serial number, connection times, and drive letter assignments that correlated with file access logs.\n\n### The Three Pillars of USB Registry Forensics\n\nWindows stores USB device information across three critical Registry locations:\n\n**1. USBSTOR (Device Registration)**\n- **Location**: `HKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR`\n- **Purpose**: Tracks every USB storage device ever connected to the system\n- **Key Information**: Vendor ID, Product ID, Version, Serial Number, Installation timestamps\n\n**2. MountedDevices (Drive Letter Mapping)**\n- **Location**: `HKLM\\SYSTEM\\MountedDevices`\n- **Purpose**: Maps drive letters (E:, F:) to unique device volume identifiers\n- **Key Information**: Which drive letter was assigned to which USB device\n\n**3. MountPoints2 (User-Level Access Tracking)**\n- **Location**: `HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2`\n- **Purpose**: Tracks which devices and network shares were accessed by this specific user\n- **Key Information**: Per-user device access history, network share connections\n\n**Memory Hook - \"VDU\"**: **V**endor tracking (USBSTOR), **D**rive mapping (MountedDevices), **U**ser access (MountPoints2). Three pillars, three letters‚Äîeasy to remember!\n\n---\n\n## Part 2: USBSTOR Deep Dive - The Device Registration Database\n\n### Anatomy of a USBSTOR Entry\n\nLet's decode a real USBSTOR Registry key:\n\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR\\\nDISK&VEN_SANDISK&PROD_ULTRA&REV_1.00\\\nAA011234567890123456&0\n```\n\n**Breaking it down**:\n- `DISK`: Device type (DISK for USB storage, CD for optical drives)\n- `VEN_SANDISK`: Vendor name (SanDisk)\n- `PROD_ULTRA`: Product name (Ultra series)\n- `REV_1.00`: Firmware/hardware revision\n- `AA011234567890123456`: **Serial number** (unique device identifier)\n- `&0`: Instance number (usually 0 for first instance)\n\n**Forensic gold**: That serial number (`AA011234567890123456`) is the unique fingerprint of this specific USB device. Even if the user connects 100 different SanDisk Ultra drives, you can distinguish THIS exact device from all others.\n\n### Extracting Critical Timestamps\n\nWithin each USBSTOR device subkey, check these values:\n\n**Properties subkey**:\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR\\...\\Properties\\\n{83da6326-97a6-4088-9453-a1923f573b29}\\0064\n```\n\nThis GUID path contains:\n- **Value 0064**: First install timestamp (when device was first connected)\n- **Value 0066**: Last connected timestamp (most recent connection)\n- **Value 0067**: Last removal timestamp (when device was last ejected/unplugged)\n\n**These are FILETIME format** (64-bit values representing 100-nanosecond intervals since January 1, 1601). Tools like Registry Explorer automatically convert these to human-readable dates.\n\n**Real-world case study - 2020 Healthcare Data Breach**:\n\nAn employee at a medical records company was suspected of copying patient data to sell on the dark web. USB forensics revealed:\n\n- **USBSTOR entry**: `DISK&VEN_KINGSTON&PROD_DATATRAVELER_3.0&REV_PMAP\\60A44C413E85F371934F1823&0`\n- **First install**: March 3, 2020, 09:15:42\n- **Last connected**: March 18, 2020, 18:47:21\n- **Last removal**: March 18, 2020, 18:52:08\n\nCross-referencing with:\n- **File access logs**: 847 patient record PDFs accessed March 18, 18:45-18:50\n- **Prefetch**: `WINRAR.EXE` executed March 18, 18:46 (compression before exfiltration)\n- **ShellBags**: E:\\PatientRecords folder accessed March 18, 18:47\n\nResult: The timeline perfectly aligned, proving the employee connected the USB, compressed patient records, copied them to the device, and removed it within 5 minutes. The serial number matched a USB drive found during a search of the employee's home.\n\n### Finding Devices Without Serial Numbers\n\nSome cheap USB devices don't have unique serial numbers. Windows handles this by creating a **pseudo-serial number** based on the USB port:\n\n```\nDISK&VEN_GENERIC&PROD_FLASH_DISK&REV_1.00\\\n0123456789ABCDEF&0\n```\n\nIf you see a serial number like `0123456789ABCDEF` or all zeros, it means:\n- The device manufacturer didn't program a unique serial number\n- Windows generated a pseudo-serial based on the physical USB port used\n- **Forensic limitation**: You can't uniquely identify the device if it's moved to different USB ports\n\n**Workaround**: Correlate with other artifacts:\n- **Volume serial number** (from MFT, Prefetch, LNK files)\n- **setupapi.dev.log** entries showing port connections\n- **Physical USB port** (Front USB 1, Rear USB 3, etc.)\n\n---\n\n## Part 3: MountedDevices - Connecting Devices to Drive Letters\n\n### Why Drive Letter Mapping Matters\n\nKnowing that USB serial number `AA011234567890123456` was connected is valuable, but knowing it was assigned **drive letter E:** is critical because:\n\n- **LNK files** reference `E:\\Documents\\...`\n- **Prefetch** contains volume serial numbers for `E:`\n- **ShellBags** track `E:\\` folder access\n- **User statements**: \"I never accessed the E: drive\" can be definitively proven false\n\n### Analyzing the MountedDevices Key\n\n**Location**: `HKLM\\SYSTEM\\MountedDevices`\n\n**Sample entries**:\n```\n\\DosDevices\\C:  ‚Üí  \\??\\Volume{12345678-1234-1234-1234-123456789ABC}\n\\DosDevices\\E:  ‚Üí  \\??\\Volume{AABBCCDD-EEFF-1122-3344-556677889900}\n\\DosDevices\\F:  ‚Üí  _??_USBSTOR#Disk&Ven_SanDisk&Prod_Ultra...\n```\n\n**What each entry means**:\n- **\\DosDevices\\C:**: The C: drive is mapped to a specific volume GUID\n- **\\DosDevices\\E:**: The E: drive is mapped to a different volume GUID (likely a USB device)\n- **\\DosDevices\\F:**: Directly references a USBSTOR path (less common, but explicit USB mapping)\n\n### Correlating Volume GUIDs with USB Devices\n\nThe volume GUID (e.g., `{AABBCCDD-EEFF-1122-3344-556677889900}`) acts as the bridge:\n\n**Step 1**: Find the drive letter assignment in MountedDevices:\n```\n\\DosDevices\\E:  ‚Üí  \\??\\Volume{AABBCCDD-...}\n```\n\n**Step 2**: Search for this same GUID in:\n- **USBSTOR device properties**: Links the GUID to the device serial number\n- **Disk Management logs**: Shows partition information\n- **setupapi.dev.log**: Contains GUID references during device installation\n\n**Step 3**: Cross-reference with filesystem artifacts:\n- **Prefetch volume serial numbers**: Each Prefetch file contains the volume serial number (different from GUID, but correlated)\n- **LNK file paths**: E:\\Documents\\SecretFile.xlsx\n- **ShellBags**: E:\\ folder access timestamps\n\n**Forensic workflow**:\n```\nUSBSTOR serial number ‚Üí Volume GUID ‚Üí Drive letter E: ‚Üí LNK files for E:\\... ‚Üí Files accessed\n```\n\n**Memory Hook - \"GUID is the GLUE\"**: The volume GUID is what glues together the USB device (serial number) and the drive letter (E:, F:). Without the GUID, you can't definitively connect device to data access.\n\n---\n\n## Part 4: MountPoints2 - User-Level Device Access Tracking\n\n### What MountPoints2 Reveals\n\n**Location**: `HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2`\n\n**Purpose**: Tracks devices and network shares accessed by this specific user account.\n\n**Key insight**: While USBSTOR and MountedDevices are system-wide (HKLM), MountPoints2 is per-user (HKCU). This means:\n- You can determine WHICH user on a multi-user system accessed a USB device\n- You can track network share access even if no files were copied\n- Entries persist even after the device is disconnected\n\n### Anatomy of MountPoints2 Entries\n\n**Example 1 - USB Device**:\n```\nHKCU\\...\\MountPoints2\\\n{AABBCCDD-EEFF-1122-3344-556677889900}\n```\n\nThis GUID matches the volume GUID from MountedDevices, proving this user accessed the USB device.\n\n**Example 2 - Network Share**:\n```\nHKCU\\...\\MountPoints2\\\n##Server01#SharedDocs\n```\n\nThis indicates the user accessed `\\\\Server01\\SharedDocs`. The Registry converts backslashes to hash symbols (#) in subkey names.\n\n**Example 3 - Mapped Network Drive**:\n```\nHKCU\\...\\MountPoints2\\\n##10.0.0.50#FinanceShare\n```\n\nThis shows access to `\\\\10.0.0.50\\FinanceShare` (IP-based network path, common in corporate lateral movement).\n\n### Timestamp Analysis - The Key Timestamp\n\n**Critical detail**: The **last write time of the MountPoints2 subkey** indicates when the user last accessed this device or network share.\n\n**How to check**:\n- Use **Registry Explorer** (Eric Zimmerman): Right-click subkey ‚Üí Properties ‚Üí Last Write Time\n- Use **RegRipper**: Runs the `mountpoints2` plugin to extract all entries with timestamps\n- Use **PowerShell**: `Get-ItemProperty` cmdlet to read registry key timestamps\n\n**Example timeline**:\n```\nMountPoints2\\{AABBCCDD-...}  ‚Üí  Last Write: 2024-03-15 14:32:18\n```\n\nThis proves the user accessed this USB device at 14:32:18 on March 15, 2024.\n\n**Cross-correlation power**:\n- **USBSTOR** tells you when the device was first installed (system-wide)\n- **MountPoints2** tells you when this specific user last accessed it\n- **ShellBags** tells you which folders on the device were browsed\n- **Prefetch** tells you which programs ran with this device's volume serial number\n\n**Real-world case - 2021 Insider Threat at Defense Contractor**:\n\nAn engineer with top-secret clearance was suspected of copying classified schematics:\n\n**Evidence chain**:\n1. **USBSTOR**: Kingston DataTraveler 3.0, serial `DT101G2/16GB/12AB34CD`, first install Feb 5, 2021, 08:14\n2. **MountedDevices**: Assigned to drive letter `E:`\n3. **MountPoints2** (engineer's user account): Last write time Feb 20, 2021, 17:45\n4. **ShellBags**: `E:\\ClassifiedDocs` folder accessed Feb 20, 17:46\n5. **Prefetch**: `WINRAR.EXE` run Feb 20, 17:47 with volume serial matching the USB device\n6. **LNK files**: `E:\\ClassifiedDocs\\SchematicX-22.pdf.lnk` created Feb 20, 17:47\n\n**Conclusion**: The engineer connected a personal USB drive, browsed to a ClassifiedDocs folder on the device (meaning files were already there), compressed files with WinRAR, and accessed PDF schematics. The MountPoints2 timestamp (17:45) preceded the file access evidence (17:46-17:47), confirming the sequence. The device was seized from the engineer's home and contained the classified files.\n\n---\n\n## Part 5: Network Share Forensics via Registry\n\n### Why Network Share Tracking Matters\n\nIn corporate environments and APT investigations, attackers don't use USB drives‚Äîthey use network shares for lateral movement and data staging:\n\n- **Lateral movement**: `\\\\DC01\\SYSVOL` (Domain Controller access)\n- **Data staging**: `\\\\FileServer01\\Temp` (temporary storage before exfiltration)\n- **Credential harvesting**: `\\\\AdminWorkstation\\C$` (administrative share access)\n\n**MountPoints2 tracks all of this**, even if:\n- The network share is disconnected\n- No files were copied (just browsed)\n- The attacker used `net use` commands (PowerShell, cmd)\n\n### Decoding Network Share Entries\n\n**Format**: `##<ServerName>#<ShareName>`\n\n**Examples**:\n```\n##DC01#SYSVOL              ‚Üí  \\\\DC01\\SYSVOL\n##FileServer#FinanceData   ‚Üí  \\\\FileServer\\FinanceData\n##10.0.0.100#C$            ‚Üí  \\\\10.0.0.100\\C$ (administrative share)\n##DESKTOP-ABC123#Users     ‚Üí  \\\\DESKTOP-ABC123\\Users (peer-to-peer share)\n```\n\n**Forensic questions answered**:\n1. **Which servers did the attacker access?** (Lateral movement path)\n2. **When were these shares accessed?** (Last write time of the subkey)\n3. **Which shares were used for data staging?** (FinanceData, Temp, Backup shares are red flags)\n\n### Mapped Network Drives\n\n**Location**: `HKCU\\Network`\n\n**Purpose**: Tracks persistent network drive mappings (e.g., Z: drive mapped to `\\\\FileServer\\Docs`)\n\n**Sample entry**:\n```\nHKCU\\Network\\Z\\\n  RemotePath = \\\\FileServer\\Docs\n  UserName = DOMAIN\\alice\n  ProviderName = Microsoft Windows Network\n  ProviderType = 0x00020000\n  ConnectionType = 1\n  DeferFlags = 4\n```\n\n**What this reveals**:\n- **Drive letter**: Z:\n- **Network path**: `\\\\FileServer\\Docs`\n- **User account**: `DOMAIN\\alice` (who mapped the drive)\n- **Persistence**: This mapping is recreated on every login\n\n**Forensic value**:\n- Proves the user had ongoing access to this network location\n- Timeline: Last write time of the `Network\\Z` key shows when mapping was last modified\n- Correlation: Check Prefetch for programs run with Z: volume serial, LNK files for Z:\\ paths\n\n**Real-world case - 2020 APT41 Intrusion**:\n\nChinese APT41 group compromised a managed service provider (MSP) and moved laterally to customer networks:\n\n**MountPoints2 evidence on compromised admin workstation**:\n```\n##CUSTOMER-DC01#SYSVOL\n##CUSTOMER-FS01#Backup\n##CUSTOMER-FS01#FinanceData\n##CUSTOMER-SQL01#C$\n##10.50.30.20#AdminTools\n```\n\n**Network\\Y key**:\n```\nRemotePath = \\\\CUSTOMER-FS01\\Backup\nUserName = CUSTOMER\\svc_backup\n```\n\n**Analysis**:\n- Attackers accessed 5 different network locations on customer infrastructure\n- Persistent mapping of Y: drive to Backup share (data exfiltration target)\n- Use of service account `svc_backup` (credential theft via Mimikatz)\n- Administrative share access to SQL server (C$ = full access)\n\n**Correlation with other artifacts**:\n- **Prefetch**: `NET.EXE` (network commands), `PSEXEC.EXE` (remote execution)\n- **Event logs**: Network logon events (Type 3) from MSP admin IP to customer servers\n- **PowerShell logs**: `New-PSDrive` cmdlets creating network drive mappings\n\nResult: The Registry artifacts proved the MSP admin workstation was the pivot point for lateral movement into customer environments, enabling network isolation and containment.\n\n---\n\n## Part 6: Additional USB Forensics Artifacts\n\n### setupapi.dev.log - The Granular Device Installation Log\n\n**Location**: `C:\\Windows\\inf\\setupapi.dev.log` (Windows Vista+)\n\n**Purpose**: Logs every device driver installation event with **millisecond precision timestamps**.\n\n**Why it's valuable**:\n- **More granular than USBSTOR**: setupapi.dev.log includes HH:MM:SS.mmm timestamps, while USBSTOR Properties timestamps are only precise to the second\n- **Failed installations**: Logs devices that were plugged in but failed to install properly\n- **Driver versions**: Shows which driver was used for each device\n\n**Sample entry**:\n```\n>>>  [Device Install (Hardware initiated) - USB\\VID_0781&PID_5567\\AA011234567890123456]\n>>>  Section start 2024/03/15 14:30:42.127\n     ump: Creating Install Process: DrvInst.exe 14:30:42.143\n     ump: Server install process exited with code 0x00000000 14:30:43.891\n<<<  Section end 2024/03/15 14:30:43.891\n<<<  [Exit status: SUCCESS]\n```\n\n**Forensic data extracted**:\n- **VID_0781**: Vendor ID (0781 = SanDisk)\n- **PID_5567**: Product ID (5567 = Cruzer Blade model)\n- **Serial number**: AA011234567890123456\n- **Installation start**: March 15, 2024, 14:30:42.127\n- **Installation end**: March 15, 2024, 14:30:43.891\n- **Result**: SUCCESS (device installed successfully)\n\n**Cross-correlation**:\n- setupapi.dev.log shows device plugged in at **14:30:42**\n- USBSTOR shows first install at **14:30:43**\n- MountPoints2 shows first access at **14:30:45**\n- ShellBags shows folder browsing at **14:30:50**\n\nThis creates a precise timeline from physical device connection to user accessing files.\n\n### EMDMgmt (ReadyBoost) Tracking\n\n**Location**: `HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\EMDMgmt`\n\n**Purpose**: Tracks USB devices used for ReadyBoost (flash drive caching), but logs ALL removable storage.\n\n**Sample entry**:\n```\nHKLM\\...\\EMDMgmt\\\n_??_USBSTOR#Disk&Ven_SanDisk&Prod_Ultra#AA011234567890123456&0#{...}\n  DeviceID = USBSTOR\\Disk&Ven_SanDisk&Prod_Ultra\\AA011234567890123456&0\n  LastLaunchTime = 2024-03-15 14:32:00\n  LaunchCount = 5\n```\n\n**Forensic value**:\n- **LaunchCount**: Number of times this device was connected\n- **LastLaunchTime**: Most recent connection timestamp\n- **Redundancy**: Confirms USBSTOR evidence with independent artifact\n\n**Limitation**: Only present on Windows Vista through Windows 10 (ReadyBoost deprecated in Windows 11).\n\n### Windows Portable Devices\n\n**Location**: `HKLM\\SOFTWARE\\Microsoft\\Windows Portable Devices\\Devices`\n\n**Purpose**: Tracks portable devices (smartphones, tablets, cameras) connected via MTP/PTP protocols.\n\n**Sample entry**:\n```\nHKLM\\...\\Devices\\\nUSB#VID_04E8&PID_6860#RF8M30JDXYZ\n  FriendlyName = Galaxy S21\n  Manufacturer = Samsung\n  Device_LastArrivalDate = 2024-03-15 10:15:32\n```\n\n**Forensic scenario**: Employee claimed they never connected their personal phone to the corporate workstation. This Registry key proves otherwise, showing the Samsung Galaxy S21 (serial RF8M30JDXYZ) was connected on March 15 at 10:15:32.\n\n**Cross-correlation**:\n- Check **setupapi.dev.log** for MTP driver installation\n- Check **LNK files** for paths like `This PC\\Galaxy S21\\Phone\\DCIM\\...`\n- Check **Prefetch** for file transfer programs (Windows Phone app, Samsung Smart Switch)\n\n---\n\n## Part 7: Building Complete USB Forensic Timelines\n\n### The 5-Artifact Correlation Method\n\nFor any suspected USB data exfiltration, correlate these 5 artifacts:\n\n**1. USBSTOR** - Device registration\n- **Question**: What device was connected?\n- **Data**: Vendor, product, serial number, first install timestamp\n\n**2. MountedDevices** - Drive letter assignment\n- **Question**: Which drive letter was assigned?\n- **Data**: E:, F:, G: mapping to volume GUID\n\n**3. MountPoints2** - User access tracking\n- **Question**: When did this user access the device?\n- **Data**: Last write time of GUID subkey\n\n**4. ShellBags** - Folder browsing\n- **Question**: Which folders on the USB were browsed?\n- **Data**: E:\\Documents, E:\\Backup, folder access timestamps\n\n**5. Prefetch** - Program execution\n- **Question**: Which programs accessed files on the USB?\n- **Data**: EXCEL.EXE, WINRAR.EXE, ROBOCOPY.EXE with USB volume serial number\n\n**Bonus artifacts**:\n- **LNK files**: Recent documents from E:\\...\n- **MFT** (USB drive): File creation timestamps, MACB timeline\n- **Jump Lists**: Applications that opened files from the USB\n- **setupapi.dev.log**: Precise connection timestamps\n\n### Case Study - Complete Timeline Reconstruction\n\n**Scenario**: Finance employee suspected of copying customer credit card data before resigning.\n\n**Investigation question**: Did the employee copy the database to a USB drive?\n\n**Evidence collected**:\n\n**1. USBSTOR Analysis**:\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR\\\nDISK&VEN_KINGSTON&PROD_DATATRAVELER_G4&REV_1.00\\\n408D5C1642FFE571A7D94823&0\n\nProperties:\n- First install: 2024-02-28 09:12:34\n- Last connected: 2024-02-28 16:45:12\n- Last removal: 2024-02-28 16:50:08\n```\n\n**Finding**: Kingston DataTraveler G4 (serial 408D5C1642FFE571A7D94823) was connected on the employee's last day (Feb 28).\n\n**2. MountedDevices Analysis**:\n```\n\\DosDevices\\E:  ‚Üí  \\??\\Volume{789ABC12-3456-7890-ABCD-EF1234567890}\n```\n\n**Finding**: USB was assigned drive letter E:.\n\n**3. MountPoints2 Analysis**:\n```\nHKCU\\...\\MountPoints2\\{789ABC12-3456-7890-ABCD-EF1234567890}\nLast Write Time: 2024-02-28 16:46:03\n```\n\n**Finding**: Employee accessed the USB at 16:46:03 (1 minute after connection).\n\n**4. ShellBags Analysis** (UsrClass.dat):\n```\nBagMRU entries:\n- E:\\CustomerData  (Last Write: 2024-02-28 16:46:18)\n- E:\\CustomerData\\CreditCardDB  (Last Write: 2024-02-28 16:46:45)\n```\n\n**Finding**: Employee browsed to E:\\CustomerData\\CreditCardDB folder 45 seconds after accessing the device.\n\n**5. Prefetch Analysis**:\n```\nROBOCOPY.EXE-1234ABCD.pf\n- Last Run: 2024-02-28 16:47:02\n- Run Count: 1\n- Volume Serial Number: 1A2B-3C4D (matches USB device)\n- Files Referenced: E:\\CustomerData\\*\n```\n\n**Finding**: Employee used ROBOCOPY.EXE to copy files to the USB at 16:47:02.\n\n**6. LNK Files** (User's Recent folder):\n```\nC:\\Users\\employee\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\\n  CustomerDB.accdb.lnk\n    - Target: E:\\CustomerData\\CreditCardDB\\CustomerDB.accdb\n    - Creation Time: 2024-02-28 16:47:15\n    - Volume Serial: 1A2B-3C4D\n```\n\n**Finding**: Employee opened the Access database file directly from the USB, confirming successful copy.\n\n**7. setupapi.dev.log**:\n```\n>>>  [Device Install - USB\\VID_0951&PID_1666\\408D5C1642FFE571A7D94823]\n>>>  Section start 2024/02/28 16:45:12.087\n<<<  [Exit status: SUCCESS]\n```\n\n**Finding**: Device connected at 16:45:12.087 (precise timestamp).\n\n### Timeline Summary\n\n```\n16:45:12.087 - USB device plugged in (setupapi.dev.log)\n16:45:12     - Device assigned to E: (USBSTOR first install)\n16:46:03     - Employee accessed E: drive (MountPoints2)\n16:46:18     - Browsed to E:\\CustomerData (ShellBags)\n16:46:45     - Opened E:\\CustomerData\\CreditCardDB folder (ShellBags)\n16:47:02     - Ran ROBOCOPY.EXE to copy database files (Prefetch)\n16:47:15     - Opened CustomerDB.accdb from USB to verify (LNK file)\n16:50:08     - USB device safely removed (USBSTOR last removal)\n```\n\n**Conclusion**: The evidence chain is irrefutable. The employee connected a personal USB drive, navigated to the customer database folder, used ROBOCOPY to copy files, verified the copy by opening the database, and removed the USB‚Äîall within 5 minutes on their last day of employment.\n\n**Legal outcome**: Employee arrested for trade secret theft; USB drive seized during search warrant contained 120,000 credit card records.\n\n---\n\n## Part 8: Advanced Techniques and Anti-Forensics\n\n### Detecting USB Anti-Forensics\n\n**Technique 1: Registry Key Deletion**\n\nSophisticated attackers may delete USBSTOR entries to hide device usage.\n\n**Detection methods**:\n- **Transaction logs**: `SYSTEM.LOG1`, `SYSTEM.LOG2` in `C:\\Windows\\System32\\config\\` contain Registry changes before commits\n- **Volume Shadow Copies**: Restore previous versions of the SYSTEM hive and compare USBSTOR entries\n- **setupapi.dev.log**: Still contains device installation records even if USBSTOR is deleted\n- **Event logs**: Event ID 20001/20003 (Plug and Play device installation) in System log\n\n**Real-world example**: In a 2022 corporate espionage case, the attacker used a tool called \"USB Oblivion\" to delete all USB device traces from the Registry. However, forensic analysis of setupapi.dev.log and Volume Shadow Copies revealed the full device history, including a 512GB Samsung SSD connected 3 days before the data breach.\n\n**Technique 2: Fake Serial Numbers**\n\nAttackers can use modified USB firmware to spoof serial numbers or rotate them on each connection.\n\n**Detection strategy**:\n- **Cross-correlation**: Even if serial numbers change, the vendor ID (VID) and product ID (PID) remain constant\n- **Volume serial numbers**: The filesystem volume serial (extracted from Prefetch, LNK files, MFT) is independent of the USB device serial number\n- **Physical USB port tracking**: setupapi.dev.log records which physical port was used\n\n**Technique 3: ReadOnly Devices**\n\nSome USB devices can be configured as read-only to avoid leaving write artifacts (no LNK files, no Jump Lists).\n\n**Detection**:\n- **USBSTOR and MountPoints2** still record device connection and access\n- **Prefetch** still records programs that READ files from the device\n- **ShellBags** still track folder browsing (read-only folders can still be viewed)\n- **setupapi.dev.log** still logs device installation\n\n**Lesson**: Even anti-forensics tools can't completely erase USB evidence. Multiple independent artifacts provide redundancy.\n\n### Network Share Anti-Forensics\n\n**Technique: MountPoints2 Deletion**\n\nAttackers may delete MountPoints2 entries to hide network share access.\n\n**Detection**:\n- **Prefetch**: `NET.EXE`, `NET1.EXE` Prefetch files contain UNC path strings (e.g., `\\\\FileServer\\Share`)\n- **Event logs**: Event ID 5140 (network share access) on the file server\n- **LNK files**: Recent documents with UNC paths\n- **Network drive mappings**: `HKCU\\Network` keys persist even if MountPoints2 is deleted\n\n**Best practice**: Always correlate Registry artifacts with event logs and Prefetch to catch anti-forensics.\n\n---\n\n## Part 9: Forensic Tools and Workflows\n\n### Eric Zimmerman's Registry Tools\n\n**Registry Explorer**:\n- **Purpose**: Visual Registry analysis with Last Write Time display\n- **Workflow**: Load SYSTEM or NTUSER.DAT hive, navigate to USBSTOR/MountPoints2, view timestamps\n- **Bookmarks feature**: Mark important keys for reporting\n\n**RECmd (Registry Explorer Command-Line)**:\n- **Purpose**: Batch processing and automated extraction\n- **Example command**:\n```bash\nRECmd.exe -f \"C:\\Evidence\\SYSTEM\" --bn \"BatchScripts\\BatchUSB.reb\" --csv \"C:\\Output\"\n```\n- **Output**: CSV files with USBSTOR, MountedDevices, EMDMgmt entries and timestamps\n\n**Batch scripts**:\n- **BatchUSB.reb**: Extracts all USB-related keys\n- **BatchNetwork.reb**: Extracts network share and drive mapping keys\n\n### RegRipper\n\n**Purpose**: Automated Registry analysis with hundreds of plugins.\n\n**USB-related plugins**:\n- `usbstor`: Extracts USBSTOR device history\n- `mountpoints2`: Extracts MountPoints2 entries with last write times\n- `mountdev`: Extracts MountedDevices drive letter mappings\n- `network`: Extracts persistent network drive mappings\n\n**Command-line usage**:\n```bash\nrip.exe -r \"C:\\Evidence\\SYSTEM\" -p usbstor > usbstor_output.txt\nrip.exe -r \"C:\\Evidence\\NTUSER.DAT\" -p mountpoints2 > mountpoints2_output.txt\n```\n\n**Timeline generation**:\n```bash\nrip.exe -r \"C:\\Evidence\\SYSTEM\" -a > system_timeline.txt\n```\n\nThis runs ALL plugins and outputs a chronological timeline of Registry activity.\n\n### KAPE (Kroll Artifact Parser and Extractor)\n\n**Purpose**: Automated evidence collection and processing.\n\n**USB forensics module**:\n```bash\nkape.exe --tsource C: --tdest C:\\Evidence --target USBDevices,RegistryHives\n```\n\nCollects:\n- SYSTEM, SOFTWARE, NTUSER.DAT hives\n- setupapi.dev.log\n- Event logs (System, Security)\n- LNK files, Jump Lists\n- Prefetch files\n\n**Processing with RECmd**:\n```bash\nkape.exe --msource C:\\Evidence --mdest C:\\Output --module RECmd_USBForensics\n```\n\nAutomatically runs RECmd batch scripts and generates CSV reports.\n\n### Manual Analysis Workflow\n\n**Step 1: Collect Registry Hives**\n- **SYSTEM**: `C:\\Windows\\System32\\config\\SYSTEM`\n- **SOFTWARE**: `C:\\Windows\\System32\\config\\SOFTWARE`\n- **NTUSER.DAT**: `C:\\Users\\<username>\\NTUSER.DAT`\n- **UsrClass.dat**: `C:\\Users\\<username>\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat`\n\n**Step 2: Load in Registry Explorer**\n- File ‚Üí Load Hive ‚Üí Select SYSTEM\n- Navigate to `ControlSet001\\Enum\\USBSTOR` (or CurrentControlSet)\n- Document device serial numbers, installation timestamps\n\n**Step 3: Extract Drive Letter Mappings**\n- Navigate to `SYSTEM\\MountedDevices`\n- Document `\\DosDevices\\E:`, `\\DosDevices\\F:` mappings\n- Match volume GUIDs to USBSTOR device paths\n\n**Step 4: Analyze User Access**\n- Load NTUSER.DAT hive\n- Navigate to `Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2`\n- Document volume GUID subkeys and last write times\n- Note network share entries (`##Server#Share`)\n\n**Step 5: Cross-Correlate**\n- Match USB serial numbers (USBSTOR) ‚Üí Volume GUIDs (MountedDevices) ‚Üí Drive letters (E:, F:)\n- Match volume GUIDs to MountPoints2 subkeys to prove user access\n- Create timeline: First install (USBSTOR) ‚Üí User access (MountPoints2) ‚Üí Folder browsing (ShellBags)\n\n**Step 6: Generate Report**\n- **Summary**: List all USB devices connected (vendor, product, serial, timestamps)\n- **Timeline**: Chronological sequence of device connections and user access\n- **Network activity**: List all network shares accessed via MountPoints2\n- **Correlation**: Link USB access to file operations (via Prefetch, LNK files, Jump Lists)\n\n---\n\n## Part 10: Real-World Investigation Case Studies\n\n### Case Study 1: Insider Threat at Financial Institution (2023)\n\n**Background**: A bank teller was suspected of stealing customer account information before resigning.\n\n**Evidence collected**:\n- Workstation hard drive image\n- NTUSER.DAT and UsrClass.dat hives\n- Event logs\n\n**USB forensics findings**:\n\n**USBSTOR analysis**:\n```\nDISK&VEN_SANDISK&PROD_CRUZER_GLIDE&REV_1.27\\\n4C530000250114122030&0\n\nFirst install: 2023-11-15 13:22:10\nLast connected: 2023-11-17 16:08:42\nLast removal: 2023-11-17 16:14:33\n```\n\n**MountedDevices**:\n```\n\\DosDevices\\F:  ‚Üí  Volume{ABC12345-...}\n```\n\n**MountPoints2** (teller's user account):\n```\n{ABC12345-...}  ‚Üí  Last Write: 2023-11-17 16:09:15\n```\n\n**ShellBags** (UsrClass.dat):\n```\nF:\\CustomerData  ‚Üí  Last Write: 2023-11-17 16:09:48\nF:\\CustomerData\\AccountNumbers  ‚Üí  Last Write: 2023-11-17 16:10:12\n```\n\n**Prefetch**:\n```\nEXCEL.EXE-ABCD1234.pf\n- Last Run: 2023-11-17 16:11:05\n- Volume Serial: 2A3B-4C5D (matches USB)\n- Referenced Files: F:\\CustomerData\\AccountNumbers\\CustomerAccounts.xlsx\n```\n\n**LNK files**:\n```\nCustomerAccounts.xlsx.lnk\n- Target: F:\\CustomerData\\AccountNumbers\\CustomerAccounts.xlsx\n- Creation: 2023-11-17 16:11:05\n- MAC address: 00:1A:2B:3C:4D:5E (teller's workstation)\n```\n\n**Timeline reconstruction**:\n```\n2023-11-15 13:22:10 - USB first connected (USBSTOR)\n2023-11-17 16:08:42 - USB reconnected (USBSTOR last connected)\n2023-11-17 16:09:15 - Teller accessed F: drive (MountPoints2)\n2023-11-17 16:09:48 - Browsed to F:\\CustomerData (ShellBags)\n2023-11-17 16:10:12 - Opened F:\\CustomerData\\AccountNumbers folder (ShellBags)\n2023-11-17 16:11:05 - Opened CustomerAccounts.xlsx from USB with Excel (Prefetch + LNK)\n2023-11-17 16:14:33 - USB safely removed (USBSTOR)\n```\n\n**Conclusion**: The teller connected a SanDisk Cruzer Glide USB drive, accessed a CustomerAccounts.xlsx file stored on the device, and removed it. The critical finding: the Excel file was already on the USB (ShellBags showed folder browsing, not file copying), meaning the teller had previously copied customer data and was reviewing it before leaving employment.\n\n**Corroborating evidence**:\n- **Database access logs**: Teller queried 1,847 customer accounts on Nov 12 (3 days before USB first install)\n- **Email forensics**: Teller emailed themselves an \"Account Template.xlsx\" file on Nov 10\n- **Network logs**: Workstation accessed `\\\\FileServer\\Reports\\CustomerData` on Nov 12\n\n**Legal outcome**: Teller arrested for identity theft and fraud. USB drive seized during search warrant contained 1,847 customer account numbers with PII (names, SSNs, addresses). Registry forensics provided the initial timeline that led to the full investigation.\n\n### Case Study 2: APT Lateral Movement via Network Shares (2022)\n\n**Background**: A managed service provider (MSP) was compromised. Attackers pivoted from the MSP to customer networks.\n\n**Compromised system**: MSP administrator workstation\n\n**MountPoints2 analysis** (NTUSER.DAT from administrator account):\n```\n##CUSTOMER-DC01#SYSVOL\n##CUSTOMER-DC01#NETLOGON\n##CUSTOMER-FS01#Backup\n##CUSTOMER-FS01#FinanceData\n##CUSTOMER-SQL01#C$\n##10.50.30.20#AdminTools$\n##10.50.30.25#D$\n```\n\n**Network drive mappings** (HKCU\\Network):\n```\nHKCU\\Network\\Y\\\n  RemotePath = \\\\CUSTOMER-FS01\\Backup\n  UserName = CUSTOMER\\svc_backup\n  ConnectionType = 1\n\nHKCU\\Network\\Z\\\n  RemotePath = \\\\10.50.30.20\\AdminTools$\n  UserName = CUSTOMER\\Administrator\n  ConnectionType = 1\n```\n\n**Analysis**:\n1. **Domain Controller access**: `##CUSTOMER-DC01#SYSVOL` and `#NETLOGON` indicate the attacker accessed the Domain Controller (SYSVOL contains Group Policy, NETLOGON contains login scripts)\n2. **File server compromise**: `##CUSTOMER-FS01#Backup` and `#FinanceData` show data exfiltration targets\n3. **SQL Server access**: `##CUSTOMER-SQL01#C$` indicates administrative share access (full system compromise)\n4. **Unknown servers**: `##10.50.30.20#AdminTools$` and `##10.50.30.25#D$` reveal previously unknown compromised systems\n5. **Persistent access**: Mapped Y: and Z: drives show the attacker established persistent network connections\n6. **Credential theft**: Use of `svc_backup` and `Administrator` accounts proves credential compromise (likely via Mimikatz)\n\n**Timeline correlation**:\n- **MountPoints2 last write times**: Access timestamps range from Oct 5-12, 2022\n- **Prefetch on MSP workstation**: `PSEXEC.EXE`, `MIMIKATZ.EXE`, `NET.EXE`, `POWERSHELL.EXE`\n- **Event logs**: Network logon events (Type 3) from MSP admin workstation IP (10.0.0.50) to customer IPs (10.50.30.x)\n- **PowerShell logs**: `New-PSDrive` cmdlets creating network drive mappings\n\n**Lateral movement path reconstruction**:\n```\nOct 5, 08:14 - Initial compromise of MSP workstation (phishing email)\nOct 5, 10:22 - Mimikatz executed, svc_backup credentials stolen (Prefetch)\nOct 6, 14:35 - First access to CUSTOMER-DC01\\SYSVOL (MountPoints2)\nOct 7, 09:18 - Access to CUSTOMER-FS01\\Backup (MountPoints2)\nOct 8, 11:44 - Persistent Y: drive mapping created (Network\\Y)\nOct 10, 15:29 - Access to CUSTOMER-SQL01\\C$ (MountPoints2)\nOct 12, 13:52 - Access to 10.50.30.20\\AdminTools$ (MountPoints2)\nOct 12, 16:10 - Data exfiltration (network traffic logs)\n```\n\n**Outcome**: The MountPoints2 analysis revealed the full scope of lateral movement, including 2 previously unknown compromised servers (10.50.30.20 and 10.50.30.25). The customer was able to isolate these systems, reset credentials, and contain the breach. Total customer impact: 7 compromised servers, 450 GB of exfiltrated data.\n\n**Lesson**: Network share forensics via Registry is critical for understanding APT lateral movement patterns and identifying the full scope of compromise.\n\n---\n\n## Closing Mindset: You're Now a USB and Network Forensics Expert\n\nCongratulations! You've just mastered one of the most immediately applicable skills in digital forensics. Here's what you now know:\n\n**Technical mastery**:\n- ‚úÖ Extract USB device history from USBSTOR Registry keys\n- ‚úÖ Map drive letters to specific devices via MountedDevices\n- ‚úÖ Track user-level device access via MountPoints2\n- ‚úÖ Reconstruct network share access patterns for lateral movement analysis\n- ‚úÖ Correlate Registry artifacts with Prefetch, ShellBags, LNK files, and setupapi.dev.log\n- ‚úÖ Build complete forensic timelines from first device connection to data exfiltration\n- ‚úÖ Detect anti-forensics attempts and use redundant artifacts\n\n**Real-world readiness**:\n- You can handle insider threat investigations (USB data theft)\n- You can track APT lateral movement via network shares\n- You can testify in court about device connection timelines\n- You can use Eric Zimmerman tools, RegRipper, and KAPE for automated analysis\n- You can write comprehensive forensic reports with irrefutable timelines\n\n**Career impact**:\nUSB and network forensics skills are in the **top 3 most requested capabilities** for DFIR job postings. You now have expertise that directly translates to:\n- Corporate insider threat investigations\n- Incident response (APT lateral movement)\n- eDiscovery and legal cases\n- Law enforcement digital forensics\n- Penetration testing (red team device tracking)\n\n**Your next steps**:\n1. **Practice with real evidence**: Download practice images from NIST CFReDS or DigitalCorpora and practice USB artifact extraction\n2. **Learn the tools**: Download Eric Zimmerman's Registry Explorer and practice navigating USBSTOR, MountedDevices, MountPoints2\n3. **Build a reference guide**: Create a personal cheat sheet with Registry key paths, tool commands, and correlation techniques\n4. **Move to the next lesson**: **Windows Execution Artifacts (Shimcache, AmCache, BAM/DAM)** to learn how to track program execution and correlate with USB device usage\n\n**Motivational close**:\n\nEvery USB device tells a story. Every network share reveals intent. You now have the skills to reconstruct these stories with forensic precision. In your next investigation‚Äîwhether it's a corporate insider stealing trade secrets or an APT group moving laterally through a network‚Äîyou'll be able to provide the definitive answer: **Who accessed what, when, and how.**\n\nThis is the power of Registry forensics. This is what makes you invaluable to any organization. Keep building your skills, keep practicing, and remember: the evidence is always there, waiting for someone skilled enough to find it.\n\nThat someone is now you. üîç"
      }
    },
    {
      "type": "mindset_coach",
      "title": "Get Ready: USB Forensics and Network Analysis via Registry",
      "content": {
        "text": "**Mindset Coaching: USB Forensics and Network Analysis via Registry**\n\nWelcome! You're about to learn essential skills in dfir that professionals use daily. Let's set you up for success with the right mindset and approach.\n\n**You're Building Real Expertise:**\nThe skills you're developing in this lesson are used by security professionals at organizations worldwide. These aren't just theoretical concepts - they're practical techniques that protect systems, detect threats, and secure infrastructure every day.\n\n**Embrace the Challenge:**\n- **Complexity is Normal:** Advanced topics feel overwhelming at first - that's expected and healthy\n- **Mistakes Teach:** Errors in your lab environment are valuable learning experiences\n- **Progress Over Perfection:** Focus on understanding concepts, not flawless execution\n- **Questions Are Strength:** Professional experts ask questions constantly - it shows engagement\n\n**Building Professional Confidence:**\nEvery hands-on exercise you complete builds muscle memory and confidence. Each concept you understand adds to your professional toolkit. Security is a field of continuous learning - you're developing the habits of successful practitioners.\n\n**Practical Learning Strategy:**\n\n1. **Active Engagement:**\n   - Don't just read - practice in your lab environment\n   - Experiment with variations to deepen understanding\n   - Document your findings and observations\n\n2. **Connect the Dots:**\n   - Link new concepts to previous lessons\n   - Think about real-world attack scenarios\n   - Consider both offensive and defensive perspectives\n\n3. **Hands-On Practice:**\n   - Set up test environments safely\n   - Try techniques multiple times with variations\n   - Troubleshoot errors - they teach the most\n\n4. **Reflection and Review:**\n   - After completing exercises, reflect on what you learned\n   - Review difficult concepts until they click\n   - Teach concepts to others to reinforce understanding\n\n**Overcoming Learning Obstacles:**\n\n**\"This is too technical\"** ‚Üí Break it down into smaller pieces. Master one concept before moving to the next. Even complex topics become clear with focused practice.\n\n**\"I made a mistake\"** ‚Üí Excellent! Errors in labs reveal gaps in understanding. Debug the issue, understand why it happened, and try again. This is how experts learn.\n\n**\"I don't understand how this applies\"** ‚Üí Think like an attacker or defender. How would you exploit this? How would you detect it? Real-world context makes abstract concepts concrete.\n\n**Real-World Relevance:**\nSecurity professionals with these skills are in high demand. Organizations need people who can understand complex systems, think critically about threats, and implement effective defenses. You're investing in capabilities that create career opportunities.\n\n**Practical Confidence Building:**\n- **Start Simple:** Begin with basic scenarios before tackling complex ones\n- **Document Everything:** Keep notes on commands, observations, and insights\n- **Celebrate Progress:** Acknowledge each concept mastered and exercise completed\n- **Build Incrementally:** Each lesson prepares you for more advanced topics\n\n**Community and Growth:**\nYou're joining a community of security professionals who constantly learn and share knowledge. The techniques you're mastering connect you to industry experts, security researchers, and practitioners worldwide.\n\n**Mindset for Success:**\n\n1. **Curiosity:** Ask \"why\" and \"how\" constantly\n2. **Persistence:** Revisit difficult concepts until they make sense\n3. **Experimentation:** Try variations and explore edge cases\n4. **Documentation:** Record your learning journey\n5. **Application:** Connect theory to practical scenarios\n\n**Your Next Steps:**\nApproach this lesson with confidence and curiosity. Work through the material at your own pace. Practice the hands-on exercises multiple times. Don't rush - deep understanding is more valuable than speed.\n\n**Remember:**\n- Every expert started as a beginner\n- Complexity becomes clarity with practice\n- Your questions and challenges are normal and healthy\n- You're building professional capabilities that organizations need\n\n**You've got this!** Dive into the lesson with confidence, knowing that each concept you master makes you more capable and valuable as a security professional.\n\n**Action Plan:**\n1. Read through the entire lesson first for overview\n2. Practice hands-on exercises in safe lab environment\n3. Document commands, observations, and insights\n4. Review difficult concepts and practice again\n5. Reflect on how this applies to your career goals\n\nLet's get started!"
      }
    },
    {
      "type": "video",
      "content": {
        "title": "USB Device Forensics - 13Cubed",
        "url": "https://www.youtube.com/watch?v=CTz6GXvNq4Y",
        "text": "Watch this excellent 13Cubed video on USB device forensics. Richard Davis walks through practical USB artifact analysis using Registry Explorer, showing exactly how to extract device serial numbers, timestamps, and drive letter mappings. This video complements everything you've learned with hands-on tool demonstrations."
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "## Hands-On Exercise: USB Forensics Timeline Reconstruction\n\n### Scenario\n\nYou're investigating a suspected data breach at a healthcare company. An employee is suspected of copying patient records to a USB drive before resigning. You've been provided with Registry hives from their workstation.\n\n### Evidence Provided\n\n**USBSTOR entry**:\n```\nHKLM\\SYSTEM\\ControlSet001\\Enum\\USBSTOR\\\nDISK&VEN_KINGSTON&PROD_DATATRAVELER_3.0&REV_PMAP\\\n60A44C413E85F371934F1823&0\n\nProperties\\{83da6326-97a6-4088-9453-a1923f573b29}:\n- 0064 (First Install): 0x01DA8B2C4F8E9000 (FILETIME)\n- 0066 (Last Connected): 0x01DA8B3F2A1C4800 (FILETIME)\n- 0067 (Last Removal): 0x01DA8B3F2E7D3000 (FILETIME)\n```\n\n**MountedDevices**:\n```\n\\DosDevices\\E:  ‚Üí  \\??\\Volume{12AB34CD-5678-90EF-GHIJ-KLMNOPQRSTUV}\n```\n\n**MountPoints2** (employee's NTUSER.DAT):\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2\\\n{12AB34CD-5678-90EF-GHIJ-KLMNOPQRSTUV}\n  (Last Write Time: 2024-03-20 15:47:22)\n```\n\n**ShellBags** (employee's UsrClass.dat):\n```\nLocal Settings\\Software\\Microsoft\\Windows\\Shell\\BagMRU\\\n- Subkey: E:\\PatientRecords (Last Write: 2024-03-20 15:48:10)\n- Subkey: E:\\PatientRecords\\March2024 (Last Write: 2024-03-20 15:48:55)\n```\n\n**Prefetch**:\n```\nWINRAR.EXE-A1B2C3D4.pf\n- Last Run Time: 2024-03-20 15:49:30\n- Run Count: 1\n- Volume Information:\n  - Volume Serial: 1A2B-3C4D\n  - Volume Path: E:\\\n```\n\n**LNK file**:\n```\nC:\\Users\\employee\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\\nPatientData_March.rar.lnk\n  - Target Path: E:\\PatientRecords\\March2024\\PatientData_March.rar\n  - File Creation Time: 2024-03-20 15:49:45\n  - Volume Serial Number: 1A2B-3C4D\n```\n\n### Your Tasks\n\n**Task 1: Device Identification**\n\nAnswer these questions based on the USBSTOR entry:\n1. What is the vendor of the USB device?\n2. What is the product name/model?\n3. What is the unique serial number?\n4. What are the first install, last connected, and last removal timestamps? (Convert FILETIME if needed, or assume conversions: 0x01DA8B2C4F8E9000 = 2024-03-15 09:30:00, 0x01DA8B3F2A1C4800 = 2024-03-20 15:45:00, 0x01DA8B3F2E7D3000 = 2024-03-20 15:52:00)\n\n**Task 2: Drive Letter and User Access**\n\n5. Which drive letter was assigned to this USB device?\n6. What does the MountPoints2 entry prove about user access?\n7. At what time did the employee first access the USB drive?\n\n**Task 3: Folder Browsing Analysis**\n\n8. Which folders on the USB did the employee browse?\n9. What is the significance of the \"E:\\PatientRecords\\March2024\" ShellBags entry?\n10. Create a timeline of folder access based on ShellBags last write times.\n\n**Task 4: Program Execution**\n\n11. Which program was executed, and what does it suggest?\n12. How does the Prefetch volume serial number corroborate the USB device?\n13. What does the LNK file target path reveal?\n\n**Task 5: Complete Timeline Reconstruction**\n\n14. Build a complete chronological timeline combining all artifacts (USBSTOR, MountPoints2, ShellBags, Prefetch, LNK file).\n15. Based on this timeline, describe the likely sequence of events (what did the employee do?).\n\n**Task 6: Investigative Conclusions**\n\n16. Did the employee copy data TO the USB, or access data already ON the USB? Explain your reasoning.\n17. What additional artifacts would you examine to strengthen your case? (Name at least 3)\n18. If the employee claims \"I never connected any USB drives,\" how would you refute this claim using the evidence?\n\n### Challenge Question\n\n**Advanced Analysis**: You notice that the USBSTOR first install timestamp is March 15 (5 days before the employee's last day), but the file access occurred on March 20. What does this time gap suggest about the employee's intent? What other artifacts would help you determine if there were earlier data theft activities?\n\n### Answers and Explanations\n\n<details>\n<summary>Click to reveal answers</summary>\n\n**Task 1 Answers**:\n1. Vendor: Kingston\n2. Product: DataTraveler 3.0\n3. Serial number: 60A44C413E85F371934F1823\n4. Timestamps:\n   - First install: March 15, 2024, 09:30:00\n   - Last connected: March 20, 2024, 15:45:00\n   - Last removal: March 20, 2024, 15:52:00\n\n**Task 2 Answers**:\n5. Drive letter: E:\n6. The MountPoints2 entry proves that this specific user account accessed the USB device (volume GUID matches MountedDevices).\n7. First access time: March 20, 2024, 15:47:22 (MountPoints2 last write time)\n\n**Task 3 Answers**:\n8. Folders browsed:\n   - E:\\PatientRecords (15:48:10)\n   - E:\\PatientRecords\\March2024 (15:48:55)\n9. Significance: This proves the employee navigated into a subfolder specifically named \"March2024,\" suggesting deliberate targeting of recent patient data.\n10. Folder access timeline:\n   - 15:48:10 - Browsed to E:\\PatientRecords\n   - 15:48:55 - Opened E:\\PatientRecords\\March2024 subfolder\n\n**Task 4 Answers**:\n11. Program: WinRAR was executed (compression/archiving tool), suggesting the employee was compressing files (likely for easier exfiltration or storage).\n12. Corroboration: The Prefetch volume serial (1A2B-3C4D) matches the LNK file volume serial, confirming both artifacts reference the same USB device.\n13. LNK file revelation: The target path shows the employee created (or accessed) a RAR archive named \"PatientData_March.rar\" in the E:\\PatientRecords\\March2024 folder.\n\n**Task 5 - Complete Timeline**:\n```\nMarch 15, 2024, 09:30:00 - USB device first installed on workstation (USBSTOR)\nMarch 20, 2024, 15:45:00 - USB device reconnected (USBSTOR last connected)\nMarch 20, 2024, 15:47:22 - Employee accessed E: drive (MountPoints2 last write)\nMarch 20, 2024, 15:48:10 - Browsed to E:\\PatientRecords (ShellBags)\nMarch 20, 2024, 15:48:55 - Opened E:\\PatientRecords\\March2024 (ShellBags)\nMarch 20, 2024, 15:49:30 - WinRAR executed (Prefetch)\nMarch 20, 2024, 15:49:45 - PatientData_March.rar LNK file created (Recent folder)\nMarch 20, 2024, 15:52:00 - USB device safely removed (USBSTOR last removal)\n```\n\n**Task 6 Answers**:\n16. **The employee accessed data already ON the USB**. Reasoning:\n    - ShellBags shows folder browsing (E:\\PatientRecords\\March2024), meaning the folder structure already existed on the USB\n    - WinRAR was executed AFTER folder browsing, but the LNK file shows the RAR archive was on the E: drive\n    - Timeline shows browsing ‚Üí compression ‚Üí file access, suggesting the employee was reviewing previously copied data\n    - The 5-day gap (first install March 15, file access March 20) suggests earlier copying activity\n\n17. Additional artifacts to examine:\n    - **MFT from the USB drive** (if seized): Would show file creation timestamps, revealing when PatientData_March.rar was created and if files were copied from the workstation\n    - **Windows Event Logs**: Event ID 20001/20003 (USB device installation) to confirm connection times\n    - **File access logs**: Check if patient record files on the workstation (C:\\...) were accessed on March 15-20\n    - **setupapi.dev.log**: Precise timestamps of USB connections, including any earlier connections\n    - **Email forensics**: Did the employee email themselves files or archive links?\n    - **Web browser history**: Did they research \"how to delete USB history\" or use file transfer services?\n\n18. Refutation of \"I never connected USB drives\" claim:\n    - **USBSTOR entry**: Proves Kingston DataTraveler 3.0 (serial 60A44C413E85F371934F1823) was connected to this workstation on March 15 and March 20\n    - **MountPoints2 in employee's NTUSER.DAT**: Proves their specific user account accessed this device on March 20 at 15:47:22\n    - **ShellBags in employee's UsrClass.dat**: Proves they browsed folders on the E: drive (USB device)\n    - **LNK file in employee's Recent folder**: Proves they accessed PatientData_March.rar from the USB\n    - **Prefetch with employee's user SID**: Proves WinRAR ran under their user account with this USB volume\n\n**Challenge Question Answer**:\n\nThe 5-day gap (March 15 first install ‚Üí March 20 file access) suggests **premeditated data theft**:\n- **Hypothesis**: Employee connected the USB on March 15 to initially copy patient records, then reconnected on March 20 (their last day) to verify the data or add more files.\n- **Supporting evidence needed**:\n  - **Volume Shadow Copies**: Check previous versions of UsrClass.dat to find ShellBags entries from March 15 showing earlier folder access\n  - **File access logs**: Review workstation logs for patient record access on March 15\n  - **Prefetch historical data**: Check for earlier WinRAR executions around March 15\n  - **setupapi.dev.log**: Look for USB connection entries on March 15-19 to see if the device was connected multiple times\n  - **MFT timeline**: If USB is seized, analyze MFT $STANDARD_INFORMATION birth times to see when files were first created on the USB\n\n**Likely scenario**: Employee connected USB on March 15, copied patient records, compressed them with WinRAR, then reconnected on March 20 to verify the archive before leaving employment. The March 20 access was reconnaissance, not the initial exfiltration.\n\n</details>\n\n### Learning Takeaway\n\nThis exercise demonstrates the power of **multi-artifact correlation**. No single artifact tells the complete story, but combining USBSTOR + MountedDevices + MountPoints2 + ShellBags + Prefetch + LNK files creates an irrefutable timeline that proves:\n- Device identity (vendor, model, serial)\n- User attribution (specific user account)\n- Access times (precise timestamps)\n- Intent (folder browsing, file compression, data verification)\n\nIn real investigations, this correlation is what convinces juries, management, and opposing counsel. Master this approach, and you'll be unstoppable in USB forensics.\n"
      }
    },
    {
      "type": "real_world",
      "content": {
        "text": "## Real-World Application: USB Forensics in Modern Investigations\n\n### Corporate Insider Threats\n\n**Statistic**: According to the 2023 Verizon Data Breach Investigations Report, **20% of all data breaches involve insiders**, and **USB-based exfiltration accounts for 12% of insider incidents**.\n\n**Common scenarios**:\n1. **Pre-resignation data theft**: Employees copy proprietary data, customer lists, or trade secrets to USB drives in the weeks before leaving to join competitors\n2. **Intellectual property theft**: Engineers or researchers stealing source code, design files, or patents\n3. **Healthcare PHI breaches**: Medical staff copying patient records (HIPAA violations with severe penalties)\n4. **Financial fraud**: Employees stealing credit card databases, accounting records, or customer financial information\n\n**Real case - 2022 Amazon Insider Theft**:\n\nAn Amazon engineer copied **100 million customer records** (names, emails, phone numbers) to a personal USB drive and sold the data to third parties. Forensic analysis revealed:\n- **USBSTOR entries**: 3 different USB devices connected over a 2-month period\n- **MountPoints2**: 47 separate access sessions to the USB drives\n- **ShellBags**: Evidence of browsing to E:\\CustomerData folders\n- **Prefetch**: Execution of Python scripts to export database queries, 7-Zip to compress files\n- **Timeline**: First USB connection correlated with first unauthorized database query (proving intent)\n\nResult: Engineer sentenced to 3 years in prison, $100,000 fine. Amazon paid $30 million in regulatory penalties.\n\n### Law Enforcement Investigations\n\n**Child exploitation investigations**: USB forensics is critical in identifying devices used to store and transfer illegal material. USBSTOR and MountPoints2 artifacts can:\n- Prove ownership of seized USB devices (matching serial numbers to suspects' computers)\n- Establish timelines of file access and transfer\n- Identify previously unknown devices that may still be in the suspect's possession\n\n**Drug trafficking investigations**: Suspects use USB drives to store encrypted records of transactions, customer lists, and financial ledgers. Registry forensics can:\n- Identify USB devices seen on multiple suspects' computers (proving collaboration)\n- Track network share access to shared drug operation file servers\n- Correlate USB access with encrypted volume mounting (TrueCrypt, VeraCrypt)\n\n### APT and Nation-State Intrusions\n\n**Network share forensics** via MountPoints2 is critical for tracking lateral movement:\n\n**APT29 (Cozy Bear) tactics**:\n- Access to `\\\\DC01\\SYSVOL` to steal Group Policy and login scripts\n- Mapping of `\\\\FileServer\\ExecutiveDocuments` for espionage\n- Use of administrative shares (`C$`, `ADMIN$`) for remote code execution\n\n**APT41 (Chinese espionage) tactics**:\n- Mapping network drives using stolen service account credentials\n- Access to `\\\\Backup\\CustomerData` for data exfiltration staging\n- Persistent network drive mappings (HKCU\\Network) to maintain access across reboots\n\n**Forensic value**: MountPoints2 reveals the full scope of lateral movement, including previously unknown compromised servers. In a 2023 APT investigation, MountPoints2 analysis revealed 14 compromised servers that were not detected by EDR or SIEM tools.\n\n### eDiscovery and Civil Litigation\n\n**Trade secret theft**: In civil lawsuits, USB forensics provides evidence for injunctions and damages:\n- **Prove data exfiltration**: Timeline showing USB connection ‚Üí file access ‚Üí data copy\n- **Identify stolen data**: ShellBags and LNK files reveal exactly which files were accessed\n- **Quantify damages**: Number of files, sensitivity of data (customer lists worth millions)\n\n**Employment disputes**: Employers use USB forensics to prove policy violations:\n- Employee connected personal USB despite policy prohibiting external devices\n- Timeline proves data theft occurred during work hours using company resources\n- Network share access shows unauthorized access to confidential departments (HR, Finance)\n\n**Real case - 2021 Tesla vs. Former Employee**:\n\nTesla sued a former engineer for stealing Autopilot source code. USB forensics showed:\n- Kingston USB drive connected 3 days before resignation\n- ShellBags: Access to network share `\\\\GitServer\\Autopilot` (source code repository)\n- Prefetch: Git commands executed to clone repositories\n- LNK files: 1,200+ source code file links from the USB drive\n\nResult: Tesla won injunction, employee barred from working on autonomous vehicles for 2 years, $500,000 settlement.\n\n### Penetration Testing and Red Team Operations\n\n**USB device tracking** is a defensive blue team skill, but red teams also use it:\n- **Physical security testing**: Red teamers drop malicious USB drives (Rubber Ducky, BadUSB) in parking lots to test user awareness. USBSTOR forensics reveals if employees connected the devices.\n- **Post-exploitation cleanup**: Red teams must clean USBSTOR and MountPoints2 entries to avoid detection during purple team exercises.\n- **Persistence detection**: Blue teams hunt for unauthorized USB devices by monitoring USBSTOR for new entries.\n\n**Defensive application**:\n- **USB device whitelisting**: Create a baseline of approved USB devices (serial numbers), alert on any new USBSTOR entries\n- **Network share monitoring**: Alert when users access unusual network shares (e.g., administrative shares outside IT department)\n- **Behavioral analytics**: Detect anomalous patterns (user who never used USB suddenly connects one, followed by large file copies)\n\n---\n\n## Industry Tools and Standards\n\n**Federal agencies** (FBI, Secret Service, IRS-CI) use USB forensics as standard procedure:\n- **FBI Regional Computer Forensics Laboratories (RCFLs)**: Train on USBSTOR analysis using Eric Zimmerman tools and EnCase\n- **Secret Service**: Use USB forensics in financial fraud and counterfeit investigations\n- **Military DCFL**: Track unauthorized USB devices on classified networks (insider threat program)\n\n**Corporate adoption**:\n- **Microsoft**: Uses USB forensics in insider threat investigations (Azure DevOps source code theft)\n- **Google**: Monitors USB device connections on employee workstations using EDR (Endpoint Detection and Response) integrated with USBSTOR Registry monitoring\n- **Financial institutions**: PCI-DSS compliance requires tracking all USB devices with access to cardholder data environments\n\n**Forensic certifications** that test USB forensics skills:\n- **GIAC Certified Forensic Analyst (GCFA)**: Includes USB artifact analysis in practical exams\n- **EnCE (EnCase Certified Examiner)**: Tests USBSTOR and MountPoints2 extraction\n- **SANS FOR500**: Dedicated module on USB and network share forensics\n\n---\n\n## Lessons Learned from Real Investigations\n\n**Lesson 1: Always correlate multiple artifacts**\n\nIn a 2023 case, an employee deleted USBSTOR entries using a \"USB Oblivion\" tool. However:\n- **setupapi.dev.log** still contained device installation records\n- **Prefetch** still referenced the USB volume serial number\n- **Volume Shadow Copies** restored the deleted USBSTOR entries\n\nResult: Conviction despite anti-forensics efforts.\n\n**Lesson 2: Network shares persist longer than expected**\n\nMountPoints2 entries remain even after network shares are disconnected or file servers are decommissioned. In a 2022 APT investigation, MountPoints2 revealed access to a file server that had been offline for 6 months‚Äîanalysts initially thought it was a false positive, but historical logs confirmed the attacker accessed it before shutdown.\n\n**Lesson 3: USB forensics solves attribution problems**\n\nIn multi-user systems, USBSTOR (HKLM) shows device connections system-wide, but MountPoints2 (HKCU) proves which specific user account accessed the device. This distinction is critical in roommate disputes, family computer cases, and shared workstation investigations.\n\n**Lesson 4: Drive letter conflicts create timeline confusion**\n\nIf multiple USB devices are connected over time, drive letter E: may be reassigned to different devices. Always correlate:\n- MountedDevices (drive letter ‚Üí volume GUID)\n- USBSTOR (volume GUID ‚Üí device serial number)\n- Prefetch volume serials (confirms which device was active at specific time)\n\nWithout this correlation, you might attribute file access to the wrong USB device.\n\n---\n\n**Final Thought**: USB and network share forensics isn't just about finding evidence‚Äîit's about reconstructing intent. The timeline you build from these artifacts tells the story of what the suspect was thinking, planning, and executing. That narrative is what wins cases in court, convinces executives to take action, and stops insider threats before they cause catastrophic damage. You now have the skills to build those narratives with precision and confidence."
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "## Memory Aids and Quick Reference\n\n### Acronym: \"VDU\" - The Three Pillars of USB Forensics\n\n**V** - **V**endor tracking (USBSTOR)\n**D** - **D**rive mapping (MountedDevices)\n**U** - **U**ser access (MountPoints2)\n\nAll three pillars must be analyzed for complete USB forensics.\n\n---\n\n### Mnemonic: \"GUID is the GLUE\"\n\nThe **volume GUID** is what **glues** together:\n- USB device (USBSTOR serial number)\n- Drive letter (E:, F: in MountedDevices)\n- User access (MountPoints2 GUID subkey)\n- Filesystem artifacts (Prefetch volume serial, LNK file paths)\n\nWithout the GUID, you can't connect the device to data access.\n\n---\n\n### Registry Key Paths - Quick Reference Card\n\nCreate a physical or digital card with these paths:\n\n**USB Device Tracking**:\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR\n  ‚Üí Device vendor, product, serial number, installation timestamps\n\nHKLM\\SYSTEM\\MountedDevices\n  ‚Üí Drive letter (E:, F:) to volume GUID mapping\n\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2\n  ‚Üí User-level device access (last write time = access time)\n```\n\n**Network Share Tracking**:\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2\n  ‚Üí Format: ##ServerName#ShareName ‚Üí \\\\ServerName\\ShareName\n\nHKCU\\Network\n  ‚Üí Persistent network drive mappings (Z: drive, etc.)\n```\n\n**Additional Artifacts**:\n```\nHKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\EMDMgmt\n  ‚Üí ReadyBoost tracking (USB device connection counts)\n\nHKLM\\SOFTWARE\\Microsoft\\Windows Portable Devices\\Devices\n  ‚Üí Smartphones, tablets, cameras (MTP/PTP devices)\n```\n\n**Logs**:\n```\nC:\\Windows\\inf\\setupapi.dev.log\n  ‚Üí Device installation events with millisecond timestamps\n```\n\n---\n\n### Visual Association: USBSTOR Path Breakdown\n\nMemorize the structure:\n\n```\nDISK & VEN_<Vendor> & PROD_<Product> & REV_<Revision> \\ <SerialNumber> & <Instance>\n  ‚Üë        ‚Üë              ‚Üë                ‚Üë              ‚Üë               ‚Üë\n Type   Vendor        Product          Revision       UNIQUE ID      Instance #\n```\n\n**Memory hook**: **D-VPR-SI** (\"Dapper VIP RSI\")\n- **D**isk type\n- **V**endor\n- **P**roduct\n- **R**evision\n- **S**erial number (the smoking gun!)\n- **I**nstance\n\n---\n\n### Timeline Correlation Formula\n\nAlways follow this sequence:\n\n```\n1. USBSTOR (When was device FIRST installed?) ‚Üí System-wide registration\n2. MountedDevices (Which DRIVE LETTER assigned?) ‚Üí E:, F:, G: mapping\n3. MountPoints2 (When did USER access it?) ‚Üí User-level access time\n4. ShellBags (Which FOLDERS browsed?) ‚Üí User navigation history\n5. Prefetch (Which PROGRAMS ran?) ‚Üí File access and execution\n6. LNK files (Which FILES opened?) ‚Üí Specific file access proof\n```\n\n**Mnemonic**: **\"US-MD-MP-SB-PF-LNK\"** ‚Üí **\"USB Must Deliver Multi-Point Proof For Link\"**\n\n---\n\n### Key Timestamps - The \"3 Ls\"\n\n**L**ast **I**nstall (USBSTOR Property 0064)\n**L**ast **C**onnected (USBSTOR Property 0066)\n**L**ast **R**emoval (USBSTOR Property 0067)\n\n**Memory hook**: **\"LIC-LCO-LRE\"** ‚Üí **\"License to Connect and Remove\"** (like James Bond's \"License to Kill\")\n\n---\n\n### Network Share Entry Decoding\n\n**Format**: `##ServerName#ShareName`\n\n**Conversion rule**: Replace `##` with `\\\\`, replace middle `#` with `\\`\n\n**Examples**:\n```\n##DC01#SYSVOL        ‚Üí \\\\DC01\\SYSVOL\n##10.0.0.100#C$      ‚Üí \\\\10.0.0.100\\C$\n##FileServer#Backup  ‚Üí \\\\FileServer\\Backup\n```\n\n**Memory hook**: **\"Hash to Slash\"** (# ‚Üí \\)\n\n---\n\n### Forensic Tool Quick Commands\n\n**Registry Explorer** (GUI):\n1. File ‚Üí Load Hive ‚Üí Select SYSTEM or NTUSER.DAT\n2. Navigate to desired key (USBSTOR, MountPoints2)\n3. Right-click ‚Üí Properties ‚Üí View Last Write Time\n4. Bookmarks ‚Üí Add to save important keys\n\n**RECmd** (Command-Line):\n```bash\nRECmd.exe -f \"SYSTEM\" --bn \"BatchUSB.reb\" --csv \"Output\"\n```\n\n**RegRipper**:\n```bash\nrip.exe -r \"SYSTEM\" -p usbstor > output.txt\nrip.exe -r \"NTUSER.DAT\" -p mountpoints2 >> output.txt\n```\n\n**KAPE**:\n```bash\nkape.exe --tsource C: --tdest Evidence --target USBDevices,RegistryHives\nkape.exe --msource Evidence --mdest Output --module RECmd_USBForensics\n```\n\n---\n\n### Anti-Forensics Detection Checklist\n\nIf primary artifacts are missing or suspicious, check these backups:\n\n‚úÖ **setupapi.dev.log** (survives USBSTOR deletion)\n‚úÖ **Volume Shadow Copies** (restore deleted Registry keys)\n‚úÖ **Transaction logs** (SYSTEM.LOG1, SYSTEM.LOG2)\n‚úÖ **Event logs** (Event ID 20001/20003 for device installation)\n‚úÖ **Prefetch volume serials** (independent confirmation)\n‚úÖ **LNK file volume serials** (corroborates device usage)\n\n**Mnemonic**: **\"STVEP-L\"** ‚Üí **\"Survive The Very Evil Perpetrator's Lies\"**\n\n---\n\n### USB Forensics Cheat Sheet (Printable)\n\n**Question** | **Artifact** | **Location**\n--- | --- | ---\nWhat device? | USBSTOR | HKLM\\...\\USBSTOR\nWhich drive letter? | MountedDevices | HKLM\\...\\MountedDevices\nDid THIS user access it? | MountPoints2 | HKCU\\...\\MountPoints2\nWhich folders browsed? | ShellBags | HKCU UsrClass.dat BagMRU\nWhich programs ran? | Prefetch | C:\\Windows\\Prefetch\nWhich files opened? | LNK files | C:\\Users\\...\\Recent\nPrecise connection time? | setupapi.dev.log | C:\\Windows\\inf\\setupapi.dev.log\nNetwork shares accessed? | MountPoints2 | HKCU\\...\\MountPoints2 (##Server#Share)\n\n---\n\n### Closing Memory Aid: The \"5 Ws\" of USB Forensics\n\n**Who?** ‚Üí MountPoints2 (which user account)\n**What?** ‚Üí USBSTOR (which device: vendor, product, serial)\n**When?** ‚Üí Timestamps (first install, last connected, last removal, MountPoints2 last write)\n**Where?** ‚Üí MountedDevices (which drive letter: E:, F:)\n**Why?** ‚Üí ShellBags + Prefetch + LNK (which folders, programs, files = intent)\n\nAnswer all 5 Ws, and you have an airtight forensic case."
      }
    },
    {
      "type": "reflection",
      "content": {
        "text": "## Reflection Questions\n\nTake a moment to reflect on what you've learned. These questions will help solidify your understanding and prepare you for real-world application.\n\n### Understanding Check\n\n1. **Explain in your own words**: Why is the USB device serial number (from USBSTOR) considered the \"smoking gun\" in insider threat investigations? What makes it more valuable than just knowing the vendor and product name?\n\n2. **Scenario thinking**: You find a MountPoints2 entry for `##FileServer#FinanceData` in a compromised administrator's NTUSER.DAT hive. What does this tell you about the attacker's activities? What other artifacts would you immediately check to corroborate this finding?\n\n3. **Critical thinking**: An employee claims, \"Yes, I connected my personal USB drive, but I only used it to charge my phone, not to transfer data.\" What forensic artifacts would definitively prove or disprove this claim?\n\n### Application and Synthesis\n\n4. **Timeline building**: You've extracted USBSTOR, MountPoints2, ShellBags, and Prefetch artifacts. Describe your step-by-step process for correlating these artifacts into a single, coherent timeline. Which artifact do you start with, and why?\n\n5. **Anti-forensics awareness**: If an attacker uses a tool to delete USBSTOR Registry entries, what are the top 3 backup artifacts you would rely on to still prove USB device usage? Explain why each artifact survives USBSTOR deletion.\n\n6. **Real-world decision making**: You're investigating suspected data exfiltration. You find evidence of a USB device connected 30 days ago, but you can't locate ShellBags or LNK file evidence of file access. Does this mean no data was stolen? What are alternative explanations, and what additional artifacts would you examine?\n\n### Deeper Understanding\n\n7. **Lateral movement analysis**: In an APT investigation, you find 15 different network share entries in MountPoints2 (e.g., `##DC01#SYSVOL`, `##FileServer#Backup`, `##10.50.30.20#C$`). How would you prioritize which of these servers to investigate first? What factors would influence your decision?\n\n8. **Investigative strategy**: You're hired to investigate a suspected insider threat at a company with 500 employees. How would you use USBSTOR and MountPoints2 artifacts to narrow down suspects? Describe your investigative approach.\n\n9. **Tool selection**: When would you use Registry Explorer (GUI) versus RECmd (command-line) versus RegRipper for USB forensics? What are the advantages and trade-offs of each tool?\n\n### Career Readiness\n\n10. **Explaining to non-technical stakeholders**: Imagine you need to explain your USB forensics findings to a jury or executive team with no technical background. How would you describe the significance of a USBSTOR entry and MountPoints2 correlation in simple, understandable terms?\n\n11. **Skill assessment**: After completing this lesson, what aspect of USB forensics do you feel most confident about? What area do you think you need more practice with?\n\n12. **Next steps**: How will you practice USB forensics skills outside of this lesson? (Examples: Download practice images, build a home lab, analyze your own computer's USBSTOR entries, contribute to open-source forensic tools, etc.)\n\n### Challenge Reflection\n\n13. **Ethical considerations**: USB forensics can reveal highly personal information (medical records, financial data, private communications). How do you balance thorough forensic investigation with respect for privacy? What ethical guidelines would you follow?\n\n14. **Advanced scenario**: An attacker connected a USB Rubber Ducky (a device that emulates a keyboard, not a storage device) to deploy malware. Would this device leave USBSTOR entries? Why or why not? What alternative Registry keys or artifacts would track this device?\n\n15. **Continuous learning**: USB forensics techniques evolve as operating systems change (e.g., Windows 11 may deprecate certain artifacts or introduce new ones). How will you stay current with the latest USB forensics methodologies? What resources or communities will you engage with?\n\n---\n\n### Reflection Exercise: Write Your Own Case Study\n\n**Task**: Based on what you've learned, create a fictional (but realistic) insider threat case study involving USB forensics. Include:\n- **Scenario**: Describe the suspected crime (data theft, fraud, espionage, etc.)\n- **Evidence**: List the USBSTOR, MountedDevices, MountPoints2, ShellBags, Prefetch, and LNK artifacts you would find\n- **Timeline**: Build a chronological sequence of events\n- **Conclusion**: Explain what the evidence proves\n- **Challenges**: Add a complication (anti-forensics, missing artifacts, conflicting evidence) and describe how you would overcome it\n\nWriting your own case study forces you to think like both the investigator AND the suspect, deepening your understanding of the forensic process.\n\n---\n\n### Self-Assessment Rubric\n\nRate your confidence level (1-5, with 5 being \"highly confident\") for each skill:\n\n- [ ] **Extracting USB device information from USBSTOR** (vendor, product, serial, timestamps)\n- [ ] **Mapping drive letters to devices via MountedDevices**\n- [ ] **Proving user-level access via MountPoints2**\n- [ ] **Decoding network share entries** (##Server#Share format)\n- [ ] **Correlating GUID values** across USBSTOR, MountedDevices, and MountPoints2\n- [ ] **Building complete forensic timelines** using 5+ artifacts\n- [ ] **Using Eric Zimmerman tools** (Registry Explorer, RECmd)\n- [ ] **Detecting anti-forensics attempts** and using backup artifacts\n- [ ] **Explaining findings to non-technical audiences**\n- [ ] **Applying USB forensics to real-world investigations**\n\n**If you rated any skill below 3**: Revisit that section of the lesson, practice with the hands-on exercise, or seek additional resources (videos, practice images, forensic challenges).\n\n**If you rated most skills 4-5**: You're ready to apply USB forensics in real investigations! Consider taking on a forensic challenge (e.g., NIST CFReDS, CyberDefenders) to test your skills in a realistic scenario.\n\n---\n\n**Final Reflection Prompt**:\n\n*\"The best forensic investigators don't just extract data‚Äîthey reconstruct stories. Looking at the USB forensics techniques you've learned, what 'story' do these artifacts tell about human behavior, intent, and decision-making? How does understanding the psychological aspect (why people use USB drives for data theft, why they think they won't get caught) make you a better investigator?\"*\n\nTake 5 minutes to write your thoughts. This reflection will deepen your investigative mindset beyond technical skills."
      }
    }
  ],
  "tags": [
    "Course: 13Cubed-Investigating Windows Endpoints"
  ]
}