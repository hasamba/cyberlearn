{
  "lesson_id": "a9b8c7d6-e5f4-4d3c-b2a1-0f9e8d7c6b5a",
  "domain": "pentest",
  "title": "Advanced IPv6 Attacks",
  "difficulty": 3,
  "order_index": 143,
  "prerequisites": [],
  "concepts": [
    "IPv6 addressing and protocol differences from IPv4",
    "IPv6 reconnaissance and neighbor discovery attacks",
    "Router Advertisement (RA) and SLAAC exploitation",
    "Dual-stack network attacks and tunneling protocols",
    "IPv6 fragmentation and extension header abuse"
  ],
  "estimated_time": 60,
  "learning_objectives": [
    "Understand IPv6 protocol architecture and security implications",
    "Perform IPv6 reconnaissance using ICMPv6 and neighbor discovery",
    "Execute Router Advertisement attacks for man-in-the-middle",
    "Exploit dual-stack environments for IPv4 bypass",
    "Abuse IPv6 extension headers for evasion and denial of service"
  ],
  "post_assessment": [
    {
      "question_id": "ipv6-001",
      "question": "What is the primary security risk of SLAAC (Stateless Address Autoconfiguration) compared to DHCPv6?",
      "options": [
        "SLAAC uses weaker encryption",
        "SLAAC allows any router to assign addresses via Router Advertisements without authentication",
        "SLAAC is slower than DHCPv6",
        "SLAAC doesn't support DNS configuration"
      ],
      "correct_answer": 1,
      "explanation": "SLAAC's primary vulnerability is that it trusts Router Advertisement (RA) messages without authentication. Any device on the network can send RAs, allowing attackers to become the default gateway (man-in-the-middle), assign malicious DNS servers, or cause denial of service by sending invalid prefixes. DHCPv6 can be configured with authentication, though it's rarely used in practice.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "ipv6-002",
      "question": "You're scanning an IPv6 network. Why is it impractical to scan an entire /64 subnet like you would scan a /24 IPv4 network?",
      "options": [
        "IPv6 doesn't support port scanning",
        "A /64 subnet contains 2^64 addresses (18 quintillion), making brute-force enumeration infeasible",
        "IPv6 firewalls block all scans",
        "nmap doesn't support IPv6"
      ],
      "correct_answer": 1,
      "explanation": "An IPv6 /64 subnet contains 2^64 addresses (approximately 18.4 quintillion addresses). Even at 1 million addresses per second, it would take 584,000 years to scan. This is why IPv6 reconnaissance relies on passive techniques (listening to multicast traffic), active multicast probes (all-nodes address ff02::1), or analyzing DNS/NDP caches rather than brute-force scanning.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "ipv6-003",
      "question": "An attacker sends a Router Advertisement with a ::/0 prefix and a high priority. What is the likely impact?",
      "options": [
        "Devices will use the attacker as the default gateway for all traffic",
        "Devices will lose IPv6 connectivity entirely",
        "The network will switch to IPv4-only",
        "Nothing - ::/0 is an invalid prefix"
      ],
      "correct_answer": 0,
      "explanation": "A ::/0 prefix in a Router Advertisement means 'all IPv6 addresses' (equivalent to 0.0.0.0/0 in IPv4). Devices will configure the attacker's router as the default gateway for all IPv6 traffic, enabling man-in-the-middle attacks. Combined with high priority (low preference value), the attacker's route will be preferred over legitimate routers. This is a classic RA spoofing attack.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "ipv6-004",
      "question": "In a dual-stack environment, you discover that IPv6 is enabled but not monitored by the organization's IDS. Which attack technique would be MOST effective?",
      "options": [
        "Disable IPv6 on all systems",
        "Tunnel malicious traffic over IPv6 to bypass IPv4-only security controls",
        "Scan the IPv6 network for vulnerabilities",
        "Configure static IPv6 addresses"
      ],
      "correct_answer": 1,
      "explanation": "If IPv6 is enabled but not monitored, tunneling attacks over IPv6 bypass IPv4-focused security controls (firewalls, IDS, DLP). Techniques include: tunneling C2 traffic over IPv6, using IPv6 for lateral movement, or encapsulating IPv4 attacks in IPv6 packets. Many organizations enable IPv6 by default (Windows, Linux, macOS) but don't monitor it, creating a security blind spot. This is a common finding on pentests.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "ipv6-005",
      "question": "You send an ICMPv6 packet with a fragmentation extension header containing overlapping fragments. What is the likely goal of this attack?",
      "options": [
        "Speed up packet transmission",
        "Evade IDS/firewall inspection by fragmenting malicious payload",
        "Compress the packet for efficiency",
        "Test network MTU"
      ],
      "correct_answer": 1,
      "explanation": "IPv6 fragmentation attacks exploit how intermediate devices (firewalls, IDS) reassemble fragments. Overlapping fragments can: 1) Evade signature-based IDS (malicious payload split across fragments), 2) Bypass firewalls (first fragment passes rule check, subsequent fragments contain attack), 3) Exploit reassembly bugs (overlapping offsets cause buffer overflows). Many security devices don't properly reassemble IPv6 fragments, making this an effective evasion technique.",
      "type": "multiple_choice",
      "difficulty": 3
    }
  ],
  "jim_kwik_principles": [
    "teach_like_im_10",
    "active_learning",
    "memory_hooks",
    "connect_to_what_i_know",
    "minimum_effective_dose",
    "multiple_memory_pathways",
    "meta_learning",
    "gamify_it"
  ],
  "content_blocks": [
    {
      "type": "mindset_coach",
      "content": {
        "text": "# Welcome to Advanced IPv6 Attacks! ğŸŒğŸ”“\n\nYou're about to learn **one of the most overlooked attack surfaces** in modern networks: IPv6.\n\n**Why does IPv6 matter for pentesters?**\n\nğŸš¨ **IPv6 is everywhere** (enabled by default):\n- Windows: IPv6 enabled since Vista (2007)\n- macOS: IPv6 enabled since 10.2 (2002)\n- Linux: IPv6 enabled in kernel since 2.2 (1999)\n- Mobile: iOS and Android enable IPv6 by default\n\n**But organizations often ignore it**:\n- âŒ 70% of networks have IPv6 enabled but **not monitored**\n- âŒ Firewalls configured for IPv4, **IPv6 traffic bypasses rules**\n- âŒ IDS/IPS inspect IPv4, **IPv6 traffic is blind spot**\n- âŒ Security policies focus on IPv4, **IPv6 is forgotten**\n\n**Result**: IPv6 is a **security blind spot** that attackers exploit.\n\n**Real-world examples**:\n\n**DEF CON 26 (2018)**: Researcher demonstrated IPv6-based backdoors on 80% of tested enterprise networks. Organizations didn't even know IPv6 was enabled.\n\n**Mirai botnet (2016)**: Later variants used IPv6 to bypass IPv4-only DDoS mitigations.\n\n**APT attacks**: Nation-state actors use IPv6 tunneling to evade detection (C2 traffic over IPv6, bypassing IPv4-only monitoring).\n\n**What you'll master today**:\n\nâœ… IPv6 addressing and protocol fundamentals  \nâœ… Reconnaissance techniques (NDP, multicast, passive discovery)  \nâœ… Router Advertisement attacks (MITM, DoS, rogue gateway)  \nâœ… Dual-stack exploitation (IPv4 bypass via IPv6)  \nâœ… Extension header abuse (fragmentation, evasion, DoS)  \nâœ… IPv6 tunneling attacks (6to4, Teredo, ISATAP)\n\n**Skills you'll gain**:\n\nğŸ¯ **Recon**: Discover IPv6 hosts without brute-force scanning  \nğŸ” **MITM**: Become the default gateway via RA spoofing  \nğŸ“¡ **Evasion**: Bypass IPv4-only security controls  \nğŸ’¥ **Impact**: Demonstrate IPv6 as a critical security gap\n\n**Career relevance**:\n\n- **Penetration testers**: 60%+ of networks are dual-stack (IPv4 + IPv6)\n- **Red teamers**: IPv6 tunneling bypasses egress filtering\n- **Security architects**: Must design controls for both IPv4 and IPv6\n- **SOC analysts**: Need to monitor IPv6 traffic (not just IPv4)\n\n**This lesson is rated \"Advanced\" (difficulty 3)** because:\n- Requires networking knowledge (IPv6 addressing, ICMPv6, NDP)\n- Involves protocol manipulation (RA spoofing, extension headers)\n- Uses specialized tools (THC-IPv6, Scapy, Chiron)\n\n**But don't worry** - we'll build up from IPv6 basics to advanced attacks.\n\n**Why learn IPv6 attacks?**\n\n**Most pentesters focus on IPv4**. Very few test IPv6 comprehensively.\n\nThis gives you a **competitive advantage**:\n- Find vulnerabilities others miss\n- Demonstrate security blind spots\n- Provide unique value to clients\n\nLet's explore the IPv6 attack surface! ğŸš€"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "# Teach Me Like I'm 10: What is IPv6 and Why Attack It?\n\n## The Post Office Analogy\n\nImagine the internet is like a postal system:\n\n### IPv4 = Old Post Office (Running Out of Addresses)\n\n**IPv4 addresses** are like street addresses:\n```\n192.168.1.100 = \"100 Main Street\"\n```\n\n**Problem**: Only ~4 billion IPv4 addresses exist (2^32).\n\n**Reality**: 8 billion people, 20+ billion devices (phones, laptops, IoT).\n\n**Solution**: NAT (Network Address Translation) - Like apartment buildings:\n```\nPublic address: 203.0.113.1 (building address)\nPrivate addresses: 192.168.1.1-255 (apartment numbers)\n```\n\nNAT works, but it's a **workaround**, not a real solution.\n\n### IPv6 = New Post Office (Infinite Addresses)\n\n**IPv6 addresses** are like cosmic coordinates:\n```\n2001:0db8:85a3:0000:0000:8a2e:0370:7334\n```\n\n**Capacity**: 340 undecillion addresses (2^128).\n\n**How many is that?**\n- Enough to give every atom on Earth's surface 100 unique addresses\n- Enough to assign 100 IPv6 addresses to every person who ever lived\n\n**Result**: No more NAT needed. Every device gets its own public address.\n\n## Why Is IPv6 Dangerous for Security?\n\n### Reason 1: It's Enabled But Ignored\n\n**Your computer right now** probably has IPv6 enabled:\n\n```bash\n# Check on Windows\nipconfig\n# You'll see: IPv6 Address . . . . . . . : fe80::1a2b:3c4d:5e6f:7890\n\n# Check on Linux/Mac\nip addr show\n# You'll see: inet6 fe80::1a2b:3c4d:5e6f:7890/64\n```\n\n**But organizations don't monitor it**:\n- Firewall rules: IPv4 only âœ…, IPv6 âŒ (wide open)\n- IDS: IPv4 signatures âœ…, IPv6 âŒ (blind)\n- Logging: IPv4 traffic âœ…, IPv6 âŒ (not captured)\n\n**Attacker advantage**: Send malicious traffic over IPv6 â†’ bypasses all security controls.\n\n### Reason 2: Auto-Configuration (SLAAC) Has No Security\n\n**IPv4**: Devices ask DHCP server for address (centralized control).\n\n**IPv6 SLAAC**: Routers broadcast \"Use this network prefix!\" (no authentication).\n\n```\nRouter: \"Hey everyone, use prefix 2001:db8::/64!\"\nDevices: \"OK!\" (automatically configure addresses)\n\nAttacker (pretending to be router): \"Actually, use MY prefix!\"\nDevices: \"OK!\" (now send all traffic through attacker)\n```\n\n**No questions asked. No authentication. Total trust.**\n\n### Reason 3: Scanning Is Impossible\n\n**IPv4 network** (192.168.1.0/24):\n```\n256 addresses (192.168.1.1 to 192.168.1.254)\nnmap scan: 30 seconds\n```\n\n**IPv6 network** (2001:db8::/64):\n```\n18,446,744,073,709,551,616 addresses (2^64)\nnmap scan: 584,000 YEARS\n```\n\n**Attacker thinking**: \"I can hide devices in IPv6. They'll never be found.\"\n\n**Defender thinking**: \"I can't scan for rogue devices. Too many addresses.\"\n\n## The Attack Scenarios\n\n### Attack 1: Rogue Router\n\n**Like putting up fake street signs**:\n\n```\nAttacker: \"All traffic to 'Main Street' goes through ME now!\"\nDevices: \"OK!\" (send traffic to attacker instead of real router)\nAttacker: Reads all traffic (passwords, emails, banking)\n```\n\n**In IPv6**: Send fake Router Advertisements (RA).\n\n### Attack 2: IPv6 Tunnel Bypass\n\n**Like a secret underground tunnel**:\n\n```\nFirewall blocks Port 443 (HTTPS):\n  IPv4 traffic: âŒ BLOCKED\n  IPv6 traffic: âœ… ALLOWED (firewall doesn't check IPv6)\n\nAttacker: Tunnels malicious traffic over IPv6\nFirewall: \"I don't see anything!\" (only looking at IPv4)\n```\n\n### Attack 3: Neighbor Discovery Poisoning\n\n**Like telling mail delivery \"I live at this address now\"**:\n\n```\nVictim's IPv6: 2001:db8::100\nAttacker: \"That's my address! Send mail here!\"\nNetwork: \"OK!\" (sends victim's traffic to attacker)\n```\n\n**In IPv6**: Spoof Neighbor Advertisement messages (like ARP poisoning in IPv4).\n\n## The Key Insight\n\n**IPv6 was designed for convenience, not security**:\n\nâŒ No authentication in auto-configuration  \nâŒ Trust all routers by default  \nâŒ Too many addresses to monitor  \nâŒ Most security tools ignore it\n\n**Your job as a pentester**: Show organizations that IPv6 is a blind spot they need to fix.\n\n**Remember**:\n- IPv6 is like having a second front door to your house\n- Most people lock the first door (IPv4)\n- But leave the second door wide open (IPv6)\n- Attackers just walk through the unlocked door\n\nNow let's learn how to pick that IPv6 lock! ğŸ˜Š"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "# Understanding IPv6 Protocol and Architecture\n\n## IPv6 Addressing Fundamentals\n\n### Address Format\n\nIPv6 addresses are 128 bits, written as 8 groups of 4 hexadecimal digits:\n\n```\n2001:0db8:85a3:0000:0000:8a2e:0370:7334\n â””â”¬â”€â”˜ â””â”¬â”€â”˜ â””â”¬â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”¬â”€â”˜ â””â”¬â”€â”˜ â””â”¬â”€â”˜\n  â”‚    â”‚    â”‚      â”‚       â”‚     â”‚    â”‚    â””â”€ Interface ID (64 bits)\n  â”‚    â”‚    â”‚      â”‚       â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€ Interface ID\n  â”‚    â”‚    â”‚      â”‚       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Interface ID\n  â”‚    â”‚    â”‚      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Interface ID\n  â”‚    â”‚    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Subnet ID\n  â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Subnet ID\n  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Global Routing Prefix\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Global Routing Prefix\n```\n\n**Shortening rules**:\n\n1. **Leading zeros** can be omitted:\n   ```\n   2001:0db8:0001:0000:0000:0000:0000:0001\n   â†’\n   2001:db8:1:0:0:0:0:1\n   ```\n\n2. **Consecutive zeros** can be replaced with `::`:\n   ```\n   2001:db8:1:0:0:0:0:1\n   â†’\n   2001:db8:1::1\n   ```\n\n   **âš ï¸ Can only use `::` once** (otherwise ambiguous).\n\n### Address Types\n\n**Global Unicast** (2000::/3):\n```\n2001:db8::1\n```\n- Routable on the internet (like IPv4 public addresses)\n- Allocated by IANA to RIRs\n\n**Link-Local** (fe80::/10):\n```\nfe80::1a2b:3c4d:5e6f:7890\n```\n- Only valid on the local network segment\n- Automatically configured on all IPv6 interfaces\n- **Cannot be routed** (equivalent to 169.254.0.0/16 in IPv4)\n- **Critical for attacks**: NDP, RA spoofing use link-local\n\n**Multicast** (ff00::/8):\n```\nff02::1 (all nodes)\nff02::2 (all routers)\nff02::1:ff00:0/104 (solicited-node multicast)\n```\n- No broadcast in IPv6 (multicast replaces it)\n- **Attack surface**: Recon via multicast pings\n\n**Unique Local** (fc00::/7):\n```\nfd12:3456:789a::1\n```\n- Private addresses (like 10.0.0.0/8, 192.168.0.0/16 in IPv4)\n- Not routable on internet\n\n**Special Addresses**:\n```\n::1         Loopback (equivalent to 127.0.0.1)\n::          Unspecified address (0.0.0.0)\n::ffff:192.168.1.1  IPv4-mapped IPv6 address\n```\n\n---\n\n## ICMPv6 and Neighbor Discovery Protocol (NDP)\n\n### ICMPv6 vs. ICMPv4\n\nIPv6 relies heavily on ICMPv6 (more than IPv4 relies on ICMP):\n\n**ICMPv6 handles**:\n- Error messages (unreachable, too big, time exceeded)\n- **Neighbor Discovery** (replaces ARP)\n- **Router Discovery** (replaces DHCP for addresses)\n- **Path MTU Discovery**\n- **Multicast Listener Discovery**\n\n**Security implication**: **Cannot block ICMPv6** without breaking IPv6 functionality.\n\n### Neighbor Discovery Protocol (NDP)\n\n**NDP replaces ARP** in IPv6. Uses ICMPv6 messages:\n\n**1. Router Solicitation (RS)** - Type 133\n```\nDevice: \"Any routers here?\"\n```\n\n**2. Router Advertisement (RA)** - Type 134\n```\nRouter: \"I'm here! Use prefix 2001:db8::/64. I'm your default gateway.\"\n```\n\n**âš ï¸ Attack vector**: Rogue RA (attacker sends fake RA)\n\n**3. Neighbor Solicitation (NS)** - Type 135\n```\nDevice: \"Who has IPv6 address 2001:db8::1?\"\n```\n\n**4. Neighbor Advertisement (NA)** - Type 136\n```\nDevice: \"I have 2001:db8::1. My MAC is aa:bb:cc:dd:ee:ff.\"\n```\n\n**âš ï¸ Attack vector**: NA spoofing (like ARP poisoning)\n\n**5. Redirect** - Type 137\n```\nRouter: \"To reach 2001:db8::100, use router 2001:db8::1 instead of me.\"\n```\n\n**âš ï¸ Attack vector**: Redirect spoofing (MITM)\n\n### NDP vs. ARP Security Comparison\n\n| Feature | ARP (IPv4) | NDP (IPv6) |\n|---------|------------|------------|\n| **Authentication** | None | None (same vulnerability) |\n| **Spoofing protection** | None | SEcure Neighbor Discovery (SEND) - rarely deployed |\n| **Broadcast** | Yes (noisy) | No (uses multicast - quieter) |\n| **Detection difficulty** | Easy (broadcast visible) | Harder (multicast less visible) |\n\n**Result**: NDP is just as vulnerable as ARP, but harder to detect.\n\n---\n\n## SLAAC (Stateless Address Autoconfiguration)\n\n### How SLAAC Works\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚            SLAAC Address Configuration                   â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                          â”‚\nâ”‚  1. Device boots, enables IPv6                           â”‚\nâ”‚     â†“                                                    â”‚\nâ”‚  2. Device generates link-local address (fe80::...)      â”‚\nâ”‚     fe80::<derived from MAC or random>                   â”‚\nâ”‚     â†“                                                    â”‚\nâ”‚  3. Device sends Router Solicitation (RS)                â”‚\nâ”‚     \"Any routers here?\" (to ff02::2 - all routers)       â”‚\nâ”‚     â†“                                                    â”‚\nâ”‚  4. Router sends Router Advertisement (RA)               â”‚\nâ”‚     \"Use prefix: 2001:db8:1::/64\"                        â”‚\nâ”‚     \"I'm your default gateway: fe80::1\"                  â”‚\nâ”‚     \"DNS servers: 2001:db8::53\"                          â”‚\nâ”‚     â†“                                                    â”‚\nâ”‚  5. Device auto-configures global address                â”‚\nâ”‚     2001:db8:1::<random 64 bits>                         â”‚\nâ”‚     â†“                                                    â”‚\nâ”‚  6. Device sends Neighbor Solicitation (DAD check)       â”‚\nâ”‚     \"Is anyone using 2001:db8:1::1234?\"                  â”‚\nâ”‚     â†“                                                    â”‚\nâ”‚  7. No response? Address is unique. Configuration done!  â”‚\nâ”‚                                                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Key security issue**: **No authentication in step 4** (RA from router).\n\nAny device can send RA â†’ Any device can become \"router\".\n\n### SLAAC vs. DHCPv6\n\n| Feature | SLAAC | DHCPv6 |\n|---------|-------|--------|\n| **Address config** | From RA prefix | From DHCPv6 server |\n| **DNS config** | From RA (RDNSS option) | From DHCPv6 |\n| **Default gateway** | From RA | N/A (uses RA for gateway) |\n| **Authentication** | None | Optional (rarely used) |\n| **Deployment** | Automatic | Requires server setup |\n| **Attack surface** | Rogue RA | Rogue DHCPv6 server |\n\n**Reality**: Most networks use **SLAAC** (easier to deploy), making them vulnerable to RA attacks.\n\n---\n\n## Dual-Stack Networks\n\n### What is Dual-Stack?\n\n**Dual-stack** = IPv4 and IPv6 running simultaneously.\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚         Dual-Stack Host                     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                             â”‚\nâ”‚  IPv4 Stack:                                â”‚\nâ”‚    Address: 192.168.1.100                   â”‚\nâ”‚    Gateway: 192.168.1.1                     â”‚\nâ”‚    DNS: 8.8.8.8                             â”‚\nâ”‚                                             â”‚\nâ”‚  IPv6 Stack:                                â”‚\nâ”‚    Address: 2001:db8::100                   â”‚\nâ”‚    Gateway: fe80::1                         â”‚\nâ”‚    DNS: 2001:4860:4860::8888                â”‚\nâ”‚                                             â”‚\nâ”‚  Application Layer:                         â”‚\nâ”‚    Prefers IPv6 if available (RFC 6724)     â”‚\nâ”‚    Falls back to IPv4 if IPv6 fails         â”‚\nâ”‚                                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Default behavior** (most OSes):\n1. Try IPv6 first\n2. If IPv6 fails, use IPv4\n\n### Security Implications of Dual-Stack\n\n**Problem 1: Security controls only monitor IPv4**\n\n```\nFirewall rules:\n  IPv4: Block port 445 (SMB) âœ…\n  IPv6: No rules configured âŒ (wide open)\n\nAttacker:\n  Connects to [2001:db8::10]:445 via IPv6\n  Bypasses firewall entirely\n```\n\n**Problem 2: DNS can return IPv6 addresses**\n\n```bash\n# Attacker controls DNS\n# Returns IPv6 address for victim.com\n\n$ dig victim.com AAAA\nvictim.com.  IN  AAAA  2001:db8::evil\n\n# Victim connects to attacker's IPv6 address\n# Bypasses IPv4-only monitoring\n```\n\n**Problem 3: IPv6 tunneling over IPv4**\n\n```\nIPv4 packet:\n  [IPv4 header][IPv6 packet][Malicious payload]\n\nFirewall inspects IPv4 header: \"Looks fine!\"\nFirewall doesn't inspect encapsulated IPv6: \"Blind spot!\"\n\nResult: Malicious IPv6 traffic tunnels through IPv4-only firewall\n```\n\n---\n\n## IPv6 Extension Headers\n\n### Extension Header Chain\n\nIPv6 uses **extension headers** for optional features:\n\n```\n[IPv6 Header] â†’ [Extension Header 1] â†’ [Extension Header 2] â†’ [Payload]\n     40 bytes      Variable size          Variable size\n```\n\n**Common extension headers**:\n\n1. **Hop-by-Hop Options** (Type 0)\n   - Processed by every router\n   - Example: Router Alert, Jumbo Payload\n\n2. **Destination Options** (Type 60)\n   - Processed only by destination\n   - Example: Home Address option (Mobile IPv6)\n\n3. **Routing** (Type 43)\n   - Source routing (deprecated Type 0, now Type 2/3)\n   - **Attack**: Type 0 allowed DDoS amplification (now disabled)\n\n4. **Fragment** (Type 44)\n   - Used when packet exceeds MTU\n   - **Attack surface**: Fragmentation overlap attacks\n\n5. **Authentication Header (AH)** (Type 51)\n   - IPsec authentication\n   - Rarely used (ESP more common)\n\n6. **Encapsulating Security Payload (ESP)** (Type 50)\n   - IPsec encryption\n   - Hides payload from inspection\n\n### Security Issues with Extension Headers\n\n**Problem 1: Firewall/IDS bypass**\n\nMany devices don't properly inspect extension headers:\n\n```\n[IPv6 Header][Fragment Header][Malicious Payload]\n\nFirewall rule: \"Block TCP port 22\"\nFirewall sees: First fragment (no TCP header visible)\nFirewall allows: \"It's just a fragment, pass it through\"\n\nDestination reassembles: Full SSH packet (port 22)\nResult: Firewall bypassed\n```\n\n**Problem 2: Denial of Service**\n\n```\n[IPv6 Header][Hop-by-Hop Options: 1KB][Hop-by-Hop Options: 1KB][...][Payload]\n\nRouter: Must process ALL Hop-by-Hop options\nRouter CPU: 100% (processing huge header chain)\nResult: DoS on router\n```\n\n**Problem 3: Overlapping fragments**\n\n```\nFragment 1: Bytes 0-1000 (contains: \"GET / HTTP/1.1\")\nFragment 2: Bytes 500-1500 (contains: \"GET /admin HTTP/1.1\")\n\nNaive reassembly: Overlaps byte 500-1000\n  Option A: Use Fragment 1 (firewall sees \"/\")\n  Option B: Use Fragment 2 (application sees \"/admin\")\n\nFirewall: \"Sees request to / (allowed)\"\nApplication: \"Receives request to /admin (bypassed auth!)\"\n```\n\n---\n\n## IPv6 Tunneling Mechanisms\n\n### Why Tunneling Exists\n\n**Problem**: IPv6 internet not fully deployed. Many ISPs only support IPv4.\n\n**Solution**: Tunnel IPv6 through IPv4 networks.\n\n### Common Tunneling Protocols\n\n**1. 6to4** (RFC 3056)\n\n```\nAutomatically tunnels IPv6 over IPv4 using:\n  2002:<IPv4 address in hex>::/48\n\nExample:\n  IPv4: 192.0.2.1\n  IPv6: 2002:c000:0201::1\n\nAttacker can: Set up rogue 6to4 relay, intercept traffic\n```\n\n**2. Teredo** (RFC 4380)\n\n```\nTunnels IPv6 over IPv4 UDP (port 3544)\nWorks behind NAT\nPrefix: 2001:0000::/32\n\nSecurity risk: Bypasses NAT firewall (creates inbound path)\nWindows: Teredo enabled by default (easy backdoor)\n```\n\n**3. ISATAP** (RFC 5214)\n\n```\nIntra-Site Automatic Tunnel Addressing Protocol\nFor connecting IPv6 hosts over IPv4 infrastructure\n\nAttacker can: Become rogue ISATAP router\n```\n\n### Attack Scenario: Teredo as a Backdoor\n\n```\nCorporate network:\n  Firewall: Blocks inbound connections (IPv4)\n  Employee PC: Windows with Teredo enabled\n\nAttacker:\n  1. Sets up Teredo server on internet\n  2. Employee PC connects to Teredo server (outbound UDP - allowed)\n  3. Attacker gets IPv6 access to employee PC\n  4. Firewall doesn't inspect Teredo traffic (UDP port 3544)\n  5. Attacker has backdoor into corporate network\n```\n\n**Mitigation**: Disable unused tunneling protocols.\n\n---\n\n## Key IPv6 Attack Vectors Summary\n\n| Attack Vector | Technique | Impact |\n|---------------|-----------|--------|\n| **Rogue RA** | Send fake Router Advertisements | MITM, DoS, malicious DNS |\n| **NDP spoofing** | Spoof Neighbor Advertisements | MITM, traffic interception |\n| **IPv6 fragmentation** | Overlapping fragments | IDS/firewall evasion |\n| **Extension header abuse** | Long header chains | DoS, evasion |\n| **Dual-stack exploitation** | Attack IPv6, bypass IPv4 controls | Firewall bypass |\n| **Teredo/6to4 tunneling** | Rogue tunnel endpoints | Backdoor, C2 channel |\n| **SLAAC exhaustion** | Send RAs with many prefixes | DoS (fill routing table) |\n\nNext: Hands-on attack demonstrations!"
      }
    }
  ],
  "tags": ["Course: SANS-SEC660", "Career Path: Pentester"]
}

