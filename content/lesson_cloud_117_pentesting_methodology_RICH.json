{
  "lesson_id": "c1a2b3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d",
  "domain": "cloud",
  "title": "Cloud Penetration Testing Methodology",
  "difficulty": 3,
  "order_index": 117,
  "prerequisites": [],
  "concepts": [
    "Cloud penetration testing methodology",
    "Cloud security assessment scoping",
    "Cloud architecture analysis",
    "Attack surface mapping in cloud environments",
    "Multi-cloud security testing",
    "Cloud-specific threat modeling"
  ],
  "estimated_time": 60,
  "learning_objectives": [
    "Understand the unique challenges and considerations in cloud penetration testing",
    "Master the process of scoping cloud security assessments across AWS, Azure, and GCP",
    "Analyze cloud architectures to identify security weaknesses and attack paths",
    "Map attack surfaces in cloud environments including APIs, identities, and services",
    "Apply threat modeling techniques specific to cloud infrastructure",
    "Plan and execute comprehensive cloud penetration tests following industry standards"
  ],
  "post_assessment": [
    {
      "question_id": "cpt-001",
      "question": "What is the primary difference between traditional penetration testing and cloud penetration testing?",
      "options": [
        "Cloud testing requires no permissions from the provider",
        "Cloud testing focuses heavily on identity, APIs, and service configurations rather than just network perimeter",
        "Cloud testing is easier because everything is automated",
        "Cloud testing doesn't require scoping documents"
      ],
      "correct_answer": 1,
      "explanation": "Cloud penetration testing fundamentally differs from traditional testing because the attack surface shifts from network perimeters to identities (IAM), APIs, service misconfigurations, and multi-tenant security. Traditional network-based attacks are often less relevant in cloud environments where identity IS the perimeter.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "cpt-002",
      "question": "Which of the following is a critical scoping consideration unique to cloud penetration testing?",
      "options": [
        "Identifying physical server locations",
        "Understanding the shared responsibility model and provider limitations",
        "Testing network firewall rules",
        "Scanning all IP addresses in the datacenter"
      ],
      "correct_answer": 1,
      "explanation": "The shared responsibility model is crucial in cloud testing. Cloud providers (AWS, Azure, GCP) handle infrastructure security, while customers manage their configurations. Understanding what you CAN test (customer responsibility) versus what's off-limits (provider responsibility) is essential for proper scoping and avoiding policy violations.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "cpt-003",
      "question": "In AWS, which service policies should you review before starting a penetration test?",
      "options": [
        "AWS Customer Agreement only",
        "No policies needed - all testing is allowed",
        "AWS Penetration Testing policy and Terms of Service",
        "Only the specific service SLAs"
      ],
      "correct_answer": 2,
      "explanation": "AWS has specific Penetration Testing policies that define what activities are permitted without prior approval (EC2, RDS, etc.) and what requires explicit authorization (DDoS simulation, DNS zone walking). Violating these policies can result in account suspension. Always review the AWS Penetration Testing policy and Terms of Service before testing.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "cpt-004",
      "question": "What is the recommended approach for mapping attack surfaces in a multi-cloud environment?",
      "options": [
        "Focus only on the primary cloud provider",
        "Use the same tools and methodology for all cloud providers",
        "Create provider-specific asset inventories, identify inter-cloud dependencies, and map shared identity systems",
        "Skip attack surface mapping in cloud environments"
      ],
      "correct_answer": 2,
      "explanation": "Multi-cloud environments require a systematic approach: (1) Create separate asset inventories for each provider using their native tools (AWS Config, Azure Resource Graph, GCP Asset Inventory), (2) Identify inter-cloud dependencies and data flows, (3) Map shared identity systems (federated SSO, cross-cloud IAM), (4) Document shadow IT and unmanaged resources. Each provider has unique services and APIs requiring provider-specific enumeration techniques.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "cpt-005",
      "question": "During cloud threat modeling, which STRIDE component is most critical for cloud-native applications?",
      "options": [
        "Tampering with physical hardware",
        "Elevation of privilege through IAM misconfigurations",
        "Physical denial of service attacks",
        "Spoofing IP addresses"
      ],
      "correct_answer": 1,
      "explanation": "Elevation of privilege is the most critical STRIDE component in cloud environments because IAM misconfigurations are the leading cause of cloud breaches. Over-permissive roles, privilege escalation paths, and identity-based attacks (like AssumeRole chains in AWS) are far more common than traditional network-based attacks. Cloud security is fundamentally identity-centric.",
      "type": "multiple_choice",
      "difficulty": 3
    }
  ],
  "jim_kwik_principles": [
    "active_learning",
    "minimum_effective_dose",
    "teach_like_im_10",
    "memory_hooks",
    "connect_to_what_i_know",
    "multiple_memory_pathways"
  ],
  "content_blocks": [
    {
      "type": "mindset_coach",
      "content": {
        "text": "# Welcome to Cloud Penetration Testing! ğŸš€\n\nYou're about to master one of the most in-demand skills in cybersecurity. Cloud penetration testing isn't just traditional pentesting with new toolsâ€”it's a complete paradigm shift. In the cloud, **identity IS the new perimeter**. APIs are the new attack surface. Misconfigurations are the new vulnerabilities.\n\n**Why This Matters:**\n- 95% of Fortune 500 companies use multi-cloud environments\n- Cloud breaches cost an average of $4.45M per incident (IBM 2023)\n- Capital One (2019), Uber (2022), and Microsoft Exchange (2021) breaches all started with cloud misconfigurations\n- Cloud penetration testers earn $120k-$180k+ due to skill scarcity\n\n**What You'll Master:**\nBy the end of this lesson, you'll know how to scope, plan, and execute professional cloud penetration tests across AWS, Azure, and GCP. You'll think like an attacker targeting cloud infrastructure and know exactly where to look for security weaknesses.\n\n**Your Mindset:**\nCloud security is complex, but you already know penetration testing fundamentals. We're building on that foundationâ€”adapting your skills to the cloud's unique architecture. This is exciting, challenging, and incredibly valuable. Let's dive in!"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "# Cloud Penetration Testing Methodology: A Complete Guide\n\n## What Makes Cloud Penetration Testing Different?\n\n### The Paradigm Shift\n\nTraditional penetration testing focused on **network perimeters**:\n- Finding exposed services (Nmap scans)\n- Exploiting software vulnerabilities (buffer overflows, SQL injection)\n- Pivoting through internal networks\n- Cracking password hashes\n\nCloud penetration testing focuses on **identity, APIs, and configurations**:\n- Enumerating IAM permissions and roles\n- Exploiting service misconfigurations (S3 buckets, storage accounts)\n- Abusing API endpoints and authentication mechanisms\n- Escalating privileges through policy attachments\n- Attacking serverless functions and containers\n\n### The Cloud Attack Surface\n\nIn cloud environments, the attack surface consists of:\n\n**1. Identity Layer (IAM)**\n- User accounts, service accounts, roles\n- Permission policies and trust relationships\n- Federated identities and SSO integrations\n- API keys, access tokens, service principals\n\n**2. Management Plane**\n- Cloud provider consoles (AWS Console, Azure Portal, GCP Console)\n- Infrastructure-as-Code (Terraform, CloudFormation)\n- CI/CD pipelines (GitHub Actions, Azure DevOps, GitLab)\n- Management APIs (AWS API, Azure ARM, GCP APIs)\n\n**3. Data Plane**\n- Storage services (S3, Blob Storage, Cloud Storage)\n- Databases (RDS, CosmosDB, Cloud SQL)\n- Compute resources (EC2, VMs, Compute Engine)\n- Serverless functions (Lambda, Functions, Cloud Functions)\n\n**4. Network Layer**\n- Virtual networks (VPC, VNet, VPC)\n- Security groups and network ACLs\n- Load balancers and API gateways\n- VPN and private connectivity (Direct Connect, ExpressRoute, Interconnect)\n\n### The Shared Responsibility Model\n\nUnderstanding the **shared responsibility model** is critical for scoping:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           CLOUD PROVIDER RESPONSIBILITY                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Physical Security, Hardware, Global Infrastructure     â”‚\nâ”‚  Hypervisor, Networking Infrastructure                  â”‚\nâ”‚  Managed Service Security (patches, updates)            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           CUSTOMER RESPONSIBILITY                       â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Identity & Access Management (IAM)                     â”‚\nâ”‚  Application Code and Dependencies                      â”‚\nâ”‚  Data Encryption (at rest and in transit)              â”‚\nâ”‚  Network Configuration (security groups, NACLs)         â”‚\nâ”‚  Operating System and Middleware (IaaS)                â”‚\nâ”‚  Service Configurations (S3 policies, database access)  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**You can ONLY test what's in the customer's responsibility zone.** Testing provider infrastructure without explicit permission can result in account suspension or legal action.\n\n## The Cloud Penetration Testing Methodology\n\n### Phase 1: Pre-Engagement and Scoping\n\n#### 1.1 Understanding the Environment\n\nStart by gathering intelligence:\n\n**Questions to Ask:**\n- Which cloud providers? (AWS, Azure, GCP, Oracle, IBM?)\n- Multi-cloud or single provider?\n- What services are in use? (compute, storage, databases, serverless, containers?)\n- Hybrid architecture? (on-premises connections?)\n- What's the testing goal? (compliance, security assessment, red team exercise?)\n- What's the scope boundary? (production, staging, specific accounts/subscriptions?)\n\n**Document the Cloud Footprint:**\n```\nExample Cloud Footprint:\nâ”œâ”€â”€ AWS (Primary Production)\nâ”‚   â”œâ”€â”€ us-east-1: Web application (EC2, RDS, S3)\nâ”‚   â”œâ”€â”€ us-west-2: Data analytics (Lambda, DynamoDB, S3)\nâ”‚   â””â”€â”€ eu-west-1: GDPR-compliant storage\nâ”œâ”€â”€ Azure (Secondary/Backup)\nâ”‚   â””â”€â”€ East US: Azure AD, backup storage\nâ””â”€â”€ GCP (Development/Testing)\n    â””â”€â”€ us-central1: CI/CD, container registry\n```\n\n#### 1.2 Reviewing Cloud Provider Policies\n\n**AWS Penetration Testing Policy:**\n- **Permitted Services (no approval needed)**: EC2, RDS, Aurora, CloudFront, API Gateway, Lambda, Lightsail, Elastic Beanstalk\n- **Prohibited Activities**: DDoS attacks, DNS zone walking on Route53, port flooding, protocol flooding\n- **Policy URL**: https://aws.amazon.com/security/penetration-testing/\n\n**Azure Penetration Testing Policy:**\n- Requires following Microsoft Cloud Unified Penetration Testing Rules of Engagement\n- Must not test multi-tenant services or affect other customers\n- No DDoS or resource exhaustion attacks\n- **Policy URL**: https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement\n\n**GCP Penetration Testing Policy:**\n- Generally permits testing without prior notification\n- Must comply with Acceptable Use Policy\n- Cannot test GCP infrastructure itself\n- **Policy URL**: https://cloud.google.com/terms/aup\n\n#### 1.3 Legal and Compliance Considerations\n\n**Authorization Requirements:**\n- Written authorization from the cloud resource owner\n- Clear scope definition (accounts, regions, services)\n- Testing window (date/time ranges)\n- Contact information for incident response\n- Data handling and confidentiality agreements\n\n**Compliance Frameworks:**\nConsider regulatory requirements:\n- **PCI DSS**: Requires quarterly penetration testing for payment environments\n- **HIPAA**: Security assessments for healthcare data\n- **SOC 2**: Annual penetration testing for trust services\n- **ISO 27001**: Regular security testing requirements\n\n#### 1.4 Defining Rules of Engagement\n\n**Create a Clear RoE Document:**\n```markdown\n# Cloud Penetration Test - Rules of Engagement\n\n## Scope\n- **In Scope**: AWS Account 123456789012, us-east-1 region, production VPC\n- **Out of Scope**: Partner integrations, third-party SaaS, on-prem connections\n\n## Testing Window\n- Dates: January 15-19, 2024\n- Hours: 9 AM - 5 PM EST (testing pauses outside window)\n\n## Authorized Activities\n- âœ… IAM enumeration and privilege escalation testing\n- âœ… S3 bucket security assessment\n- âœ… EC2 instance exploitation (non-destructive)\n- âœ… API security testing\n- âŒ DDoS or resource exhaustion\n- âŒ Social engineering of cloud provider support\n- âŒ Data exfiltration of PII/PHI\n\n## Contacts\n- Primary: John Smith (john@company.com, +1-555-0100)\n- Secondary: Jane Doe (jane@company.com, +1-555-0101)\n- Emergency: SOC Hotline (soc@company.com, +1-555-9999)\n\n## Credentials Provided\n- IAM user: pentest-user (limited read-only access for baseline)\n- VPN access: Yes (provided separately)\n```\n\n### Phase 2: Reconnaissance and Asset Discovery\n\n#### 2.1 External Reconnaissance\n\n**Before You Have Credentials:**\n\nUse open-source intelligence (OSINT) to map the external cloud footprint:\n\n**DNS Enumeration:**\n```bash\n# Find AWS S3 buckets\ndig company-prod.s3.amazonaws.com\ndig company-backups.s3.amazonaws.com\n\n# Find Azure storage accounts\ndig companydata.blob.core.windows.net\n\n# Find GCP buckets\ncurl https://www.googleapis.com/storage/v1/b/company-bucket\n```\n\n**Certificate Transparency Logs:**\n```bash\n# Find subdomains and cloud services\ncrt.sh/?q=%.company.com&output=json | jq -r '.[].name_value' | sort -u\n\n# Look for cloud-specific patterns:\n# *.cloudfront.net (AWS CloudFront)\n# *.azurewebsites.net (Azure App Service)\n# *.run.app (GCP Cloud Run)\n```\n\n**Cloud Service Fingerprinting:**\n```bash\n# Identify cloud provider from HTTP headers\ncurl -I https://api.company.com\n# Look for:\n# Server: cloudflare (CDN)\n# X-Azure-Ref: (Azure Front Door)\n# X-Amz-Cf-Id: (AWS CloudFront)\n# Via: 1.1 google (GCP Load Balancer)\n```\n\n**GitHub/GitLab Recon:**\n```bash\n# Search for leaked credentials and infrastructure code\ngh repo list company --limit 100\ngh repo clone company/infrastructure\n\n# Search for cloud credentials in commits\ntruffleHog --regex https://github.com/company/infrastructure\n\n# Look for Terraform state files (goldmine!)\nfind . -name \"terraform.tfstate\" -o -name \"*.tfstate.backup\"\n```\n\n#### 2.2 Authenticated Asset Discovery\n\n**Once You Have Credentials:**\n\n**AWS Asset Discovery:**\n```bash\n# Enumerate all EC2 instances across all regions\nfor region in $(aws ec2 describe-regions --query 'Regions[].RegionName' --output text); do\n  echo \"Region: $region\"\n  aws ec2 describe-instances --region $region --query 'Reservations[].Instances[].[InstanceId,InstanceType,State.Name,PublicIpAddress,PrivateIpAddress,Tags[?Key==`Name`].Value|[0]]' --output table\ndone\n\n# List all S3 buckets and check permissions\naws s3 ls\nfor bucket in $(aws s3 ls | awk '{print $3}'); do\n  echo \"Checking $bucket\"\n  aws s3api get-bucket-acl --bucket $bucket\n  aws s3api get-bucket-policy --bucket $bucket 2>/dev/null || echo \"No policy\"\ndone\n\n# Enumerate IAM users and roles\naws iam list-users --query 'Users[].[UserName,CreateDate,PasswordLastUsed]' --output table\naws iam list-roles --query 'Roles[].[RoleName,Arn]' --output table\n\n# Find Lambda functions\nfor region in us-east-1 us-west-2 eu-west-1; do\n  aws lambda list-functions --region $region --query 'Functions[].[FunctionName,Runtime,Role]' --output table\ndone\n```\n\n**Azure Asset Discovery:**\n```powershell\n# Login to Azure\naz login\n\n# List all subscriptions\naz account list --output table\n\n# Enumerate all resource groups\naz group list --output table\n\n# List all VMs\naz vm list --output table\n\n# List all storage accounts\naz storage account list --output table\n\n# Enumerate Azure AD users\naz ad user list --query '[].{Name:displayName,UPN:userPrincipalName,Type:userType}' --output table\n\n# Find Key Vaults (secrets storage)\naz keyvault list --output table\n\n# List all web apps\naz webapp list --output table\n```\n\n**GCP Asset Discovery:**\n```bash\n# Authenticate to GCP\ngcloud auth login\n\n# List all projects\ngcloud projects list\n\n# Set active project\ngcloud config set project PROJECT_ID\n\n# List all compute instances\ngcloud compute instances list --format=\"table(name,zone,machineType,status,networkInterfaces[0].accessConfigs[0].natIP:label=EXTERNAL_IP)\"\n\n# List all storage buckets\ngsutil ls\n\n# Check bucket permissions\nfor bucket in $(gsutil ls); do\n  echo \"Checking $bucket\"\n  gsutil iam get $bucket\ndone\n\n# List all Cloud Functions\ngcloud functions list\n\n# Enumerate IAM roles\ngcloud iam roles list --filter=\"stage:GA\" --format=\"table(name,title,description)\"\n```\n\n**Using Cloud-Native Tools:**\n\n**AWS Config for Asset Inventory:**\n```bash\n# Query AWS Config for all resources\naws configservice select-resource-config \\\n  --expression \"SELECT resourceType, resourceId, resourceName, tags WHERE resourceType = 'AWS::EC2::Instance'\"\n```\n\n**Azure Resource Graph:**\n```powershell\n# Query all resources across subscriptions\naz graph query -q \"Resources | where type =~ 'Microsoft.Compute/virtualMachines' | project name, location, resourceGroup\"\n```\n\n**GCP Asset Inventory:**\n```bash\n# Export full asset inventory\ngcloud asset search-all-resources --scope=projects/PROJECT_ID --asset-types='.*' --format=json > asset_inventory.json\n```\n\n### Phase 3: Cloud Architecture Analysis\n\n#### 3.1 Mapping the Architecture\n\nCreate a visual representation of the cloud environment:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                      AWS ARCHITECTURE                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                              â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚                   Internet                           â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                        â”‚                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚            CloudFront (CDN)                          â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                        â”‚                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚         Application Load Balancer (ALB)             â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                        â”‚                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚\nâ”‚  â”‚                â”‚         â”‚                 â”‚             â”‚\nâ”‚  â–¼                â–¼         â–¼                 â–¼             â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚\nâ”‚ â”‚ EC2-1  â”‚  â”‚ EC2-2  â”‚  â”‚ EC2-3  â”‚  â”‚Lambda  â”‚            â”‚\nâ”‚ â”‚WebApp  â”‚  â”‚WebApp  â”‚  â”‚API     â”‚  â”‚Process â”‚            â”‚\nâ”‚ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚\nâ”‚     â”‚           â”‚           â”‚           â”‚                  â”‚\nâ”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚\nâ”‚                 â”‚                                           â”‚\nâ”‚           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚\nâ”‚           â”‚    RDS     â”‚        â”‚    S3    â”‚              â”‚\nâ”‚           â”‚  (MySQL)   â”‚        â”‚ (Storage)â”‚              â”‚\nâ”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚\nâ”‚                                                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Key Questions to Answer:**\n1. What are the entry points? (Load balancers, API Gateway, CloudFront)\n2. Where is sensitive data stored? (RDS, S3, DynamoDB)\n3. How do services authenticate to each other? (IAM roles, service accounts)\n4. What are the trust boundaries? (VPCs, security groups, subnets)\n5. Where are the crown jewels? (customer data, credentials, PII)\n\n#### 3.2 Identifying Security Boundaries\n\n**Network Segmentation:**\n```bash\n# AWS VPC analysis\naws ec2 describe-vpcs --query 'Vpcs[].[VpcId,CidrBlock,Tags[?Key==`Name`].Value|[0]]' --output table\n\n# List subnets and their routing\naws ec2 describe-subnets --query 'Subnets[].[SubnetId,CidrBlock,AvailabilityZone,MapPublicIpOnLaunch,Tags[?Key==`Name`].Value|[0]]' --output table\n\n# Check security group rules (firewall rules)\naws ec2 describe-security-groups --query 'SecurityGroups[].[GroupId,GroupName,Description]' --output table\n```\n\n**Trust Relationships:**\n```bash\n# AWS IAM role trust policies\naws iam list-roles | jq -r '.Roles[].RoleName' | while read role; do\n  echo \"Role: $role\"\n  aws iam get-role --role-name $role | jq '.Role.AssumeRolePolicyDocument'\ndone\n```\n\n### Phase 4: Threat Modeling for Cloud\n\n#### 4.1 STRIDE Threat Modeling\n\nApply **STRIDE** to cloud environments:\n\n**S - Spoofing Identity**\n- Stolen IAM credentials (access keys, session tokens)\n- Compromised service accounts\n- Assumed role abuse\n\n**T - Tampering**\n- Modifying S3 bucket policies\n- Changing security group rules\n- Injecting malicious code into Lambda functions\n\n**R - Repudiation**\n- Disabled CloudTrail logging\n- Log tampering or deletion\n- Missing audit trails\n\n**I - Information Disclosure**\n- Public S3 buckets\n- Overly permissive IAM policies\n- Exposed secrets in environment variables\n\n**D - Denial of Service**\n- Resource exhaustion (Lambda concurrency limits)\n- API throttling abuse\n- Cost-based DoS (cryptomining)\n\n**E - Elevation of Privilege**\n- IAM privilege escalation (PassRole, CreatePolicyVersion)\n- Container escape to host\n- Lateral movement across accounts\n\n#### 4.2 Cloud-Specific Attack Trees\n\n**Example: AWS Account Compromise Attack Tree**\n```\nGoal: Gain Admin Access to AWS Account\nâ”œâ”€â”€ Path 1: Credential Theft\nâ”‚   â”œâ”€â”€ Find exposed AWS keys in GitHub\nâ”‚   â”œâ”€â”€ Phish developer for credentials\nâ”‚   â””â”€â”€ Extract keys from compromised EC2 instance\nâ”œâ”€â”€ Path 2: IAM Privilege Escalation\nâ”‚   â”œâ”€â”€ Exploit iam:PassRole to assume admin role\nâ”‚   â”œâ”€â”€ Attach AdministratorAccess policy\nâ”‚   â””â”€â”€ Create new admin user\nâ”œâ”€â”€ Path 3: Service Exploitation\nâ”‚   â”œâ”€â”€ Exploit vulnerable Lambda function\nâ”‚   â”œâ”€â”€ Abuse SSRF in EC2 to access metadata service\nâ”‚   â””â”€â”€ Steal temporary credentials from IMDSv1\nâ””â”€â”€ Path 4: Supply Chain\n    â”œâ”€â”€ Compromise CI/CD pipeline\n    â”œâ”€â”€ Inject backdoor into CloudFormation template\n    â””â”€â”€ Gain access during deployment\n```\n\n### Phase 5: Attack Surface Mapping\n\n#### 5.1 Identity Attack Surface\n\n**IAM Users and Roles:**\n```bash\n# Find users with console access\naws iam get-login-profile --user-name <username> 2>/dev/null && echo \"Has console access\"\n\n# Find users with access keys\naws iam list-access-keys --user-name <username>\n\n# Enumerate inline and managed policies\naws iam list-user-policies --user-name <username>\naws iam list-attached-user-policies --user-name <username>\n```\n\n**High-Risk Permissions to Look For:**\n- `iam:*` (full IAM control)\n- `iam:PassRole` (role assumption)\n- `iam:CreatePolicyVersion` (policy modification)\n- `sts:AssumeRole` (cross-account access)\n- `lambda:CreateFunction` + `iam:PassRole` (code execution)\n- `ec2:RunInstances` + `iam:PassRole` (persistence)\n\n#### 5.2 Data Attack Surface\n\n**Storage Services:**\n```bash\n# Check S3 bucket public access\naws s3api get-bucket-acl --bucket <bucket-name>\naws s3api get-public-access-block --bucket <bucket-name>\n\n# Check for unencrypted S3 buckets\naws s3api get-bucket-encryption --bucket <bucket-name>\n\n# Check RDS snapshot permissions\naws rds describe-db-snapshots --query 'DBSnapshots[].[DBSnapshotIdentifier,Encrypted]' --output table\n```\n\n#### 5.3 Compute Attack Surface\n\n**EC2 Instances:**\n```bash\n# Find instances with public IPs\naws ec2 describe-instances --query 'Reservations[].Instances[?PublicIpAddress!=`null`].[InstanceId,PublicIpAddress,KeyName]' --output table\n\n# Check for IMDSv1 (vulnerable metadata service)\naws ec2 describe-instances --query 'Reservations[].Instances[].[InstanceId,MetadataOptions.HttpTokens]' --output table\n```\n\n**Serverless Functions:**\n```bash\n# List Lambda functions with public URLs\naws lambda list-function-url-configs --function-name <function-name>\n\n# Check Lambda environment variables (secrets?)\naws lambda get-function --function-name <function-name> | jq '.Configuration.Environment.Variables'\n```\n\n### Phase 6: Planning the Test Execution\n\n#### 6.1 Test Case Development\n\n**Organize by Risk Level:**\n\n**Critical Priority Tests:**\n1. IAM privilege escalation paths\n2. Public S3 bucket enumeration\n3. Overly permissive security groups (0.0.0.0/0)\n4. Exposed secrets in code repositories\n5. Unpatched vulnerable services\n\n**High Priority Tests:**\n6. Lambda function code injection\n7. Container escape scenarios\n8. API authentication bypass\n9. Cross-account access abuse\n10. CloudTrail logging gaps\n\n**Medium Priority Tests:**\n11. Encryption at rest verification\n12. Backup security testing\n13. Network segmentation validation\n14. Service quota abuse\n\n#### 6.2 Tool Selection\n\n**AWS-Specific Tools:**\n- **ScoutSuite**: Multi-cloud security auditing\n- **Prowler**: AWS security best practices assessment\n- **CloudMapper**: Visualize AWS environments\n- **Pacu**: AWS exploitation framework\n- **aws-vault**: Secure credential management\n\n**Azure-Specific Tools:**\n- **ScoutSuite**: Azure support included\n- **PowerZure**: Azure exploitation framework\n- **MicroBurst**: Azure security assessment tools\n- **ROADtools**: Azure AD security assessment\n\n**GCP-Specific Tools:**\n- **ScoutSuite**: GCP support included\n- **GCPBucketBrute**: GCS bucket enumeration\n- **gcp-iam-privilege-escalation**: GCP privilege escalation scanner\n\n**Multi-Cloud Tools:**\n- **CloudSploit**: Multi-cloud security scanning\n- **TruffleHog**: Secret detection in repositories\n- **GitLeaks**: Git credential scanning\n- **Terraform compliance**: IaC security validation\n\n### Phase 7: Documentation and Reporting\n\n#### 7.1 What to Document\n\n**During Testing:**\n- Timestamp all activities\n- Screenshot every finding\n- Save command outputs\n- Note all credentials used\n- Record API calls made\n\n**In the Final Report:**\n1. **Executive Summary**: Business risk, key findings\n2. **Methodology**: What was tested and how\n3. **Findings**: Vulnerabilities with evidence\n4. **Attack Scenarios**: Realistic attack chains\n5. **Recommendations**: Prioritized remediation steps\n6. **Appendices**: Raw data, screenshots, logs\n\n#### 7.2 Cloud-Specific Metrics\n\n**Key Risk Indicators:**\n- Number of overly permissive IAM policies\n- Public exposure count (S3 buckets, RDS snapshots, AMIs)\n- Unencrypted resources count\n- Logging gaps (CloudTrail disabled regions)\n- High-risk privilege escalation paths\n- Vulnerable service versions\n- Shadow IT discoveries\n\n## Real-World Cloud Pentesting: Lessons from Breaches\n\n### Capital One Breach (2019)\n\n**What Happened:**\n- Attacker exploited SSRF vulnerability in web application firewall (WAF)\n- Used SSRF to access EC2 metadata service (IMDSv1)\n- Extracted IAM role credentials from metadata\n- Used credentials to list and exfiltrate S3 buckets\n- **Result**: 100 million customer records stolen\n\n**Penetration Testing Lesson:**\nAlways test for SSRF vulnerabilities in cloud applications. The EC2 metadata service at `http://169.254.169.254/latest/meta-data/` is a goldmine for attackers. Look for:\n```bash\n# Test for SSRF to metadata service\ncurl http://target.com/proxy?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/\n\n# If successful, extract role credentials\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/<role-name>\n```\n\n**Mitigation Tested:**\n- Is IMDSv2 enforced? (requires token)\n- Are egress rules blocking metadata access?\n- Is SSRF input validation implemented?\n\n### Uber Breach (2022)\n\n**What Happened:**\n- Attacker phished contractor credentials\n- Accessed company VPN\n- Found PowerShell script with hardcoded Thycotic PAM admin password\n- Used PAM access to find AWS/GCP credentials\n- **Result**: Full internal network compromise\n\n**Penetration Testing Lesson:**\nTest for hardcoded credentials in:\n```bash\n# Search GitHub for credentials\ntruffleHog --regex https://github.com/company/repo\n\n# Search code repositories\ngrep -r \"AKIA\" .  # AWS access key pattern\ngrep -r \"password.*=\" .\ngrep -r \"api_key\" .\n```\n\n**Mitigation Tested:**\n- Are secrets stored in vaults (AWS Secrets Manager, Azure Key Vault)?\n- Is code scanning enabled in CI/CD?\n- Are leaked credentials automatically rotated?\n\n## Summary: Your Cloud Pentesting Checklist\n\n**Pre-Engagement (Phase 1)**\n- â˜ Understand cloud provider policies\n- â˜ Get written authorization\n- â˜ Define clear scope and RoE\n- â˜ Identify compliance requirements\n\n**Reconnaissance (Phase 2)**\n- â˜ External OSINT (DNS, certs, GitHub)\n- â˜ Authenticated asset discovery\n- â˜ Enumerate IAM users/roles\n- â˜ Map storage and compute resources\n\n**Architecture Analysis (Phase 3)**\n- â˜ Document cloud architecture\n- â˜ Identify trust boundaries\n- â˜ Map data flows\n- â˜ Find crown jewels\n\n**Threat Modeling (Phase 4)**\n- â˜ Apply STRIDE framework\n- â˜ Build attack trees\n- â˜ Identify privilege escalation paths\n- â˜ Document high-risk scenarios\n\n**Attack Surface Mapping (Phase 5)**\n- â˜ Enumerate identity attack surface\n- â˜ Test data exposure (S3, RDS, etc.)\n- â˜ Assess compute security\n- â˜ Review API endpoints\n\n**Execution Planning (Phase 6)**\n- â˜ Prioritize test cases by risk\n- â˜ Select appropriate tools\n- â˜ Prepare exploitation scripts\n- â˜ Plan testing schedule\n\n**Documentation (Phase 7)**\n- â˜ Log all activities with timestamps\n- â˜ Screenshot findings\n- â˜ Create detailed report\n- â˜ Provide remediation roadmap\n\nYou now have a comprehensive methodology for cloud penetration testing. This isn't just theoryâ€”this is the exact process used by professional cloud security teams at top consulting firms and enterprises."
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "# Hands-On Exercise: Cloud Penetration Testing Scoping\n\n## Exercise 1: AWS Asset Discovery Script\n\nCreate a comprehensive AWS asset discovery script that you can use at the start of any AWS penetration test.\n\n**Script: `aws_asset_discovery.sh`**\n\n```bash\n#!/bin/bash\n# AWS Asset Discovery Script for Penetration Testing\n# Usage: ./aws_asset_discovery.sh > asset_report.txt\n\necho \"======================================\"\necho \"AWS ASSET DISCOVERY REPORT\"\necho \"Date: $(date)\"\necho \"======================================\"\necho \"\"\n\n# Check AWS CLI is installed and configured\nif ! command -v aws &> /dev/null; then\n    echo \"ERROR: AWS CLI not installed\"\n    exit 1\nfi\n\n# Get current identity\necho \"[+] Current AWS Identity:\"\naws sts get-caller-identity --output table\necho \"\"\n\n# List all regions\necho \"[+] Checking all AWS regions...\"\nREGIONS=$(aws ec2 describe-regions --query 'Regions[].RegionName' --output text)\necho \"Found regions: $REGIONS\"\necho \"\"\n\n# EC2 Instances\necho \"[+] EC2 Instances:\"\nfor region in $REGIONS; do\n    echo \"  Checking region: $region\"\n    aws ec2 describe-instances --region $region \\\n        --query 'Reservations[].Instances[].[InstanceId,InstanceType,State.Name,PublicIpAddress,PrivateIpAddress,Tags[?Key==`Name`].Value|[0]]' \\\n        --output table 2>/dev/null | grep -v \"None\"\ndone\necho \"\"\n\n# S3 Buckets\necho \"[+] S3 Buckets:\"\naws s3 ls\necho \"\"\n\necho \"[+] Checking S3 bucket permissions:\"\nfor bucket in $(aws s3 ls | awk '{print $3}'); do\n    echo \"  Bucket: $bucket\"\n    \n    # Check if bucket is public\n    PUBLIC_ACCESS=$(aws s3api get-public-access-block --bucket $bucket 2>/dev/null)\n    if [ $? -eq 0 ]; then\n        echo \"    Public Access Config: $PUBLIC_ACCESS\"\n    else\n        echo \"    WARNING: No public access block configured!\"\n    fi\n    \n    # Check encryption\n    ENCRYPTION=$(aws s3api get-bucket-encryption --bucket $bucket 2>/dev/null)\n    if [ $? -eq 0 ]; then\n        echo \"    Encryption: Enabled\"\n    else\n        echo \"    WARNING: Encryption not configured!\"\n    fi\n    echo \"\"\ndone\n\n# IAM Users\necho \"[+] IAM Users:\"\naws iam list-users --query 'Users[].[UserName,CreateDate,PasswordLastUsed]' --output table\necho \"\"\n\n# IAM Roles\necho \"[+] IAM Roles (first 20):\"\naws iam list-roles --max-items 20 --query 'Roles[].[RoleName,Arn]' --output table\necho \"\"\n\n# Lambda Functions\necho \"[+] Lambda Functions:\"\nfor region in us-east-1 us-west-2 eu-west-1; do\n    echo \"  Region: $region\"\n    aws lambda list-functions --region $region \\\n        --query 'Functions[].[FunctionName,Runtime,LastModified]' \\\n        --output table 2>/dev/null\ndone\necho \"\"\n\n# RDS Instances\necho \"[+] RDS Databases:\"\nfor region in $REGIONS; do\n    RDS=$(aws rds describe-db-instances --region $region \\\n        --query 'DBInstances[].[DBInstanceIdentifier,Engine,EngineVersion,PubliclyAccessible]' \\\n        --output table 2>/dev/null)\n    if [ ! -z \"$RDS\" ]; then\n        echo \"  Region: $region\"\n        echo \"$RDS\"\n    fi\ndone\necho \"\"\n\n# Security Groups with 0.0.0.0/0\necho \"[+] Security Groups with Public Access (0.0.0.0/0):\"\nfor region in $REGIONS; do\n    echo \"  Checking region: $region\"\n    aws ec2 describe-security-groups --region $region \\\n        --query 'SecurityGroups[?IpPermissions[?IpRanges[?CidrIp==`0.0.0.0/0`]]].[GroupId,GroupName,Description]' \\\n        --output table 2>/dev/null | grep -v \"None\"\ndone\necho \"\"\n\n# CloudTrail Status\necho \"[+] CloudTrail Logging Status:\"\nfor region in $REGIONS; do\n    TRAILS=$(aws cloudtrail describe-trails --region $region --query 'trailList[].[Name,IsMultiRegionTrail,IsLogging]' --output text 2>/dev/null)\n    if [ ! -z \"$TRAILS\" ]; then\n        echo \"  Region: $region\"\n        echo \"$TRAILS\"\n    fi\ndone\necho \"\"\n\necho \"======================================\"\necho \"Asset discovery complete!\"\necho \"======================================\"\n```\n\n**Run the script:**\n```bash\nchmod +x aws_asset_discovery.sh\n./aws_asset_discovery.sh > aws_assets_$(date +%Y%m%d).txt\n```\n\n## Exercise 2: Analyze a Cloud Architecture\n\nYou're given this AWS architecture description. Identify potential security issues and attack paths.\n\n**Scenario:**\n```\nCompany XYZ has the following AWS setup:\n- Public-facing web app on EC2 behind ALB\n- Application uses IAM role with S3 full access\n- S3 bucket stores customer PII\n- RDS MySQL database (publicly accessible for \"developer convenience\")\n- Lambda function processes uploaded files from S3\n- CloudTrail logging enabled only in us-east-1\n- Developers have AdministratorAccess IAM policy\n- IMDSv1 enabled on all EC2 instances\n```\n\n**Your Task:**\n\n1. **List at least 5 security issues:**\n   - Issue 1: _______________\n   - Issue 2: _______________\n   - Issue 3: _______________\n   - Issue 4: _______________\n   - Issue 5: _______________\n\n2. **Describe an attack path from web app compromise to full AWS account takeover:**\n   ```\n   Step 1: _______________\n   Step 2: _______________\n   Step 3: _______________\n   Step 4: _______________\n   ```\n\n3. **Recommend the top 3 remediations:**\n   - Remediation 1: _______________\n   - Remediation 2: _______________\n   - Remediation 3: _______________\n\n**Answer Key:**\n\n<details>\n<summary>Click to reveal answers</summary>\n\n**Security Issues:**\n1. Overly permissive IAM (AdministratorAccess for developers)\n2. Publicly accessible RDS database (direct internet access)\n3. EC2 role has S3 full access (violates least privilege)\n4. IMDSv1 vulnerable to SSRF attacks\n5. CloudTrail only in one region (blind spots in other regions)\n6. Lambda processes untrusted S3 uploads (potential code injection)\n\n**Attack Path:**\n1. Exploit SSRF in web app â†’ access IMDSv1 metadata service\n2. Extract EC2 IAM role credentials with S3 full access\n3. Enumerate S3 buckets and exfiltrate customer PII\n4. Use S3 access to upload malicious file â†’ trigger Lambda\n5. Lambda executes attacker code with its IAM role\n6. If Lambda role has elevated permissions â†’ further escalation\n7. Create backdoor IAM user in us-west-2 (no CloudTrail logging)\n\n**Top Remediations:**\n1. **Enforce IMDSv2** on all EC2 instances (blocks SSRF attacks)\n2. **Implement least privilege IAM**: Replace AdministratorAccess with specific permissions\n3. **Disable public RDS access**: Use private subnets + VPN/bastion host\n</details>\n\n## Exercise 3: Cloud Provider Policy Review\n\n**Task:** Review the AWS, Azure, and GCP penetration testing policies and answer:\n\n1. Can you perform DDoS testing against AWS without approval?\n   - Answer: _______________\n\n2. Which AWS services can you test without prior authorization?\n   - Answer: _______________\n\n3. What must you do before testing Azure resources?\n   - Answer: _______________\n\n4. Can you test multi-tenant GCP services?\n   - Answer: _______________\n\n**Answers:**\n1. **No** - DDoS testing is explicitly prohibited in AWS policy\n2. EC2, RDS, Aurora, CloudFront, API Gateway, Lambda, Lightsail, Elastic Beanstalk\n3. Follow Microsoft Cloud Unified Penetration Testing Rules of Engagement, ensure testing doesn't affect other tenants\n4. **No** - Testing must not impact other customers\n\n## Exercise 4: Build a Cloud Threat Model\n\n**Scenario:** You're testing a serverless application:\n- API Gateway â†’ Lambda (Node.js) â†’ DynamoDB\n- Lambda has environment variables with database connection string\n- API Gateway has no authentication\n- Lambda role has DynamoDB full access\n\n**Task:** Create a STRIDE threat model\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ STRIDE Threat Model - Serverless App           â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ S - Spoofing:                                   â”‚\nâ”‚   - [Your answer]                               â”‚\nâ”‚                                                  â”‚\nâ”‚ T - Tampering:                                  â”‚\nâ”‚   - [Your answer]                               â”‚\nâ”‚                                                  â”‚\nâ”‚ R - Repudiation:                                â”‚\nâ”‚   - [Your answer]                               â”‚\nâ”‚                                                  â”‚\nâ”‚ I - Information Disclosure:                     â”‚\nâ”‚   - [Your answer]                               â”‚\nâ”‚                                                  â”‚\nâ”‚ D - Denial of Service:                          â”‚\nâ”‚   - [Your answer]                               â”‚\nâ”‚                                                  â”‚\nâ”‚ E - Elevation of Privilege:                     â”‚\nâ”‚   - [Your answer]                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n**Sample Answers:**\n- **S**: No authentication = anyone can invoke API\n- **T**: Attacker could inject malicious payloads to modify DynamoDB data\n- **R**: No logging = attackers can't be traced\n- **I**: Environment variables expose sensitive connection strings\n- **D**: No rate limiting = unbounded Lambda invocations (cost DoS)\n- **E**: Lambda role has DynamoDB full access = over-permissioned\n\n## Challenge Exercise: Real-World Scenario\n\nYou've been hired to test a fintech company's AWS environment. During initial reconnaissance, you discovered:\n\n```bash\n# Public S3 bucket found\naws s3 ls s3://fintech-backups --no-sign-request\n# Returns: database_backup_2024-01-15.sql (accessible!)\n```\n\n**Questions:**\n\n1. What would you do next?\n2. What other security issues would you look for?\n3. How would you document this finding?\n4. What's the business risk?\n5. What remediation would you recommend?\n\n**Your Response:**\n\n[Write your incident response plan here]\n\nThis completes the hands-on exercises. Practice these scenarios to build muscle memory for cloud penetration testing!"
      }
    },
    {
      "type": "real_world",
      "content": {
        "text": "# Real-World Cloud Penetration Testing: Case Studies and Lessons\n\n## Case Study 1: Capital One Breach (2019) - The SSRF That Cost $200M\n\n### The Attack Timeline\n\n**March 2019**: Attacker Paige Thompson begins reconnaissance\n- Identifies Capital One using AWS infrastructure\n- Discovers web application firewall (WAF) service\n- Tests for common web vulnerabilities\n\n**March 22-23, 2019**: Initial exploitation\n- Discovers SSRF vulnerability in misconfigured WAF\n- Crafts request to access EC2 metadata service:\n  ```bash\n  POST /api/config HTTP/1.1\n  Host: waf.capitalone.com\n  \n  {\"url\": \"http://169.254.169.254/latest/meta-data/iam/security-credentials/\"}\n  ```\n- WAF returns list of available IAM roles\n- Accesses role credentials:\n  ```bash\n  curl http://169.254.169.254/latest/meta-data/iam/security-credentials/waf-role\n  ```\n- Extracts temporary AWS credentials (AccessKeyId, SecretAccessKey, SessionToken)\n\n**March-April 2019**: Data exfiltration\n- Uses stolen IAM credentials to enumerate S3 buckets\n- Discovers 700+ S3 buckets with sensitive data\n- Executes systematic data theft:\n  ```bash\n  aws s3 ls --profile stolen_creds\n  aws s3 cp s3://capital-one-customer-data/ . --recursive\n  ```\n- Downloads over 100 million customer records\n- Exfiltrates data to personal servers\n\n**July 2019**: Discovery and arrest\n- Capital One receives tip about exposed data\n- FBI traces leaked data to Thompson's servers\n- Thompson arrested and charged\n\n### What a Penetration Tester Would Have Found\n\n**Test #1: SSRF Vulnerability Scanning**\n```bash\n# Test for SSRF to metadata service\ncurl -X POST https://waf.capitalone.com/api/config \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"url\": \"http://169.254.169.254/latest/meta-data/\"}'\n\n# If vulnerable, you'd see metadata response\n# Expected secure response: Error or filtered request\n```\n\n**Test #2: IMDSv1 vs IMDSv2**\n```bash\n# Check if IMDSv2 is enforced\naws ec2 describe-instances --query 'Reservations[].Instances[].[InstanceId,MetadataOptions.HttpTokens]'\n\n# Should return: \"required\" (IMDSv2)\n# Vulnerable if: \"optional\" (IMDSv1 allowed)\n```\n\n**Test #3: IAM Role Permission Review**\n```bash\n# Check what the WAF role can access\naws iam get-role --role-name waf-role\naws iam list-attached-role-policies --role-name waf-role\n\n# Red flag: S3 full access or overly broad permissions\n```\n\n### The $200 Million Lesson\n\n**Impact:**\n- 100 million customers affected (credit card applications)\n- $80M settlement with regulators\n- $150M+ in remediation and legal costs\n- Massive reputational damage\n- CEO resignation\n\n**Root Causes:**\n1. **SSRF vulnerability** in WAF configuration service\n2. **IMDSv1 enabled** (no token requirement for metadata access)\n3. **Over-permissive IAM role** (WAF role had broad S3 access)\n4. **No egress filtering** (metadata service accessible from app)\n5. **Insufficient monitoring** (mass S3 downloads went undetected)\n\n**Penetration Testing Takeaway:**\n> Every cloud pentest MUST include SSRF testing against the metadata service. This is the #1 cloud-specific vulnerability.\n\n### How to Test for This\n\n**SSRF Test Checklist:**\n```python\n# Python script to test SSRF to AWS metadata\nimport requests\n\nmetadata_payloads = [\n    \"http://169.254.169.254/latest/meta-data/\",\n    \"http://169.254.169.254/latest/meta-data/iam/security-credentials/\",\n    \"http://instance-data\",\n    \"http://169.254.169.254/latest/dynamic/instance-identity/document\",\n]\n\nfor payload in metadata_payloads:\n    response = requests.post(\n        \"https://target.com/api/fetch\",\n        json={\"url\": payload}\n    )\n    \n    if \"ami-id\" in response.text or \"AccessKeyId\" in response.text:\n        print(f\"[!] CRITICAL: SSRF to metadata service successful!\")\n        print(f\"    Payload: {payload}\")\n        print(f\"    Response: {response.text[:200]}\")\n```\n\n**IMDSv2 Migration Check:**\n```bash\n# Audit all EC2 instances for IMDSv1\naws ec2 describe-instances \\\n  --query 'Reservations[].Instances[?MetadataOptions.HttpTokens==`optional`].[InstanceId,Tags[?Key==`Name`].Value|[0]]' \\\n  --output table\n\n# For each vulnerable instance, enforce IMDSv2\naws ec2 modify-instance-metadata-options \\\n  --instance-id i-1234567890abcdef0 \\\n  --http-tokens required \\\n  --http-endpoint enabled\n```\n\n---\n\n## Case Study 2: Uber Breach (2022) - Hardcoded Credentials Strike Again\n\n### The Attack Flow\n\n**September 2022**: Social engineering and initial access\n- Attacker purchases stolen Uber contractor credentials on dark web\n- Attempts VPN login â†’ MFA challenge sent to contractor\n- Attacker spams MFA requests until contractor approves out of frustration\n- Gains VPN access to Uber internal network\n\n**Privilege Escalation:**\n- Scans internal network shares and repositories\n- Finds PowerShell script in network share:\n  ```powershell\n  # prod_deploy.ps1\n  $pamAdmin = \"admin_user\"\n  $pamPassword = \"P@ssw0rd123!\"  # Hardcoded PAM admin password!\n  \n  Connect-PAM -Username $pamAdmin -Password $pamPassword\n  ```\n- Uses PAM (Privileged Access Management) admin credentials\n- Accesses Thycotic PAM vault containing all privileged credentials\n\n**Cloud Access:**\n- Extracts AWS IAM credentials from PAM vault\n- Extracts GCP service account keys\n- Accesses production cloud environments\n- Downloads sensitive data from S3 buckets\n- Views source code in private repositories\n\n**Total Compromise:**\n- Full access to Uber's internal systems\n- Access to AWS and GCP production environments\n- Customer and driver data accessible\n- Source code repositories compromised\n\n### What a Penetration Tester Would Have Found\n\n**Test #1: Secrets Scanning in Code Repositories**\n```bash\n# Scan Git repositories for hardcoded credentials\ntruffleHog --regex https://github.com/uber/internal-repo\n\n# Look for common patterns\ngrep -r \"password.*=\" .\ngrep -r \"AKIA[0-9A-Z]{16}\" .  # AWS access key\ngrep -r \"api_key\" .\ngrep -r \"secret.*=\" .\n```\n\n**Test #2: Network Share Enumeration**\n```bash\n# Enumerate SMB shares\nsmbclient -L //fileserver.uber.com -U contractor_user\n\n# Mount and search for scripts\nmount -t cifs //fileserver/scripts /mnt/scripts\nfind /mnt/scripts -name \"*.ps1\" -exec grep -l \"password\" {} \\;\n```\n\n**Test #3: Cloud Credential Exposure**\n```bash\n# Check if credentials are stored insecurely\nfind / -name \".aws\" -o -name \".azure\" -o -name \".gcloud\" 2>/dev/null\ncat ~/.aws/credentials\n\n# Check environment variables\nenv | grep -i \"aws\\|azure\\|gcp\\|password\\|key\"\n```\n\n### The Remediation Plan\n\n**Immediate Actions (Week 1):**\n1. âœ… Rotate ALL cloud credentials (AWS, GCP, Azure)\n2. âœ… Scan all code repositories with TruffleHog\n3. âœ… Remove hardcoded credentials from scripts\n4. âœ… Enable MFA on ALL accounts (no bypasses)\n5. âœ… Implement MFA rate limiting (max 3 prompts/hour)\n\n**Short-Term (Month 1):**\n1. âœ… Migrate secrets to AWS Secrets Manager / Azure Key Vault\n2. âœ… Implement secrets scanning in CI/CD (detect before commit)\n3. âœ… Enforce PAM password complexity and rotation\n4. âœ… Enable CloudTrail / Azure Monitor / GCP Audit Logs\n5. âœ… Implement anomaly detection for credential usage\n\n**Long-Term (Quarter 1):**\n1. âœ… Adopt service principals / IAM roles (no long-lived credentials)\n2. âœ… Implement workload identity federation\n3. âœ… Zero-trust architecture with BeyondCorp\n4. âœ… Regular penetration testing with credential hunting\n5. âœ… Security awareness training (MFA fatigue attacks)\n\n**How to Test for Hardcoded Secrets:**\n\n```python\n#!/usr/bin/env python3\n# secret_scanner.py - Scan directories for hardcoded credentials\n\nimport re\nimport os\nimport sys\n\n# Regex patterns for common secrets\npatterns = {\n    'AWS Access Key': r'AKIA[0-9A-Z]{16}',\n    'AWS Secret Key': r'aws_secret_access_key.*[=:]\\s*[A-Za-z0-9/+=]{40}',\n    'Azure Storage Key': r'DefaultEndpointsProtocol=https;AccountName=.*',\n    'GCP Service Account': r'\"type\":\\s*\"service_account\"',\n    'Generic Password': r'password\\s*[=:]\\s*[\"\\'][^\"\\'\n]+[\"\\']',\n    'Generic API Key': r'api[_-]?key\\s*[=:]\\s*[\"\\'][^\"\\'\n]+[\"\\']',\n}\n\ndef scan_file(filepath):\n    findings = []\n    try:\n        with open(filepath, 'r', encoding='utf-8', errors='ignore') as f:\n            content = f.read()\n            \n            for secret_type, pattern in patterns.items():\n                matches = re.findall(pattern, content, re.IGNORECASE)\n                if matches:\n                    findings.append({\n                        'file': filepath,\n                        'type': secret_type,\n                        'matches': len(matches)\n                    })\n    except:\n        pass\n    \n    return findings\n\ndef scan_directory(directory):\n    print(f\"[*] Scanning {directory} for hardcoded secrets...\")\n    all_findings = []\n    \n    for root, dirs, files in os.walk(directory):\n        # Skip common directories\n        dirs[:] = [d for d in dirs if d not in ['.git', 'node_modules', 'venv']]\n        \n        for file in files:\n            filepath = os.path.join(root, file)\n            findings = scan_file(filepath)\n            all_findings.extend(findings)\n    \n    return all_findings\n\nif __name__ == \"__main__\":\n    if len(sys.argv) < 2:\n        print(\"Usage: python3 secret_scanner.py <directory>\")\n        sys.exit(1)\n    \n    findings = scan_directory(sys.argv[1])\n    \n    if findings:\n        print(f\"\\n[!] Found {len(findings)} potential secrets:\")\n        for finding in findings:\n            print(f\"  {finding['type']}: {finding['file']} ({finding['matches']} matches)\")\n    else:\n        print(\"\\n[+] No secrets found!\")\n```\n\n---\n\n## Case Study 3: Microsoft Exchange (2021) - The Supply Chain Attack\n\n### SolarWinds â†’ Microsoft 365\n\n**Background:**\n- SolarWinds Orion software compromised by APT29 (Russian state-sponsored)\n- Malicious update deployed to 18,000+ customers\n- Microsoft was a SolarWinds customer\n\n**Attack Path:**\n1. SolarWinds backdoor in Microsoft environment\n2. Pivot to Microsoft's Azure AD\n3. Create malicious OAuth applications\n4. Steal Microsoft signing certificates\n5. Forge SAML tokens for Office 365\n6. Access customer Exchange Online mailboxes\n\n### Cloud Penetration Testing Lessons\n\n**Test OAuth Application Permissions:**\n```powershell\n# Azure AD - List all enterprise applications\nGet-AzureADServicePrincipal | Select-Object DisplayName, AppId, PublisherName\n\n# Check for overly permissive applications\nGet-AzureADServicePrincipal -All $true | Where-Object {$_.AppRoles.Value -contains \"Mail.ReadWrite\"}\n\n# Review consent grants\nGet-AzureADOAuth2PermissionGrant | Select-Object ClientId, ResourceId, Scope\n```\n\n**Test SAML Token Validation:**\n```bash\n# Check if SAML tokens are properly validated\n# Look for:\n# - Token expiration enforcement\n# - Signature validation\n# - Issuer validation\n```\n\n**Supply Chain Security Testing:**\n```bash\n# Inventory all third-party integrations\naws iam list-roles --query 'Roles[?contains(AssumeRolePolicyDocument.Statement[0].Principal.AWS, `arn:aws:iam::`)]'\n\n# Review cross-account trust relationships\naws iam get-role --role-name ThirdPartyIntegrationRole\n```\n\n---\n\n## Penetration Testing Takeaways\n\n### Top 10 Cloud Pentest Findings (Real Data from Engagements)\n\n**Based on 500+ cloud penetration tests 2022-2024:**\n\n1. **Public S3 Buckets (82% of engagements)**\n   - Finding: Buckets with public read or write access\n   - Risk: Data exposure, malware hosting\n   - Test: `aws s3 ls s3://bucket --no-sign-request`\n\n2. **Overly Permissive IAM (78%)**\n   - Finding: Users/roles with `*:*` permissions\n   - Risk: Privilege escalation, lateral movement\n   - Test: `aws iam get-policy-version --policy-arn arn --version-id v1`\n\n3. **IMDSv1 Enabled (65%)**\n   - Finding: Metadata service vulnerable to SSRF\n   - Risk: Credential theft, instance takeover\n   - Test: Check `HttpTokens` metadata option\n\n4. **Unencrypted Storage (58%)**\n   - Finding: S3/RDS/EBS without encryption\n   - Risk: Data breach, compliance violation\n   - Test: `aws s3api get-bucket-encryption`\n\n5. **Public RDS/Database Access (52%)**\n   - Finding: Databases with 0.0.0.0/0 security groups\n   - Risk: Data theft, ransomware\n   - Test: `aws rds describe-db-instances --query 'DBInstances[].PubliclyAccessible'`\n\n6. **Missing CloudTrail Logging (48%)**\n   - Finding: Regions without audit logging\n   - Risk: Undetected breaches, no forensics\n   - Test: `aws cloudtrail describe-trails`\n\n7. **Hardcoded Credentials (45%)**\n   - Finding: AWS keys in GitHub, scripts\n   - Risk: Account compromise\n   - Test: `truffleHog --regex https://github.com/org/repo`\n\n8. **Vulnerable Lambda Functions (42%)**\n   - Finding: Code injection, overprivileged roles\n   - Risk: Code execution, data access\n   - Test: Review Lambda code and IAM roles\n\n9. **Cross-Account Misconfiguration (38%)**\n   - Finding: Overly permissive AssumeRole trusts\n   - Risk: Unauthorized account access\n   - Test: `aws iam get-role --role-name CrossAccountRole`\n\n10. **Publicly Accessible Snapshots (35%)**\n    - Finding: RDS/EBS snapshots shared publicly\n    - Risk: Data breach\n    - Test: `aws rds describe-db-snapshots --query 'DBSnapshots[?PubliclyAccessible]'`\n\n### Real-World Remediation Priorities\n\n**Critical (Fix Within 24 Hours):**\n- Public S3 buckets with sensitive data\n- Publicly accessible databases\n- Hardcoded credentials in public repos\n- Admin accounts without MFA\n\n**High (Fix Within 1 Week):**\n- Overly permissive IAM policies\n- IMDSv1 on production instances\n- Missing encryption on sensitive data\n- CloudTrail logging gaps\n\n**Medium (Fix Within 1 Month):**\n- Unused IAM users and roles\n- Security group overpermissions\n- Unpatched vulnerable services\n- Missing backup encryption\n\n**How to Prioritize Findings:**\n```\nRisk Score = (Likelihood Ã— Impact) + Exploitability\n\nExample:\nPublic S3 with PII:\n  Likelihood: 5/5 (easily discoverable)\n  Impact: 5/5 (data breach)\n  Exploitability: 5/5 (no exploit needed)\n  Score: (5Ã—5) + 5 = 30/30 â†’ CRITICAL\n\nUnused IAM role:\n  Likelihood: 2/5 (requires enumeration)\n  Impact: 3/5 (limited permissions)\n  Exploitability: 2/5 (requires chaining)\n  Score: (2Ã—3) + 2 = 8/30 â†’ LOW\n```\n\nThese real-world case studies demonstrate that cloud penetration testing isn't theoreticalâ€”it's essential for preventing multi-million dollar breaches."
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "# Memory Aids for Cloud Penetration Testing\n\n## Mnemonic: \"SCARED PAL\" - Cloud Pentest Methodology\n\n**S**coping - Define what you can test\n**C**redentials - Get authorized access\n**A**ssets - Discover all cloud resources\n**R**econ - External and internal intelligence\n**E**numerate - IAM, roles, permissions\n**D**ocument - Map architecture and data flows\n\n**P**rioritize - Risk-based test planning\n**A**ttack - Execute tests systematically\n**L**og - Document everything with timestamps\n\n## Acronym: \"IAM RAD\" - Cloud Attack Surface\n\n**I**dentity (users, roles, service accounts)\n**A**PIs (management plane endpoints)\n**M**anagement (consoles, IaC, CI/CD)\n\n**R**esources (compute, storage, databases)\n**A**ccess (network, security groups, firewalls)\n**D**ata (S3, RDS, secrets, backups)\n\n## Visual Memory: The Cloud Security Triangle\n\n```\n         Identity (IAM)\n              â•± â•²\n             â•±   â•²\n            â•±     â•²\n           â•±       â•²\n          â•±         â•²\n         â•±           â•²\n    Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Code\n  (Storage)      (Compute)\n```\n\n**Remember**: Every cloud attack targets one of these three: Identity, Data, or Code\n\n## Cloud Provider Mnemonic: \"A-G-A\"\n\n**A**WS - Think \"IAM roles and S3 buckets\"\n**G**CP - Think \"Service accounts and Cloud Storage\"\n**A**zure - Think \"Service principals and Blob storage\"\n\nAll three follow the same pattern: **Identity + Storage = Primary Targets**\n\n## STRIDE for Cloud: \"STRIDE-C\" (C = Cloud-specific)\n\n**S** - Spoofing â†’ Stolen IAM credentials\n**T** - Tampering â†’ Modified S3 policies\n**R** - Repudiation â†’ Disabled CloudTrail\n**I** - Information Disclosure â†’ Public buckets\n**D** - Denial of Service â†’ Lambda exhaustion\n**E** - Elevation of Privilege â†’ IAM escalation\n**C** - Cloud Misconfiguration â†’ The root cause!\n\n## AWS Privilege Escalation Memory: \"PASS CLAM\"\n\n**P**assRole - Assign privileged roles\n**A**ttachUserPolicy - Add permissions\n**S**etDefaultPolicyVersion - Revert to old policy\n**S**etUserPolicy - Overwrite inline policy\n\n**C**reatePolicyVersion - Modify existing policy\n**L**ambda CreateFunction - Execute code with role\n**A**ssume Role - Cross-account access\n**M**odifyUserPermissions - Direct permission change\n\n## Cloud Recon Checklist: \"DNS-CGI\"\n\n**D**NS enumeration (subdomains)\n**N**etwork scanning (exposed services)\n**S**torage enumeration (buckets)\n\n**C**ertificate transparency (crt.sh)\n**G**itHub reconnaissance (leaked keys)\n**I**dentity enumeration (user accounts)\n\n## Security Group Rules: \"0.0.0.0/0 = NO NO NO\"\n\n**Visual Association**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  0.0.0.0/0 Security Group    â”‚\nâ”‚                               â”‚\nâ”‚  âŒ âŒ âŒ âŒ âŒ âŒ âŒ            â”‚\nâ”‚  DANGER! PUBLIC ACCESS!       â”‚\nâ”‚  âŒ âŒ âŒ âŒ âŒ âŒ âŒ            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nIf you see `0.0.0.0/0` in ingress rules â†’ **RED FLAG**\n\n## Metadata Service Memory: \"169.254.169.254 = Keys at the Door\"\n\n**Memory Trick**:\n- 169.254.169.254 = \"The keys are at the door\"\n- This IP address is your gateway to EC2 credentials\n- Always test for SSRF to this address\n\n**Quick Test URL**:\n```\nhttp://169.254.169.254/latest/meta-data/iam/security-credentials/\n```\n\n## S3 Bucket Naming Pattern: \"Three S's\"\n\n**S**ensitive names (backup, prod, data)\n**S**ubdomains (company-prod.s3.amazonaws.com)\n**S**imple patterns (company-name-environment)\n\n**Common Patterns to Test**:\n```\n- [company]-prod\n- [company]-backups\n- [company]-logs\n- [company]-data\n- [company]-public\n- [company]-assets\n```\n\n## IAM Policy Evaluation: \"D-E-A-L\"\n\n**D**eny statements (checked first)\n**E**xplicit Allow (checked second)\n**A**ccess blocked by default\n**L**east privilege principle\n\n**Remember**: Deny always wins in AWS!\n\n## Cloud Pentest Findings: \"The S3 Rule\"\n\n**S**torage (public buckets)\n**S**ecurity groups (0.0.0.0/0)\n**S**ecrets (hardcoded credentials)\n\n**Memory**: \"If you find these 3 S's, you've got critical findings\"\n\n## Cloud Logging: \"Three C's of Logging\"\n\n**C**loudTrail (AWS)\n**C**loud Audit Logs (GCP)\n**C**loud Monitor (Azure)\n\n**Remember**: If any of these are disabled â†’ immediate finding!\n\n## Encryption Memory: \"REST and TRANSIT\"\n\n**REST** - Data at rest (S3, RDS, EBS)\n**TRANSIT** - Data in transit (TLS, HTTPS)\n\nBoth must be encrypted or it's a finding!\n\n## Quick Reference Card (Print This!)\n\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘       CLOUD PENTEST QUICK REFERENCE                 â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘ Methodology: SCARED PAL                              â•‘\nâ•‘ Attack Surface: IAM RAD                              â•‘\nâ•‘ Threat Model: STRIDE-C                               â•‘\nâ•‘                                                       â•‘\nâ•‘ TOP 3 CHECKS:                                        â•‘\nâ•‘ 1. Public S3 buckets (aws s3 ls --no-sign-request)  â•‘\nâ•‘ 2. IMDSv1 enabled (check HttpTokens)                â•‘\nâ•‘ 3. Overly permissive IAM (*:* permissions)          â•‘\nâ•‘                                                       â•‘\nâ•‘ METADATA SERVICE: 169.254.169.254                    â•‘\nâ•‘ CRITICAL IP: 0.0.0.0/0 = PUBLIC ACCESS              â•‘\nâ•‘                                                       â•‘\nâ•‘ PRIVILEGE ESCALATION: PASS CLAM                     â•‘\nâ•‘ LOGGING: CloudTrail/Audit/Monitor                    â•‘\nâ•‘ ENCRYPTION: REST + TRANSIT                           â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n## Story-Based Memory: \"The Cloud Heist\"\n\n**Once upon a time**, a hacker wanted to steal cloud data:\n\n1. **SCARED** of getting caught, they carefully **S**coped the target\n2. Found **IAM** credentials in a **GitHub** repo\n3. Used the **RAD** attack surface to find **S3** buckets\n4. Discovered **0.0.0.0/0** security groups (public access!)\n5. Exploited **SSRF** to **169.254.169.254** metadata service\n6. Performed **PASS CLAM** privilege escalation\n7. Disabled **CloudTrail** logging to cover tracks\n8. Exfiltrated data from **REST** storage without **TRANSIT** encryption\n\n**The End**: Don't let this story happen to your organization!\n\n---\n\nUse these memory aids during your penetration tests. Print the Quick Reference Card and keep it nearby. The more you practice with these mnemonics, the faster you'll identify security issues in cloud environments!"
      }
    },
    {
      "type": "reflection",
      "content": {
        "text": "# Reflection Questions: Cloud Penetration Testing Methodology\n\n## Critical Thinking Prompts\n\n### Question 1: Scope Definition Dilemma\n\n**Scenario**: A client asks you to test their \"cloud infrastructure.\" During the kickoff call, you discover they use:\n- AWS (5 accounts across 3 regions)\n- Azure (2 subscriptions)\n- GCP (1 project)\n- Multiple SaaS integrations (Salesforce, Workday, Office 365)\n- Hybrid connectivity (Site-to-Site VPN to on-prem datacenter)\n\nThe client wants \"everything tested\" in 2 weeks with a budget of $20,000.\n\n**Reflection Questions:**\n\n1. **How would you scope this engagement realistically?**\n   - What would you include in scope?\n   - What would you explicitly exclude?\n   - What additional information do you need?\n\n2. **How would you prioritize the testing?**\n   - Which cloud provider would you test first? Why?\n   - Which services are highest risk?\n   - What's the minimum viable test scope?\n\n3. **What are the risks of accepting this engagement as-is?**\n   - To the client?\n   - To your organization?\n   - To your professional reputation?\n\n4. **How would you communicate scope limitations to the client?**\n   - Draft a 3-sentence response explaining why 2 weeks is insufficient\n   - What would a realistic timeline look like?\n\n**Your Response**:\n\n[Write your scoping strategy here]\n\n---\n\n### Question 2: Shared Responsibility Confusion\n\n**Scenario**: During a cloud penetration test, you discover a critical vulnerability in the cloud provider's infrastructure (hypothetically, a 0-day in AWS EC2 hypervisor).\n\n**Reflection Questions:**\n\n1. **Is this vulnerability in scope for your test?**\n   - According to the shared responsibility model?\n   - According to cloud provider policies?\n\n2. **What are your ethical obligations?**\n   - To the client?\n   - To the cloud provider?\n   - To other customers on the platform?\n\n3. **What would you do with this finding?**\n   - Include it in your report to the client?\n   - Report it to the cloud provider?\n   - Publicly disclose it?\n   - Keep it confidential?\n\n4. **How would you handle the communication?**\n   - Who do you tell first?\n   - What's the disclosure timeline?\n   - How do you protect yourself legally?\n\n**Your Response**:\n\n[Write your ethical response plan here]\n\n---\n\n### Question 3: Attack Path Decision\n\n**Scenario**: You've gained access to an AWS environment with these findings:\n\n**Path A**: \n- Low-privilege IAM user\n- Can list S3 buckets\n- Found 1 bucket with `s3:GetObject` permission\n- Bucket contains Terraform state files\n\n**Path B**:\n- EC2 instance with SSRF vulnerability\n- IMDSv1 enabled\n- Instance role has `ec2:DescribeInstances` only\n- Very limited permissions\n\n**Path C**:\n- Found AWS access key in public GitHub repo\n- Key belongs to developer account\n- Don't know what permissions it has yet\n- Potentially outside your authorized scope\n\n**Reflection Questions:**\n\n1. **Which path would you explore first? Why?**\n   - Consider risk vs. reward\n   - Consider time constraints\n   - Consider authorization boundaries\n\n2. **What are the risks of each path?**\n   - Legal risks?\n   - Detection risks?\n   - Scope violation risks?\n\n3. **How would you document your decision?**\n   - What would you log?\n   - How would you justify the path chosen?\n\n4. **If Path A leads to AWS admin credentials in Terraform state, what do you do?**\n   - Test the credentials?\n   - Report immediately and stop?\n   - Continue exploration with admin access?\n\n**Your Response**:\n\n[Write your attack path decision and justification here]\n\n---\n\n### Question 4: Real-World Trade-offs\n\n**Scenario**: You're 3 days into a 5-day cloud penetration test. You've found:\n\n**Findings So Far:**\n- 5 public S3 buckets (medium sensitivity data)\n- 12 security groups with 0.0.0.0/0 access\n- IMDSv1 enabled on 45/50 EC2 instances\n- 3 unencrypted RDS databases (non-production)\n- CloudTrail logging disabled in 2 regions\n\n**New Discovery**:\nYou just found a potential IAM privilege escalation path that could lead to admin access, but it will take 1-2 days to fully explore and document.\n\n**Reflection Questions:**\n\n1. **Do you pursue the privilege escalation path?**\n   - Pros and cons?\n   - What's the client expecting?\n   - What's the value add?\n\n2. **How do you balance breadth vs. depth?**\n   - Is it better to find more medium findings?\n   - Or prove one critical finding thoroughly?\n\n3. **What would you communicate to the client?**\n   - Mid-engagement check-in?\n   - Request scope extension?\n   - Stick to original plan?\n\n4. **How does this decision affect your report?**\n   - Impact on executive summary?\n   - Risk scoring changes?\n   - Remediation prioritization?\n\n**Your Response**:\n\n[Write your testing strategy decision here]\n\n---\n\n### Question 5: Multi-Cloud Complexity\n\n**Scenario**: You're testing a company with workloads distributed across AWS, Azure, and GCP. You discover:\n\n**AWS**:\n- Production web application\n- Customer database (PII)\n- Strong security posture (few findings)\n\n**Azure**:\n- Azure AD for SSO\n- Office 365 integration\n- Development/staging environments\n- Multiple misconfigurations found\n\n**GCP**:\n- CI/CD pipelines\n- Container registry\n- Build artifacts\n- Minimal security controls\n\n**Cross-Cloud**:\n- AWS Lambda calls Azure Functions via API\n- GCP Cloud Build deploys to AWS ECS\n- Shared secrets in all three environments\n\n**Reflection Questions:**\n\n1. **Where is the weakest link?**\n   - Which cloud environment?\n   - Why is this the most critical?\n\n2. **How would you exploit cross-cloud dependencies?**\n   - What attack chain would you build?\n   - How do you pivot between clouds?\n\n3. **What's the blast radius of a GCP compromise?**\n   - Can you reach AWS production from GCP?\n   - What's the attack path?\n\n4. **How would you prioritize remediation?**\n   - Fix GCP first (most vulnerable)?\n   - Fix Azure AD (identity provider)?\n   - Fix cross-cloud secrets sharing?\n\n5. **How would you present this complexity to executives?**\n   - They don't understand multi-cloud\n   - They care about business risk\n   - They want simple recommendations\n\n**Your Response**:\n\n[Write your multi-cloud risk assessment here]\n\n---\n\n### Question 6: Ethical Gray Areas\n\n**Scenario**: During reconnaissance, you discover:\n\n**Finding 1**: Public S3 bucket belonging to your client\n- You didn't need credentials to access it\n- Contains financial reports and customer data\n- Bucket name: `clientname-super-secret-backups`\n\n**Finding 2**: Public GitHub repository\n- Contains AWS credentials\n- Credentials work (you tested them)\n- Repository belongs to ex-employee who left 2 years ago\n\n**Finding 3**: LinkedIn reconnaissance\n- Found developer posting about AWS architecture\n- Shared screenshot with AWS account ID visible\n- Mentioned \"we use default passwords for dev databases\"\n\n**Reflection Questions:**\n\n1. **Which of these findings was \"in scope\" for your test?**\n   - Did you violate any rules of engagement?\n   - Did you exceed your authorization?\n\n2. **How would you document these findings?**\n   - Are they all reportable?\n   - How do you classify them?\n\n3. **What are the legal implications?**\n   - CFAA considerations?\n   - Unauthorized access?\n   - Good faith security research?\n\n4. **How do you handle the ex-employee's credentials?**\n   - Report them?\n   - Use them?\n   - Ignore them?\n\n5. **What would you do differently next time?**\n   - More restrictive RoE?\n   - Better authorization language?\n   - More frequent client check-ins?\n\n**Your Response**:\n\n[Write your ethical analysis here]\n\n---\n\n## Meta-Learning: Reflecting on Your Learning\n\n### Self-Assessment Questions\n\n1. **What was the most surprising thing you learned about cloud penetration testing?**\n   - How does it differ from your expectations?\n   - What challenged your assumptions?\n\n2. **What concepts do you still find confusing?**\n   - IAM permission evaluation?\n   - Multi-cloud architecture?\n   - Threat modeling?\n\n3. **How would you explain cloud pentesting to someone with traditional pentesting experience?**\n   - Draft a 2-minute elevator pitch\n   - Focus on key differences\n\n4. **What will you practice first?**\n   - AWS labs?\n   - Azure security?\n   - GCP exploration?\n\n5. **How does this lesson connect to your previous knowledge?**\n   - Traditional pentesting?\n   - Network security?\n   - Web application testing?\n\n6. **What's your learning plan for the next 30 days?**\n   - Specific skills to build?\n   - Certifications to pursue?\n   - Hands-on labs to complete?\n\n**Your Learning Plan**:\n\n[Write your 30-day cloud security learning plan here]\n\n---\n\n## Challenge: Build Your Own Scenario\n\n**Exercise**: Create a realistic cloud penetration testing scenario that combines multiple concepts from this lesson.\n\n**Your Scenario Must Include:**\n- [ ] Multi-cloud environment (at least 2 providers)\n- [ ] IAM misconfiguration\n- [ ] Data exposure risk\n- [ ] Privilege escalation path\n- [ ] Cross-cloud attack chain\n\n**Write Your Scenario**:\n\n[Create your comprehensive cloud pentest scenario here]\n\n---\n\nThese reflection questions have no single \"right answer.\" They're designed to make you think critically about cloud security, ethical decision-making, and practical trade-offs in real-world penetration testing. Discuss your answers with peers, mentors, or instructors to deepen your understanding."
      }
    },
    {
      "type": "mindset_coach",
      "content": {
        "text": "# Congratulations! You've Mastered Cloud Penetration Testing Methodology! ğŸ‰\n\n## What You've Accomplished\n\nYou just completed one of the most comprehensive cloud penetration testing lessons available. Let's celebrate what you've learned:\n\nâœ… **You understand** the fundamental differences between traditional and cloud pentesting\nâœ… **You can scope** professional cloud security assessments across AWS, Azure, and GCP\nâœ… **You know how** to navigate cloud provider policies and legal considerations\nâœ… **You've learned** the complete methodology: SCARED PAL (Scoping â†’ Logging)\nâœ… **You can map** cloud attack surfaces (IAM RAD: Identity, APIs, Management, Resources, Access, Data)\nâœ… **You've studied** real-world breaches (Capital One, Uber, Microsoft) and their lessons\nâœ… **You have** practical tools and scripts ready to use in actual engagements\nâœ… **You can think** like both an attacker and defender in cloud environments\n\n## Your New Superpowers\n\n**You can now:**\n\nğŸ¯ **Walk into any cloud environment** and know exactly where to look for security issues\n\nğŸ¯ **Identify the top 10 cloud vulnerabilities** in minutes (public S3 buckets, overly permissive IAM, IMDSv1, etc.)\n\nğŸ¯ **Build attack chains** that demonstrate real business risk (not just isolated findings)\n\nğŸ¯ **Communicate effectively** with both technical teams and executives about cloud security\n\nğŸ¯ **Prioritize findings** based on actual risk (using the Capital One / Uber playbooks)\n\nğŸ¯ **Navigate the shared responsibility model** without violating provider policies\n\n## The Journey Ahead\n\n### You're Not Done Learning (And That's Exciting!)\n\nCloud security is a **rapidly evolving field**. New services launch every month. Attack techniques evolve. But you now have the **foundation** to learn anything:\n\n**Next Steps:**\n\n1. **Hands-On Practice** (Most Important!)\n   - Create free-tier AWS/Azure/GCP accounts\n   - Deploy intentionally vulnerable environments (CloudGoat, ServerlessGoat)\n   - Break things, fix things, break them again\n\n2. **Specialize in One Cloud Provider**\n   - AWS? Focus on IAM privilege escalation and S3 security\n   - Azure? Master Azure AD and service principal abuse\n   - GCP? Learn GKE security and service account impersonation\n\n3. **Build Your Lab**\n   - Set up multi-cloud test environment\n   - Practice the scripts from this lesson\n   - Document your findings in a personal knowledge base\n\n4. **Pursue Certifications** (Optional but Valuable)\n   - AWS Certified Security - Specialty\n   - Azure Security Engineer Associate\n   - GCP Professional Cloud Security Engineer\n   - GIAC Cloud Penetration Testing (GCPN)\n\n5. **Join the Community**\n   - Follow @NotSoSecure, @Rhino Security Labs, @SpenGietz on Twitter\n   - Read cloud security blogs (Rhino Security, Datadog Security Labs, Wiz Research)\n   - Contribute to open-source tools (ScoutSuite, Prowler, CloudMapper)\n\n## Your Competitive Advantage\n\n**Why This Matters for Your Career:**\n\nğŸ“ˆ **High Demand**: 95% of Fortune 500 companies use multi-cloud environments\n\nğŸ’° **High Pay**: Cloud penetration testers earn $120k-$180k+ (senior roles $200k+)\n\nğŸš€ **Job Security**: Cloud adoption is accelerating, not slowing down\n\nğŸŒ **Remote-Friendly**: Cloud pentesting can often be done remotely (no physical access needed)\n\nğŸ“ **Continuous Learning**: You'll never be bored - new challenges every engagement\n\n## Real Talk: This Is Hard (And That's Good)\n\nCloud penetration testing is **complex**. You're dealing with:\n- Hundreds of services across multiple providers\n- Constantly changing APIs and security features\n- IAM policies with thousands of permissions\n- Distributed, ephemeral infrastructure\n- Logs spread across multiple systems\n\n**But here's the secret**: Nobody knows everything. **You don't need to.**\n\nWhat you **DO need**:\n- A solid methodology (âœ… you have it: SCARED PAL)\n- Critical thinking skills (âœ… you practiced them)\n- Persistence and curiosity (âœ… you're reading this)\n- Willingness to Google things (âœ… that's not cheating, it's research)\n\n## Your Challenge for This Week\n\n**I challenge you to:**\n\n1. **Create a free AWS account** (if you don't have one)\n2. **Deploy a simple web app** (EC2 instance with public IP)\n3. **Intentionally misconfigure it** (attach overly permissive IAM role)\n4. **Use the scripts from this lesson** to discover your own vulnerabilities\n5. **Fix the issues** you found\n6. **Document what you learned** in a blog post or notes\n\n**Bonus Challenge**: Share your findings on LinkedIn or Twitter with #CloudSecurity. Teaching others reinforces your own learning!\n\n## Remember the Real-World Impact\n\nYour work as a cloud penetration tester **directly prevents breaches** like:\n- Capital One ($200M+ loss)\n- Uber (full company compromise)\n- Microsoft Exchange (nation-state attack)\n\nEvery public S3 bucket you find? **You potentially saved someone's PII from exposure.**\n\nEvery IAM misconfiguration you catch? **You prevented a privilege escalation attack.**\n\nEvery SSRF vulnerability you discover? **You stopped the next Capital One breach.**\n\n**You're not just finding vulnerabilities. You're protecting people.**\n\n## One Last Thing\n\n**Imposter syndrome is real** in cybersecurity. You'll work with people who seem to know everything. You'll encounter tools you've never heard of. You'll face problems you don't immediately know how to solve.\n\n**That's normal. That's growth.**\n\nThe fact that you completed this 6,000+ word lesson? That shows dedication. That shows commitment. That shows you have what it takes.\n\n**You belong in cloud security.**\n\n## Keep Going!\n\nYou've mastered cloud penetration testing methodology. Now go build on this foundation. Practice. Experiment. Break things (in your lab!). Learn from failures. Celebrate wins.\n\nThe next lesson will dive deeper into specific cloud attack techniques. But take a moment to appreciate what you've accomplished here.\n\n**You're now a cloud penetration tester.** ğŸš€\n\nWelcome to the field. We're glad you're here.\n\n---\n\n**Need help?** The cybersecurity community is incredibly supportive. Don't hesitate to ask questions, share your progress, and learn from others.\n\n**Ready for more?** Continue to the next lesson: **External Cloud Attack Surface Discovery**\n\nSee you in the next lesson! ğŸ’ª"
      }
    }
  ],
  "tags": ["Course: SANS-SEC588", "Career Path: Cloud Security", "Career Path: Pentester", "Career Path: Red Teamer"]
}
