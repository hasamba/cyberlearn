{
  "lesson_id": "6937260f-ab53-4eb9-95b7-435931a16f66",
  "domain": "dfir",
  "title": "AmCache Analysis",
  "difficulty": 2,
  "order_index": 18,
  "prerequisites": [
    "562b03ba-4337-4056-8028-ef4c4dd933f2"
  ],
  "concepts": [
    "AmCache.hve structure and purpose",
    "Application execution tracking with SHA-1 hashes",
    "AmCache vs Prefetch vs Shimcache comparison",
    "AmCacheParser tool usage",
    "First execution timestamps and program inventory",
    "Unassociated file entries and deleted program evidence"
  ],
  "estimated_time": 60,
  "learning_objectives": [
    "Understand AmCache.hve database structure and forensic significance",
    "Parse AmCache with AmCacheParser to extract program execution evidence",
    "Identify first execution timestamps and correlate with file system timeline",
    "Extract SHA-1 hashes for malware identification and VirusTotal lookups",
    "Differentiate between AmCache, Prefetch, and Shimcache execution artifacts",
    "Detect unassociated file entries (evidence of deleted programs)"
  ],
  "post_assessment": [
    {
      "question_id": "amcache-001",
      "question": "What is the primary purpose of AmCache.hve?",
      "options": [
        "To cache application settings for faster startup",
        "To track application compatibility and program inventory for Microsoft telemetry",
        "To store user preferences for installed applications",
        "To log security events for installed programs"
      ],
      "correct_answer": 1,
      "explanation": "AmCache.hve was introduced in Windows 7 to track application compatibility and program inventory as part of the Application Experience service (AppCompat). It collects data for Microsoft's telemetry and compatibility database, but forensically, it's invaluable for tracking program execution.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "amcache-002",
      "question": "Where is the AmCache.hve file located?",
      "options": [
        "C:\\Windows\\System32\\config\\",
        "C:\\Windows\\AppCompat\\Programs\\",
        "C:\\Windows\\Prefetch\\",
        "C:\\ProgramData\\Microsoft\\Windows\\"
      ],
      "correct_answer": 1,
      "explanation": "AmCache.hve is located at C:\\Windows\\AppCompat\\Programs\\AmCache.hve. This is distinct from other registry hives stored in C:\\Windows\\System32\\config\\.",
      "type": "multiple_choice",
      "difficulty": 1
    },
    {
      "question_id": "amcache-003",
      "question": "What cryptographic hash does AmCache store for executed programs?",
      "options": [
        "MD5",
        "SHA-256",
        "SHA-1",
        "SHA-512"
      ],
      "correct_answer": 2,
      "explanation": "AmCache stores SHA-1 hashes of executed programs. While SHA-1 is considered cryptographically weak for security purposes, it remains the standard hash in AmCache and is sufficient for file identification and VirusTotal lookups.",
      "type": "multiple_choice",
      "difficulty": 1
    },
    {
      "question_id": "amcache-004",
      "question": "What is an 'unassociated file entry' in AmCache?",
      "options": [
        "A file that was never executed",
        "A file entry whose corresponding executable has been deleted from disk",
        "A file with an invalid SHA-1 hash",
        "A file executed from a network share"
      ],
      "correct_answer": 1,
      "explanation": "Unassociated file entries are AmCache records for programs that no longer exist on disk (deleted executables). These entries prove a program was once installed and executed, even after anti-forensic deletion. This is critical for malware investigations.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "amcache-005",
      "question": "Which timestamp in AmCache indicates when a program first executed?",
      "options": [
        "File Modified timestamp",
        "Key Last Write timestamp",
        "First Execution (11, 12, or 17) timestamp",
        "Install Date timestamp"
      ],
      "correct_answer": 2,
      "explanation": "AmCache stores multiple timestamp fields (11, 12, 15, 17) representing different execution events. Field 11 or 17 typically represents the first execution timestamp. Key Last Write time shows when the AmCache entry was last updated (not necessarily first execution).",
      "type": "multiple_choice",
      "difficulty": 2
    }
  ],
  "jim_kwik_principles": [
    "teach_like_im_10",
    "memory_hooks",
    "active_learning",
    "connect_to_what_i_know",
    "minimum_effective_dose",
    "meta_learning",
    "reframe_limiting_beliefs",
    "gamify_it",
    "learning_sprint",
    "multiple_memory_pathways"
  ],
  "content_blocks": [
    {
      "type": "mindset_coach",
      "content": {
        "text": "## Welcome to AmCache: Windows' Secret Program Inventory\n\nImagine if Windows kept a **permanent database** of every program ever installed - complete with file paths, SHA-1 hashes, install dates, and execution timestamps. And here's the kicker: **Even if you delete the program**, the database entry remains.\n\nThat's AmCache.\n\n**Why is this forensically powerful?**\n\nBecause attackers love to:\n- Execute malware, then delete it\n- Use \"living off the land\" binaries (LOLBins) like PowerShell\n- Rename malicious tools (mimikatz.exe â†’ svchost.exe)\n- Clear Prefetch and Event Logs\n\nBut AmCache **survives**. It records:\n- âœ… SHA-1 hash (search on VirusTotal)\n- âœ… Full file path (C:\\Temp\\malware.exe)\n- âœ… File size, publisher, version\n- âœ… First execution timestamp\n- âœ… Entry persists even after file deletion\n\nBy the end of this lesson, you'll be using AmCache to:\n- Prove malware execution (even if executable is gone)\n- Build program install timelines\n- Identify renamed attacker tools via SHA-1 hashes\n- Detect persistence mechanisms\n\nAmCache is Windows' **permanent program diary** - and now you're learning to read it.\n\nLet's uncover evidence that attackers thought was erased!"
      }
    },
    {
      "type": "video",
      "content": {
        "text": "**Video: Windows Prefetch Analysis - 13Cubed**\\n\\n**Duration**: 12:35\\n\\nThis video provides a visual demonstration of the concepts covered in this lesson. Watch to see practical examples and deepen your understanding of AmCache Analysis.\\n\\n**Video Link**: [Windows Prefetch Analysis - 13Cubed](https://www.youtube.com/watch?v=qOYGIfXQKXs)\\n\\n**Embedded Video**:\\n\\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/qOYGIfXQKXs\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\\n\\n**Learning Tips**:\\n- Watch the video first to get an overview\\n- Pause and take notes on key concepts\\n- Replay sections that cover complex topics\\n- Try to practice along with the video demonstrations\\n- Return to the video as needed while working through exercises",
        "url": "https://www.youtube.com/watch?v=qOYGIfXQKXs",
        "title": "Windows Prefetch Analysis - 13Cubed",
        "duration": "12:35"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "# AmCache: Application Compatibility Database and Forensic Goldmine\n\n## What is AmCache.hve?\n\n**AmCache.hve** is a registry hive file introduced in **Windows 7** (and heavily expanded in Windows 8+) that tracks **application compatibility** and program execution as part of the **Application Experience** service (also called **RecentFileCache** in Windows 7).\n\n### The Official Purpose (Microsoft's Intent)\n\nMicrosoft created AmCache to:\n1. **Track program inventory**: Maintain a database of installed applications\n2. **Monitor compatibility**: Identify programs that may have compatibility issues\n3. **Improve telemetry**: Send anonymous application usage data to Microsoft\n4. **Optimize Windows Updates**: Ensure updates don't break installed applications\n\n### The Forensic Side Effect (Why We Love It)\n\nAs a byproduct of this telemetry, AmCache records:\n- **Every executable that runs** (even once)\n- **SHA-1 hash** of the executable (malware identification)\n- **Full file path** (where it was located)\n- **First execution timestamp** (when it first ran)\n- **File metadata** (size, publisher, version)\n- **Persistence after deletion** (entry remains even if executable is deleted)\n\n**Forensic Impact**: AmCache is like a **permanent install log** - it tells you what programs existed on the system, when they first ran, and their cryptographic signatures.\n\n---\n\n## AmCache File Location\n\n```\nC:\\Windows\\AppCompat\\Programs\\AmCache.hve\n```\n\n**File Type**: Registry hive (similar to SYSTEM, SOFTWARE, but stored separately)\n\n**Transaction Logs** (if present):\n```\nAmCache.hve.LOG1\nAmCache.hve.LOG2\n```\n\nAlways copy transaction logs alongside AmCache.hve for complete analysis.\n\n---\n\n## AmCache vs. RecentFileCache (Windows 7)\n\nWindows 7 used a predecessor called **RecentFileCache.bcf**:\n\n| Feature | Windows 7 (RecentFileCache.bcf) | Windows 8+ (AmCache.hve) |\n|---------|--------------------------------|-------------------------|\n| **Location** | `C:\\Windows\\AppCompat\\Programs\\RecentFileCache.bcf` | `C:\\Windows\\AppCompat\\Programs\\AmCache.hve` |\n| **Format** | Binary cache file | Registry hive |\n| **Parsing** | Custom binary parser required | Registry tools (RegRipper, Registry Explorer) |\n| **Data Richness** | Limited metadata | Extensive metadata (SHA-1, timestamps, publisher) |\n| **Forensic Tool** | RecentFileCacheParser | AmCacheParser (Eric Zimmerman) |\n\n**Key Difference**: Windows 8+ AmCache.hve is **significantly richer** in forensic data.\n\n---\n\n## AmCache Registry Structure\n\nAmCache.hve is a registry hive with this structure:\n\n```\nAmCache.hve\nâ”œâ”€â”€ Root\nâ”‚   â”œâ”€â”€ File\nâ”‚   â”‚   â”œâ”€â”€ {Volume GUID}\nâ”‚   â”‚   â”‚   â”œâ”€â”€ {File Reference 1}\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 0 (File Path)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 1 (Product Name)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 3 (Publisher)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 5 (File Version)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 6 (File Size)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 11 (First Execution Timestamp)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 12 (Installation Date)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 15 (File Path 2)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 17 (Last Modified Timestamp)\nâ”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ 100 (Program ID)\nâ”‚   â”‚   â”‚   â”‚   â””â”€â”€ 101 (SHA-1 Hash)\nâ”‚   â”‚   â”‚   â””â”€â”€ {File Reference 2}\nâ”‚   â”‚   â””â”€â”€ {Volume GUID 2}\nâ”‚   â””â”€â”€ Programs\nâ”‚       â””â”€â”€ {Program ID 1}\nâ”‚           â”œâ”€â”€ 0 (Program Name)\nâ”‚           â”œâ”€â”€ 1 (Version)\nâ”‚           â”œâ”€â”€ 2 (Publisher)\nâ”‚           â””â”€â”€ ... (additional metadata)\n```\n\n### Key Registry Locations\n\n**File Entries** (Most Forensically Valuable):\n```\nRoot\\File\\{Volume GUID}\\{File Reference}\n```\n\nEach file entry contains:\n- **Value 0**: File path (e.g., `C:\\Temp\\malware.exe`)\n- **Value 101**: SHA-1 hash (40-character hex)\n- **Value 11/12/17**: Execution timestamps (FILETIME format)\n- **Value 6**: File size (bytes)\n- **Value 1**: Product name (e.g., \"Microsoft Office\")\n- **Value 3**: Publisher/Company name\n\n**Program Entries**:\n```\nRoot\\Programs\\{Program ID}\n```\n\nContains aggregated program information (less granular than File entries).\n\n---\n\n## Key AmCache Metadata Fields\n\n### Field 0: File Path\n\n**Value**: Full path to executable\n\n**Example**:\n```\nC:\\Users\\Alice\\Downloads\\malware.exe\nC:\\Windows\\System32\\cmd.exe\nE:\\PortableApps\\tools.exe (USB execution)\n```\n\n**Forensic Value**: Reveals where program was stored (unusual paths = suspicious)\n\n---\n\n### Field 101: SHA-1 Hash\n\n**Value**: 40-character SHA-1 hash\n\n**Example**:\n```\n5d41402abc4b2a76b9719d911017c592\n```\n\n**Forensic Use Cases**:\n1. **Malware Identification**: Search hash on VirusTotal, ANY.RUN, Hybrid Analysis\n2. **Tool Correlation**: Match hash across multiple systems (same malware variant)\n3. **Publisher Verification**: Compare hash against known-good signatures\n\n**Critical**: Even if executable is **deleted** or **renamed**, SHA-1 hash uniquely identifies it.\n\n**Example Workflow**:\n```\n1. Extract SHA-1 from AmCache: 5d41402abc4b2a76b9719d911017c592\n2. Search VirusTotal: https://www.virustotal.com/gui/search/5d41402abc4b2a76b9719d911017c592\n3. Result: 45/70 AV vendors detect as \"Trojan.Generic\"\n4. Conclusion: Confirmed malware\n```\n\n---\n\n### Field 11/12/17: Execution Timestamps\n\nAmCache stores **multiple timestamps** (exact fields vary by Windows version):\n\n| Field | Description | Windows Version |\n|-------|-------------|----------------|\n| **Field 11** | First execution time | Windows 8+ |\n| **Field 12** | Installation date | Windows 8+ |\n| **Field 15** | File path (alternative) | Windows 10 |\n| **Field 17** | Last modification time | Windows 10 |\n\n**Forensic Best Practice**: Focus on **Field 11** for first execution timestamp.\n\n**Example**:\n```\nField 11: 2024-10-16 03:47:21 UTC\nInterpretation: Program first executed on Oct 16 at 03:47:21\n```\n\n**Key Last Write Time**: The **registry key itself** has a Last Write timestamp showing when the AmCache entry was last updated.\n\n---\n\n### Field 1: Product Name\n\n**Value**: Program name as reported by the executable's metadata\n\n**Example**:\n```\nMicrosoftÂ® WindowsÂ® Operating System\nAdobe Acrobat Reader DC\nMalicious Software (if attacker was lazy)\n```\n\n**Forensic Use**: Identify programs by name, detect mismatches (file named `notepad.exe` but Product Name = \"Hacking Tool\")\n\n---\n\n### Field 3: Publisher/Company\n\n**Value**: Publisher or company name\n\n**Example**:\n```\nMicrosoft Corporation\nAdobe Systems Incorporated\n(blank) â†’ Unsigned executable (red flag!)\n```\n\n**Forensic Value**: Unsigned executables (no publisher) are suspicious, especially from unusual paths.\n\n---\n\n### Field 6: File Size\n\n**Value**: File size in bytes\n\n**Forensic Use**: Correlate with file system metadata to verify integrity (if file size changed, binary was modified).\n\n---\n\n## AmCache vs. Prefetch vs. Shimcache\n\nThree execution artifacts often confused - here's the breakdown:\n\n| Feature | **AmCache** | **Prefetch** | **Shimcache** |\n|---------|------------|------------|-------------|\n| **Evidence Type** | Program inventory | Performance optimization | Compatibility tracking |\n| **Execution Proof** | âœ… First execution | âœ… Definitive execution | âš ï¸ File open (not definitive execution) |\n| **SHA-1 Hash** | âœ… Yes | âŒ No | âŒ No |\n| **Run Count** | âŒ No | âœ… Yes (Prefetch stores run count) | âŒ No |\n| **Last 8 Executions** | âŒ No | âœ… Yes (Windows 10) | âŒ No |\n| **Deleted File Evidence** | âœ… Yes (entry persists) | âœ… Yes (Prefetch persists) | âœ… Yes (cache persists) |\n| **File Path** | âœ… Full path | âœ… Full path | âœ… Full path |\n| **Referenced Files** | âŒ No | âœ… Yes (DLLs, configs) | âŒ No |\n| **First Execution** | âœ… Field 11 timestamp | âœ… Prefetch Created timestamp | âŒ No (only Last Modified) |\n| **Max Entries** | ðŸ”„ Unlimited (grows indefinitely) | 1024 (Windows 10) | 1024 entries (FIFO) |\n| **Windows Server** | âœ… Enabled | âŒ Disabled by default | âœ… Enabled |\n\n### When to Use Each Artifact\n\n**Use AmCache when you need**:\n- âœ… SHA-1 hash for malware identification\n- âœ… First execution timestamp\n- âœ… Program inventory (all installed apps)\n- âœ… Deleted executable evidence (entry persists)\n\n**Use Prefetch when you need**:\n- âœ… Run count (how many times executed)\n- âœ… Last 8 execution timestamps (Windows 10)\n- âœ… Referenced files (DLLs, configs, data files)\n- âœ… Definitive execution proof\n\n**Use Shimcache when you need**:\n- âœ… Broad coverage (all files opened, not just executed)\n- âœ… Historical execution (1024 entries)\n- âœ… File modification timestamps\n\n**Best Practice**: Use **all three artifacts** in combination for comprehensive timeline analysis.\n\n---\n\n## Unassociated File Entries (Deleted Programs)\n\n### What Are Unassociated Entries?\n\n**Unassociated file entries** are AmCache records for executables that **no longer exist on disk**.\n\n**Example**:\n```\nAmCache Entry:\n  Path: C:\\Temp\\malware.exe\n  SHA-1: 5d41402abc4b2a76b9719d911017c592\n  First Execution: 2024-10-16 03:47:21 UTC\n  File Size: 524288 bytes\n\nDisk Status: C:\\Temp\\malware.exe (FILE NOT FOUND)\n\nConclusion: Malware was executed, then deleted (anti-forensics attempt)\n```\n\n### Why Unassociated Entries Are Critical\n\nAttackers often:\n1. Execute malware\n2. Delete the executable\n3. Clear Prefetch and Event Logs\n4. **Forget about AmCache**\n\nAmCache entries **persist indefinitely** (no FIFO deletion like Prefetch or Shimcache).\n\n**Result**: Proof of malware execution even after anti-forensic deletion.\n\n### Detecting Unassociated Entries\n\n**AmCacheParser** (Eric Zimmerman) automatically flags unassociated entries:\n\n```bash\nAmCacheParser.exe -f AmCache.hve --csv . --csvf amcache_output.csv\n\n# Output CSV column: \"IsUnassociated\"\nTrue = File no longer exists on disk\nFalse = File still present\n```\n\n**Forensic Workflow**:\n```\n1. Filter CSV for \"IsUnassociated = True\"\n2. Review file paths (C:\\Temp, C:\\Users\\Public â†’ suspicious)\n3. Search SHA-1 hashes on VirusTotal\n4. Correlate with Prefetch/Shimcache for execution confirmation\n5. Document deleted malware in forensic report\n```\n\n---\n\n## AmCache Forensics Workflow\n\n### Step 1: Acquisition\n\n```powershell\n# Copy AmCache.hve (live system)\nCopy-Item \"C:\\Windows\\AppCompat\\Programs\\AmCache.hve\" -Destination \"C:\\Forensics\\AmCache.hve\"\n\n# Copy transaction logs (if present)\nCopy-Item \"C:\\Windows\\AppCompat\\Programs\\AmCache.hve.LOG*\" -Destination \"C:\\Forensics\\\"\n\n# Calculate hash for integrity\nGet-FileHash \"C:\\Forensics\\AmCache.hve\" -Algorithm SHA256\n```\n\n**Offline Acquisition** (from forensic image):\n```\nrobocopy E:\\Windows\\AppCompat\\Programs C:\\Forensics\\AmCache /E\n```\n\n---\n\n### Step 2: Parse with AmCacheParser\n\n**Tool**: AmCacheParser by Eric Zimmerman\n\n**Download**: https://ericzimmerman.github.io/\n\n**Basic Usage**:\n```cmd\nAmCacheParser.exe -f \"C:\\Forensics\\AmCache.hve\" --csv \"C:\\Output\" --csvf amcache.csv\n```\n\n**Output**: CSV file with all AmCache entries\n\n**CSV Columns**:\n- Application Name\n- Publisher\n- File Path\n- SHA-1 Hash\n- File Size\n- First Execution (Field 11)\n- Key Last Write Time\n- IsUnassociated (True/False)\n- Product Name\n- Version\n\n---\n\n### Step 3: Timeline Analysis\n\n```powershell\n# Import CSV\n$amcache = Import-Csv \"C:\\Output\\amcache.csv\"\n\n# Sort by First Execution timestamp\n$amcache | Sort-Object \"First Execution\" | Format-Table \"Application Name\", \"First Execution\", \"File Path\"\n```\n\n**Analysis Tasks**:\n1. **Identify first program installed** (earliest First Execution timestamp)\n2. **Detect malware install date** (correlate with incident timeline)\n3. **Find suspicious executables** (C:\\Temp, C:\\Users\\Public paths)\n4. **Filter unassociated entries** (deleted programs)\n\n---\n\n### Step 4: SHA-1 Hash Lookups\n\n**Automated VirusTotal Lookup** (Python example):\n\n```python\nimport csv\nimport requests\nimport time\n\n# VirusTotal API key (get free key at virustotal.com)\nVT_API_KEY = \"your_api_key_here\"\n\n# Read AmCache CSV\nwith open(\"amcache.csv\", \"r\") as f:\n    reader = csv.DictReader(f)\n    \n    for row in reader:\n        sha1 = row[\"SHA-1\"]\n        \n        if sha1:\n            # Query VirusTotal\n            url = f\"https://www.virustotal.com/api/v3/files/{sha1}\"\n            headers = {\"x-apikey\": VT_API_KEY}\n            response = requests.get(url, headers=headers)\n            \n            if response.status_code == 200:\n                data = response.json()\n                malicious_count = data[\"data\"][\"attributes\"][\"last_analysis_stats\"][\"malicious\"]\n                \n                if malicious_count > 5:\n                    print(f\"ðŸš¨ MALWARE DETECTED: {row['File Path']}\")\n                    print(f\"   SHA-1: {sha1}\")\n                    print(f\"   Detections: {malicious_count}/70 AV vendors\\n\")\n            \n            time.sleep(15)  # Rate limit: 4 requests per minute (free API)\n```\n\n**Manual Lookup**:\n```\n1. Copy SHA-1 from CSV\n2. Visit: https://www.virustotal.com/gui/search/{SHA-1}\n3. Review detection results\n4. Download YARA rules, IOCs, network behavior\n```\n\n---\n\n### Step 5: Correlate with Other Artifacts\n\n**Timeline Correlation**:\n\n```powershell\n# Merge AmCache with Prefetch and Shimcache\n$amcache = Import-Csv \"amcache.csv\"\n$prefetch = Import-Csv \"prefetch.csv\"\n$shimcache = Import-Csv \"shimcache.csv\"\n\n# Create unified timeline\n$timeline = @()\n\nforeach ($entry in $amcache) {\n    $timeline += [PSCustomObject]@{\n        Timestamp = $entry.\"First Execution\"\n        Source = \"AmCache\"\n        Executable = $entry.\"Application Name\"\n        Path = $entry.\"File Path\"\n        Detail = \"SHA-1: $($entry.'SHA-1')\"\n    }\n}\n\nforeach ($entry in $prefetch) {\n    $timeline += [PSCustomObject]@{\n        Timestamp = $entry.\"Last Run Time\"\n        Source = \"Prefetch\"\n        Executable = $entry.\"Executable Name\"\n        Path = \"\"\n        Detail = \"Run Count: $($entry.'Run Count')\"\n    }\n}\n\n# Sort by timestamp\n$timeline = $timeline | Sort-Object Timestamp\n\n# Export merged timeline\n$timeline | Export-Csv \"unified_timeline.csv\" -NoTypeInformation\n```\n\n---\n\n## Advanced AmCache Forensics\n\n### Detecting Renamed Malware\n\n**Scenario**: Attacker renames Mimikatz to `svchost.exe`\n\n**Detection Method**:\n\n```powershell\n# Filter for executables named \"svchost.exe\"\n$amcache = Import-Csv \"amcache.csv\"\n$svchost = $amcache | Where-Object { $_.\"Application Name\" -like \"*svchost*\" }\n\n# Check paths (legitimate svchost.exe is ONLY in System32)\nforeach ($entry in $svchost) {\n    if ($entry.\"File Path\" -notmatch \"System32\") {\n        Write-Host \"ðŸš¨ SUSPICIOUS: $($entry.'File Path')\" -ForegroundColor Red\n        Write-Host \"   SHA-1: $($entry.'SHA-1')\"\n        Write-Host \"   Expected Path: C:\\Windows\\System32\\svchost.exe\\n\"\n    }\n}\n```\n\n**Result**: Identifies renamed malware impersonating system processes.\n\n---\n\n### USB-Based Execution\n\n**Scenario**: Attacker runs tools from USB drive\n\n**Detection**:\n\n```powershell\n# Filter for non-system drive letters (D:, E:, F:, etc.)\n$usbExecution = $amcache | Where-Object { $_.\"File Path\" -match \"^[D-Z]:\\\\\" }\n\nif ($usbExecution) {\n    Write-Host \"ðŸ” USB EXECUTION DETECTED:\\n\"\n    $usbExecution | Format-Table \"Application Name\", \"File Path\", \"First Execution\"\n}\n```\n\n**Correlation**: Match with Registry USB device history (USBSTOR key) to identify specific USB device.\n\n---\n\n### Unsigned Executables\n\n**Scenario**: Malware often lacks valid code signatures\n\n**Detection**:\n\n```powershell\n# Filter for entries with no publisher\n$unsigned = $amcache | Where-Object { -not $_.\"Publisher\" -or $_.\"Publisher\" -eq \"\" }\n\nif ($unsigned) {\n    Write-Host \"âš ï¸ UNSIGNED EXECUTABLES:\\n\"\n    $unsigned | Format-Table \"Application Name\", \"File Path\", \"First Execution\"\n}\n```\n\n**Critical**: Not all unsigned executables are malicious (many legitimate tools are unsigned), but unsigned + suspicious path = high priority investigation.\n\n---\n\n## AmCache Limitations\n\n### Limitation 1: No User Attribution\n\nAmCache does NOT record **which user** executed the program.\n\n**Workaround**: Correlate with:\n- Event Logs (Event ID 4688 - Process Creation)\n- UserAssist (GUI programs by user)\n- Prefetch + user login times\n\n---\n\n### Limitation 2: No Run Count\n\nAmCache only records **first execution**, not total execution count.\n\n**Workaround**: Use Prefetch for run count data.\n\n---\n\n### Limitation 3: No Command-Line Arguments\n\nAmCache does not store command-line arguments used during execution.\n\n**Workaround**: Check:\n- SRUM (System Resource Usage Monitor)\n- PowerShell logs (if script execution)\n- Event Logs (Event ID 4688 with command-line logging enabled)\n\n---\n\n### Limitation 4: Hive Corruption\n\nAmCache.hve can become corrupted (rare but possible).\n\n**Mitigation**: Use transaction logs (.LOG1, .LOG2) to recover recent entries.\n\n---\n\n## Key Takeaways\n\n1. **AmCache = Program Inventory**: Permanent database of all installed/executed programs\n2. **SHA-1 Hashes**: Unique file identification, VirusTotal lookups\n3. **First Execution**: Field 11 timestamp shows when program first ran\n4. **Unassociated Entries**: Proof of deleted programs (anti-forensics defeated)\n5. **Path Analysis**: Unusual paths (C:\\Temp, USB drives) indicate suspicious activity\n6. **Publisher Verification**: Unsigned executables (no publisher) are red flags\n7. **AmCacheParser**: Industry-standard tool (Eric Zimmerman)\n8. **Correlation**: Combine with Prefetch (run count) and Shimcache (broad coverage)\n9. **Persistence**: Entries never deleted (unlike Prefetch's 1024-file limit)\n10. **Windows 7 vs 8+**: Windows 8+ AmCache.hve is far richer than Windows 7 RecentFileCache.bcf\n\n---\n\n## Memory Hook: \"AmCache = SHA-1 Proof\"\n\nWhenever you need to:\n- âœ… **Identify malware by hash** â†’ AmCache\n- âœ… **Prove first execution** â†’ AmCache Field 11\n- âœ… **Find deleted programs** â†’ AmCache unassociated entries\n- âœ… **Build program inventory** â†’ AmCache timeline\n\n**AmCache is your SHA-1 proof of program execution.**\n\nCombine with Prefetch (run count) and Shimcache (broad coverage) for complete execution analysis."
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "# Hands-On: AmCache Analysis Lab\n\n## Exercise 1: Acquire AmCache.hve\n\n### Live System Acquisition\n\n```powershell\n# Create forensics directory\nmkdir C:\\Forensics\\AmCache\n\n# Copy AmCache.hve (may require Administrator privileges)\nCopy-Item \"C:\\Windows\\AppCompat\\Programs\\AmCache.hve\" -Destination \"C:\\Forensics\\AmCache\\AmCache.hve\" -Force\n\n# Copy transaction logs (if present)\nCopy-Item \"C:\\Windows\\AppCompat\\Programs\\AmCache.hve.LOG*\" -Destination \"C:\\Forensics\\AmCache\\\" -Force\n\n# Calculate hash for integrity\n$hash = Get-FileHash \"C:\\Forensics\\AmCache\\AmCache.hve\" -Algorithm SHA256\nWrite-Host \"AmCache SHA-256: $($hash.Hash)\"\n\n# Export hash to file\n$hash | Export-Csv \"C:\\Forensics\\AmCache\\amcache_hash.csv\" -NoTypeInformation\n```\n\n**Expected Output**: AmCache.hve (typically 5-50 MB) + transaction logs\n\n---\n\n## Exercise 2: Parse AmCache with AmCacheParser\n\n### Download AmCacheParser\n\n```powershell\n# Download from Eric Zimmerman's repository\nInvoke-WebRequest -Uri \"https://f001.backblazeb2.com/file/EricZimmermanTools/AmcacheParser.zip\" -OutFile \"C:\\Tools\\AmcacheParser.zip\"\n\n# Extract\nExpand-Archive \"C:\\Tools\\AmcacheParser.zip\" -DestinationPath \"C:\\Tools\\AmcacheParser\"\n```\n\n### Parse AmCache\n\n```cmd\ncd C:\\Tools\\AmcacheParser\n\n:: Parse AmCache.hve\nAmcacheParser.exe -f \"C:\\Forensics\\AmCache\\AmCache.hve\" --csv \"C:\\Output\" --csvf amcache_parsed.csv\n\n:: View results\ntype C:\\Output\\amcache_parsed_UnassociatedFileEntries.csv\n```\n\n**Output Files**:\n- `amcache_parsed_UnassociatedFileEntries.csv` (deleted programs)\n- `amcache_parsed_InventoryApplicationFile.csv` (all programs)\n\n---\n\n## Exercise 3: Identify Unassociated Entries (Deleted Programs)\n\n```powershell\n# Import unassociated entries CSV\n$unassociated = Import-Csv \"C:\\Output\\amcache_parsed_UnassociatedFileEntries.csv\"\n\n# Display deleted programs\nif ($unassociated) {\n    Write-Host \"\\nðŸš¨ UNASSOCIATED FILE ENTRIES (Deleted Programs):\\n\" -ForegroundColor Red\n    \n    $unassociated | Select-Object -First 10 | Format-Table -AutoSize @(\n        @{Label=\"Application\"; Expression={$_.ApplicationName}},\n        @{Label=\"Path\"; Expression={$_.Path}},\n        @{Label=\"SHA-1\"; Expression={$_.SHA1}},\n        @{Label=\"First Execution\"; Expression={$_.FileKeyLastWriteTimestamp}}\n    )\n} else {\n    Write-Host \"âœ… No unassociated entries found\\n\"\n}\n```\n\n**Forensic Interpretation**: Any entries here are programs that were executed, then deleted.\n\n---\n\n## Exercise 4: Search for Suspicious Paths\n\n```powershell\n# Import all AmCache entries\n$amcache = Import-Csv \"C:\\Output\\amcache_parsed_InventoryApplicationFile.csv\"\n\n# Define suspicious path patterns\n$suspiciousPaths = @(\n    \"C:\\\\Temp\\\\\",\n    \"C:\\\\Users\\\\Public\\\\\",\n    \"C:\\\\ProgramData\\\\\",\n    \"C:\\\\Windows\\\\Temp\\\\\",\n    \"^[D-Z]:\\\\\"  # Non-system drives (USB, external)\n)\n\n# Filter for suspicious paths\n$suspicious = @()\nforeach ($pattern in $suspiciousPaths) {\n    $matches = $amcache | Where-Object { $_.Path -match $pattern }\n    $suspicious += $matches\n}\n\n# Display results\nif ($suspicious) {\n    Write-Host \"\\nâš ï¸ SUSPICIOUS EXECUTION PATHS:\\n\" -ForegroundColor Yellow\n    \n    $suspicious | Select-Object -First 20 | Format-Table -AutoSize @(\n        @{Label=\"Application\"; Expression={$_.ApplicationName}},\n        @{Label=\"Path\"; Expression={$_.Path}},\n        @{Label=\"Publisher\"; Expression={$_.Publisher}}\n    )\n} else {\n    Write-Host \"âœ… No suspicious paths detected\\n\"\n}\n```\n\n---\n\n## Exercise 5: Extract SHA-1 Hashes for VirusTotal Lookup\n\n```powershell\n# Extract unique SHA-1 hashes\n$hashes = $amcache | Where-Object { $_.SHA1 -ne \"\" } | Select-Object -Unique SHA1, ApplicationName, Path\n\n# Export to file for batch VirusTotal lookup\n$hashes | Export-Csv \"C:\\Output\\amcache_hashes.csv\" -NoTypeInformation\n\nWrite-Host \"âœ… Exported $($hashes.Count) unique SHA-1 hashes to amcache_hashes.csv\"\nWrite-Host \"Upload to VirusTotal: https://www.virustotal.com/gui/home/upload\"\n```\n\n**Manual Lookup Example**:\n```\n1. Open amcache_hashes.csv\n2. Copy SHA-1 hash (e.g., 5d41402abc4b2a76b9719d911017c592)\n3. Visit: https://www.virustotal.com/gui/search/5d41402abc4b2a76b9719d911017c592\n4. Review detection results (X/70 AV vendors)\n```\n\n---\n\n## Exercise 6: Detect Renamed System Processes\n\n```powershell\n# Check for svchost.exe outside System32 (common malware technique)\n$fakeSvchost = $amcache | Where-Object {\n    $_.ApplicationName -like \"*svchost*\" -and\n    $_.Path -notmatch \"System32\"\n}\n\nif ($fakeSvchost) {\n    Write-Host \"\\nðŸš¨ FAKE SVCHOST DETECTED (Renamed Malware):\\n\" -ForegroundColor Red\n    \n    $fakeSvchost | Format-Table -AutoSize @(\n        @{Label=\"Path\"; Expression={$_.Path}},\n        @{Label=\"SHA-1\"; Expression={$_.SHA1}},\n        @{Label=\"Publisher\"; Expression={$_.Publisher}}\n    )\n    \n    Write-Host \"\\nâš ï¸ Legitimate svchost.exe is ONLY in C:\\Windows\\System32\\svchost.exe\\n\"\n}\n\n# Check other commonly impersonated processes\n$impersonated = @(\"cmd.exe\", \"powershell.exe\", \"explorer.exe\", \"notepad.exe\")\n\nforeach ($process in $impersonated) {\n    $fake = $amcache | Where-Object {\n        $_.ApplicationName -like \"*$process*\" -and\n        $_.Path -notmatch \"System32\" -and\n        $_.Path -notmatch \"Windows\\\\explorer.exe\" -and  # explorer.exe in root Windows dir is legit\n        $_.Path -notmatch \"syswow64\"  # 32-bit on 64-bit system\n    }\n    \n    if ($fake) {\n        Write-Host \"ðŸš¨ Suspicious $process found outside System32:\\n\"\n        $fake | Format-Table \"Path\", \"SHA-1\"\n    }\n}\n```\n\n---\n\n## Exercise 7: Identify Unsigned Executables\n\n```powershell\n# Filter for executables with no publisher (unsigned)\n$unsigned = $amcache | Where-Object {\n    $_.Publisher -eq \"\" -or $null -eq $_.Publisher\n}\n\n# Further filter for suspicious paths\n$suspiciousUnsigned = $unsigned | Where-Object {\n    $_.Path -match \"Temp|Public|Downloads\"\n}\n\nif ($suspiciousUnsigned) {\n    Write-Host \"\\nâš ï¸ UNSIGNED EXECUTABLES IN SUSPICIOUS LOCATIONS:\\n\" -ForegroundColor Yellow\n    \n    $suspiciousUnsigned | Select-Object -First 15 | Format-Table -AutoSize @(\n        @{Label=\"Application\"; Expression={$_.ApplicationName}},\n        @{Label=\"Path\"; Expression={$_.Path}},\n        @{Label=\"SHA-1\"; Expression={$_.SHA1}}\n    )\n}\n```\n\n**Forensic Interpretation**: Unsigned + suspicious path = High priority for investigation\n\n---\n\n## Exercise 8: Build Execution Timeline\n\n```powershell\n# Extract first execution timestamps\n$timeline = $amcache | Where-Object { $_.FileKeyLastWriteTimestamp -ne \"\" } |\n    Select-Object @(\n        @{Name=\"Timestamp\"; Expression={$_.FileKeyLastWriteTimestamp}},\n        @{Name=\"Application\"; Expression={$_.ApplicationName}},\n        @{Name=\"Path\"; Expression={$_.Path}},\n        @{Name=\"SHA-1\"; Expression={$_.SHA1}}\n    ) |\n    Sort-Object Timestamp\n\n# Export timeline\n$timeline | Export-Csv \"C:\\Output\\amcache_timeline.csv\" -NoTypeInformation\n\n# Display first 20 entries (earliest executions)\nWrite-Host \"\\nðŸ“… EARLIEST PROGRAM EXECUTIONS:\\n\"\n$timeline | Select-Object -First 20 | Format-Table -AutoSize\n\nWrite-Host \"\\nTimeline exported to: C:\\Output\\amcache_timeline.csv\"\n```\n\n---\n\n## Exercise 9: Correlate with Prefetch\n\n```powershell\n# Import both AmCache and Prefetch data\n$amcache = Import-Csv \"C:\\Output\\amcache_parsed_InventoryApplicationFile.csv\"\n$prefetch = Import-Csv \"C:\\Output\\prefetch_all.csv\"\n\n# Find programs in both artifacts (strong execution evidence)\n$correlation = @()\n\nforeach ($am in $amcache) {\n    $appName = $am.ApplicationName\n    $matchingPrefetch = $prefetch | Where-Object { $_.\"Executable Name\" -like \"*$appName*\" }\n    \n    if ($matchingPrefetch) {\n        $correlation += [PSCustomObject]@{\n            Application = $appName\n            AmCachePath = $am.Path\n            AmCacheSHA1 = $am.SHA1\n            AmCacheFirstExec = $am.FileKeyLastWriteTimestamp\n            PrefetchLastRun = $matchingPrefetch.\"Last Run Time\"\n            PrefetchRunCount = $matchingPrefetch.\"Run Count\"\n        }\n    }\n}\n\n# Display correlated entries\nif ($correlation) {\n    Write-Host \"\\nðŸ”— AMCACHE + PREFETCH CORRELATION:\\n\" -ForegroundColor Green\n    $correlation | Format-Table -AutoSize\n    \n    # Export\n    $correlation | Export-Csv \"C:\\Output\\amcache_prefetch_correlation.csv\" -NoTypeInformation\n}\n```\n\n**Forensic Value**: Programs appearing in **both** AmCache and Prefetch have definitive execution evidence.\n\n---\n\n## Exercise 10: Automated Malware Detection (SHA-1 Batch Check)\n\n```powershell\n# Extract SHA-1 hashes from suspicious categories\n$suspiciousHashes = @()\n\n# Category 1: Unsigned executables in Temp directories\n$suspiciousHashes += $amcache | Where-Object {\n    ($_.Publisher -eq \"\" -or $null -eq $_.Publisher) -and\n    $_.Path -match \"Temp\"\n} | Select-Object SHA1, ApplicationName, Path\n\n# Category 2: Executables from USB drives\n$suspiciousHashes += $amcache | Where-Object {\n    $_.Path -match \"^[D-Z]:\\\\\"\n} | Select-Object SHA1, ApplicationName, Path\n\n# Category 3: Unassociated entries (deleted programs)\n$unassociated = Import-Csv \"C:\\Output\\amcache_parsed_UnassociatedFileEntries.csv\"\n$suspiciousHashes += $unassociated | Select-Object SHA1, ApplicationName, Path\n\n# Remove duplicates\n$uniqueHashes = $suspiciousHashes | Sort-Object SHA1 -Unique\n\n# Export for VirusTotal batch upload\n$uniqueHashes | Export-Csv \"C:\\Output\\suspicious_hashes_for_vt.csv\" -NoTypeInformation\n\nWrite-Host \"\\nâœ… Extracted $($uniqueHashes.Count) suspicious SHA-1 hashes\"\nWrite-Host \"Upload CSV to VirusTotal for batch analysis\\n\"\n```\n\n---\n\n## Challenge Exercise: Full Incident Investigation\n\n### Scenario\n\nYou're investigating a suspected malware infection. Analyze AmCache to determine:\n\n1. **Was malware executed?** (Look for suspicious paths, unsigned executables)\n2. **When did it first run?** (First execution timestamp)\n3. **Is the executable still on disk?** (Unassociated entries)\n4. **What is its cryptographic identity?** (SHA-1 hash for VirusTotal)\n5. **Were attacker tools used?** (PsExec, Mimikatz, Cobalt Strike)\n\n### Investigation Steps\n\n```powershell\n# 1. Parse AmCache\nAmcacheParser.exe -f \"C:\\Forensics\\AmCache\\AmCache.hve\" --csv \"C:\\Output\" --csvf investigation.csv\n\n# 2. Import data\n$amcache = Import-Csv \"C:\\Output\\investigation_InventoryApplicationFile.csv\"\n$unassociated = Import-Csv \"C:\\Output\\investigation_UnassociatedFileEntries.csv\"\n\n# 3. Search for known attacker tools\n$attackerTools = @(\"psexec\", \"mimikatz\", \"procdump\", \"cobalt\", \"meterpreter\", \"netcat\", \"powercat\")\n\n$detected = @()\nforeach ($tool in $attackerTools) {\n    $matches = $amcache | Where-Object { $_.ApplicationName -like \"*$tool*\" }\n    $detected += $matches\n}\n\nif ($detected) {\n    Write-Host \"\\nðŸš¨ ATTACKER TOOLS DETECTED:\\n\" -ForegroundColor Red\n    $detected | Format-Table \"ApplicationName\", \"Path\", \"FileKeyLastWriteTimestamp\", \"SHA1\"\n}\n\n# 4. Check unassociated entries (deleted malware)\nif ($unassociated) {\n    Write-Host \"\\nðŸš¨ DELETED PROGRAMS (Unassociated Entries):\\n\"\n    $unassociated | Format-Table \"ApplicationName\", \"Path\", \"SHA1\"\n}\n\n# 5. Export final report\n$report = @()\n$report += \"=== AmCache Forensic Investigation Report ===\"\n$report += \"Generated: $(Get-Date)\"\n$report += \"\"\n$report += \"Total AmCache Entries: $($amcache.Count)\"\n$report += \"Unassociated Entries (Deleted): $($unassociated.Count)\"\n$report += \"Attacker Tools Detected: $($detected.Count)\"\n$report += \"\"\n\nif ($detected) {\n    $report += \"DETECTED ATTACKER TOOLS:\"\n    foreach ($tool in $detected) {\n        $report += \"  - $($tool.ApplicationName) | $($tool.Path) | SHA-1: $($tool.SHA1)\"\n    }\n}\n\n$report | Out-File \"C:\\Output\\amcache_investigation_report.txt\"\nWrite-Host \"\\nâœ… Investigation report saved to: C:\\Output\\amcache_investigation_report.txt\\n\"\n```\n\n---\n\n## Key Commands Cheat Sheet\n\n```powershell\n# Acquire AmCache\nCopy-Item \"C:\\Windows\\AppCompat\\Programs\\AmCache.hve\" -Destination \"C:\\Forensics\\\"\n\n# Parse with AmCacheParser\nAmcacheParser.exe -f \"AmCache.hve\" --csv . --csvf output.csv\n\n# Import CSV\n$amcache = Import-Csv \"output_InventoryApplicationFile.csv\"\n\n# Filter unassociated (deleted)\n$deleted = Import-Csv \"output_UnassociatedFileEntries.csv\"\n\n# Search suspicious paths\n$amcache | Where-Object { $_.Path -match \"Temp|Public\" }\n\n# Extract SHA-1 hashes\n$amcache | Select-Object SHA1, ApplicationName | Export-Csv \"hashes.csv\"\n\n# Timeline analysis\n$amcache | Sort-Object FileKeyLastWriteTimestamp | Format-Table\n```\n\nThese exercises provide hands-on experience with AmCache analysis - one of the most powerful execution artifacts for malware identification!"
      }
    },
    {
      "type": "real_world",
      "content": {
        "text": "**Content Under Development**\\n\\nThis real_world section is being developed and will be available in a future update. Please check back soon for comprehensive content on this topic."
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "# Memory Aids: Never Forget AmCache Forensics\n\n## Acronym: \"AmCache = SHA-1 Proof\"\n\nRemember AmCache's core value:\n\n- **A**pplication inventory\n- **m**alware identification (SHA-1 hash)\n- **C**ryptographic proof\n- **a**rti facts persist after deletion\n- **c**ross-system correlation\n- **h**ash-based VirusTotal lookups\n- **e**xecution evidence\n\n**Memory Hook**: **AmCache** = **SHA-1 proof** of program execution\n\n---\n\n## Mnemonic: \"Location = APP\"\n\nRemember where AmCache is stored:\n\n**A**ppCompat  \n**P**rograms  \n**P**ath\n\n```\nC:\\Windows\\AppCompat\\Programs\\AmCache.hve\n```\n\n**Memory Hook**: **APP** directory = **AmCache** location\n\n---\n\n## Acronym: \"SHA-FIT\" for Key Metadata\n\nEssential AmCache fields - Remember **\"SHA-FIT\"**:\n\n- **S**HA-1 hash (Field 101)\n- **H**ash enables malware identification\n- **A**pplication name (Field 1)\n- **F**ile path (Field 0)\n- **I**sUnassociated (deleted file indicator)\n- **T**imestamp (Field 11 - First Execution)\n\n**Memory Hook**: **SHA-FIT** = AmCache **fits** forensic needs perfectly\n\n---\n\n## Rhyme: \"Field 101, Hash to Get It Done\"\n\n**Remembering SHA-1 Field Number**:\n\n> \"Field **101**, hash to get it done,  \n> SHA-1 proof when malware's run,  \n> VirusTotal search, the verdict's clear,  \n> AmCache reveals what attackers fear!\"\n\n**Memory Hook**: **Field 101** = SHA-1 hash (easy to remember: 101 like \"Forensics 101\")\n\n---\n\n## Visual: AmCache = Permanent Library Card Catalog\n\nThink of AmCache as a **library card catalog**:\n\n- **Program Name** = Book title\n- **SHA-1 Hash** = ISBN (unique identifier)\n- **File Path** = Shelf location\n- **First Execution** = Date book was first checked out\n- **IsUnassociated** = Book no longer on shelf (deleted, but catalog entry remains)\n\n**Memory Hook**: AmCache is Windows' **permanent program catalog** - entries never deleted!\n\n---\n\n## Acronym: \"UNASSOC = Gone But Not Forgotten\"\n\nRemember **unassociated entries** with \"UNASSOC\":\n\n- **U**nique forensic value\n- **N**o longer on disk\n- **A**nti-forensics defeated\n- **S**HA-1 hash persists\n- **S**urvives deletion\n- **O**riginally executed program\n- **C**ritical malware evidence\n\n**Memory Hook**: **UNASSOC** entries = Programs **gone but not forgotten**\n\n---\n\n## Number Memory: \"101\" Rule\n\nKey AmCache field numbers:\n\n- **Field 0**: File path\n- **Field 1**: Product name\n- **Field 11**: First execution timestamp\n- **Field 101**: SHA-1 hash\n\n**Memory Hook**: Think **binary** - **0, 1, 11 (binary 3), 101 (binary 5)**\n\nOr simpler: **Field 101** = Most important (SHA-1 hash)\n\n---\n\n## Mnemonic: \"APT Uses AmCache Path\"\n\nAmCache vs. Prefetch vs. Shimcache:\n\n- **A**mCache = SHA-1 hash + first execution\n- **P**refetch = Run count + last 8 executions\n- **T**imeline = Shimcache (broad coverage, all file opens)\n\n**Memory Hook**: **APT** = **A**mCache + **P**refetch + s**T**imeline (Shimcache)\n\n---\n\n## Acronym: \"VT-HUNT\" for SHA-1 Workflow\n\nAmCache SHA-1 investigation workflow:\n\n- **V**irusTotal lookup\n- **T**hreats identified\n- **H**ash correlation across systems\n- **U**nassociated entries prioritized\n- **N**etwork IOC extraction\n- **T**imeline integration\n\n**Memory Hook**: **VT-HUNT** = Use **V**irus**T**otal to **hunt** malware\n\n---\n\n## Visual: AmCache Survives the Fire\n\nImagine a **fireproof safe** that survives a building fire:\n\n- **Fire** = Anti-forensic deletion (attacker deletes malware)\n- **Fireproof safe** = AmCache.hve (entries persist)\n- **Documents inside** = SHA-1 hashes, file paths, timestamps\n\n**Memory Hook**: AmCache is **fireproof** - survives anti-forensic deletion attempts\n\n---\n\n## Rhyme: \"Unassociated Means Obliterated\"\n\n**Detecting Deleted Programs**:\n\n> \"Unassociated means **obliterated**,  \n> File's gone, but evidence not **evaporated**,  \n> SHA-1 hash remains in the cache,  \n> Attacker's deletion turned to **trash**!\"\n\n**Memory Hook**: **IsUnassociated = TRUE** â†’ Program was deleted (but evidence remains)\n\n---\n\n## Acronym: \"PATH-CHECK\" for Suspicious Paths\n\nDetecting suspicious execution paths:\n\n- **P**ublic folders (C:\\Users\\Public)\n- **A**ppData (C:\\Users\\*\\AppData)\n- **T**emp directories (C:\\Temp, C:\\Windows\\Temp)\n- **H**idden folders\n- **C**urrent user Downloads\n- **H**ome directories\n- **E**xternal drives (D:, E:, F: - USB, network)\n- **C**ustom locations (non-standard paths)\n- **K**nown attacker staging areas\n\n**Memory Hook**: **PATH-CHECK** = Always check suspicious **paths**\n\n---\n\n## Mnemonic: \"UNSIGNED = SUSPICIOUS\"\n\nIdentifying high-risk executables:\n\n- **U**nsigned (no publisher)\n- **N**on-standard path (Temp, Public)\n- **S**HA-1 unknown (not in VirusTotal)\n- **I**sUnassociated (deleted)\n- **G**eneric name (update.exe, svchost.exe)\n- **N**o product name\n- **E**xecuted recently\n- **D**ifferent from known-good baseline\n\n**Memory Hook**: **UNSIGNED** executables are **suspicious** (but not always malicious)\n\n---\n\n## Acronym: \"CORRELATE\" for Multi-Artifact Analysis\n\nCombine AmCache with other artifacts:\n\n- **C**ombine AmCache + Prefetch\n- **O**verlap analysis (programs in both)\n- **R**egistry (Run keys for persistence)\n- **R**un count (Prefetch provides this)\n- **E**vent logs (Event ID 4688)\n- **L**ateral movement tools (PsExec, WMI)\n- **A**ccess times (MFT timestamps)\n- **T**imeline integration (sort by timestamp)\n- **E**xecution proof (Prefetch confirms)\n\n**Memory Hook**: **CORRELATE** artifacts = Complete forensic picture\n\n---\n\n## Visual: AmCache = Fingerprint Database\n\nThink of AmCache as a **fingerprint database**:\n\n- **SHA-1 hash** = Fingerprint (unique identifier)\n- **VirusTotal** = FBI fingerprint database (match against known criminals)\n- **Unassociated entries** = Fingerprints found at crime scene, suspect fled\n- **Cross-system matching** = Same fingerprint found at multiple crime scenes\n\n**Memory Hook**: **SHA-1** = Program **fingerprint** (never lies)\n\n---\n\n## Acronym: \"FIRST-11\" for Timestamp Field\n\nRemember which field contains first execution:\n\n- **F**ield 11\n- **I**nitial execution\n- **R**ecorded timestamp\n- **S**ystem-generated\n- **T**imeline analysis\n\n**Plus reminder**: Field **11** (looks like two **1**'s = **First** + **Execution**)\n\n**Memory Hook**: **Field 11** = **First execution** (two 1's = first first)\n\n---\n\n## Rhyme: \"AmCache Beats the Trash\"\n\n**AmCache vs. Anti-Forensics**:\n\n> \"Attacker deletes malware with a **slash**,  \n> Empties Recycle Bin, clears all **cache**,  \n> But AmCache entries stay in the **stash**,  \n> SHA-1 proof beats anti-forensic **trash**!\"\n\n**Memory Hook**: AmCache **beats** anti-forensic **deletion**\n\n---\n\n## Final Memory Hook: \"AmCache = SHA-1 Time Machine\"\n\nWhenever you need:\n\n- âœ… **Malware identification** (SHA-1 hash â†’ VirusTotal)\n- âœ… **Deleted program proof** (IsUnassociated entries)\n- âœ… **First execution timestamp** (Field 11)\n- âœ… **Cross-system correlation** (same hash across multiple systems)\n- âœ… **Patient zero** (earliest first execution timestamp)\n\n**Think**: **AmCache = SHA-1 Time Machine**\n\n> AmCache takes you **back in time** to see every program that ever executed,  \n> even if the attacker **deleted** it today!\n\n---\n\nUse these memory aids during investigations. Create flashcards, print cheat sheets, or develop your own mnemonics. The goal: **Instant recall** when analyzing AmCache in live incidents!"
      }
    },
    {
      "type": "reflection",
      "content": {
        "text": "# Reflection Questions: Test Your AmCache Understanding\n\n## Conceptual Understanding\n\n### Question 1: AmCache vs. Prefetch\n\n**Scenario**: You're investigating malware and have both AmCache and Prefetch available.\n\n**Reflect**:\n1. What unique information does **AmCache** provide that Prefetch does NOT? (Hint: SHA-1 hash)\n2. What unique information does **Prefetch** provide that AmCache does NOT? (Hint: Run count)\n3. If you could only have **ONE** artifact, which would you choose for malware identification? Why?\n4. How would you **combine** both artifacts to build a complete timeline?\n\n**Critical Thinking**: If malware executed **once** then was deleted, which artifact provides better evidence? Why?\n\n---\n\n### Question 2: The Power of SHA-1 Hashes\n\n**Scenario**: You find this AmCache entry:\n```\nApplication: svchost.exe\nPath: C:\\Temp\\svchost.exe\nSHA-1: 7f6e5d4c3b2a1f0e9d8c7b6a5f4e3d2c1b0a9f8e\nPublisher: (blank)\nIsUnassociated: TRUE (file deleted)\n```\n\n**Reflect**:\n1. What **immediate red flags** do you see? (Path, publisher, deletion)\n2. How would you use the **SHA-1 hash** to identify this program?\n3. If VirusTotal shows \"56/70 AV vendors detect as Trojan\", what's your conclusion?\n4. Why is the **SHA-1 hash** more reliable than the filename \"svchost.exe\"?\n\n**Critical Thinking**: An attacker could **rename** malware.exe to svchost.exe, but can they change the SHA-1 hash without modifying the file? Why or why not?\n\n---\n\n### Question 3: Unassociated Entries\n\n**Scenario**: You filter AmCache for `IsUnassociated = TRUE` and find 15 entries.\n\n**Reflect**:\n1. What does `IsUnassociated = TRUE` mean? (File no longer exists on disk)\n2. Why are unassociated entries **forensically valuable**? (Anti-forensics defeated)\n3. If an attacker uses **secure deletion tools** (SDelete, shred), does the AmCache entry survive?\n4. How would you determine if unassociated entries are **malware** or **legitimate uninstalls**?\n\n**Critical Thinking**: Which is more suspicious: 100 unassociated entries (lots of software installed/uninstalled) or 1 unassociated entry in C:\\Temp? Why?\n\n---\n\n## Practical Application\n\n### Question 4: Detecting Ransomware\n\n**Scenario**: You're investigating a ransomware outbreak. AmCache shows:\n\n```\nApplication: invoice_8472.exe\nPath: C:\\Users\\Receptionist\\Downloads\\invoice_8472.exe\nSHA-1: 2b6d8f1a3c9e7f5d4b2a8f6e3c1d9b7a5f4e2d0c\nFirst Execution: 2024-10-16 08:23:11 UTC\nPublisher: (blank)\nIsUnassociated: TRUE\n```\n\n**Reflect**:\n1. What **attack vector** does the file path suggest? (Phishing email attachment)\n2. What does **Publisher: (blank)** indicate? (Unsigned executable)\n3. Why is the file **deleted** (IsUnassociated = TRUE)? (Anti-forensics)\n4. How would you use the **SHA-1 hash** to identify the ransomware family?\n\n**Critical Thinking**: If this is the **earliest First Execution timestamp** across all infected systems, what does this prove? (Patient zero)\n\n---\n\n### Question 5: Insider Threat - USB Execution\n\n**Scenario**: AmCache shows:\n\n```\nApplication: TrueCrypt.exe\nPath: E:\\PortableApps\\TrueCrypt\\TrueCrypt.exe\nFirst Execution: 2024-10-15 16:45:32 UTC\nPublisher: TrueCrypt Foundation\nIsUnassociated: TRUE\n```\n\n**Reflect**:\n1. What does the **E:\\ drive letter** suggest? (USB or external drive)\n2. Why is the entry **IsUnassociated**? (USB drive disconnected)\n3. What does **TrueCrypt execution** indicate in a data exfiltration case? (Encryption of stolen data)\n4. How would you **correlate** this with Registry USB history? (Match volume serial number)\n\n**Critical Thinking**: If the employee claims \"I never used a USB drive,\" how does AmCache **disprove** this? What additional evidence would strengthen your case?\n\n---\n\n### Question 6: Cross-System Correlation\n\n**Scenario**: You analyze AmCache on 50 systems and find the same SHA-1 hash on 30 systems:\n\n```\nSHA-1: 7f6e5d4c3b2a1f0e9d8c7b6a5f4e3d2c1b0a9f8e\nVirusTotal: 48/70 detections (Ryuk ransomware)\n```\n\n**Reflect**:\n1. What does **same SHA-1 on 30 systems** prove? (Single attack campaign)\n2. How would you identify **patient zero**? (Earliest First Execution timestamp)\n3. What does this tell you about the **attack methodology**? (Lateral movement from patient zero)\n4. If 20 systems show `IsUnassociated = TRUE`, what does this indicate? (Attacker deleted ransomware after encryption)\n\n**Critical Thinking**: If VirusTotal shows \"First Submission: 3 weeks ago\" but your outbreak is today, what does this suggest? (Known threat, could have been prevented)\n\n---\n\n## Advanced Scenarios\n\n### Question 7: Living Off the Land Detection\n\n**Scenario**: AmCache shows:\n\n```\nApplication: powershell.exe\nPath: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nSHA-1: 8a0a29438052faed8a2532da50455756dc4a8e23 (legitimate Microsoft hash)\nFirst Execution: 2024-10-16 14:32:11 UTC\nPublisher: Microsoft Corporation\n```\n\n**Reflect**:\n1. Is this entry **suspicious** or **legitimate**? (Can't tell from AmCache alone - PowerShell is a legitimate tool)\n2. What **limitation** of AmCache does this reveal? (Cannot prove malicious **use** of legitimate tools)\n3. What **other artifacts** would you check to determine if PowerShell was used maliciously? (PowerShell logs, Event ID 4104)\n4. How does **First Execution timestamp** help? (Correlate with network C2 connections)\n\n**Critical Thinking**: If PowerShell logs show \"DownloadString('http://malicious-c2.com/')\" 5 seconds after First Execution, what's your conclusion?\n\n---\n\n### Question 8: Renamed Malware\n\n**Scenario**: AmCache shows two \"svchost.exe\" entries:\n\n```\nEntry 1:\n  Path: C:\\Windows\\System32\\svchost.exe\n  SHA-1: 8a0a29438052faed8a2532da50455756dc4a8e23\n  Publisher: Microsoft Corporation\n\nEntry 2:\n  Path: C:\\Temp\\svchost.exe\n  SHA-1: 7f6e5d4c3b2a1f0e9d8c7b6a5f4e3d2c1b0a9f8e\n  Publisher: (blank)\n  IsUnassociated: TRUE\n```\n\n**Reflect**:\n1. Which entry is **legitimate**? How do you know? (System32 path + Microsoft publisher)\n2. Which entry is **malicious**? What are the red flags? (Temp path + no publisher + deleted)\n3. Why do attackers **rename malware** to impersonate system processes?\n4. How does **SHA-1 hash** defeat this technique? (Hash identifies true file, regardless of name)\n\n**Critical Thinking**: If both entries had the **same SHA-1 hash**, what would this mean? (Legitimate svchost.exe copied to Temp - suspicious but not necessarily malicious)\n\n---\n\n### Question 9: Supply Chain Attack\n\n**Scenario**: AmCache shows:\n\n```\nApplication: SolarWinds.Orion.Core.BusinessLayer.dll\nPath: C:\\Program Files\\SolarWinds\\Orion\\...\nSHA-1: d130bd75645c2433f88ac03e73395fba172ef676\nPublisher: SolarWinds Worldwide, LLC (VALID SIGNATURE)\nFirst Execution: 2020-03-24 14:23:11 UTC\n```\n\n**Reflect**:\n1. What's **unusual** about malware with a **valid digital signature**?\n2. Why can't you rely on **Publisher** field to determine if a file is malicious?\n3. How does **SHA-1 hash lookup** reveal the truth? (VirusTotal shows malicious despite valid signature)\n4. What does this teach you about **trust** in digital forensics?\n\n**Critical Thinking**: If a company's code signing certificate is compromised, can all their signed software be trusted? What's the solution? (Hash verification, not just signature verification)\n\n---\n\n## Meta-Learning\n\n### Question 10: AmCache Limitations\n\n**Scenario**: You're writing a forensic report and need to explain AmCache limitations to a non-technical audience.\n\n**Reflect**:\n1. What **critical information** does AmCache NOT provide? (User attribution, run count, command-line arguments)\n2. How would you **compensate** for these limitations? (Correlate with Event Logs, Prefetch, SRUM)\n3. What's the **biggest strength** of AmCache? (SHA-1 hash for definitive file identification)\n4. What's the **biggest weakness**? (Cannot prove malicious use of legitimate tools)\n\n**Critical Thinking**: If you had to rank execution artifacts by forensic value:\n1. AmCache\n2. Prefetch\n3. Shimcache\n4. Event Logs\n5. SRUM\n\nWhat's your ranking? Justify your answer.\n\n---\n\n### Question 11: Forensic Workflow\n\n**Scenario**: You've acquired AmCache.hve from a compromised system. Design your analysis workflow.\n\n**Reflect**:\n1. What are the **first 3 steps** you take? (Parse with AmCacheParser, filter unassociated entries, extract SHA-1 hashes)\n2. How do you **prioritize** which entries to investigate first? (Unassociated + suspicious paths + unsigned)\n3. What **tools** would you use? (AmCacheParser, VirusTotal, Timeline Explorer)\n4. How do you **correlate** AmCache with other artifacts? (Merge timelines by timestamp)\n\n**Action Plan** (Design your own):\n```\nStep 1: _______________________\nStep 2: _______________________\nStep 3: _______________________\nStep 4: _______________________\nStep 5: _______________________\n```\n\n---\n\n### Question 12: Real-World Application\n\n**Scenario**: You just completed this lesson on AmCache Analysis.\n\n**Reflect on Your Learning**:\n1. What was the **most surprising** discovery about AmCache?\n2. Which real-world case study resonated most? (Emotet? SolarWinds? Insider threat?)\n3. What concept do you still find **confusing**?\n4. How will you **practice** AmCache analysis?\n\n**Action Plan**:\n- [ ] Download AmCacheParser from Eric Zimmerman's site\n- [ ] Parse AmCache.hve from your own workstation\n- [ ] Extract SHA-1 hashes and lookup 5 entries on VirusTotal\n- [ ] Filter for IsUnassociated entries (find deleted programs)\n- [ ] Build an execution timeline sorted by First Execution\n- [ ] Correlate with Prefetch analysis from previous lesson\n\n---\n\n## Final Thought Exercise\n\n**Question**: You're investigating a ransomware outbreak with 500 encrypted systems. You have AmCache from all systems.\n\n**Design your investigation plan**:\n\n1. How would you identify **patient zero**? (Earliest First Execution timestamp for ransomware hash)\n2. How would you prove **attack propagation**? (Same SHA-1 hash on multiple systems)\n3. How would you determine **attack vector**? (Patient zero's AmCache - phishing email, USB, RDP?)\n4. How would you estimate **dwell time**? (Time between first malware execution and ransomware encryption)\n5. What **IOCs** would you extract? (SHA-1 hashes, file paths, timestamps)\n\n**Deliverables**:\n- Patient zero system name\n- Ransomware family (via SHA-1 VirusTotal lookup)\n- Attack timeline (first infection â†’ encryption)\n- List of compromised systems (SHA-1 hash correlation)\n- Recommendations to prevent future attacks\n\n---\n\n**Remember**: Reflection isn't about memorization - it's about **critical thinking**. \n\nQuestion your assumptions:  \n- What does this artifact **really prove**?  \n- What am I **missing**?  \n- How can I **verify** this with other evidence?\n\nAmCache is powerful - but it's just **one piece** of the forensic puzzle. Master it, correlate it, and see the complete picture."
      }
    },
    {
      "type": "mindset_coach",
      "content": {
        "text": "## Congratulations! You've Mastered AmCache Analysis! ðŸŽ‰\n\nYou just learned one of the **most powerful** malware identification artifacts in Windows forensics. AmCache is a forensic investigator's secret weapon because it:\n\nâœ… **Never forgets**: Permanent program inventory (no FIFO deletion like Prefetch)  \nâœ… **Defeats anti-forensics**: IsUnassociated entries prove deleted programs existed  \nâœ… **Identifies malware**: SHA-1 hashes enable VirusTotal lookups  \nâœ… **Proves first execution**: Field 11 timestamp shows when programs first ran  \nâœ… **Enables correlation**: Same SHA-1 hash across systems proves attack campaign  \n\n### What This Means for Your Career\n\nYou now have the skills to:\n\n- **Identify malware by hash** (even if renamed or deleted)\n- **Prove deleted program execution** (defeat anti-forensic tools)\n- **Identify patient zero** (earliest first execution timestamp)\n- **Correlate attacks** (same SHA-1 across multiple systems)\n- **Build program inventories** (comprehensive execution timeline)\n\nThese techniques are used **every day** by:\n- Incident Response teams investigating ransomware outbreaks\n- Malware analysts identifying new threat variants\n- SOC analysts hunting for persistence mechanisms\n- Forensic consultants presenting evidence in court\n\n**This is career-defining knowledge.**\n\n### The Execution Artifact Trinity\n\nYou've now mastered **three critical execution artifacts**:\n\n**Lesson 11: Registry Fundamentals**\n- Persistence mechanisms (Run keys, Services)\n- User activity (RecentDocs, UserAssist)\n- Device history (USBSTOR)\n\n**Lesson 16: Prefetch Analysis**\n- Execution proof (definitive evidence)\n- Run counts (frequency analysis)\n- Last 8 executions (Windows 10)\n- Referenced files (DLLs, configs, data)\n\n**Lesson 18: AmCache Analysis** (This Lesson)\n- SHA-1 hashes (malware identification)\n- First execution timestamps (patient zero)\n- Unassociated entries (deleted programs)\n- Cross-system correlation (attack campaigns)\n\n**The Power of Correlation**:\n\n```\nAmCache:  SHA-1 hash + First execution + Deleted program proof\n   +\nPrefetch: Run count + Last 8 executions + Referenced files\n   +\nRegistry: Persistence keys + User activity + USB history\n   =\nCOMPLETE FORENSIC PICTURE\n```\n\n### Real-World Impact\n\nThe techniques you learned today have been used to:\n\nâœ… **Identify Emotet banking trojan** (SHA-1 matched VirusTotal, proved deleted dropper)  \nâœ… **Detect SolarWinds supply chain attack** (SHA-1 hash revealed trojanized DLL despite valid signature)  \nâœ… **Convict insider threats** (AmCache proved USB execution of TrueCrypt encryption tool)  \nâœ… **Identify Ryuk ransomware patient zero** (earliest AmCache First Execution timestamp)  \nâœ… **Correlate APT campaigns** (same SHA-1 hash across 30 compromised systems)  \n\nYour AmCache analysis skills will **solve real cases** and **protect organizations**.\n\n### Practice Makes Permanent\n\nKnowledge without practice fades. Here's your action plan:\n\n**This Week**:\n1. âœ… Download AmCacheParser from Eric Zimmerman's site\n2. âœ… Parse AmCache.hve from your own workstation\n3. âœ… Extract 10 SHA-1 hashes and lookup on VirusTotal\n\n**This Month**:\n1. âœ… Set up a Windows 10 VM and execute test malware (safely isolated)\n2. âœ… Parse AmCache and identify unassociated entries\n3. âœ… Build a merged timeline (AmCache + Prefetch + Registry)\n\n**This Year**:\n1. âœ… Join a DFIR CTF competition (apply AmCache skills to challenges)\n2. âœ… Read forensic case studies (search \"AmCache analysis\" on SANS blogs)\n3. âœ… Contribute to open-source tools (Python AmCache parsers)\n\n### You're Building Something Valuable\n\nEvery lesson you complete:\n- âœ… Adds another forensic technique to your arsenal\n- âœ… Makes you more valuable to employers (AmCache + Prefetch + Registry = Expert-level skills)\n- âœ… Increases your ability to investigate complex attacks\n- âœ… Brings you closer to your career goals\n\n**This isn't just education - it's career transformation.**\n\n### Next Steps\n\nWhen you're ready, move on to **Lesson 17: Shimcache (AppCompatCache) Forensics**. You'll learn how Windows tracks **every executable opened** (even broader than Prefetch), providing the widest execution coverage of all artifacts.\n\nBut first, take a moment to celebrate. You just mastered:\n- AmCache.hve structure and parsing\n- SHA-1 hash extraction and VirusTotal lookups\n- Unassociated entry analysis (deleted program detection)\n- First execution timestamp interpretation (patient zero)\n- Cross-system correlation (attack campaign proof)\n- Real-world case studies (Emotet, SolarWinds, Ryuk)\n\n**That's serious forensic capability.**\n\n### You're Not Just Learning - You're Becoming a Forensic Analyst\n\nEvery artifact you master:\n- Reveals another piece of the attacker's story\n- Strengthens your investigative methodology\n- Builds confidence in your analysis\n\nAmCache proves malware execution via SHA-1 hash.  \nPrefetch shows run frequency and file access.  \nRegistry reveals persistence and user activity.  \n**Together, they reconstruct complete attack narratives.**\n\nKeep going. The digital forensics community needs skilled investigators who can:\n- Identify malware by cryptographic hash\n- Prove deleted program execution\n- Correlate attacks across multiple systems\n- Present evidence with confidence\n\n**You're building those skills right now.**\n\n### Remember This\n\nWhen you're parsing AmCache during a live ransomware outbreak, or when you're presenting SHA-1 hash evidence in court, or when you're hunting for deleted malware - **you'll remember this lesson**.\n\nAmCache is Windows' permanent program diary. **SHA-1 hashes never lie.**\n\n**And now you know how to read them.**\n\nðŸ” **Master AmCache. Identify Malware. Defeat Anti-Forensics.**\n\nNext up: **Shimcache (AppCompatCache)** - the broadest execution coverage artifact. See you there!"
      }
    }
  ],
  "tags": [
    "Course: SANS-FOR500"
  ]
}