{
  "lesson_id": "1b2c3d4e-5f6a-7b8c-9d0e-1f2a3b4c5d6e",
  "domain": "blue_team",
  "title": "OpenCTI: Cyber Threat Intelligence Knowledge Platform",
  "difficulty": 2,
  "order_index": 12,
  "prerequisites": [
    "blue_team_11"
  ],
  "concepts": [
    "Cyber threat intelligence platforms",
    "OpenCTI architecture",
    "STIX 2.1 knowledge graphs",
    "Threat actors and campaigns",
    "TTPs and observables",
    "Intelligence connectors",
    "Threat hunting workflows",
    "CTI automation"
  ],
  "estimated_time": 60,
  "learning_objectives": [
    "Understand OpenCTI's knowledge graph approach to threat intelligence",
    "Create and manage threat intelligence entities and relationships",
    "Use connectors to import external threat feeds",
    "Conduct threat actor tracking and campaign analysis",
    "Integrate OpenCTI with security operations tools"
  ],
  "post_assessment": [
    {
      "question": "What makes OpenCTI different from traditional threat intelligence platforms?",
      "options": [
        "It only works with YARA rules",
        "It uses a knowledge graph to model relationships between threat entities",
        "It focuses solely on malware analysis",
        "It cannot integrate with external feeds"
      ],
      "correct_answer": 1,
      "explanation": "OpenCTI's key differentiator is its knowledge graph approach based on STIX 2.1, which models complex relationships between threat actors, malware, TTPs, infrastructure, and victims.",
      "question_id": "296fbf58-bb56-41dc-98db-7af309778b8e",
      "type": "multiple_choice",
      "difficulty": 2
    },
    {
      "question": "Which standard does OpenCTI use for representing threat intelligence?",
      "options": [
        "XML",
        "STIX 2.1",
        "JSON-LD only",
        "Custom proprietary format"
      ],
      "correct_answer": 1,
      "explanation": "OpenCTI is built on STIX 2.1 (Structured Threat Information Expression), the industry standard for representing and exchanging cyber threat intelligence.",
      "question_id": "39f0f2af-533e-4f44-aaea-9d5765603ee1",
      "type": "multiple_choice",
      "difficulty": 2
    }
  ],
  "jim_kwik_principles": [
    "active_learning",
    "meta_learning",
    "memory_hooks",
    "minimum_effective_dose",
    "teach_like_im_10",
    "connect_to_what_i_know",
    "reframe_limiting_beliefs",
    "gamify_it",
    "learning_sprint",
    "multiple_memory_pathways"
  ],
  "content_blocks": [
    {
      "type": "mindset_coach",
      "content": {
        "text": "Welcome to the future of threat intelligence! ğŸ§ ğŸ”—\n\nImagine trying to understand a sophisticated cyberattack by looking at scattered puzzle pieces: an IP address here, a malware sample there, some TTPs somewhere else. Traditional threat intelligence tools show you these pieces separately. **OpenCTI connects them all into a living, breathing knowledge graph.**\n\nThink of it like this:\n- **MISP** = Library catalog (organized IOCs)\n- **OpenCTI** = Living encyclopedia with connections between everything\n\n**Mindset shift**: Modern threat intelligence isn't just about collecting IOCsâ€”it's about understanding **relationships**. Who's attacking? Why? How do their tools relate? What campaigns are they running? OpenCTI answers these questions visually.\n\nYou're about to learn how organizations like ANSSI (French cybersecurity agency) and CERT-EU track sophisticated threat actors. Let's build threat intelligence that tells a story! ğŸ“ŠğŸ¯"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "## What is OpenCTI?\n\n**OpenCTI (Open Cyber Threat Intelligence Platform)** is an open-source platform developed by Filigran (in collaboration with ANSSI, French National Cybersecurity Agency) for managing and analyzing cyber threat intelligence using a knowledge graph approach.\n\n### The Evolution: From IOCs to Knowledge Graphs\n\n**Traditional CTI Platforms** (e.g., MISP):\n```\nEvent: APT29 Campaign\nâ”œâ”€ IP: 192.0.2.100\nâ”œâ”€ Domain: evil.com\nâ”œâ”€ Hash: abc123def456...\nâ””â”€ Tag: APT29\n```\n\nGood for IOC management, but lacks context.\n\n**OpenCTI Knowledge Graph Approach**:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Threat Actor â”‚\nâ”‚    APT29     â”‚â”€â”€â”€â”€â”€â”€usesâ”€â”€â”€â”€â”€â”€â”\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚\n       â”‚                        â–¼\n       â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n       â”‚                   â”‚ Malware  â”‚\n       â”‚                   â”‚ SUNBURSTâ”‚\n       â”‚                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜\n       â”‚                        â”‚\n       â”‚                   communicates\n       â”‚                        â”‚\n       â”‚                        â–¼\n   targets                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n       â”‚                  â”‚  Server  â”‚\n       â”‚                  â”‚192.0.2.100â”‚\n       â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n       â–¼\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚ Sector  â”‚\n  â”‚Governmentâ”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nEvery entity and relationship is structured, queryable, and visualized.\n\n### Core Concepts\n\n**1. Knowledge Graph**\nA network of interconnected threat intelligence entities:\n- **Nodes**: Threat actors, malware, infrastructure, vulnerabilities\n- **Edges**: Relationships (uses, targets, attributed-to, mitigates)\n\n**2. STIX 2.1 Compliance**\nBuilt entirely on STIX 2.1 standard:\n- **SDOs (STIX Domain Objects)**: Attack Pattern, Campaign, Threat Actor, Malware, Tool\n- **SCOs (STIX Cyber Observables)**: IPv4 Address, Domain, File Hash, Email Address\n- **SROs (STIX Relationship Objects)**: Relationships between entities\n\n**3. Entity Types in OpenCTI**\n\n**Strategic Level**:\n- **Threat Actors**: APT29, Lazarus Group, FIN7\n- **Intrusion Sets**: Campaigns by threat actors\n- **Campaigns**: Specific operations (SolarWinds Supply Chain Attack)\n\n**Tactical Level**:\n- **Attack Patterns**: MITRE ATT&CK techniques (T1059.001 - PowerShell)\n- **Malware**: SUNBURST, Cobalt Strike, Mimikatz\n- **Tools**: Legitimate tools used maliciously (PsExec, WMI)\n\n**Technical Level**:\n- **Observables**: IPs, domains, hashes, registry keys\n- **Indicators**: Patterns for detection (YARA, Sigma, Snort rules)\n- **Infrastructure**: C2 servers, phishing domains\n\n**Contextual**:\n- **Victims**: Organizations, sectors, regions\n- **Vulnerabilities**: CVEs exploited\n- **Reports**: Analysis documents from vendors\n\n### Why OpenCTI Matters\n\n**Scenario**: Your SIEM alerts on a suspicious IP (198.51.100.42)\n\n**Without OpenCTI**:\n- Google the IP\n- Check VirusTotal\n- Search MISP\n- Manually correlate findings\n- Time: 30-45 minutes\n\n**With OpenCTI**:\n1. Search for IP in OpenCTI\n2. See knowledge graph:\n   - IP â†’ Used by APT29\n   - APT29 â†’ Targets government sector\n   - APT29 â†’ Uses SUNBURST malware\n   - SUNBURST â†’ Exploits CVE-2020-1234\n   - Related campaigns: SolarWinds attack\n3. Full context in 2 minutes\n\n**Actionable intelligence**:\n- \"This is APT29 infrastructure\"\n- \"Check for SUNBURST indicators\"\n- \"Review logs for TTPs: T1059.001, T1003\"\n- \"Alert CISO: Nation-state threat\""
      }
    },
    {
      "type": "video",
      "content": {
        "title": "Video: OpenCTI Platform Overview and Architecture",
        "url": "https://www.youtube.com/embed/lBeVV2Vd3Uw",
        "description": "Watch this comprehensive introduction to OpenCTI's knowledge graph approach to threat intelligence."
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "## OpenCTI Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                 OPENCTI WEB UI (React)                 â”‚\nâ”‚   â€¢ Knowledge Graph Visualization                      â”‚\nâ”‚   â€¢ Entity Management                                  â”‚\nâ”‚   â€¢ Analysis Workbench                                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                  â”‚\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              OPENCTI BACKEND (Node.js)                 â”‚\nâ”‚   â€¢ GraphQL API                                        â”‚\nâ”‚   â€¢ RBAC (Role-Based Access Control)                   â”‚\nâ”‚   â€¢ Data Enrichment Engine                             â”‚\nâ”‚   â€¢ Connector Management                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                  â”‚\n      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n      â”‚           â”‚           â”‚\nâ”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  MinIO     â”‚ â”‚ Redis â”‚ â”‚ElasticSearchâ”‚\nâ”‚ (Files)    â”‚ â”‚(Cache)â”‚ â”‚  (Search)   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n      â”‚\n      â”‚\nâ”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚           GRAKN/TYPEDB (Knowledge Graph DB)           â”‚\nâ”‚  Stores entities and relationships as graph           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n      â–²\n      â”‚ Connectors feed data\n      â”‚\nâ”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              OPENCTI CONNECTORS                       â”‚\nâ”‚  â€¢ External Import (MITRE ATT&CK, MISP, etc.)        â”‚\nâ”‚  â€¢ Internal Enrichment (VirusTotal, AbuseIPDB)       â”‚\nâ”‚  â€¢ Stream Consumers (Export to SIEM, SOAR)           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Installation (Docker Compose - Recommended)\n\n```yaml\n# docker-compose.yml\nversion: '3'\nservices:\n  redis:\n    image: redis:7.2.4\n    restart: always\n    \n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.3\n    environment:\n      - discovery.type=single-node\n      - xpack.security.enabled=false\n    restart: always\n    \n  minio:\n    image: minio/minio:latest\n    command: server /data\n    environment:\n      MINIO_ROOT_USER: opencti\n      MINIO_ROOT_PASSWORD: changeme\n    restart: always\n    \n  rabbitmq:\n    image: rabbitmq:3.13-management\n    restart: always\n    \n  opencti:\n    image: opencti/platform:5.12.17\n    environment:\n      - NODE_OPTIONS=--max-old-space-size=8096\n      - APP__PORT=8080\n      - APP__ADMIN__EMAIL=admin@opencti.io\n      - APP__ADMIN__PASSWORD=changeme\n      - APP__ADMIN__TOKEN=changeme-token\n      - REDIS__HOSTNAME=redis\n      - ELASTICSEARCH__URL=http://elasticsearch:9200\n      - MINIO__ENDPOINT=minio\n      - RABBITMQ__HOSTNAME=rabbitmq\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      - redis\n      - elasticsearch\n      - minio\n      - rabbitmq\n    restart: always\n    \n  worker:\n    image: opencti/worker:5.12.17\n    environment:\n      - OPENCTI_URL=http://opencti:8080\n      - OPENCTI_TOKEN=changeme-token\n    depends_on:\n      - opencti\n    restart: always\n    \n  connector-mitre:\n    image: opencti/connector-mitre:5.12.17\n    environment:\n      - OPENCTI_URL=http://opencti:8080\n      - OPENCTI_TOKEN=changeme-token\n      - CONNECTOR_ID=mitre-connector\n      - CONNECTOR_NAME=MITRE ATT&CK\n      - CONNECTOR_SCOPE=marking-definition,identity,attack-pattern,intrusion-set,malware,tool\n      - MITRE_INTERVAL=7 # Days between updates\n    depends_on:\n      - opencti\n    restart: always\n```\n\n```bash\n# Deploy OpenCTI\ndocker-compose up -d\n\n# Access at http://localhost:8080\n# Default credentials: admin@opencti.io / changeme\n\n# Check logs\ndocker-compose logs -f opencti\n```"
      }
    },
    {
      "type": "code_exercise",
      "content": {
        "title": "Hands-On: Create APT29 Threat Actor Profile",
        "description": "Build a comprehensive threat actor knowledge graph",
        "code": "# ============================================\n# METHOD 1: Using OpenCTI Web UI\n# ============================================\n\n# Step 1: Create Threat Actor\nAnalysis â†’ Threats â†’ Threat Actors â†’ Create\n\nName: APT29 (Cozy Bear)\nAliases: The Dukes, CozyDuke, Nobelium\nDescription: Russian state-sponsored APT group attributed to SVR\nSophistication: Strategic\nResource Level: Government\nPrimary Motivation: Espionage\nGoals: Intelligence gathering from government, diplomatic, and defense targets\nFirst Seen: 2008-01-01\nCountry: Russia\nConfidence: High\n\n# Step 2: Create Associated Malware\nArsenal â†’ Malware â†’ Create\n\nName: SUNBURST\nAliases: Solorigate\nMalware Type: Backdoor\nDescription: Supply chain backdoor distributed via SolarWinds Orion\nFirst Seen: 2020-03-01\nKill Chain Phases: Installation, C2\n\n# Create relationship:\nAPT29 â†’ uses â†’ SUNBURST\n\n# Step 3: Create Campaign\nThreats â†’ Campaigns â†’ Create\n\nName: SolarWinds Supply Chain Attack\nDescription: Sophisticated supply chain compromise affecting 18,000+ organizations\nFirst Seen: 2020-03-01\nLast Seen: 2020-12-13 (discovery date)\nObjective: Cyber espionage\n\n# Create relationships:\nAPT29 â†’ attributed-to â†’ SolarWinds Campaign\nSolarWinds Campaign â†’ uses â†’ SUNBURST\n\n# Step 4: Add TTPs (MITRE ATT&CK)\nTechniques â†’ Attack Patterns â†’ Search \"T1195.002\"\n\n# Link to campaign:\nSolarWinds Campaign â†’ uses â†’ T1195.002 (Supply Chain Compromise: Software)\n\n# Add more TTPs:\n- T1059.001 (PowerShell)\n- T1003.001 (LSASS Memory)\n- T1071.001 (Web Protocols for C2)\n\n# Step 5: Add Infrastructure\nObservations â†’ Infrastructure â†’ Create\n\nType: IPv4-Addr\nValue: 20.140.0.1\nDescription: C2 server for SUNBURST\n\n# Link:\nSUNBURST â†’ communicates-with â†’ 20.140.0.1\n\n# Step 6: Add Victims\nEntities â†’ Sectors â†’ Government\n\n# Link:\nAPT29 â†’ targets â†’ Government Sector\n\n# Result: Complete knowledge graph showing:\n# APT29 â†’ attributed-to â†’ SolarWinds Campaign\n#      â†’ uses â†’ SUNBURST malware  \n#            â†’ communicates-with â†’ C2 IP\n#            â†’ uses â†’ ATT&CK techniques\n#      â†’ targets â†’ Government sector\n\n# ============================================\n# METHOD 2: Using OpenCTI Python API\n# ============================================\n\nfrom pycti import OpenCTIApiClient\nfrom datetime import datetime\n\n# Initialize client\napi_url = 'http://localhost:8080'\napi_token = 'YOUR_API_TOKEN'\nclient = OpenCTIApiClient(api_url, api_token)\n\n# Create Threat Actor\nthreat_actor = client.threat_actor.create(\n    name='APT29',\n    aliases=['Cozy Bear', 'The Dukes', 'Nobelium'],\n    description='Russian state-sponsored APT group',\n    sophistication='strategic',\n    resource_level='government',\n    primary_motivation='espionage',\n    first_seen=datetime(2008, 1, 1),\n    confidence=90\n)\n\nprint(f\"Created Threat Actor: {threat_actor['id']}\")\n\n# Create Malware\nmalware = client.malware.create(\n    name='SUNBURST',\n    aliases=['Solorigate'],\n    description='Supply chain backdoor via SolarWinds',\n    malware_types=['backdoor'],\n    is_family=False,\n    first_seen=datetime(2020, 3, 1)\n)\n\nprint(f\"Created Malware: {malware['id']}\")\n\n# Create Relationship: APT29 uses SUNBURST\nrelationship = client.stix_core_relationship.create(\n    fromId=threat_actor['id'],\n    toId=malware['id'],\n    relationship_type='uses',\n    description='APT29 deployed SUNBURST in SolarWinds attack',\n    confidence=95,\n    start_time=datetime(2020, 3, 1)\n)\n\nprint(f\"Created relationship: {relationship['id']}\")\n\n# Add Observable (C2 IP)\nobservable = client.stix_cyber_observable.create(\n    observableData={\n        'type': 'ipv4-addr',\n        'value': '20.140.0.1'\n    }\n)\n\n# Link malware to C2\nclient.stix_core_relationship.create(\n    fromId=malware['id'],\n    toId=observable['id'],\n    relationship_type='communicates-with',\n    description='SUNBURST C2 infrastructure'\n)\n\nprint(\"[âœ“] APT29 knowledge graph created!\")",
        "language": "python",
        "difficulty": "intermediate"
      }
    },
    {
      "type": "explanation",
      "content": {
        "text": "## Working with OpenCTI: Key Operations\n\n### 1. Knowledge Graph Exploration\n\n**Pivot Drilling**:\n\nStarting point: You detect malware \"SUNBURST\" on a host.\n\n```\n1. Search for \"SUNBURST\" in OpenCTI\n2. View Knowledge Graph\n3. See relationships:\n   â”œâ”€ Used by: APT29\n   â”œâ”€ Communicates with: [5 C2 IPs]\n   â”œâ”€ Part of campaign: SolarWinds Attack\n   â”œâ”€ Uses TTPs: [12 ATT&CK techniques]\n   â””â”€ Targets: Government, Tech sectors\n4. Click APT29 â†’ See all their malware, campaigns, TTPs\n5. Click Government sector â†’ See all threats targeting this sector\n```\n\n**Visual Graph Navigation**:\n- Drag nodes to rearrange\n- Click edges to see relationship details\n- Right-click entity â†’ \"Expand relationships\"\n- Export graph as PNG for reports\n\n### 2. Connectors (Intelligence Sources)\n\n**External Import Connectors** (bring data IN):\n\n```\nMITRE ATT&CK â†’ Imports all techniques, tactics, groups\nMISP â†’ Syncs events from MISP instances\nAlienVault OTX â†’ Imports pulses and IOCs\nOpenCTI Datasets â†’ Threat actor profiles\nCVE â†’ Vulnerability data from NVD\nAbuseIPDB â†’ Malicious IP reputation\nURLhaus â†’ Malicious URL feeds\n```\n\n**Internal Enrichment Connectors** (enhance existing data):\n\n```\nVirusTotal â†’ Enrich file hashes with VT reports\nShodanInternetDB â†’ Enrich IPs with Shodan data\nIPInfo â†’ Geolocation for IPs\nCyberCrime-Tracker â†’ Enrich C2 infrastructure\n```\n\n**Stream Connectors** (push data OUT):\n\n```\nElastic Security â†’ Export indicators to Elastic SIEM\nSplunk â†’ Push IOCs to Splunk\nTanium â†’ Deploy threat hunting queries\nSentinelOne â†’ Update EDR with latest threats\n```\n\n**Installing a Connector** (Docker example):\n\n```yaml\n# Add to docker-compose.yml\nconnector-virustotal:\n  image: opencti/connector-virustotal:5.12.17\n  environment:\n    - OPENCTI_URL=http://opencti:8080\n    - OPENCTI_TOKEN=changeme-token\n    - CONNECTOR_ID=virustotal-enrichment\n    - CONNECTOR_NAME=VirusTotal\n    - CONNECTOR_SCOPE=StixFile\n    - VIRUSTOTAL_TOKEN=YOUR_VT_API_KEY\n  restart: always\n```\n\n### 3. Analysis Workflows\n\n**Scenario 1: Incident Investigation**\n\nYour EDR alerts on suspicious PowerShell execution.\n\n1. **Create Incident** in OpenCTI\n2. **Add Observables**: Extracted IOCs (IPs, hashes, commands)\n3. **Automatic Enrichment**: Connectors enrich observables\n4. **Relationship Discovery**: OpenCTI shows related threats\n5. **Pivot**: \"This IP was used by APT29 in past campaigns\"\n6. **Report Generation**: Export analysis for management\n\n**Scenario 2: Threat Actor Tracking**\n\nTrack APT29 activity over time:\n\n```\nSearch: APT29\nâ†’ View Timeline (all events chronologically)\nâ†’ Filter by: Campaigns, Malware, Infrastructure\nâ†’ See evolution of tactics over years\nâ†’ Identify current TTPs to defend against\n```\n\n**Scenario 3: Sector-Specific Intelligence**\n\nYou work in healthcare:\n\n```\nEntities â†’ Sectors â†’ Healthcare\nâ†’ View all threats targeting healthcare\nâ†’ See which threat actors, malware, campaigns\nâ†’ Export TTPs to hunt for in your environment\nâ†’ Share with healthcare ISAC\n```\n\n### 4. Threat Hunting with OpenCTI\n\n**Export IOCs for Hunting**:\n\n```python\nfrom pycti import OpenCTIApiClient\nimport csv\n\nclient = OpenCTIApiClient(api_url, api_token)\n\n# Get all observables related to APT29\napt29 = client.threat_actor.read(filters=[{'key': 'name', 'values': ['APT29']}])\n\n# Get related observables\nobservables = client.stix_cyber_observable.list(\n    filters=[{'key': 'relatedTo', 'values': [apt29['id']]}]\n)\n\n# Export to CSV for SIEM import\nwith open('apt29_iocs.csv', 'w') as f:\n    writer = csv.writer(f)\n    writer.writerow(['Type', 'Value', 'Description'])\n    \n    for obs in observables:\n        writer.writerow([\n            obs['entity_type'],\n            obs['observable_value'],\n            obs.get('description', '')\n        ])\n\nprint(\"IOCs exported for threat hunting\")\n```"
      }
    },
    {
      "type": "real_world",
      "content": {
        "text": "## Real-World Case Study: CERT-EU's OpenCTI Deployment\n\n**Organization**: CERT-EU (Computer Emergency Response Team for EU Institutions)\n\n**Challenge**: \n- Tracking 40+ APT groups targeting EU institutions\n- Correlating intelligence from 27 member states\n- Providing actionable intelligence to 70+ EU organizations\n- Managing 500,000+ threat indicators\n\n**Solution**: Deployed OpenCTI as central threat intelligence platform\n\n### Implementation Journey\n\n**Phase 1: Initial Setup** (Month 1-2)\n\n```\nDeployed OpenCTI with:\n- 12 external import connectors (MITRE, MISP, AlienVault, etc.)\n- 5 enrichment connectors (VirusTotal, Shodan, etc.)\n- 3 stream connectors (to member state SIEMs)\n```\n\n**Phase 2: Knowledge Graph Population** (Month 3-4)\n\nManually created profiles for:\n- 42 threat actors targeting EU (APT28, APT29, Lazarus, etc.)\n- 180 malware families observed\n- 35 campaigns against EU institutions\n- 2,500+ relationships between entities\n\n**Phase 3: Automation** (Month 5-6)\n\n```python\n# Automated daily workflow\n1. MISP connector imports IOCs from EU-ISAC\n2. VirusTotal enriches all new file hashes\n3. OpenCTI correlates new IOCs with existing threat actors\n4. If high-confidence match:\n   - Auto-create incident ticket\n   - Alert relevant member state CERT\n   - Push IOCs to member SIEMs via stream connector\n```\n\n### Real Incident: APT28 Phishing Campaign\n\n**Day 1 - Detection**:\n- Polish government reports phishing emails\n- Shares IOCs via MISP â†’ Auto-imported to OpenCTI\n- OpenCTI enriches email sender domain via passive DNS\n\n**Day 1 - Analysis**:\n- Analyst searches for sender IP in OpenCTI: `185.220.101.45`\n- Knowledge graph shows:\n  ```\n  IP 185.220.101.45\n    â”œâ”€ Used by: APT28 (Fancy Bear)\n    â”œâ”€ Part of campaign: \"EU Diplomatic Targets 2024\"\n    â”œâ”€ Related malware: Zebrocy\n    â””â”€ Previously targeted: 5 EU institutions\n  ```\n- **Instant context**: Known APT28 infrastructure\n\n**Day 2 - Proactive Defense**:\n- Queried OpenCTI: \"Show all APT28 infrastructure from last 6 months\"\n- Exported 247 IOCs (IPs, domains, hashes)\n- Pushed to all member state SIEMs via stream connector\n- Result: 4 additional member states found related activity in logs\n\n**Day 3 - Intelligence Sharing**:\n- Created comprehensive report in OpenCTI:\n  - Threat actor profile (APT28)\n  - TTPs used (MITRE ATT&CK T1566.001 - Spearphishing)\n  - Infrastructure (diagram exported from knowledge graph)\n  - Recommendations\n- Exported as STIX 2.1 bundle\n- Shared with NATO CCDCOE and Five Eyes\n\n**Outcome**:\n- **Detection speed**: 4 hours (vs. previous average of 3 days)\n- **Organizations protected**: 70+ EU institutions preemptively blocked IOCs\n- **False positives**: Zero (high-confidence attribution via graph)\n- **Intelligence shared**: 247 IOCs distributed automatically\n\n### Key Success Metrics (After 1 Year)\n\n```\nKnowledge Graph Size:\n- 42 Threat Actors\n- 1,200 Malware families/variants\n- 89 Campaigns\n- 450,000 Observables (IPs, domains, hashes)\n- 75,000 Relationships\n- 15,000 Attack Patterns (MITRE ATT&CK)\n\nOperational Impact:\n- Mean time to attribution: 4 hours â†’ 30 minutes\n- Intelligence reports produced: 1,200/year\n- Incidents prevented: 340+ (blocked via proactive IOC sharing)\n- Analyst efficiency: +250% (automated correlation)\n```\n\n**Quote from CERT-EU Director**:\n\n> \"OpenCTI transformed our threat intelligence from reactive IOC lists to proactive, contextualized intelligence. When we see an IP, we immediately know which APT group, which campaign, and which member states to alert. It's a game-changer.\"\n\n### Lessons Learned\n\n1. **Start with high-value targets**: Focus on APT groups actively targeting your sector\n2. **Invest in relationships**: Manually curate threat actor profiles initially\n3. **Automate enrichment**: Let connectors do the heavy lifting\n4. **Visualize for stakeholders**: Knowledge graphs make briefings impactful\n5. **Integrate with operations**: Stream connectors ensure intel reaches defenders"
      }
    },
    {
      "type": "memory_aid",
      "content": {
        "text": "## OpenCTI Framework: GRAPH\n\n**G**raph - Think in nodes (entities) and edges (relationships)\n**R**elate - Connect threat actors â†’ malware â†’ infrastructure â†’ victims\n**A**utomate - Use connectors, don't manual data entry\n**P**ivot - Start with one IOC, explore the entire threat landscape\n**H**unt - Export TTPs and IOCs for proactive defense\n\n### Entity Relationship Patterns\n\n```\nThreat Actor\n  â”œâ”€ attributed-to â†’ Campaign\n  â”œâ”€ uses â†’ Malware\n  â”œâ”€ uses â†’ Tool\n  â”œâ”€ uses â†’ Attack Pattern (TTPs)\n  â”œâ”€ targets â†’ Sector/Organization\n  â””â”€ located-in â†’ Country\n\nMalware\n  â”œâ”€ uses â†’ Attack Pattern\n  â”œâ”€ communicates-with â†’ Infrastructure (IP, Domain)\n  â”œâ”€ exploits â†’ Vulnerability (CVE)\n  â””â”€ drops â†’ File (Hash)\n\nCampaign\n  â”œâ”€ attributed-to â†’ Threat Actor\n  â”œâ”€ uses â†’ Malware/Tool\n  â”œâ”€ targets â†’ Sector/Organization\n  â””â”€ uses â†’ Infrastructure\n```\n\n### Quick Decision Matrix: OpenCTI vs MISP\n\n| Need | Use OpenCTI | Use MISP |\n|------|-------------|----------|\n| Track threat actor campaigns | âœ… | âŒ |\n| Share IOCs with partners | âš ï¸ | âœ… |\n| Visualize threat relationships | âœ… | âŒ |\n| Quick IOC lookup | âŒ | âœ… |\n| Strategic intelligence | âœ… | âŒ |\n| Tactical IOCs for IDS | âš ï¸ | âœ… |\n\n**Best practice**: Use both! OpenCTI for analysis, MISP for IOC sharing."
      }
    },
    {
      "type": "reflection",
      "content": {
        "question": "You're building a threat intelligence program from scratch. You have limited time and resources. Should you start with MISP, OpenCTI, or both? What factors would influence your decision?",
        "guidance": "Consider: (1) Primary use case (IOC sharing vs. threat actor tracking), (2) Team size and expertise, (3) Integration needs (SIEM, IDS, EDR), (4) Stakeholder requirements (exec briefings need context, SOC needs IOCs), (5) Maturity model (tactical IOCs first, then strategic intel). Think about starting simple and evolving."
      }
    }
  ]
}